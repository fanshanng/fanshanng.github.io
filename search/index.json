[{"content":"1. ç®€ä»‹ (Introduction) AES (Advanced Encryption Standard)ï¼Œå³é«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ç›®å‰å…¨çƒæœ€å¹¿æ³›ä½¿ç”¨çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å®ƒç”±æ¯”åˆ©æ—¶å¯†ç å­¦å®¶ Joan Daemen å’Œ Vincent Rijmen è®¾è®¡ï¼ŒåŸå Rijndaelã€‚2001å¹´è¢« NIST æ­£å¼é‡‡çº³ä¸ºæ ‡å‡† (FIPS 197)ï¼Œç”¨ä»¥å–ä»£è€æ—§çš„ DESã€‚\n1.1 å…³é”®å‚æ•° åˆ†ç»„é•¿åº¦ (Block Size): å›ºå®šä¸º 128ä½ (16å­—èŠ‚)ã€‚ å¯†é’¥é•¿åº¦ (Key Length): æ”¯æŒ 128ã€192ã€256 ä½ã€‚æœ¬ç¬”è®°ä¸»è¦è®¨è®º AES-128ã€‚ è½®æ•° (Rounds): AES-128: 10 è½® AES-192: 12 è½® AES-256: 14 è½® 2. æ•°å­¦åŸºç¡€ (Mathematical Background) AES çš„è¿ç®—ä¸æ˜¯åœ¨æ™®é€šçš„æ•´æ•°åŸŸä¸Šè¿›è¡Œçš„ï¼Œè€Œæ˜¯åœ¨ æœ‰é™åŸŸ (Finite Field)ï¼Œç‰¹åˆ«æ˜¯ ä¼½ç½—ç“¦åŸŸ $GF(2^8)$ ä¸Šè¿›è¡Œçš„ã€‚è¿™ä¿è¯äº†è¿ç®—ç»“æœå§‹ç»ˆåœ¨ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰èŒƒå›´å†…ï¼Œä¸”å…·æœ‰è‰¯å¥½çš„éçº¿æ€§ç‰¹æ€§ã€‚\n2.1 å­—èŠ‚çš„è¡¨ç¤º ä¸€ä¸ªå­—èŠ‚ $b_7 b_6 b_5 b_4 b_3 b_2 b_1 b_0$ å¯ä»¥çœ‹ä½œæ˜¯ç³»æ•°ä¸º ${0, 1}$ çš„å¤šé¡¹å¼ï¼š $$ b(x) = b_7x^7 + b_6x^6 + b_5x^5 + b_4x^4 + b_3x^3 + b_2x^2 + b_1x + b_0 $$ ä¾‹å¦‚ï¼šåå…­è¿›åˆ¶ 0x57 (äºŒè¿›åˆ¶ 01010111) å¯¹åº”å¤šé¡¹å¼ $x^6 + x^4 + x^2 + x + 1$ã€‚\n2.2 åŸŸä¸Šçš„åŠ æ³• (Addition) åœ¨ $GF(2^8)$ ä¸­ï¼ŒåŠ æ³•å°±æ˜¯å¤šé¡¹å¼ç³»æ•°æ¨¡ 2 ç›¸åŠ ï¼Œç­‰ä»·äº å¼‚æˆ– (XOR) è¿ç®—ã€‚ $$ a + b \\iff a \\oplus b $$ ä¾‹å¦‚ï¼š0x57 + 0x83 = 01010111 ^ 10000011 = 11010100 = 0xD4ã€‚\n2.3 åŸŸä¸Šçš„ä¹˜æ³• (Multiplication) ä¹˜æ³•æ˜¯å¤šé¡¹å¼ç›¸ä¹˜åï¼Œæ¨¡ä¸€ä¸ªä¸å¯çº¦å¤šé¡¹å¼ (Irreducible Polynomial) $m(x)$ã€‚AES è§„å®šçš„ä¸å¯çº¦å¤šé¡¹å¼ä¸ºï¼š $$ m(x) = x^8 + x^4 + x^3 + x + 1 \\quad (\\text{Hex: } 0x11B) $$xtime å‡½æ•°: è¿™æ˜¯ AES ä¹˜æ³•çš„æ ¸å¿ƒã€‚xtime(a) ç›¸å½“äº $a$ ä¹˜ä»¥ $x$ï¼ˆå³å·¦ç§»ä¸€ä½ï¼‰ã€‚\nå¦‚æœ $a$ çš„æœ€é«˜ä½ $b_7 = 0$ï¼Œåˆ™ xtime(a) = a \u0026lt;\u0026lt; 1ã€‚ å¦‚æœ $a$ çš„æœ€é«˜ä½ $b_7 = 1$ï¼Œåˆ™ xtime(a) = (a \u0026lt;\u0026lt; 1) ^ 0x1B (æ¨¡ $m(x)$ çš„ç»“æœ)ã€‚ ä»»æ„ä¹˜æ³• $a \\times b$ å¯ä»¥é€šè¿‡é‡å¤ xtime å’ŒåŠ æ³•ï¼ˆXORï¼‰ç»„åˆå®ç°ã€‚ 3. ç®—æ³•å†…éƒ¨ç»“æ„ (Internal Structure) AES å¤„ç†çš„æ•°æ®å•ä½æ˜¯ çŠ¶æ€çŸ©é˜µ (State Matrix)ã€‚16 å­—èŠ‚çš„è¾“å…¥è¢«æ’åˆ—æˆ $4 \\times 4$ çš„çŸ©é˜µï¼ˆæŒ‰åˆ—ä¼˜å…ˆå¡«å……ï¼‰ã€‚\n$$ \\text{State} = \\begin{bmatrix} s_{0,0} \u0026 s_{0,1} \u0026 s_{0,2} \u0026 s_{0,3} \\\\ s_{1,0} \u0026 s_{1,1} \u0026 s_{1,2} \u0026 s_{1,3} \\\\ s_{2,0} \u0026 s_{2,1} \u0026 s_{2,2} \u0026 s_{2,3} \\\\ s_{3,0} \u0026 s_{3,1} \u0026 s_{3,2} \u0026 s_{3,3} \\end{bmatrix} $$3.1 æ•´ä½“æµç¨‹ (AES-128) å¯†é’¥æ‰©å±• (Key Expansion): å°†åˆå§‹å¯†é’¥æ‰©å±•ä¸º 11 ç»„è½®å¯†é’¥ ($K_0, K_1, \u0026hellip;, K_{10}$)ã€‚ åˆå§‹è½® (Initial Round): AddRoundKey (ä¸ $K_0$ å¼‚æˆ–) å¸¸è§„è½® (Rounds 1 to 9): SubBytes (å­—èŠ‚ä»£æ¢) ShiftRows (è¡Œç§»ä½) MixColumns (åˆ—æ··åˆ) AddRoundKey (ä¸ $K_i$ å¼‚æˆ–) æœ€ç»ˆè½® (Final Round 10): SubBytes ShiftRows AddRoundKey (ä¸ $K_{10}$ å¼‚æˆ–) (æ³¨æ„ï¼šæœ€ç»ˆè½®æ²¡æœ‰ MixColumns) 4. è¯¦ç»†æ­¥éª¤è§£æ (Detailed Transformations) 4.1 å­—èŠ‚ä»£æ¢ (SubBytes) è¿™æ˜¯ AES ä¸­å”¯ä¸€çš„éçº¿æ€§å˜æ¢ï¼Œæä¾›äº†æ··æ·†æ€§ (Confusion)ã€‚\nåŸç†: æ¯ä¸ªå­—èŠ‚ $b$ è¢«æ›¿æ¢ä¸º S-Box ä¸­çš„å¯¹åº”å€¼ã€‚ S-Box æ„é€ : æ±‚ $b$ åœ¨ $GF(2^8)$ ä¸­çš„ä¹˜æ³•é€†å…ƒ $b^{-1}$ (0 çš„é€†å…ƒè®¾ä¸º 0)ã€‚ å¯¹ $b^{-1}$ è¿›è¡Œä»¿å°„å˜æ¢ (Affine Transformation)ã€‚ æŸ¥è¡¨æ³•: å®é™…å®ç°é€šå¸¸ç›´æ¥æŸ¥é¢„è®¡ç®—å¥½çš„ $16 \\times 16$ S-Box è¡¨ã€‚ 4.2 è¡Œç§»ä½ (ShiftRows) å¯¹çŠ¶æ€çŸ©é˜µçš„æ¯ä¸€è¡Œè¿›è¡Œå¾ªç¯å·¦ç§»ï¼Œæä¾›äº†æ‰©æ•£æ€§ (Diffusion)ã€‚\nç¬¬ 0 è¡Œï¼šä¸ç§»åŠ¨ã€‚ ç¬¬ 1 è¡Œï¼šå¾ªç¯å·¦ç§» 1 å­—èŠ‚ã€‚ ç¬¬ 2 è¡Œï¼šå¾ªç¯å·¦ç§» 2 å­—èŠ‚ã€‚ ç¬¬ 3 è¡Œï¼šå¾ªç¯å·¦ç§» 3 å­—èŠ‚ã€‚ $$ \\begin{bmatrix} s_{0,0} \u0026 s_{0,1} \u0026 s_{0,2} \u0026 s_{0,3} \\\\ s_{1,0} \u0026 s_{1,1} \u0026 s_{1,2} \u0026 s_{1,3} \\\\ s_{2,0} \u0026 s_{2,1} \u0026 s_{2,2} \u0026 s_{2,3} \\\\ s_{3,0} \u0026 s_{3,1} \u0026 s_{3,2} \u0026 s_{3,3} \\end{bmatrix} \\xrightarrow{\\text{ShiftRows}} \\begin{bmatrix} s_{0,0} \u0026 s_{0,1} \u0026 s_{0,2} \u0026 s_{0,3} \\\\ s_{1,1} \u0026 s_{1,2} \u0026 s_{1,3} \u0026 s_{1,0} \\\\ s_{2,2} \u0026 s_{2,3} \u0026 s_{2,0} \u0026 s_{2,1} \\\\ s_{3,3} \u0026 s_{3,0} \u0026 s_{3,1} \u0026 s_{3,2} \\end{bmatrix} $$4.3 åˆ—æ··åˆ (MixColumns) å¯¹çŠ¶æ€çŸ©é˜µçš„æ¯ä¸€åˆ—è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œè¿›ä¸€æ­¥å¢å¼ºæ‰©æ•£æ€§ã€‚\nåŸç†: å°†æ¯ä¸€åˆ—è§†ä¸º $GF(2^8)$ ä¸Šçš„å¤šé¡¹å¼ï¼Œä¸ä¸€ä¸ªå›ºå®šçš„å¤šé¡¹å¼ $c(x)$ è¿›è¡Œæ¨¡ $x^4 + 1$ ä¹˜æ³•ã€‚ $$ c(x) = 03x^3 + 01x^2 + 01x + 02 $$ çŸ©é˜µå½¢å¼: $$ \\begin{bmatrix} b_0 \\\\ b_1 \\\\ b_2 \\\\ b_3 \\end{bmatrix} = \\begin{bmatrix} 02 \u0026 03 \u0026 01 \u0026 01 \\\\ 01 \u0026 02 \u0026 03 \u0026 01 \\\\ 01 \u0026 01 \u0026 02 \u0026 03 \\\\ 03 \u0026 01 \u0026 01 \u0026 02 \\end{bmatrix} \\times \\begin{bmatrix} a_0 \\\\ a_1 \\\\ a_2 \\\\ a_3 \\end{bmatrix} $$ è¿™é‡Œçš„ä¹˜æ³•æ˜¯ $GF(2^8)$ ä¸Šçš„ä¹˜æ³•ï¼ŒåŠ æ³•æ˜¯å¼‚æˆ–ã€‚\n4.4 è½®å¯†é’¥åŠ  (AddRoundKey) å°†çŠ¶æ€çŸ©é˜µä¸å½“å‰çš„è½®å¯†é’¥è¿›è¡ŒæŒ‰ä½å¼‚æˆ– (XOR)ã€‚è¿™æ˜¯å°†å¯†é’¥èå…¥å¯†æ–‡çš„å…³é”®æ­¥éª¤ã€‚ $$ \\text{State} = \\text{State} \\oplus \\text{RoundKey}_i $$ 5. å¯†é’¥æ‰©å±• (Key Expansion) AES-128 éœ€è¦å°† 16 å­—èŠ‚çš„åˆå§‹å¯†é’¥æ‰©å±•ä¸º 176 å­—èŠ‚ï¼ˆ44 ä¸ªå­—ï¼Œæ¯ä¸ªå­— 4 å­—èŠ‚ï¼‰ï¼Œä¾› 11 è½®ä½¿ç”¨ã€‚ ä»¤ $W[0 \\dots 43]$ ä¸ºæ‰©å±•åçš„å­—æ•°ç»„ã€‚\nå‰ 4 ä¸ªå­—: ç›´æ¥å¤åˆ¶åˆå§‹å¯†é’¥ã€‚ åç»­å­— $W[i]$: å¦‚æœ $i$ æ˜¯ 4 çš„å€æ•°: $$ W[i] = W[i-4] \\oplus \\text{SubWord}(\\text{RotWord}(W[i-1])) \\oplus \\text{Rcon}[i/4] $$ å¦åˆ™: $$ W[i] = W[i-4] \\oplus W[i-1] $$ RotWord: å­—å¾ªç¯å·¦ç§» 1 å­—èŠ‚ ($[a_0, a_1, a_2, a_3] \\to [a_1, a_2, a_3, a_0]$)ã€‚ SubWord: å¯¹å­—çš„æ¯ä¸ªå­—èŠ‚åº”ç”¨ S-Boxã€‚ Rcon (è½®å¸¸æ•°): ç”¨äºç ´åå¯¹ç§°æ€§ã€‚$Rcon[i] = [x^{i-1}, 00, 00, 00]$ (åœ¨ $GF(2^8)$ ä¸­)ã€‚ 6. è§£å¯†æµç¨‹ (Decryption) è§£å¯†æ˜¯åŠ å¯†çš„é€†è¿‡ç¨‹ï¼Œéœ€è¦ä½¿ç”¨é€†å˜æ¢ï¼š\nInvSubBytes: ä½¿ç”¨é€† S-Boxã€‚ InvShiftRows: å¾ªç¯å³ç§»ã€‚ InvMixColumns: ä¹˜ä»¥ $c(x)$ çš„é€†å¤šé¡¹å¼ $d(x) = 0Bx^3 + 0Dx^2 + 09x + 0E$ã€‚ AddRoundKey: å¼‚æˆ–æœ¬èº«å°±æ˜¯é€†è¿ç®—ã€‚ æ³¨æ„: è§£å¯†æ—¶è½®å¯†é’¥çš„ä½¿ç”¨é¡ºåºæ˜¯ç›¸åçš„ï¼ˆä» $K_{10}$ åˆ° $K_0$ï¼‰ã€‚\n7. æºä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 import sys from typing import List # ============================================================================= # AES å¸¸é‡å®šä¹‰ # ============================================================================= # S-Box (Substitution Box): ç”¨äº SubBytes æ­¥éª¤çš„éçº¿æ€§æ›¿æ¢è¡¨ # å®ƒæ˜¯åŸºäº GF(2^8) ä¸Šçš„ä¹˜æ³•é€†å…ƒå’Œä»¿å°„å˜æ¢æ„é€ çš„ SBOX = [ 0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16 ] # Inverse S-Box: ç”¨äºè§£å¯†æ—¶çš„é€†å­—èŠ‚ä»£æ¢ INV_SBOX = [ 0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d ] # Rcon (Round Constant): è½®å¸¸æ•°ï¼Œç”¨äºå¯†é’¥æ‰©å±• # Rcon[i] ä»£è¡¨ x^(i-1) åœ¨ GF(2^8) ä¸­çš„å€¼ RCON = [ 0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1B, 0x36 ] BLOCK_SIZE = 16 # AES åˆ†ç»„å¤§å°å›ºå®šä¸º 128 ä½ (16 å­—èŠ‚) # ============================================================================= # è¾…åŠ©å‡½æ•°ï¼šå¡«å……ä¸æ•°æ®è½¬æ¢ # ============================================================================= def pkcs7_pad(data: bytes, block_size: int = BLOCK_SIZE) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; PKCS#7 å¡«å……ï¼šå°†æ•°æ®å¡«å……åˆ° block_size çš„å€æ•°ã€‚ å¡«å……çš„å€¼ç­‰äºå¡«å……çš„å­—èŠ‚æ•°ã€‚ ä¾‹å¦‚ï¼šå¦‚æœç¼º 3 ä¸ªå­—èŠ‚ï¼Œå°±å¡«å…… 0x03 0x03 0x03ã€‚ \u0026#34;\u0026#34;\u0026#34; pad_len = block_size - (len(data) % block_size) if pad_len == 0: pad_len = block_size return data + bytes([pad_len] * pad_len) def pkcs7_unpad(data: bytes) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; PKCS#7 å»å¡«å……ï¼šè¯»å–æœ€åä¸€ä¸ªå­—èŠ‚ç¡®å®šå¡«å……é•¿åº¦ï¼Œå¹¶ç§»é™¤å¡«å……ã€‚ \u0026#34;\u0026#34;\u0026#34; if not data: raise ValueError(\u0026#34;ç©ºæ•°æ®ä¸æ”¯æŒå»å¡«å……\u0026#34;) pad_len = data[-1] if pad_len \u0026lt; 1 or pad_len \u0026gt; BLOCK_SIZE: raise ValueError(\u0026#34;å¡«å……é•¿åº¦éæ³•\u0026#34;) if data[-pad_len:] != bytes([pad_len] * pad_len): raise ValueError(\u0026#34;å¡«å……å†…å®¹éæ³•\u0026#34;) return data[:-pad_len] def zero_pad_key_to_16(key: bytes) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; å°†å¯†é’¥å¤„ç†ä¸º 16 å­—èŠ‚ (128 ä½)ã€‚ å¦‚æœä¸è¶³ 16 å­—èŠ‚ï¼Œå³ä¾§è¡¥ 0ï¼›å¦‚æœè¶…è¿‡ï¼Œæˆªæ–­ã€‚ (ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ KDF) \u0026#34;\u0026#34;\u0026#34; if len(key) \u0026gt;= 16: return key[:16] return key + bytes(16 - len(key)) def bytes_to_state(block: bytes) -\u0026gt; List[List[int]]: \u0026#34;\u0026#34;\u0026#34; å°† 16 å­—èŠ‚çš„è¾“å…¥å—è½¬æ¢ä¸º 4x4 çš„çŠ¶æ€çŸ©é˜µ (State)ã€‚ AES è§„å®šæŒ‰ã€åˆ—ä¼˜å…ˆã€‘é¡ºåºå¡«å……ã€‚ \u0026#34;\u0026#34;\u0026#34; return [list(block[i::4])[:4] for i in range(4)] def state_to_bytes(state: List[List[int]]) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; å°† 4x4 çŠ¶æ€çŸ©é˜µè½¬æ¢å› 16 å­—èŠ‚æ•°æ® (åˆ—ä¼˜å…ˆè¯»å–)ã€‚ \u0026#34;\u0026#34;\u0026#34; out = bytearray(16) for r in range(4): for c in range(4): out[c * 4 + r] = state[r][c] return bytes(out) # ============================================================================= # AES æ ¸å¿ƒå˜æ¢å‡½æ•° # ============================================================================= def sub_bytes(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; SubBytes (å­—èŠ‚ä»£æ¢)ï¼š ä½¿ç”¨ S-Box å¯¹çŠ¶æ€çŸ©é˜µä¸­çš„æ¯ä¸ªå­—èŠ‚è¿›è¡Œéçº¿æ€§æ›¿æ¢ã€‚ æä¾›äº†ç®—æ³•çš„æ··æ·†æ€§ (Confusion)ã€‚ \u0026#34;\u0026#34;\u0026#34; for r in range(4): for c in range(4): state[r][c] = SBOX[state[r][c]] def inv_sub_bytes(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; InvSubBytes (é€†å­—èŠ‚ä»£æ¢)ï¼š ä½¿ç”¨é€† S-Box è¿˜åŸå­—èŠ‚ï¼Œç”¨äºè§£å¯†ã€‚ \u0026#34;\u0026#34;\u0026#34; for r in range(4): for c in range(4): state[r][c] = INV_SBOX[state[r][c]] def shift_rows(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; ShiftRows (è¡Œç§»ä½)ï¼š å¯¹çŠ¶æ€çŸ©é˜µçš„æ¯ä¸€è¡Œè¿›è¡Œå¾ªç¯å·¦ç§»ã€‚ ç¬¬0è¡Œä¸ç§»ï¼Œç¬¬1è¡Œå·¦ç§»1ä½ï¼Œç¬¬2è¡Œå·¦ç§»2ä½ï¼Œç¬¬3è¡Œå·¦ç§»3ä½ã€‚ æä¾›äº†ç®—æ³•çš„æ‰©æ•£æ€§ (Diffusion)ã€‚ \u0026#34;\u0026#34;\u0026#34; state[1] = state[1][1:] + state[1][:1] state[2] = state[2][2:] + state[2][:2] state[3] = state[3][3:] + state[3][:3] def inv_shift_rows(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; InvShiftRows (é€†è¡Œç§»ä½)ï¼š å¯¹çŠ¶æ€çŸ©é˜µçš„æ¯ä¸€è¡Œè¿›è¡Œå¾ªç¯å³ç§»ï¼Œç”¨äºè§£å¯†ã€‚ \u0026#34;\u0026#34;\u0026#34; state[1] = state[1][-1:] + state[1][:-1] state[2] = state[2][-2:] + state[2][:-2] state[3] = state[3][-3:] + state[3][:-3] # --- GF(2^8) æ•°å­¦è¿ç®—è¾…åŠ©å‡½æ•° --- def xtime(a: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34; xtime å‡½æ•°ï¼šè®¡ç®— a * x (åœ¨ GF(2^8) åŸŸä¸Š)ã€‚ ç›¸å½“äºå·¦ç§»ä¸€ä½ï¼Œå¦‚æœæº¢å‡ºåˆ™å¼‚æˆ–ä¸å¯çº¦å¤šé¡¹å¼ 0x1Bã€‚ \u0026#34;\u0026#34;\u0026#34; return ((a \u0026lt;\u0026lt; 1) \u0026amp; 0xFF) ^ (0x1B if (a \u0026amp; 0x80) else 0) def mul(a: int, b: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34; GF(2^8) ä¸Šçš„ä¹˜æ³•ï¼šè®¡ç®— a * bã€‚ é€šè¿‡é‡å¤ xtime å’Œæ¡ä»¶å¼‚æˆ–å®ç° (ç±»ä¼¼å¿«é€Ÿå¹‚/ä¿„ç½—æ–¯å†œæ°‘ä¹˜æ³•)ã€‚ \u0026#34;\u0026#34;\u0026#34; res = 0 for i in range(8): if b \u0026amp; 1: res ^= a a = xtime(a) b \u0026gt;\u0026gt;= 1 return res def mix_single_column(col: List[int]) -\u0026gt; List[int]: \u0026#34;\u0026#34;\u0026#34; MixColumns çš„å•åˆ—è®¡ç®—ã€‚ å°†åˆ—å‘é‡ä¸å›ºå®šå¤šé¡¹å¼ c(x) = 03x^3 + 01x^2 + 01x + 02 ç›¸ä¹˜ã€‚ \u0026#34;\u0026#34;\u0026#34; a0, a1, a2, a3 = col return [ mul(a0, 2) ^ mul(a1, 3) ^ a2 ^ a3, a0 ^ mul(a1, 2) ^ mul(a2, 3) ^ a3, a0 ^ a1 ^ mul(a2, 2) ^ mul(a3, 3), mul(a0, 3) ^ a1 ^ a2 ^ mul(a3, 2) ] def mix_columns(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; MixColumns (åˆ—æ··åˆ)ï¼š å¯¹çŠ¶æ€çŸ©é˜µçš„æ¯ä¸€åˆ—è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œè¿›ä¸€æ­¥å¢å¼ºæ‰©æ•£æ€§ã€‚ \u0026#34;\u0026#34;\u0026#34; for c in range(4): col = [state[r][c] for r in range(4)] new_col = mix_single_column(col) for r in range(4): state[r][c] = new_col[r] def inv_mix_single_column(col: List[int]) -\u0026gt; List[int]: \u0026#34;\u0026#34;\u0026#34; InvMixColumns çš„å•åˆ—è®¡ç®—ã€‚ ä¹˜ä»¥ c(x) çš„é€†å¤šé¡¹å¼ d(x) = 0Bx^3 + 0Dx^2 + 09x + 0Eã€‚ \u0026#34;\u0026#34;\u0026#34; a0, a1, a2, a3 = col return [ mul(a0, 0x0e) ^ mul(a1, 0x0b) ^ mul(a2, 0x0d) ^ mul(a3, 0x09), mul(a0, 0x09) ^ mul(a1, 0x0e) ^ mul(a2, 0x0b) ^ mul(a3, 0x0d), mul(a0, 0x0d) ^ mul(a1, 0x09) ^ mul(a2, 0x0e) ^ mul(a3, 0x0b), mul(a0, 0x0b) ^ mul(a1, 0x0d) ^ mul(a2, 0x09) ^ mul(a3, 0x0e) ] def inv_mix_columns(state: List[List[int]]): \u0026#34;\u0026#34;\u0026#34; InvMixColumns (é€†åˆ—æ··åˆ)ï¼šç”¨äºè§£å¯†ã€‚ \u0026#34;\u0026#34;\u0026#34; for c in range(4): col = [state[r][c] for r in range(4)] new_col = inv_mix_single_column(col) for r in range(4): state[r][c] = new_col[r] def add_round_key(state: List[List[int]], round_key: bytes): \u0026#34;\u0026#34;\u0026#34; AddRoundKey (è½®å¯†é’¥åŠ )ï¼š å°†çŠ¶æ€çŸ©é˜µä¸å½“å‰çš„è½®å¯†é’¥è¿›è¡ŒæŒ‰ä½å¼‚æˆ– (XOR)ã€‚ \u0026#34;\u0026#34;\u0026#34; for r in range(4): for c in range(4): state[r][c] ^= round_key[c * 4 + r] # ============================================================================= # å¯†é’¥æ‰©å±• (Key Expansion) # ============================================================================= def rot_word(w: List[int]) -\u0026gt; List[int]: \u0026#34;\u0026#34;\u0026#34;å­—å¾ªç¯å·¦ç§»ï¼š[a0, a1, a2, a3] -\u0026gt; [a1, a2, a3, a0]\u0026#34;\u0026#34;\u0026#34; return w[1:] + w[:1] def sub_word(w: List[int]) -\u0026gt; List[int]: \u0026#34;\u0026#34;\u0026#34;å­—ä»£æ¢ï¼šå¯¹å­—ä¸­çš„æ¯ä¸ªå­—èŠ‚åº”ç”¨ S-Box\u0026#34;\u0026#34;\u0026#34; return [SBOX[b] for b in w] def key_expansion(key: bytes) -\u0026gt; List[bytes]: \u0026#34;\u0026#34;\u0026#34; å¯†é’¥æ‰©å±•ç®—æ³• (AES-128)ï¼š å°† 16 å­—èŠ‚åˆå§‹å¯†é’¥æ‰©å±•ä¸º 11 ç»„è½®å¯†é’¥ (æ¯ç»„ 16 å­—èŠ‚)ã€‚ \u0026#34;\u0026#34;\u0026#34; Nk = 4 # å¯†é’¥é•¿åº¦ (å­—æ•°)ï¼ŒAES-128 ä¸º 4 Nb = 4 # åˆ†ç»„é•¿åº¦ (å­—æ•°)ï¼Œå›ºå®šä¸º 4 Nr = 10 # è½®æ•°ï¼ŒAES-128 ä¸º 10 # w å­˜å‚¨æ‰©å±•åçš„æ‰€æœ‰å­— (4 * (Nr + 1) = 44 ä¸ªå­—) w = [[0, 0, 0, 0] for _ in range(Nb * (Nr + 1))] # å‰ Nk ä¸ªå­—ç›´æ¥å–è‡ªåˆå§‹å¯†é’¥ for i in range(Nk): w[i] = [key[4 * i + 0], key[4 * i + 1], key[4 * i + 2], key[4 * i + 3]] # ç”Ÿæˆå‰©ä½™çš„å­— for i in range(Nk, Nb * (Nr + 1)): temp = w[i - 1][:] if i % Nk == 0: # æ¯ Nk ä¸ªå­—è¿›è¡Œä¸€æ¬¡å¤æ‚å˜æ¢ï¼šRotWord + SubWord + XOR Rcon temp = sub_word(rot_word(temp)) temp[0] ^= RCON[i // Nk] # W[i] = W[i-Nk] XOR temp w[i] = [ (w[i - Nk][j] ^ temp[j]) \u0026amp; 0xFF for j in range(4) ] # å°†å­—æ•°ç»„é‡æ–°ç»„åˆæˆ 11 ä¸ª 16 å­—èŠ‚çš„è½®å¯†é’¥ round_keys = [] for r in range(Nr + 1): rk = [] for c in range(Nb): rk.extend(w[r * Nb + c]) round_keys.append(bytes(rk)) return round_keys # ============================================================================= # è°ƒè¯•ä¸è¾“å‡ºè¾…åŠ© # ============================================================================= def bytes_hex(b: bytes) -\u0026gt; str: return b.hex().upper() def state_hex(state: List[List[int]]) -\u0026gt; str: return state_to_bytes(state).hex().upper() # ============================================================================= # AES åŠ å¯†ä¸è§£å¯†æµç¨‹ (Block Level) # ============================================================================= def aes_encrypt_block(block: bytes, round_keys: List[bytes], verbose: bool = False) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; åŠ å¯†å•ä¸ª 16 å­—èŠ‚åˆ†ç»„ã€‚ æµç¨‹ï¼šAddRoundKey(Initial) -\u0026gt; 9è½®(Sub/Shift/Mix/Add) -\u0026gt; æœ€ç»ˆè½®(Sub/Shift/Add) \u0026#34;\u0026#34;\u0026#34; state = bytes_to_state(block) if verbose: print(\u0026#34;\\n==================== å¼€å§‹ AES åŠ å¯† (å•å—) ===================\u0026#34;) print(f\u0026#34;è¾“å…¥æ•°æ® (Hex): {block.hex().upper()}\u0026#34;) print(f\u0026#34;åˆå§‹è½®å¯†é’¥ (Hex): {bytes_hex(round_keys[0])}\u0026#34;) # åˆå§‹è½®ï¼šåªåš AddRoundKey add_round_key(state, round_keys[0]) # ç¬¬ 1 åˆ° 9 è½® for round_idx in range(1, 10): if verbose: print(f\u0026#34;\\n-- Round {round_idx} --\u0026#34;) sub_bytes(state) if verbose: print(f\u0026#34;After SubBytes: {state_hex(state)}\u0026#34;) shift_rows(state) if verbose: print(f\u0026#34;After ShiftRows: {state_hex(state)}\u0026#34;) mix_columns(state) if verbose: print(f\u0026#34;After MixColumns: {state_hex(state)}\u0026#34;) add_round_key(state, round_keys[round_idx]) if verbose: print(f\u0026#34;AddRoundKey ({round_idx}): {bytes_hex(round_keys[round_idx])}\u0026#34;) print(f\u0026#34;State: {state_hex(state)}\u0026#34;) # æœ€ç»ˆè½® (ç¬¬ 10 è½®)ï¼šæ—  MixColumns if verbose: print(\u0026#34;\\n-- Final Round (10) --\u0026#34;) sub_bytes(state) if verbose: print(f\u0026#34;After SubBytes: {state_hex(state)}\u0026#34;) shift_rows(state) if verbose: print(f\u0026#34;After ShiftRows: {state_hex(state)}\u0026#34;) add_round_key(state, round_keys[10]) if verbose: print(f\u0026#34;AddRoundKey (10): {bytes_hex(round_keys[10])}\u0026#34;) print(f\u0026#34;[åŠ å¯†ç»“æœ] (Hex): {state_hex(state)}\u0026#34;) print(\u0026#34;==================== ç»“æŸ AES åŠ å¯† ====================\\n\u0026#34;) return state_to_bytes(state) def aes_decrypt_block(block: bytes, round_keys: List[bytes], verbose: bool = False) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; è§£å¯†å•ä¸ª 16 å­—èŠ‚åˆ†ç»„ã€‚ æµç¨‹æ˜¯åŠ å¯†çš„é€†è¿‡ç¨‹ï¼Œæ³¨æ„è½®å¯†é’¥é¡ºåºç›¸åã€‚ \u0026#34;\u0026#34;\u0026#34; state = bytes_to_state(block) if verbose: print(\u0026#34;\\n==================== å¼€å§‹ AES è§£å¯† (å•å—) ===================\u0026#34;) print(f\u0026#34;è¾“å…¥æ•°æ® (Hex): {block.hex().upper()}\u0026#34;) print(f\u0026#34;ç»ˆæ­¢è½®å¯†é’¥ (Hex): {bytes_hex(round_keys[10])}\u0026#34;) # åˆå§‹é€†å˜æ¢ï¼šå…ˆå¼‚æˆ–æœ€åä¸€è½®å¯†é’¥ add_round_key(state, round_keys[10]) inv_shift_rows(state) inv_sub_bytes(state) # ç¬¬ 9 åˆ° 1 è½® (é€†åº) for round_idx in range(9, 0, -1): if verbose: print(f\u0026#34;\\n-- Round {round_idx} --\u0026#34;) add_round_key(state, round_keys[round_idx]) if verbose: print(f\u0026#34;AddRoundKey ({round_idx}): {bytes_hex(round_keys[round_idx])}\u0026#34;) print(f\u0026#34;State: {state_hex(state)}\u0026#34;) inv_mix_columns(state) if verbose: print(f\u0026#34;After InvMixColumns: {state_hex(state)}\u0026#34;) inv_shift_rows(state) if verbose: print(f\u0026#34;After InvShiftRows: {state_hex(state)}\u0026#34;) inv_sub_bytes(state) if verbose: print(f\u0026#34;After InvSubBytes: {state_hex(state)}\u0026#34;) # æœ€ç»ˆé€†å˜æ¢ add_round_key(state, round_keys[0]) if verbose: print(f\u0026#34;AddRoundKey (0): {bytes_hex(round_keys[0])}\u0026#34;) print(f\u0026#34;[è§£å¯†ç»“æœ] (Hex): {state_hex(state)}\u0026#34;) print(\u0026#34;==================== ç»“æŸ AES è§£å¯† ====================\\n\u0026#34;) return state_to_bytes(state) # ============================================================================= # ECB æ¨¡å¼å°è£… # ============================================================================= def aes_encrypt_ecb(plaintext: bytes, key: bytes, verbose: bool = False) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; AES-128 ECB æ¨¡å¼åŠ å¯†ã€‚ 1. å¤„ç†å¯†é’¥ 2. å¡«å……æ˜æ–‡ (PKCS#7) 3. åˆ†å—åŠ å¯† \u0026#34;\u0026#34;\u0026#34; key16 = zero_pad_key_to_16(key) round_keys = key_expansion(key16) padded = pkcs7_pad(plaintext, BLOCK_SIZE) if verbose: print(\u0026#34;å¼€å§‹åŠ å¯†...\u0026#34;) print(f\u0026#34;åŸå§‹é•¿åº¦: {len(plaintext)}, å¡«å……åé•¿åº¦: {len(padded)}\u0026#34;) out = bytearray() for i in range(0, len(padded), BLOCK_SIZE): blk = padded[i:i+BLOCK_SIZE] if verbose: try: print(f\u0026#34;\\n\u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ {i//BLOCK_SIZE + 1} å—: {blk.decode(\u0026#39;utf-8\u0026#39;, \u0026#39;ignore\u0026#39;)}\u0026#34;) except Exception: print(f\u0026#34;\\n\u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ {i//BLOCK_SIZE + 1} å— (Hex): {blk.hex().upper()}\u0026#34;) ct = aes_encrypt_block(blk, round_keys, verbose) out.extend(ct) return bytes(out) def aes_decrypt_ecb(ciphertext: bytes, key: bytes, verbose: bool = False) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34; AES-128 ECB æ¨¡å¼è§£å¯†ã€‚ 1. å¤„ç†å¯†é’¥ 2. åˆ†å—è§£å¯† 3. å»å¡«å…… (PKCS#7) \u0026#34;\u0026#34;\u0026#34; key16 = zero_pad_key_to_16(key) round_keys = key_expansion(key16) out = bytearray() if verbose: print(\u0026#34;å¼€å§‹è§£å¯†...\u0026#34;) for i in range(0, len(ciphertext), BLOCK_SIZE): blk = ciphertext[i:i+BLOCK_SIZE] if verbose: print(f\u0026#34;\\n\u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ {i//BLOCK_SIZE + 1} å— (Hex): {blk.hex().upper()}\u0026#34;) pt = aes_decrypt_block(blk, round_keys, verbose) out.extend(pt) return pkcs7_unpad(bytes(out)) def main(): raw_text = \u0026#34;hello fanshanng\u0026#34; raw_key = \u0026#34;secret\u0026#34; print(f\u0026#34;åŸå§‹æ˜æ–‡: {raw_text}\u0026#34;) print(f\u0026#34;åŸå§‹å¯†é’¥: {raw_key}\u0026#34;) pt = raw_text.encode(\u0026#34;utf-8\u0026#34;) key_bytes = raw_key.encode(\u0026#34;utf-8\u0026#34;) # åŠ å¯† ct = aes_encrypt_ecb(pt, key_bytes, verbose=True) print(f\u0026#34;\\næœ€ç»ˆå¯†æ–‡ (Hex): {ct.hex().upper()}\u0026#34;) # è§£å¯† dec = aes_decrypt_ecb(ct, key_bytes, verbose=True) dec_str = dec.decode(\u0026#34;utf-8\u0026#34;) print(\u0026#34;\\næœ€ç»ˆéªŒè¯:\u0026#34;) print(f\u0026#34; åŸå§‹æ˜æ–‡: {raw_text}\u0026#34;) print(f\u0026#34; è§£å¯†æ˜æ–‡: {dec_str}\u0026#34;) print(f\u0026#34; åŒ¹é…æˆåŠŸ: {raw_text == dec_str}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: main() 8 ä»£ç è¯¦è§£ï¼š 8.1åˆ—æ··åˆ (Code Deep Dive: MixColumns) AES çš„åˆ—æ··åˆï¼ˆMixColumnsï¼‰æ˜¯æ•´ä¸ªç®—æ³•ä¸­æ•°å­¦å‘³æœ€æµ“ã€ä¹Ÿæœ€éš¾ç†è§£çš„éƒ¨åˆ†ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨ æœ‰é™åŸŸ $GF(2^8)$ ä¸Šè¿›è¡Œçš„ çŸ©é˜µä¹˜æ³•ã€‚\n1. æœ€åº•å±‚ï¼šxtime (x ä¹˜æ³•) è¿™æ˜¯ AES æ•°å­¦è¿ç®—çš„åŸºçŸ³ã€‚åœ¨æœ‰é™åŸŸ $GF(2^8)$ ä¸­ï¼Œæ•°å­—è¢«è§†ä¸ºå¤šé¡¹å¼çš„ç³»æ•°ã€‚\nåŠ æ³•/å‡æ³•ï¼šå°±æ˜¯å¼‚æˆ– (XOR)ã€‚ ä¹˜æ³•ï¼šæ¯”è¾ƒå¤æ‚ï¼Œç‰¹åˆ«æ˜¯ä¹˜ä»¥ 2ï¼ˆå³å¤šé¡¹å¼ $x$ï¼‰ã€‚ 1 2 3 4 5 6 7 8 9 def xtime(a: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34; xtime å‡½æ•°ï¼šè®¡ç®— a * 2 (åœ¨ GF(2^8) åŸŸä¸Š)ã€‚ ç›¸å½“äºå·¦ç§»ä¸€ä½ï¼Œå¦‚æœæº¢å‡ºåˆ™å¼‚æˆ–ä¸å¯çº¦å¤šé¡¹å¼ 0x1Bã€‚ \u0026#34;\u0026#34;\u0026#34; # (a \u0026lt;\u0026lt; 1) \u0026amp; 0xFF : å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºä¹˜ä»¥ xã€‚\u0026amp; 0xFF ç¡®ä¿ç»“æœåœ¨ 8 ä½ä»¥å†…ã€‚ # (a \u0026amp; 0x80) : æ£€æŸ¥æœ€é«˜ä½ï¼ˆç¬¬8ä½ï¼‰æ˜¯å¦ä¸º 1ã€‚ # ^ 0x1B : å¦‚æœæœ€é«˜ä½æ˜¯ 1ï¼Œè¯´æ˜æº¢å‡ºäº†ï¼Œéœ€è¦å‡å»ï¼ˆå¼‚æˆ–ï¼‰ä¸å¯çº¦å¤šé¡¹å¼ 0x1B (00011011)ã€‚ return ((a \u0026lt;\u0026lt; 1) \u0026amp; 0xFF) ^ (0x1B if (a \u0026amp; 0x80) else 0) é€šä¿—è§£é‡Šï¼š è¿™å°±å¥½æ¯”æˆ‘ä»¬åœ¨åè¿›åˆ¶é‡Œè§„å®šâ€œæœ€å¤§ä¸èƒ½è¶…è¿‡ 99â€ã€‚å¦‚æœä½ ç®— $50 \\times 2 = 100$ï¼Œè¶…è¿‡äº†ï¼Œå°±å¾—å‡å»ä¸€ä¸ªç‰¹å®šçš„æ•°ï¼ˆæ¯”å¦‚ 100ï¼‰è®©å®ƒå˜å› 0ã€‚ åœ¨ AES çš„ 8 ä½ä¸–ç•Œé‡Œï¼Œå¦‚æœå·¦ç§»å¯¼è‡´æœ€é«˜ä½å˜æˆäº† 1ï¼ˆæº¢å‡ºï¼‰ï¼Œæˆ‘ä»¬å°±å¼‚æˆ– 0x1B æ¥â€œæŠ˜å â€å›å»ã€‚\n2. ä¸­é—´å±‚ï¼šmul (é€šç”¨ä¹˜æ³•) æœ‰äº† xtime (ä¹˜ä»¥ 2)ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—ä¹˜ä»¥ä»»æ„æ•°äº†ã€‚è¿™é‡Œç”¨çš„æ˜¯**â€œä¿„ç½—æ–¯å†œæ°‘ä¹˜æ³•â€**ï¼ˆä¹Ÿå«å€å¢å‡åŠæ³•ï¼‰çš„å˜ä½“ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 def mul(a: int, b: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34; GF(2^8) ä¸Šçš„ä¹˜æ³•ï¼šè®¡ç®— a * bã€‚ \u0026#34;\u0026#34;\u0026#34; res = 0 for i in range(8): # å¦‚æœ b çš„å½“å‰æœ€ä½ä½æ˜¯ 1ï¼Œå°±æŠŠå½“å‰çš„ a åŠ ï¼ˆå¼‚æˆ–ï¼‰åˆ°ç»“æœé‡Œ if b \u0026amp; 1: res ^= a # a ç¿»å€ (ä¹˜ä»¥ x) a = xtime(a) # b å‡åŠ (å³ç§») b \u0026gt;\u0026gt;= 1 return res ä¸¾ä¾‹è®¡ç®— $A \\times 3$ï¼š\n$3$ çš„äºŒè¿›åˆ¶æ˜¯ 00000011ã€‚ $A \\times 3 = A \\times (2 + 1) = (A \\times 2) + (A \\times 1)$ã€‚ ä»£ç é‡Œï¼š ç¬¬ä¸€è½®ï¼šb æœ«ä½æ˜¯ 1ï¼Œres = res ^ Aã€‚ ç¬¬äºŒè½®ï¼ša å˜æˆäº† xtime(A) (å³ $2A$)ï¼Œb æœ«ä½è¿˜æ˜¯ 1ï¼Œres = res ^ 2Aã€‚ ç»“æœå°±æ˜¯ $A \\oplus 2A$ã€‚ 3. åº”ç”¨å±‚ï¼šmix_single_column (çŸ©é˜µå˜æ¢) è¿™ä¸€æ­¥æ˜¯çœŸæ­£çš„åˆ—æ··åˆã€‚AES è§„å®šæ¯ä¸€åˆ—éƒ½è¦å’Œä¸€ä¸ªå›ºå®šçš„çŸ©é˜µç›¸ä¹˜ã€‚ è¿™ä¸ªå›ºå®šçŸ©é˜µæ˜¯ï¼š $$ \\begin{bmatrix} 2 \u0026 3 \u0026 1 \u0026 1 \\\\ 1 \u0026 2 \u0026 3 \u0026 1 \\\\ 1 \u0026 1 \u0026 2 \u0026 3 \\\\ 3 \u0026 1 \u0026 1 \u0026 2 \\end{bmatrix} $$ä»£ç å®Œå…¨å¯¹åº”è¿™ä¸ªçŸ©é˜µä¹˜æ³•å…¬å¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 def mix_single_column(col: List[int]) -\u0026gt; List[int]: a0, a1, a2, a3 = col # è¾“å…¥åˆ—çš„ 4 ä¸ªå­—èŠ‚ return [ # æ–°çš„ç¬¬ 0 è¡Œ = 2*a0 + 3*a1 + 1*a2 + 1*a3 mul(a0, 2) ^ mul(a1, 3) ^ a2 ^ a3, # æ–°çš„ç¬¬ 1 è¡Œ = 1*a0 + 2*a1 + 3*a2 + 1*a3 a0 ^ mul(a1, 2) ^ mul(a2, 3) ^ a3, # æ–°çš„ç¬¬ 2 è¡Œ = 1*a0 + 1*a1 + 2*a2 + 3*a3 a0 ^ a1 ^ mul(a2, 2) ^ mul(a3, 3), # æ–°çš„ç¬¬ 3 è¡Œ = 3*a0 + 1*a1 + 1*a2 + 2*a3 mul(a0, 3) ^ a1 ^ a2 ^ mul(a3, 2) ] ä¸ºä»€ä¹ˆæ˜¯ 2 å’Œ 3ï¼Ÿ\nä¹˜ä»¥ 1ï¼šå°±æ˜¯å®ƒè‡ªå·±ï¼ˆä»£ç é‡Œç›´æ¥å†™ a2 è€Œä¸æ˜¯ mul(a2, 1)ï¼‰ã€‚ ä¹˜ä»¥ 2ï¼šè°ƒç”¨ xtime ä¸€æ¬¡ã€‚ ä¹˜ä»¥ 3ï¼šç­‰äº xtime(a) ^ aã€‚ AES è®¾è®¡è€…é€‰æ‹© 1, 2, 3 æ˜¯å› ä¸ºå®ƒä»¬è®¡ç®—æœ€å¿«ï¼ˆåªéœ€è¦ç§»ä½å’Œå¼‚æˆ–ï¼‰ï¼ŒåŒæ—¶èƒ½ä¿è¯å¾ˆå¥½çš„æ‰©æ•£æ•ˆæœï¼ˆè®©ä¸€ä¸ªå­—èŠ‚çš„å˜åŒ–å½±å“åˆ°è¿™ä¸€åˆ—çš„æ‰€æœ‰ 4 ä¸ªå­—èŠ‚ï¼‰ã€‚ 8.2 ä»£ç è¯¦è§£ï¼šå¯†é’¥æ‰©å±• (Code Deep Dive: Key Expansion) AES çš„å¯†é’¥æ‰©å±•ï¼ˆKey Expansionï¼‰è´Ÿè´£æŠŠç”¨æˆ·è¾“å…¥çš„çŸ­å¯†é’¥ï¼ˆ16å­—èŠ‚ï¼‰â€œæ‹‰é•¿â€æˆè¶³å¤Ÿ 11 è½®åŠ å¯†ä½¿ç”¨çš„é•¿å¯†é’¥ä¸²ï¼ˆ176å­—èŠ‚ï¼‰ã€‚\n1. è¾…åŠ©å˜æ¢ å¯†é’¥æ‰©å±•å¤„ç†çš„åŸºæœ¬å•ä½æ˜¯ â€œå­—â€ (Word)ï¼Œå³ 4 ä¸ªå­—èŠ‚ã€‚\nrot_word(w) (å­—å¾ªç¯å·¦ç§»)\n1 2 3 def rot_word(w: List[int]) -\u0026gt; List[int]: # è¾“å…¥ [a0, a1, a2, a3] -\u0026gt; è¾“å‡º [a1, a2, a3, a0] return w[1:] + w[:1] è¿™å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå­—èŠ‚ç§»åˆ°æœ€åå»ã€‚\nsub_word(w) (å­—ä»£æ¢)\n1 2 3 def sub_word(w: List[int]) -\u0026gt; List[int]: # å¯¹å­—é‡Œçš„æ¯ä¸ªå­—èŠ‚ï¼Œéƒ½å»æŸ¥ S-Box æ›¿æ¢ä¸€ä¸‹ return [SBOX[b] for b in w] è¿™å’ŒåŠ å¯†æ­¥éª¤é‡Œçš„ SubBytes ä¸€æ ·ï¼Œå¼•å…¥éçº¿æ€§ï¼Œé˜²æ­¢æ”»å‡»è€…é€šè¿‡çº¿æ€§å…³ç³»æ¨å¯¼å¯†é’¥ã€‚\n2. æ ¸å¿ƒé€»è¾‘ï¼škey_expansion AES-128 éœ€è¦ 44 ä¸ªå­—ï¼ˆ$4 \\times 11$ è½® = 44 å­—ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 def key_expansion(key: bytes) -\u0026gt; List[bytes]: Nk = 4 # åŸå§‹å¯†é’¥åŒ…å«çš„å­—æ•° (16å­—èŠ‚ / 4 = 4) Nb = 4 # æ¯è½®éœ€è¦çš„å­—æ•° (å›ºå®šä¸º 4) Nr = 10 # è½®æ•° # w æ˜¯ä¸€ä¸ªå¤§åˆ—è¡¨ï¼Œç”¨æ¥å­˜è¿™ 44 ä¸ªå­— w = [[0, 0, 0, 0] for _ in range(Nb * (Nr + 1))] # ã€ç¬¬ä¸€æ­¥ã€‘å‰ 4 ä¸ªå­— (w[0]~w[3]) ç›´æ¥å°±æ˜¯åŸå§‹å¯†é’¥ for i in range(Nk): w[i] = [key[4 * i + 0], key[4 * i + 1], key[4 * i + 2], key[4 * i + 3]] # ã€ç¬¬äºŒæ­¥ã€‘ç”Ÿæˆå‰©ä¸‹çš„ 40 ä¸ªå­— (w[4]~w[43]) for i in range(Nk, Nb * (Nr + 1)): temp = w[i - 1][:] # å…ˆå–å‡ºå‰ä¸€ä¸ªå­— # æ¯éš” 4 ä¸ªå­— (i % Nk == 0)ï¼Œå°±è¦è¿›è¡Œä¸€æ¬¡â€œå¤æ‚å˜æ¢â€ if i % Nk == 0: # 1. å¾ªç¯å·¦ç§» (RotWord) # 2. Sç›’ä»£æ¢ (SubWord) temp = sub_word(rot_word(temp)) # 3. å¼‚æˆ–è½®å¸¸æ•° (Rcon) # RCON[i // Nk] è·å–å½“å‰æ˜¯ç¬¬å‡ è½®çš„å¸¸æ•° # åªå¼‚æˆ–ç¬¬ä¸€ä¸ªå­—èŠ‚ (temp[0])ï¼Œå› ä¸º Rcon çš„åä¸‰ä¸ªå­—èŠ‚éƒ½æ˜¯ 0 temp[0] ^= RCON[i // Nk] # æ ¸å¿ƒå…¬å¼ï¼šW[i] = W[i-Nk] XOR temp # ä¹Ÿå°±æ˜¯è¯´ï¼šå½“å‰å­— = (4ä¸ªä½ç½®å‰çš„å­—) XOR (ç»è¿‡å¤„ç†çš„å‰ä¸€ä¸ªå­—) w[i] = [ (w[i - Nk][j] ^ temp[j]) \u0026amp; 0xFF for j in range(4) ] é€»è¾‘å›¾è§£ï¼š æƒ³è±¡ä¸€ä¸ªæ»‘åŠ¨çª—å£ã€‚\nå¤§å¤šæ•°æ—¶å€™ï¼ˆæ™®é€šåˆ—ï¼‰ï¼šæ–°å­— = 4ä¸ªå‰çš„å­— XOR å‰ä¸€ä¸ªå­—ã€‚ æ¯é€¢ 4 çš„å€æ•°ï¼ˆç¬¬ä¸€åˆ—ï¼‰ï¼šæ–°å­— = 4ä¸ªå‰çš„å­— XOR g(å‰ä¸€ä¸ªå­—)ã€‚ å‡½æ•° $g$ å°±æ˜¯ï¼šå…ˆå·¦ç§»ï¼Œå†ä»£æ¢ï¼Œæœ€åå¼‚æˆ–è½®å¸¸æ•°ã€‚ 3. è½®å¸¸æ•° RCON 1 2 3 RCON = [ 0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1B, 0x36 ] RCON æ˜¯ä¸ºäº†æ¶ˆé™¤æ¯ä¸€è½®å¯†é’¥ç”Ÿæˆçš„å¯¹ç§°æ€§ã€‚\nå®ƒåªä½œç”¨äºæ¯ä¸ªå­—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚ å®ƒçš„å€¼æ˜¯ $x^{i-1}$ åœ¨ $GF(2^8)$ ä¸Šçš„å¹‚ï¼š ç¬¬1è½®ï¼š$x^0 = 1$ (0x01) ç¬¬2è½®ï¼š$x^1 = 2$ (0x02) \u0026hellip; ç¬¬9è½®ï¼š$x^8$ (æº¢å‡ºï¼Œå˜æˆ 0x1B) ç¬¬10è½®ï¼š$x^9 = x \\cdot x^8 = 2 \\cdot 0x1B = 0x36$â€‹ 9. é™„å½•ï¼šè¿è¡Œç»“æœï¼ˆè¯¦ç»†æ—¥å¿—ï¼‰ ä»¥ä¸‹æ—¥å¿—å±•ç¤ºäº†å¯¹æ˜æ–‡ \u0026quot;hello fanshanng\u0026quot; ä½¿ç”¨å¯†é’¥ \u0026quot;secret\u0026quot; è¿›è¡ŒåŠ å¯†çš„å®Œæ•´å†…éƒ¨çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 åŸå§‹æ˜æ–‡: hello fanshanng åŸå§‹å¯†é’¥: secret å¼€å§‹åŠ å¯†... åŸå§‹é•¿åº¦: 15, å¡«å……åé•¿åº¦: 16 \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 1 å—: hello fanshanng ==================== å¼€å§‹ AES åŠ å¯† (å•å—) =================== è¾“å…¥æ•°æ® (Hex): 68656C6C6F2066616E7368616E6E6701 åˆå§‹è½®å¯†é’¥ (Hex): 73656372657400000000000000000000 -- Round 1 -- After SubBytes: 84B05399D8E9F0792B7629157886430A After ShiftRows: 84E9290AD87643792B86539978B0F015 After MixColumns: D742B4B2C67AE73340810CB134BEA817 AddRoundKey (1): 11060011747200117472001174720011 State: C64CB4A19208872234F30CA0602CB806 -- Round 2 -- After SubBytes: 0D5A8166C7F66F5672BDC6872891B03E After ShiftRows: 0DF6C63EC7BDB06672918156685A6F87 After MixColumns: 75262BEBCD333CAAA5FC11340EA7F864 AddRoundKey (2): 53658283271782925365828327178292 State: 2643A968EA24BE38F69993B729B07AF6 -- Round 3 -- After SubBytes: F71AD3458736AE0742EEDCA9A5E7DA42 After ShiftRows: F736DC4287EEDA4542E7D307A51AAEA9 After MixColumns: 31A6A46CA370092C62FE11FC78D11809 AddRoundKey (3): A776CD4F80614FDDD304CD5EF4134FCC State: 96D06923231146F1B1FADCA28CC257C5 -- Round 4 -- After SubBytes: 9070F92626825AA1C82D863A64255BA6 After ShiftRows: 908286A6262D5B26C825F9A164705A3A After MixColumns: 86B8F4F846B7D750BC33FCC63850EEF2 AddRoundKey (4): D2F286F05293C92D8197047375844BBF State: 544A720814241E7D3DA4F8B54DD4A54D -- Round 5 -- After SubBytes: 20D64030FA3672FF274941D5E34806E3 After ShiftRows: 203641E3FA490630274840FFE3D672D5 After MixColumns: B86CAACA0252EF3A2988F5841B17B52B AddRoundKey (5): 9D418E6DCFD247404E4543333BC1088C State: 252D24A7CD80A87A67CDB6B720D6BDA7 -- Round 6 -- After SubBytes: 3FD8365CBDCDC2DA85BD4EA9B7F67A5C After ShiftRows: 3FCD4E5CBDBD7A5C85F636DAB7D8C2A9 After MixColumns: 20308A7A9B0E10A3FCF26AFB6DE81091 AddRoundKey (6): C571EA8F0AA3ADCF44E6EEFC7F27E670 State: E54160F591ADBD6CB814840712CFF6E1 -- Round 7 -- After SubBytes: D983D0E681957A506CFA5FC5C98A42F8 After ShiftRows: D9955FF881FA42E66C8AD050C9837AC5 After MixColumns: AAF1E151A84ECEF7DD58AD4EA89FEA28 AddRoundKey (7): 49FFBB5D435C169207BAF86E789D1E1E State: E30E5A0CEB12D865DAE25520D002F436 -- Round 8 -- After SubBytes: 11ABBEFEE9C9614D5798FCB77077BF05 After ShiftRows: 11C9FC05E998BFFE5777BE4D70AB61B7 After MixColumns: 9B82340C3BE60DE0C42D90AAD029DB2F AddRoundKey (8): 978DC9E1D4D1DF73D36B271DABF63903 State: 0C0FFDEDEF37D2931746B7B77BDFE22C -- Round 9 -- After SubBytes: FE765455DF9AB5DCF05AA9A9219E9871 After ShiftRows: FE9AA971DF5A9855F09E54DC2176B5A9 After MixColumns: 8A40BEC8868D5112CAF7B962C4A0C6E9 AddRoundKey (9): CE9FB2831A4E6DF0C9254AED62D373EE State: 44DF0C4B9CC33CE203D2F38FA673B507 -- Final Round (10) -- After SubBytes: 1B9EFEB3DE2EEB987BB50D73248FD5C5 After ShiftRows: 1B2E0DC5DEB5D5B37B8FFE98249EEB73 AddRoundKey (10): 9E109A29845EF7D94D7BBD342FA8CEDA [åŠ å¯†ç»“æœ] (Hex): 853E97EC5AEB226A36F443AC0B3625A9 ==================== ç»“æŸ AES åŠ å¯† ==================== æœ€ç»ˆå¯†æ–‡ (Hex): 853E97EC5AEB226A36F443AC0B3625A9 å¼€å§‹è§£å¯†... \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 1 å— (Hex): 853E97EC5AEB226A36F443AC0B3625A9 ==================== å¼€å§‹ AES è§£å¯† (å•å—) =================== è¾“å…¥æ•°æ® (Hex): 853E97EC5AEB226A36F443AC0B3625A9 ç»ˆæ­¢è½®å¯†é’¥ (Hex): 9E109A29845EF7D94D7BBD342FA8CEDA -- Round 9 -- AddRoundKey (9): CE9FB2831A4E6DF0C9254AED62D373EE State: 8A40BEC8868D5112CAF7B962C4A0C6E9 After InvMixColumns: FE9AA971DF5A9855F09E54DC2176B5A9 After InvShiftRows: FE765455DF9AB5DCF05AA9A9219E9871 After InvSubBytes: 0C0FFDEDEF37D2931746B7B77BDFE22C -- Round 8 -- AddRoundKey (8): 978DC9E1D4D1DF73D36B271DABF63903 State: 9B82340C3BE60DE0C42D90AAD029DB2F After InvMixColumns: 11C9FC05E998BFFE5777BE4D70AB61B7 After InvShiftRows: 11ABBEFEE9C9614D5798FCB77077BF05 After InvSubBytes: E30E5A0CEB12D865DAE25520D002F436 -- Round 7 -- AddRoundKey (7): 49FFBB5D435C169207BAF86E789D1E1E State: AAF1E151A84ECEF7DD58AD4EA89FEA28 After InvMixColumns: D9955FF881FA42E66C8AD050C9837AC5 After InvShiftRows: D983D0E681957A506CFA5FC5C98A42F8 After InvSubBytes: E54160F591ADBD6CB814840712CFF6E1 -- Round 6 -- AddRoundKey (6): C571EA8F0AA3ADCF44E6EEFC7F27E670 State: 20308A7A9B0E10A3FCF26AFB6DE81091 After InvMixColumns: 3FCD4E5CBDBD7A5C85F636DAB7D8C2A9 After InvShiftRows: 3FD8365CBDCDC2DA85BD4EA9B7F67A5C After InvSubBytes: 252D24A7CD80A87A67CDB6B720D6BDA7 -- Round 5 -- AddRoundKey (5): 9D418E6DCFD247404E4543333BC1088C State: B86CAACA0252EF3A2988F5841B17B52B After InvMixColumns: 203641E3FA490630274840FFE3D672D5 After InvShiftRows: 20D64030FA3672FF274941D5E34806E3 After InvSubBytes: 544A720814241E7D3DA4F8B54DD4A54D -- Round 4 -- AddRoundKey (4): D2F286F05293C92D8197047375844BBF State: 86B8F4F846B7D750BC33FCC63850EEF2 After InvMixColumns: 908286A6262D5B26C825F9A164705A3A After InvShiftRows: 9070F92626825AA1C82D863A64255BA6 After InvSubBytes: 96D06923231146F1B1FADCA28CC257C5 -- Round 3 -- AddRoundKey (3): A776CD4F80614FDDD304CD5EF4134FCC State: 31A6A46CA370092C62FE11FC78D11809 After InvMixColumns: F736DC4287EEDA4542E7D307A51AAEA9 After InvShiftRows: F71AD3458736AE0742EEDCA9A5E7DA42 After InvSubBytes: 2643A968EA24BE38F69993B729B07AF6 -- Round 2 -- AddRoundKey (2): 53658283271782925365828327178292 State: 75262BEBCD333CAAA5FC11340EA7F864 After InvMixColumns: D742B4B2C67AE73340810CB134BEA817 After InvShiftRows: D7BE0C33C642A8B1407AB4173481E7B2 After InvSubBytes: 0D5A8166C7F66F5672BDC6872891B03E -- Round 1 -- AddRoundKey (1): 11060011747200117472001174720011 State: 1C5C8177B3846F4706CFC6965CE3B02F After InvMixColumns: AF20457C678F85729F9F76EF9F6333EF After InvShiftRows: AF637672672033EF9F8F45EF9F9F857C After InvSubBytes: 1B000F1E0A5466616E7368616E6E6701 AddRoundKey (0): 73656372657400000000000000000000 [è§£å¯†ç»“æœ] (Hex): 68656C6C6F2066616E7368616E6E6701 ==================== ç»“æŸ AES è§£å¯† ==================== æœ€ç»ˆéªŒè¯: åŸå§‹æ˜æ–‡: hello fanshanng è§£å¯†æ˜æ–‡: hello fanshanng åŒ¹é…æˆåŠŸ: True ","date":"2025-12-17T17:13:59+08:00","image":"https://s.panlai.com/upload/20241210043703173377662350175.jpg-arthumbs","permalink":"https://fanshanng.cn/p/aeslearn/","title":"AES å­¦ä¹ ç¬”è®°"},{"content":"2015 Challenge 3 0x00 æŸ¥å£³ä¸ç¯å¢ƒè¯†åˆ« ä½¿ç”¨ DIE (Detect It Easy) è¿›è¡Œåˆæ­¥åˆ†æï¼š\nåˆ†æç»“æœæ˜¾ç¤ºç¨‹åºæ˜¯ç”± PyInstaller æ‰“åŒ…çš„ã€‚\n0x01 è§£åŒ…ä¸åç¼–è¯‘ 1. PyInstaller è§£åŒ… ä½¿ç”¨ pyinstxtractor.py å¯¹ç›®æ ‡æ–‡ä»¶ elfie.exe (æˆ– elfie) è¿›è¡Œè§£åŒ…ï¼š\n1 python pyinstxtractor.py elfie è§£åŒ…åå¾—åˆ° elfie_extracted æ–‡ä»¶å¤¹ã€‚\n2. å­—èŠ‚ç åˆ†æ è¿›å…¥è§£åŒ…ç›®å½•ï¼Œå‘ç°å­˜åœ¨ .pyc æ–‡ä»¶ã€‚ åœ¨å°è¯•ä½¿ç”¨åç¼–è¯‘å·¥å…·å¤±è´¥åï¼Œå‘ç°å¯ä»¥ç›´æ¥æŸ¥çœ‹ .pyc æ–‡ä»¶å†…å®¹ã€‚è§‚å¯Ÿåˆ°æ–‡ä»¶å¤´é­”æ•° 03 f3 0d 0a ä»¥åŠç›®å½•ä¸‹çš„ python27.dllï¼Œç¡®è®¤è¿™æ˜¯ Python 2.7 ç¯å¢ƒã€‚\nç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æŸ¥çœ‹ .pyc æ–‡ä»¶ï¼Œå¯ä»¥æ¸…æ™°çœ‹åˆ° base64ã€b64decode ç­‰å…³é”®å­—åŠå¤§é‡æ··æ·†å˜é‡ã€‚è¿™æ˜¯ Python 2.7 å­—èŠ‚ç çš„ä¸€ä¸ªç‰¹å¾ï¼šå­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬å˜é‡åï¼‰ä»¥æœªå‹ç¼©çš„ ASCII å½¢å¼å­˜å‚¨ã€‚\nåç¼–è¯‘åçš„æºç ï¼ˆæˆ–ç›´æ¥è§‚å¯Ÿï¼‰æ˜¾ç¤ºç¨‹åºä½¿ç”¨äº†å…¸å‹çš„ exec(base64.b64decode(...)) æ··æ·†æ–¹å¼ï¼š\n1 2 3 4 5 O0OO0OO00000OOOO0OOOOO0O00O0O0O0 = \u0026#39;IRGppV0FJM3BRRlNwWGhNNG\u0026#39; # ... å¤§é‡æ··æ·†å˜é‡å®šä¹‰ ... O00OO00OOO0OOOO0OOOO0OO00000OOO0 += \u0026#39;nNocTB\u0026#39; import base64 exec(base64.b64decode(OOO0OOOOOOOO0000O000O00O0OOOO00O + ...)) 0x02 å»æ··æ·† ä¸ºäº†è·å–è¢«æ‰§è¡Œçš„çœŸå®ä»£ç ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è§£å¯†ï¼Œåªéœ€â€œå€ŸåŠ›æ‰“åŠ›â€ã€‚ç¼–å†™è„šæœ¬æ¨¡æ‹Ÿ Loader çš„å˜é‡æ‹¼æ¥è¿‡ç¨‹ï¼Œä½†å°†æœ€åçš„ exec(...) æ›¿æ¢ä¸ºæ–‡ä»¶å†™å…¥æ“ä½œã€‚\nè§£åŒ…è„šæœ¬é€»è¾‘:\n1 2 3 4 5 6 7 8 9 10 11 # ... (å¤åˆ¶åŸå§‹æ–‡ä»¶ä¸­çš„æ‰€æœ‰å˜é‡å®šä¹‰) ... import base64 # åŸå§‹ä»£ç : exec(base64.b64decode(...)) # ä¿®æ”¹ä¸ºå†™å…¥æ–‡ä»¶: decoded_code = base64.b64decode(OOO0OOOOOOOO0000O000O00O0OOOO00O + ...) with open(r\u0026#39;elfie.py\u0026#39;, \u0026#39;wb\u0026#39;) as f: f.write(decoded_code) print(\u0026#39;Decoded stage 2 saved.\u0026#39;) æå–å‡ºçš„ä»£ç éƒ¨åˆ†å¦‚å›¾æ‰€ç¤ºï¼š 0x03 é€»è¾‘åˆ†æ æå–å‡ºçš„ elfie.py æ˜¯ä¸€ä¸ªåŸºäº PySide (Qt) çš„å›¾å½¢ç•Œé¢åº”ç”¨ç¨‹åºã€‚\nè¿è¡Œæ•ˆæœï¼š ä»£ç ä¸­ä½¿ç”¨äº†å¤§é‡çš„ getattr å’Œå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆå¦‚ 'txeTnialPot'[::-1] å³ toPlainTextï¼‰æ¥éšè— API è°ƒç”¨ï¼Œå¢åŠ äº†é™æ€åˆ†æçš„éš¾åº¦ã€‚\næ ¸å¿ƒéªŒè¯é€»è¾‘: ç¨‹åºå®šä¹‰äº†ä¸€ä¸ªç»§æ‰¿è‡ª QtGui.QLineEdit çš„ç±»ï¼Œå¹¶åœ¨ keyPressEvent ä¸­ç›‘å¬å›è½¦é”®ã€‚å½“ç”¨æˆ·æŒ‰ä¸‹å›è½¦æ—¶ï¼Œè§¦å‘éªŒè¯å‡½æ•° O000OOOOOO0OOOO00000OO0O0O000OO0ã€‚\n1 2 3 4 5 6 7 8 def O000OOOOOO0OOOO00000OO0O0O000OO0(self): # è·å–ç”¨æˆ·è¾“å…¥: getattr(self, \u0026#39;toPlainText\u0026#39;)() O0O0O0000OOO000O00000OOO000OO000 = getattr(self, \u0026#39;txeTnialPot\u0026#39;[::-1])() # æ ¸å¿ƒæ¯”å¯¹é€»è¾‘ if (O0O0O0000OOO000O00000OOO000OO000 == \u0026#39;\u0026#39;.join((OO00O00OOOO00OO000O00OO0OOOO0000 for OO00O00OOOO00OO000O00OO0OOOO0000 in reversed(\u0026#39;moc.no-eralf@OOOOY.sev0000L.eiflE\u0026#39;)))): self.OO0O0O0O0OO0OO00000OO00O0O0000O0.setWindowTitle(\u0026#39;!sseccus taerg\u0026#39;[::-1]) # ... æ˜¾ç¤ºæˆåŠŸçŠ¶æ€ ... 0x04 Flag è·å– åˆ†æä¸Šè¿°æ¯”å¯¹é€»è¾‘ï¼š reversed('moc.no-eralf@OOOOY.sev0000L.eiflE') ä¼šå°†å­—ç¬¦ä¸²åè½¬ã€‚\nç›´æ¥åè½¬ç¡¬ç¼–ç å­—ç¬¦ä¸²å³å¯å¾—åˆ° Flagï¼š\n1 Elfie.L0000ves.YOOOO@flare-on.com 0x05 é™„å½•ï¼šç°ä»£ç¯å¢ƒè¿è¡Œå…¼å®¹æ€§ ç›´æ¥æå–çš„ä»£ç ä¾èµ–äºè€æ—§çš„ PySide (Qt4) åº“ã€‚åœ¨ç°ä»£ Python 3 ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä½¿ç”¨ PySide2 (Qt5) æˆ– PySide6 (Qt6)ã€‚\nä¸ºäº†è®©æå–çš„ä»£ç åœ¨ç°ä»£ç¯å¢ƒä¸­è¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å«ç‰‡ä»£ç ï¼ˆShimï¼‰è¿›è¡Œå…¼å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 try: from PySide import QtGui, QtCore except ImportError: try: from PySide2 import QtGui, QtCore, QtWidgets # å°† QtWidgets ä¸­çš„å±æ€§æ˜ å°„å› QtGuiï¼Œä»¥å…¼å®¹æ—§ä»£ç  for name in dir(QtWidgets): if not hasattr(QtGui, name): setattr(QtGui, name, getattr(QtWidgets, name)) except ImportError: from PySide6 import QtGui, QtCore, QtWidgets for name in dir(QtWidgets): if not hasattr(QtGui, name): setattr(QtGui, name, getattr(QtWidgets, name)) æ­¤å¤–ï¼Œä»£ç ä¸­è¿˜åŒ…å«ä¸¤æ®µ Base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«å¯¹åº”éªŒè¯æˆåŠŸå’Œå¤±è´¥æ—¶æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œæ„Ÿå…´è¶£å¯ä»¥è§£ç è¿˜åŸã€‚\n","date":"2025-12-16T22:29:11+08:00","image":"https://s.panlai.com/zb_users/upload/2025/06/20250618045138175019349817696.jpg-arthumbs","permalink":"https://fanshanng.cn/p/flare_on/","title":"The Flare-On Challenge ç»ƒä¹ è®°å½•"},{"content":"1. ç®—æ³•æ¦‚è§ˆ å…¨ç§°ï¼šData Encryption Standard (æ•°æ®åŠ å¯†æ ‡å‡†) ç±»å‹ï¼šå¯¹ç§°åŠ å¯†ï¼ˆåŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼‰ åˆ†ç»„é•¿åº¦ï¼š64ä½ (8å­—èŠ‚) å¯†é’¥é•¿åº¦ï¼š64ä½ (å®é™…æœ‰æ•ˆä½ 56ä½ï¼Œå…¶ä½™8ä½ä¸ºå¥‡å¶æ ¡éªŒä½) ç»“æ„ï¼šFeistel ç½‘ç»œç»“æ„ (16è½®è¿­ä»£) 2. å¯†é’¥ç”Ÿæˆ (Key Schedule) è¿™æ˜¯ DES çš„ç¬¬ä¸€æ­¥ï¼Œç›®çš„æ˜¯ä»åŸå§‹çš„ 64 ä½å¯†é’¥ä¸­ç”Ÿæˆ 16 ä¸ª 48 ä½çš„å­å¯†é’¥ ($K_1, K_2, \u0026hellip;, K_{16}$)ã€‚\nç†è®ºä¸ä»£ç å¯¹åº”è¯¦è§£ PC-1 ç½®æ¢ (64ä½ -\u0026gt; 56ä½)\nç†è®ºï¼šåŸå§‹å¯†é’¥æ˜¯ 64 ä½ï¼Œä½†å…¶ä¸­ç¬¬ 8, 16, 24\u0026hellip; ç­‰ 8 ä¸ªä½æ˜¯å¥‡å¶æ ¡éªŒä½ï¼Œä¸å‚ä¸åŠ å¯†ã€‚PC-1 è¡¨å°†è¿™ 8 ä½ä¸¢å¼ƒï¼Œå¹¶æ‰“ä¹±å‰©ä½™ 56 ä½çš„é¡ºåºã€‚\nä»£ç å®ç°ï¼š\n1 2 3 # å¯¹åº”ä»£ç ä¸­çš„ generate_subkeys å‡½æ•° # PC1_TABLE åªæœ‰ 56 ä¸ªç´¢å¼•ï¼Œç›´æ¥å®Œæˆäº†\u0026#34;å»æ ¡éªŒä½\u0026#34;å’Œ\u0026#34;ä¹±åº\u0026#34;ä¸¤ä»¶äº‹ key_56 = permute(key_bin, PC1_TABLE) å·¦å³æ‹†åˆ†\nç†è®ºï¼šå°† 56 ä½åˆ†ä¸ºå‰ 28 ä½ ($C_0$) å’Œå 28 ä½ ($D_0$)ã€‚\nä»£ç å®ç°ï¼š\n1 2 c = key_56[:28] d = key_56[28:] 16è½®å¾ªç¯å·¦ç§» (Left Shift)\nç†è®ºï¼šæ¯ä¸€è½®æ ¹æ®å›ºå®šçš„è§„åˆ™å·¦ç§» 1 ä½æˆ– 2 ä½ã€‚è¿™èƒ½ä¿è¯æ¯ä¸€è½®çš„å­å¯†é’¥éƒ½ä¸åŒã€‚\nä»£ç å®ç°ï¼š\n1 2 3 4 5 6 # SHIFT_SCHEDULE å®šä¹‰äº†æ¯è½®å·¦ç§»çš„ä½æ•° # [1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1] shift = SHIFT_SCHEDULE[i] # è¾…åŠ©å‡½æ•° left_shift å®ç°åˆ‡ç‰‡æ‹¼æ¥ï¼šdata[n:] + data[:n] c = left_shift(c, shift) d = left_shift(d, shift) PC-2 ç½®æ¢ (56ä½ -\u0026gt; 48ä½)\nç†è®ºï¼šä»ç§»ä½åçš„ 56 ä½ ($C_i + D_i$) ä¸­é€‰å‡º 48 ä½ï¼Œä½œä¸ºæœ¬è½®çš„å­å¯†é’¥ $K_i$ã€‚\nä»£ç å®ç°ï¼š\n1 2 cd = c + d k = permute(cd, PC2_TABLE) # å†æ¬¡åˆ©ç”¨é€šç”¨ç½®æ¢å‡½æ•°ï¼Œé€‰å‡º48ä½ 3. åŠ å¯†ä¸»æµç¨‹ (Feistel ç»“æ„) DES çš„æ ¸å¿ƒæ˜¯ 16 è½®è¿­ä»£ï¼ŒåŠ ä¸Šå¤´å°¾çš„ä¸¤ä¸ªç½®æ¢ã€‚\nç†è®ºä¸ä»£ç å¯¹åº”è¯¦è§£ åˆå§‹ç½®æ¢ (IP)\nç†è®ºï¼šå°† 64 ä½æ˜æ–‡æŒ‰ç…§ IP è¡¨æ‰“ä¹±ã€‚ ä»£ç å®ç°ï¼šip_data = permute(data_bin, IP_TABLE) å·¦å³æ‹†åˆ†\nç†è®ºï¼š$L_0$ (å‰32ä½), $R_0$ (å32ä½)ã€‚ ä»£ç å®ç°ï¼šl, r = ip_data[:32], ip_data[32:] 16 è½®è¿­ä»£ (Round Function)\nç†è®ºå…¬å¼ï¼š\n$L_i = R_{i-1}$ $R_i = L_{i-1} \\oplus f(R_{i-1}, K_i)$ ä»£ç æ ¸å¿ƒé€»è¾‘ (des_process å‡½æ•°ä¸­)ï¼š\n1 2 3 4 5 6 7 8 9 10 11 for i in range(16): prev_l = l prev_r = r # æ–°çš„å·¦è¾¹ = æ—§çš„å³è¾¹ l = prev_r # æ–°çš„å³è¾¹ = æ—§çš„å·¦è¾¹ XOR è½®å‡½æ•°ç»“æœ # f_function æ˜¯æ ¸å¿ƒå¤æ‚éƒ¨åˆ†ï¼Œè§ä¸‹æ–‡è¯¦è§£ f_res = f_function(prev_r, subkeys[i], verbose) r = xor(prev_l, f_res) 32ä½äº’æ¢ä¸é€†åˆå§‹ç½®æ¢\nç†è®ºï¼šæ ‡å‡† DES åœ¨ç¬¬ 16 è½®åï¼Œè¾“å‡ºæ˜¯ $R_{16}L_{16}$ï¼ˆæ³¨æ„ä¸æ˜¯ $L_{16}R_{16}$ï¼‰ã€‚ç„¶åè¿›è¡Œ $IP^{-1}$ã€‚\nä»£ç å®ç°ï¼š\n1 2 final_rl = r + l # æ³¨æ„è¿™é‡Œæ˜¯ r + lï¼Œå®ç°äº†32ä½äº’æ¢ cipher_bin = permute(final_rl, IP_INV_TABLE) ğŸ’¡ é‡ç‚¹ï¼šè§£å¯†è¿‡ç¨‹ è§£å¯†è¿‡ç¨‹ä¸åŠ å¯†å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å­å¯†é’¥çš„ä½¿ç”¨é¡ºåºç›¸å ($K_{16} \\to K_1$)ã€‚\nä»£ç å®ç°ï¼š\n1 2 if mode == \u0026#39;decrypt\u0026#39;: subkeys = subkeys[::-1] # Python åˆ—è¡¨åˆ‡ç‰‡åè½¬ 4. æ ¸å¿ƒï¼šè½®å‡½æ•° $f(R, K)$ è¿™æ˜¯ DES æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œè¾“å…¥ 32 ä½æ•°æ® $R$ï¼Œä¸ 48 ä½å­å¯†é’¥ $K$ æ··åˆï¼Œè¾“å‡º 32 ä½ç»“æœã€‚\nç†è®ºä¸ä»£ç å¯¹åº”è¯¦è§£ E æ‰©å±•ç½®æ¢ (Expansion)\nç†è®ºï¼šå°† 32 ä½æ‰©å±•ä¸º 48 ä½ï¼Œè®©æ•°æ®é•¿åº¦åŒ¹é…å­å¯†é’¥ã€‚ ä»£ç å®ç°ï¼šexpanded_r = permute(right_data, E_BOX_TABLE) å¯†é’¥åŠ  (XOR)\nç†è®ºï¼šæ•°æ®ä¸å­å¯†é’¥è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ ä»£ç å®ç°ï¼šxored = xor(expanded_r, subkey) S ç›’ä»£æ¢ (Substitution) â€”â€” å…³é”®éš¾ç‚¹\nç†è®ºï¼šå°† 48 ä½å‹ç¼©å› 32 ä½ã€‚48ä½è¢«åˆ†ä¸º 8 ç»„ï¼Œæ¯ç»„ 6 ä½ã€‚æ¯ç»„ 6 ä½é€šè¿‡æŸ¥è¡¨å˜æˆ 4 ä½ã€‚\nä»£ç ç»†èŠ‚è¯¦è§£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 # éå† 8 ä¸ª Sç›’ for i in range(8): chunk = xored[i*6 : (i+1)*6] # å–å‡º 6 ä½ï¼Œä¾‹å¦‚ \u0026#34;101101\u0026#34; # è¡Œå·è®¡ç®—ï¼šå–ç¬¬1ä½å’Œç¬¬6ä½ (\u0026#34;1...1\u0026#34; -\u0026gt; \u0026#34;11\u0026#34; -\u0026gt; 3) row = int(chunk[0] + chunk[5], 2) # åˆ—å·è®¡ç®—ï¼šå–ä¸­é—´4ä½ (\u0026#34;0110\u0026#34; -\u0026gt; 6) col = int(chunk[1:5], 2) # æŸ¥è¡¨å¹¶è½¬å› 4ä½äºŒè¿›åˆ¶å­—ç¬¦ä¸² val = S_BOXES[i][row][col] s_box_output += format(val, \u0026#39;04b\u0026#39;) P ç›’ç½®æ¢ (Permutation)\nç†è®ºï¼šå°† S ç›’è¾“å‡ºçš„ 32 ä½å†æ¬¡æ‰“ä¹±ï¼Œè®©æŸä¸€ä½çš„å˜åŒ–èƒ½æ‰©æ•£åˆ°ä¸‹ä¸€è½®çš„æ›´å¤šä½ä¸­ã€‚ ä»£ç å®ç°ï¼šp_box_output = permute(s_box_output, P_BOX_TABLE) 5. å·¥ç¨‹åŒ–å¤„ç†ï¼šåˆ†ç»„ä¸å¡«å…… æ ‡å‡†çš„ DES åªèƒ½å¤„ç† 64 ä½ (8å­—èŠ‚) çš„æ•°æ®å—ã€‚å¦‚æœæ˜æ–‡é•¿åº¦ä¸æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ï¼Œæˆ–è€…è¶…è¿‡ 8 å­—èŠ‚ï¼Œå°±éœ€è¦è¿›è¡Œå¡«å…… (Padding) å’Œ åˆ†ç»„æ¨¡å¼ (Block Cipher Mode) å¤„ç†ã€‚\n5.1 PKCS#5 å¡«å…… æœ€å¸¸è§çš„å¡«å……æ–¹å¼æ˜¯ PKCS#5 (å¯¹äº 8 å­—èŠ‚åˆ†ç»„ä¹Ÿå¸¸ç§°ä¸º PKCS#7)ã€‚ è§„åˆ™ï¼šç¼º $N$ ä¸ªå­—èŠ‚ï¼Œå°±å¡«å…… $N$ ä¸ªæ•°å€¼ä¸º $N$ çš„å­—èŠ‚ã€‚\nå¦‚æœåˆšå¥½æ˜¯ 8 å­—èŠ‚å€æ•°ï¼Œåˆ™å¡«å…… 8 ä¸ª 0x08ã€‚ æ•°æ® ABCDE (5å­—èŠ‚)ï¼Œç¼º 3 å­—èŠ‚ $\\to$ å¡«å…… 3 ä¸ª 0x03 $\\to$ ABCDE\\x03\\x03\\x03ã€‚æ•°æ®åˆšå¥½ 8 å­—èŠ‚ $\\to$â€‹ å¡«å…… 8 ä¸ª 0x08 (å¢åŠ ä¸€ä¸ªå®Œæ•´å—ï¼Œä»¥ä¾¿è§£å¯†æ—¶çŸ¥é“æœ‰å¡«å……)ã€‚ 5.2 å¯†é’¥å¤„ç† è¿‡çŸ­ï¼šé€šå¸¸ç”¨ \\0 è¡¥é½ï¼Œæˆ–é‡å¤å¯†é’¥ã€‚ è¿‡é•¿ï¼šç›´æ¥æˆªæ–­å–å‰ 8 å­—èŠ‚ï¼Œæˆ–è¿›è¡Œ Hash è¿ç®— (å¦‚ MD5) å–å‰ 8 å­—èŠ‚ã€‚ 5.3 ECB æ¨¡å¼ (Electronic Codebook)(ç”µå­å¯†ç æœ¬æ¨¡å¼) æœ€ç®€å•çš„åˆ†ç»„æ¨¡å¼ã€‚å°†æ˜æ–‡åˆ†æˆ 8 å­—èŠ‚çš„å—ï¼Œæ¯å—ç‹¬ç«‹åŠ å¯†ã€‚\nä¼˜ç‚¹ï¼šç®€å•ï¼Œå¯å¹¶è¡Œã€‚ ç¼ºç‚¹ï¼šç›¸åŒçš„æ˜æ–‡å—ä¼šäº§ç”Ÿç›¸åŒçš„å¯†æ–‡å—ï¼Œå®¹æ˜“è¢«æ¨¡å¼åˆ†æã€‚ é™„ï¼šCBC (å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼)ï¼šæ›´å®‰å…¨ã€‚å½“å‰æ˜æ–‡å—å…ˆä¸å‰ä¸€ä¸ªå¯†æ–‡å—å¼‚æˆ–ï¼Œå†åŠ å¯†ã€‚\n5.3 å¸¸è§ç–‘é—®ï¼šå¯†é’¥è¿‡é•¿æ€ä¹ˆåŠï¼Ÿ å¾ˆå¤šåˆå­¦è€…ä¼šæœ‰ç–‘é—®ï¼šå¦‚æœå¯†é’¥é•¿åº¦è¶…è¿‡ 8 å­—èŠ‚ï¼Œæ˜¯å–å‰ 8 å­—èŠ‚ï¼Œè¿˜æ˜¯ä¹Ÿè¿›è¡Œåˆ†ç»„ï¼Ÿ\nç­”æ¡ˆæ˜¯ï¼šæ ‡å‡† DES å¯†é’¥å¿…é¡»æ˜¯ 8 å­—èŠ‚ã€‚\næˆªæ–­ (Truncation)ï¼š\nå¤§å¤šæ•°ç®€å•çš„ DES å®ç°ï¼ˆåŒ…æ‹¬æœ¬ä»£ç ï¼‰å¦‚æœæ”¶åˆ°é•¿å¯†é’¥ï¼Œåªä¼šè¯»å–å‰ 64 ä½ï¼ˆ8å­—èŠ‚ï¼‰å‚ä¸å¯†é’¥ç”Ÿæˆï¼ˆPC-1 ç½®æ¢åªçœ‹å‰ 64 ä½ï¼‰ï¼Œåé¢çš„éƒ¨åˆ†ä¼šè¢«ç›´æ¥å¿½ç•¥ã€‚ å¹¶ä¸ä¼šå‡ºç°â€œç”¨å¯†é’¥çš„ç¬¬ä¸€ç»„åŠ å¯†æ˜æ–‡ç¬¬ä¸€ç»„ï¼Œç”¨å¯†é’¥ç¬¬äºŒç»„åŠ å¯†æ˜æ–‡ç¬¬äºŒç»„â€çš„æƒ…å†µã€‚å¯†é’¥åœ¨æ•´ä¸ªé€šä¿¡è¿‡ç¨‹ä¸­å¿…é¡»æ˜¯å›ºå®šçš„ã€‚ 3DES (Triple DES)ï¼š\nå¦‚æœéœ€è¦ä½¿ç”¨æ›´é•¿çš„å¯†é’¥ï¼ˆå¦‚ 16 å­—èŠ‚æˆ– 24 å­—èŠ‚ï¼‰æ¥æå‡å®‰å…¨æ€§ï¼Œæ ‡å‡†åšæ³•æ˜¯ä½¿ç”¨ 3DESã€‚ 3DES å®é™…ä¸Šæ˜¯è¿è¡Œä¸‰æ¬¡ DESï¼š$C = E_{K3}(D_{K2}(E_{K1}(P)))$ã€‚ å·¥ç¨‹å®è·µï¼š\nåœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥äº†ä¸€ä¸ªé•¿å¯†ç ï¼ˆPassphraseï¼‰ï¼Œé€šå¸¸ä¼šä½¿ç”¨å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA-256ï¼‰å°†å…¶è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„æ‘˜è¦ï¼Œç„¶åæˆªå–å‰ 8 å­—èŠ‚ä½œä¸º DES å¯†é’¥ã€‚ 6. é™„å½•ï¼šå®Œæ•´ Python å®ç°ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 import sys # ============================================================================= # DES ç®—æ³•å¸¸é‡å®šä¹‰ (æ ‡å‡†è¡¨) # ============================================================================= # åˆå§‹ç½®æ¢è¡¨ (IP) IP_TABLE = [ 58, 50, 42, 34, 26, 18, 10, 2, 60, 52, 44, 36, 28, 20, 12, 4, 62, 54, 46, 38, 30, 22, 14, 6, 64, 56, 48, 40, 32, 24, 16, 8, 57, 49, 41, 33, 25, 17, 9, 1, 59, 51, 43, 35, 27, 19, 11, 3, 61, 53, 45, 37, 29, 21, 13, 5, 63, 55, 47, 39, 31, 23, 15, 7 ] # é€†åˆå§‹ç½®æ¢è¡¨ (IP^-1) IP_INV_TABLE = [ 40, 8, 48, 16, 56, 24, 64, 32, 39, 7, 47, 15, 55, 23, 63, 31, 38, 6, 46, 14, 54, 22, 62, 30, 37, 5, 45, 13, 53, 21, 61, 29, 36, 4, 44, 12, 52, 20, 60, 28, 35, 3, 43, 11, 51, 19, 59, 27, 34, 2, 42, 10, 50, 18, 58, 26, 33, 1, 41, 9, 49, 17, 57, 25 ] # æ‰©å±•ç½®æ¢è¡¨ (E-Box): 32ä½ -\u0026gt; 48ä½ E_BOX_TABLE = [ 32, 1, 2, 3, 4, 5, 4, 5, 6, 7, 8, 9, 8, 9, 10, 11, 12, 13, 12, 13, 14, 15, 16, 17, 16, 17, 18, 19, 20, 21, 20, 21, 22, 23, 24, 25, 24, 25, 26, 27, 28, 29, 28, 29, 30, 31, 32, 1 ] # Pç›’ç½®æ¢è¡¨ (P-Box): 32ä½ -\u0026gt; 32ä½ P_BOX_TABLE = [ 16, 7, 20, 21, 29, 12, 28, 17, 1, 15, 23, 26, 5, 18, 31, 10, 2, 8, 24, 14, 32, 27, 3, 9, 19, 13, 30, 6, 22, 11, 4, 25 ] # å¯†é’¥ç½®æ¢è¡¨ 1 (PC-1): 64ä½ -\u0026gt; 56ä½ (å»æ‰äº†æ ¡éªŒä½) PC1_TABLE = [ 57, 49, 41, 33, 25, 17, 9, 1, 58, 50, 42, 34, 26, 18, 10, 2, 59, 51, 43, 35, 27, 19, 11, 3, 60, 52, 44, 36, 63, 55, 47, 39, 31, 23, 15, 7, 62, 54, 46, 38, 30, 22, 14, 6, 61, 53, 45, 37, 29, 21, 13, 5, 28, 20, 12, 4 ] # å¯†é’¥ç½®æ¢è¡¨ 2 (PC-2): 56ä½ -\u0026gt; 48ä½ PC2_TABLE = [ 14, 17, 11, 24, 1, 5, 3, 28, 15, 6, 21, 10, 23, 19, 12, 4, 26, 8, 16, 7, 27, 20, 13, 2, 41, 52, 31, 37, 47, 55, 30, 40, 51, 45, 33, 48, 44, 49, 39, 56, 34, 53, 46, 42, 50, 36, 29, 32 ] # å¯†é’¥å·¦ç§»ä½æ•°è¡¨ (æ¯è½®å·¦ç§»çš„ä½æ•°) SHIFT_SCHEDULE = [1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1] # Sç›’ (S-Boxes): 8ä¸ª Sç›’ï¼Œæ¯ä¸ªå°† 6ä½ æ˜ å°„ä¸º 4ä½ S_BOXES = [ # S1 [ [14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7], [0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8], [4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0], [15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13] ], # S2 [ [15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10], [3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5], [0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15], [13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9] ], # S3 [ [10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8], [13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1], [13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7], [1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12] ], # S4 [ [7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15], [13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9], [10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4], [3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14] ], # S5 [ [2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9], [14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6], [4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14], [11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3] ], # S6 [ [12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11], [10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8], [9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6], [4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13] ], # S7 [ [4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1], [13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6], [1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2], [6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12] ], # S8 [ [13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7], [1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2], [7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8], [2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11] ] ] # ============================================================================= # è¾…åŠ©å·¥å…·å‡½æ•° # ============================================================================= def str_to_bin(text): \u0026#34;\u0026#34;\u0026#34;å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸² (æ¯ä¸ªå­—ç¬¦8ä½)\u0026#34;\u0026#34;\u0026#34; return \u0026#39;\u0026#39;.join(format(ord(c), \u0026#39;08b\u0026#39;) for c in text) def bin_to_str(binary): \u0026#34;\u0026#34;\u0026#34;å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ä¸²\u0026#34;\u0026#34;\u0026#34; # æ¯8ä½ä¸€ç»„ chars = [binary[i:i+8] for i in range(0, len(binary), 8)] return \u0026#39;\u0026#39;.join(chr(int(c, 2)) for c in chars) def hex_to_bin(hex_str): \u0026#34;\u0026#34;\u0026#34;å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²\u0026#34;\u0026#34;\u0026#34; # æ¯ä¸ªhexå­—ç¬¦å¯¹åº”4ä½bin return \u0026#39;\u0026#39;.join(format(int(c, 16), \u0026#39;04b\u0026#39;) for c in hex_str) def bin_to_hex(binary): \u0026#34;\u0026#34;\u0026#34;å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²\u0026#34;\u0026#34;\u0026#34; # æ¯4ä½ä¸€ç»„ hex_str = \u0026#34;\u0026#34; for i in range(0, len(binary), 4): chunk = binary[i:i+4] hex_str += format(int(chunk, 2), \u0026#39;x\u0026#39;).upper() return hex_str def permute(data, table): \u0026#34;\u0026#34;\u0026#34; é€šç”¨ç½®æ¢å‡½æ•° data: è¾“å…¥çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² table: ç½®æ¢è¡¨ (1-based index) \u0026#34;\u0026#34;\u0026#34; return \u0026#39;\u0026#39;.join(data[i - 1] for i in table) def xor(a, b): \u0026#34;\u0026#34;\u0026#34;å¯¹ä¸¤ä¸ªç­‰é•¿çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œå¼‚æˆ–è¿ç®—\u0026#34;\u0026#34;\u0026#34; return \u0026#39;\u0026#39;.join(\u0026#39;1\u0026#39; if x != y else \u0026#39;0\u0026#39; for x, y in zip(a, b)) def left_shift(data, n): \u0026#34;\u0026#34;\u0026#34;å¾ªç¯å·¦ç§» n ä½\u0026#34;\u0026#34;\u0026#34; return data[n:] + data[:n] # ============================================================================= # å¡«å……ä¸å¯†é’¥å¤„ç† (æ–°å¢) # ============================================================================= def pkcs7_pad(text): \u0026#34;\u0026#34;\u0026#34;PKCS#7 å¡«å……: å°†æ–‡æœ¬å¡«å……ä¸º 8 çš„å€æ•°\u0026#34;\u0026#34;\u0026#34; pad_len = 8 - (len(text) % 8) padding = chr(pad_len) * pad_len return text + padding def pkcs7_unpad(text): \u0026#34;\u0026#34;\u0026#34;PKCS#7 å»å¡«å……\u0026#34;\u0026#34;\u0026#34; pad_len = ord(text[-1]) return text[:-pad_len] def process_key(key_str): \u0026#34;\u0026#34;\u0026#34;å¤„ç†å¯†é’¥: ç¡®ä¿æ˜¯ 8 å­—èŠ‚\u0026#34;\u0026#34;\u0026#34; # å¦‚æœå¤ªçŸ­ï¼Œè¡¥ \\0 if len(key_str) \u0026lt; 8: return key_str.ljust(8, \u0026#39;\\0\u0026#39;) # å¦‚æœå¤ªé•¿ï¼Œæˆªæ–­ (å®é™…åº”ç”¨ä¸­é€šå¸¸åš Hash) elif len(key_str) \u0026gt; 8: return key_str[:8] return key_str # ============================================================================= # æ ¸å¿ƒé€»è¾‘å‡½æ•° # ============================================================================= def generate_subkeys(key_bin, verbose=False): \u0026#34;\u0026#34;\u0026#34; ç”Ÿæˆ 16 ä¸ª 48 ä½çš„å­å¯†é’¥ key_bin: 64ä½äºŒè¿›åˆ¶å¯†é’¥ \u0026#34;\u0026#34;\u0026#34; if verbose: print(f\u0026#34;\\n[å¯†é’¥ç”Ÿæˆ] åŸå§‹å¯†é’¥ (64ä½): {key_bin}\u0026#34;) # 1. PC-1 ç½®æ¢ (64ä½ -\u0026gt; 56ä½) key_56 = permute(key_bin, PC1_TABLE) if verbose: print(f\u0026#34;[å¯†é’¥ç”Ÿæˆ] PC-1ç½®æ¢å (56ä½): {key_56}\u0026#34;) # åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ† C0, D0 c = key_56[:28] d = key_56[28:] subkeys = [] for i in range(16): # 2. å¾ªç¯å·¦ç§» shift = SHIFT_SCHEDULE[i] c = left_shift(c, shift) d = left_shift(d, shift) # åˆå¹¶ cd = c + d # 3. PC-2 ç½®æ¢ (56ä½ -\u0026gt; 48ä½) k = permute(cd, PC2_TABLE) subkeys.append(k) if verbose: print(f\u0026#34; Round {i+1:2d}: å·¦ç§» {shift} ä½ -\u0026gt; å­å¯†é’¥: {bin_to_hex(k)}\u0026#34;) return subkeys def f_function(right_data, subkey, verbose=False): \u0026#34;\u0026#34;\u0026#34; Feistel è½®å‡½æ•° f(R, K) right_data: 32ä½ subkey: 48ä½ \u0026#34;\u0026#34;\u0026#34; # 1. æ‰©å±•ç½®æ¢ E (32 -\u0026gt; 48) expanded_r = permute(right_data, E_BOX_TABLE) # 2. ä¸å­å¯†é’¥å¼‚æˆ– xored = xor(expanded_r, subkey) # 3. Sç›’ä»£æ¢ (48 -\u0026gt; 32) # å°†48ä½åˆ†ä¸º8ç»„ï¼Œæ¯ç»„6ä½ s_box_output = \u0026#34;\u0026#34; for i in range(8): chunk = xored[i*6 : (i+1)*6] # è¡Œå·ï¼šç¬¬1ä½å’Œç¬¬6ä½ row = int(chunk[0] + chunk[5], 2) # åˆ—å·ï¼šç¬¬2,3,4,5ä½ col = int(chunk[1:5], 2) # æŸ¥è¡¨ val = S_BOXES[i][row][col] # è½¬ä¸º4ä½äºŒè¿›åˆ¶ s_box_output += format(val, \u0026#39;04b\u0026#39;) # 4. Pç›’ç½®æ¢ (32 -\u0026gt; 32) p_box_output = permute(s_box_output, P_BOX_TABLE) return p_box_output def des_process(data_bin, key_bin, mode=\u0026#39;encrypt\u0026#39;, verbose=True): \u0026#34;\u0026#34;\u0026#34; DES æ ¸å¿ƒå¤„ç†æµç¨‹ (åŠ å¯†/è§£å¯†å…±ç”¨) data_bin: 64ä½æ•°æ® key_bin: 64ä½å¯†é’¥ mode: \u0026#39;encrypt\u0026#39; æˆ– \u0026#39;decrypt\u0026#39; \u0026#34;\u0026#34;\u0026#34; action_name = \u0026#34;åŠ å¯†\u0026#34; if mode == \u0026#39;encrypt\u0026#39; else \u0026#34;è§£å¯†\u0026#34; if verbose: print(f\u0026#34;\\n{\u0026#39;=\u0026#39;*20} å¼€å§‹ DES {action_name} (å•å—) {\u0026#39;=\u0026#39;*20}\u0026#34;) print(f\u0026#34;è¾“å…¥æ•°æ® (Hex): {bin_to_hex(data_bin)}\u0026#34;) print(f\u0026#34;å¯†é’¥ (Hex): {bin_to_hex(key_bin)}\u0026#34;) # 1. ç”Ÿæˆå­å¯†é’¥ subkeys = generate_subkeys(key_bin, verbose=verbose) # å¦‚æœæ˜¯è§£å¯†ï¼Œå­å¯†é’¥é¡ºåºåè½¬ if mode == \u0026#39;decrypt\u0026#39;: subkeys = subkeys[::-1] if verbose: print(f\u0026#34;\\n[æ³¨æ„] è§£å¯†æ¨¡å¼ï¼šå­å¯†é’¥é¡ºåºå·²åè½¬\u0026#34;) # 2. åˆå§‹ç½®æ¢ IP ip_data = permute(data_bin, IP_TABLE) if verbose: print(f\u0026#34;\\n[åˆå§‹ç½®æ¢ IP] ç»“æœ: {bin_to_hex(ip_data)}\u0026#34;) # å°†æ•°æ®åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ† L0, R0 l = ip_data[:32] r = ip_data[32:] if verbose: print(f\u0026#34;åˆå§‹ L0: {bin_to_hex(l)}\u0026#34;) print(f\u0026#34;åˆå§‹ R0: {bin_to_hex(r)}\u0026#34;) print(\u0026#34;-\u0026#34; * 60) # 3. 16è½®è¿­ä»£ for i in range(16): prev_l = l prev_r = r # L(i) = R(i-1) l = prev_r # R(i) = L(i-1) XOR f(R(i-1), K(i)) f_res = f_function(prev_r, subkeys[i], verbose) r = xor(prev_l, f_res) if verbose: print(f\u0026#34;Round {i+1:2d}:\u0026#34;) print(f\u0026#34; K{i+1 if mode==\u0026#39;encrypt\u0026#39; else 16-i}: {bin_to_hex(subkeys[i])}\u0026#34;) print(f\u0026#34; L{i+1}: {bin_to_hex(l)} (from old R)\u0026#34;) print(f\u0026#34; f(R,K): {bin_to_hex(f_res)}\u0026#34;) print(f\u0026#34; R{i+1}: {bin_to_hex(r)} (L XOR f)\u0026#34;) # 4. 32ä½äº’æ¢ final_rl = r + l if verbose: print(\u0026#34;-\u0026#34; * 60) print(f\u0026#34;[32ä½äº’æ¢] ç»“æœ (R16 L16): {bin_to_hex(final_rl)}\u0026#34;) # 5. é€†åˆå§‹ç½®æ¢ IP^-1 cipher_bin = permute(final_rl, IP_INV_TABLE) if verbose: print(f\u0026#34;\\n[{action_name}ç»“æœ] (Hex): {bin_to_hex(cipher_bin)}\u0026#34;) print(f\u0026#34;{\u0026#39;=\u0026#39;*20} ç»“æŸ DES {action_name} {\u0026#39;=\u0026#39;*20}\\n\u0026#34;) return cipher_bin # ============================================================================= # é«˜çº§æ¥å£ (æ”¯æŒä¸å®šé•¿æ•°æ®) # ============================================================================= def des_encrypt_ecb(text, key, verbose=False): \u0026#34;\u0026#34;\u0026#34;ECB æ¨¡å¼åŠ å¯†\u0026#34;\u0026#34;\u0026#34; key = process_key(key) key_bin = str_to_bin(key) # 1. å¡«å…… text_padded = pkcs7_pad(text) print(f\u0026#34;åŸå§‹é•¿åº¦: {len(text)}, å¡«å……åé•¿åº¦: {len(text_padded)}\u0026#34;) ciphertext_hex = \u0026#34;\u0026#34; # 2. åˆ†ç»„å¤„ç† for i in range(0, len(text_padded), 8): block = text_padded[i:i+8] print(f\u0026#34;\\n\u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ {i//8 + 1} å—: {block}\u0026#34;) block_bin = str_to_bin(block) cipher_bin = des_process(block_bin, key_bin, mode=\u0026#39;encrypt\u0026#39;, verbose=verbose) ciphertext_hex += bin_to_hex(cipher_bin) return ciphertext_hex def des_decrypt_ecb(hex_str, key, verbose=False): \u0026#34;\u0026#34;\u0026#34;ECB æ¨¡å¼è§£å¯†\u0026#34;\u0026#34;\u0026#34; key = process_key(key) key_bin = str_to_bin(key) plaintext = \u0026#34;\u0026#34; # 1. åˆ†ç»„å¤„ç† for i in range(0, len(hex_str), 16): block_hex = hex_str[i:i+16] print(f\u0026#34;\\n\u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ {i//16 + 1} å— (Hex): {block_hex}\u0026#34;) block_bin = hex_to_bin(block_hex) plain_bin = des_process(block_bin, key_bin, mode=\u0026#39;decrypt\u0026#39;, verbose=verbose) plaintext += bin_to_str(plain_bin) # 2. å»å¡«å…… return pkcs7_unpad(plaintext) # ============================================================================= # ç”¨æˆ·æ¥å£ # ============================================================================= def main(): # ç¤ºä¾‹ï¼šä¸å®šé•¿æ•°æ®å’ŒçŸ­å¯†é’¥ raw_key = \u0026#34;secret\u0026#34; # 6å­—èŠ‚ (ä¸è¶³8å­—èŠ‚) raw_text = \u0026#34;hello fanshanng\u0026#34; # 15å­—èŠ‚ print(f\u0026#34;åŸå§‹æ˜æ–‡: {raw_text}\u0026#34;) print(f\u0026#34;åŸå§‹å¯†é’¥: {raw_key}\u0026#34;) # 1. åŠ å¯† print(\u0026#34;\\nå¼€å§‹åŠ å¯†...\u0026#34;) # verbose=False é¿å…æ‰“å°å¤ªå¤šç»†èŠ‚ï¼Œåªçœ‹åˆ†ç»„æµç¨‹ cipher_hex = des_encrypt_ecb(raw_text, raw_key, verbose=False) print(f\u0026#34;\\næœ€ç»ˆå¯†æ–‡ (Hex): {cipher_hex}\u0026#34;) # 2. è§£å¯† print(\u0026#34;\\nå¼€å§‹è§£å¯†...\u0026#34;) decrypted_text = des_decrypt_ecb(cipher_hex, raw_key, verbose=False) print(f\u0026#34;\\næœ€ç»ˆéªŒè¯:\u0026#34;) print(f\u0026#34; åŸå§‹æ˜æ–‡: {raw_text}\u0026#34;) print(f\u0026#34; è§£å¯†æ˜æ–‡: {decrypted_text}\u0026#34;) print(f\u0026#34; åŒ¹é…æˆåŠŸ: {raw_text == decrypted_text}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: main() 7. é™„å½•ï¼šè¿è¡Œç»“æœç¤ºä¾‹ æ³¨æ„ï¼šè¿è¡Œæ—¥å¿—ä¿ç•™äº†åŠ å¯†è¿‡ç¨‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥é€šè¿‡è®¾ç½®verboseçš„å€¼æ¥æ˜¾ç¤º/éšè—ã€‚\nç‚¹å‡»å±•å¼€æŸ¥çœ‹å®Œæ•´è¿è¡Œæ—¥å¿— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 åŸå§‹æ˜æ–‡: hello fanshanng åŸå§‹å¯†é’¥: secret å¼€å§‹åŠ å¯†... åŸå§‹é•¿åº¦: 15, å¡«å……åé•¿åº¦: 16 \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 1 å—: hello fa ==================== å¼€å§‹ DES åŠ å¯† (å•å—) =================== = è¾“å…¥æ•°æ® (Hex): 68656C6C6F206661 å¯†é’¥ (Hex): 7365637265740000 [å¯†é’¥ç”Ÿæˆ] åŸå§‹å¯†é’¥ (64ä½): 011100110110010101100011011100100 1100101011101000000000000000000 [å¯†é’¥ç”Ÿæˆ] PC-1ç½®æ¢å (56ä½): 0000000000111111001111110010000 0110100110010000000001001 Round 1: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: A0BE86442211 Round 2: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: E03606B08081 Round 3: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 609E74420607 Round 4: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: C4F0721E2188 Round 5: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: A6C772205141 Round 6: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: EE530342A022 Round 7: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 2B9359E40D08 Round 8: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0D50DB08125A Round 9: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: 1D43D8C80560 Round 10: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 16599908CA0C Round 11: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 1F2945505490 Round 12: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0B6C8D890029 Round 13: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 5925AC827A00 Round 14: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D08CA9300334 Round 15: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D1AA26910882 Round 16: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: B0AE2E0123C4 [åˆå§‹ç½®æ¢ IP] ç»“æœ: DF005E9200FF1D50 åˆå§‹ L0: DF005E92 åˆå§‹ R0: 00FF1D50 ------------------------------------------------------------ Round 1: K1: A0BE86442211 L1: 00FF1D50 (from old R) f(R,K): ED9BF922 R1: 329BA7B0 (L XOR f) Round 2: K2: E03606B08081 L2: 329BA7B0 (from old R) f(R,K): E13F4440 R2: E1C05910 (L XOR f) Round 3: K3: 609E74420607 L3: E1C05910 (from old R) f(R,K): F7D9E90A R3: C5424EBA (L XOR f) Round 4: K4: C4F0721E2188 L4: C5424EBA (from old R) f(R,K): 1057B4FD R4: F197EDED (L XOR f) Round 5: K5: A6C772205141 L5: F197EDED (from old R) f(R,K): 54E93256 R5: 91AB7CEC (L XOR f) Round 6: K6: EE530342A022 L6: 91AB7CEC (from old R) f(R,K): 6448A9B5 R6: 95DF4458 (L XOR f) Round 7: K7: 2B9359E40D08 L7: 95DF4458 (from old R) f(R,K): 7057F913 R7: E1FC85FF (L XOR f) Round 8: K8: 0D50DB08125A L8: E1FC85FF (from old R) f(R,K): 28EFD137 R8: BD30956F (L XOR f) Round 9: K9: 1D43D8C80560 L9: BD30956F (from old R) f(R,K): 1887DA46 R9: F97B5FB9 (L XOR f) Round 10: K10: 16599908CA0C L10: F97B5FB9 (from old R) f(R,K): 7CBA0E4C R10: C18A9B23 (L XOR f) Round 11: K11: 1F2945505490 L11: C18A9B23 (from old R) f(R,K): D9AFC90B R11: 20D496B2 (L XOR f) Round 12: K12: 0B6C8D890029 L12: 20D496B2 (from old R) f(R,K): B31E0DF2 R12: 729496D1 (L XOR f) Round 13: K13: 5925AC827A00 L13: 729496D1 (from old R) f(R,K): AF7A0F53 R13: 8FAE99E1 (L XOR f) Round 14: K14: D08CA9300334 L14: 8FAE99E1 (from old R) f(R,K): D46C878B R14: A6F8115A (L XOR f) Round 15: K15: D1AA26910882 L15: A6F8115A (from old R) f(R,K): E5189084 R15: 6AB60965 (L XOR f) Round 16: K16: B0AE2E0123C4 L16: 6AB60965 (from old R) f(R,K): 93045CD9 R16: 35FC4D83 (L XOR f) ------------------------------------------------------------ [32ä½äº’æ¢] ç»“æœ (R16 L16): 35FC4D836AB60965 [åŠ å¯†ç»“æœ] (Hex): 4FA1769C70F29631 ==================== ç»“æŸ DES åŠ å¯† ==================== \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 2 å—: nshanng ==================== å¼€å§‹ DES åŠ å¯† (å•å—) =================== = è¾“å…¥æ•°æ® (Hex): 6E7368616E6E6701 å¯†é’¥ (Hex): 7365637265740000 [å¯†é’¥ç”Ÿæˆ] åŸå§‹å¯†é’¥ (64ä½): 011100110110010101100011011100100 1100101011101000000000000000000 [å¯†é’¥ç”Ÿæˆ] PC-1ç½®æ¢å (56ä½): 0000000000111111001111110010000 0110100110010000000001001 Round 1: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: A0BE86442211 Round 2: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: E03606B08081 Round 3: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 609E74420607 Round 4: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: C4F0721E2188 Round 5: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: A6C772205141 Round 6: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: EE530342A022 Round 7: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 2B9359E40D08 Round 8: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0D50DB08125A Round 9: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: 1D43D8C80560 Round 10: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 16599908CA0C Round 11: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 1F2945505490 Round 12: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0B6C8D890029 Round 13: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 5925AC827A00 Round 14: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D08CA9300334 Round 15: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D1AA26910882 Round 16: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: B0AE2E0123C4 [åˆå§‹ç½®æ¢ IP] ç»“æœ: 7F0271CA007F3573 åˆå§‹ L0: 7F0271CA åˆå§‹ R0: 007F3573 ------------------------------------------------------------ Round 1: K1: A0BE86442211 L1: 007F3573 (from old R) f(R,K): E3311305 R1: 9C3362CF (L XOR f) Round 2: K2: E03606B08081 L2: 9C3362CF (from old R) f(R,K): 12526FF1 R2: 122D5A82 (L XOR f) Round 3: K3: 609E74420607 L3: 122D5A82 (from old R) f(R,K): 9A973D7F R3: 06A45FB0 (L XOR f) Round 4: K4: C4F0721E2188 L4: 06A45FB0 (from old R) f(R,K): 2D61EC83 R4: 3F4CB601 (L XOR f) Round 5: K5: A6C772205141 L5: 3F4CB601 (from old R) f(R,K): FB826C35 R5: FD263385 (L XOR f) Round 6: K6: EE530342A022 L6: FD263385 (from old R) f(R,K): B1C4E5B3 R6: 8E8853B2 (L XOR f) Round 7: K7: 2B9359E40D08 L7: 8E8853B2 (from old R) f(R,K): 7B44D49F R7: 8662E71A (L XOR f) Round 8: K8: 0D50DB08125A L8: 8662E71A (from old R) f(R,K): EB40BF7C R8: 65C8ECCE (L XOR f) Round 9: K9: 1D43D8C80560 L9: 65C8ECCE (from old R) f(R,K): 21455B31 R9: A727BC2B (L XOR f) Round 10: K10: 16599908CA0C L10: A727BC2B (from old R) f(R,K): C80AD43B R10: ADC238F5 (L XOR f) Round 11: K11: 1F2945505490 L11: ADC238F5 (from old R) f(R,K): C481D96D R11: 63A66546 (L XOR f) Round 12: K12: 0B6C8D890029 L12: 63A66546 (from old R) f(R,K): C9BB716D R12: 64794998 (L XOR f) Round 13: K13: 5925AC827A00 L13: 64794998 (from old R) f(R,K): 82D5154B R13: E173700D (L XOR f) Round 14: K14: D08CA9300334 L14: E173700D (from old R) f(R,K): DA486AA4 R14: BE31233C (L XOR f) Round 15: K15: D1AA26910882 L15: BE31233C (from old R) f(R,K): 42C8DCE9 R15: A3BBACE4 (L XOR f) Round 16: K16: B0AE2E0123C4 L16: A3BBACE4 (from old R) f(R,K): 920A0F2E R16: 2C3B2C12 (L XOR f) ------------------------------------------------------------ [32ä½äº’æ¢] ç»“æœ (R16 L16): 2C3B2C12A3BBACE4 [åŠ å¯†ç»“æœ] (Hex): B0B14E7C31FE02AA ==================== ç»“æŸ DES åŠ å¯† ==================== æœ€ç»ˆå¯†æ–‡ (Hex): 4FA1769C70F29631B0B14E7C31FE02AA å¼€å§‹è§£å¯†... \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 1 å— (Hex): 4FA1769C70F29631 ==================== å¼€å§‹ DES è§£å¯† (å•å—) =================== = è¾“å…¥æ•°æ® (Hex): 4FA1769C70F29631 å¯†é’¥ (Hex): 7365637265740000 [å¯†é’¥ç”Ÿæˆ] åŸå§‹å¯†é’¥ (64ä½): 011100110110010101100011011100100 1100101011101000000000000000000 [å¯†é’¥ç”Ÿæˆ] PC-1ç½®æ¢å (56ä½): 0000000000111111001111110010000 0110100110010000000001001 Round 1: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: A0BE86442211 Round 2: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: E03606B08081 Round 3: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 609E74420607 Round 4: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: C4F0721E2188 Round 5: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: A6C772205141 Round 6: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: EE530342A022 Round 7: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 2B9359E40D08 Round 8: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0D50DB08125A Round 9: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: 1D43D8C80560 Round 10: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 16599908CA0C Round 11: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 1F2945505490 Round 12: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0B6C8D890029 Round 13: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 5925AC827A00 Round 14: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D08CA9300334 Round 15: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D1AA26910882 Round 16: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: B0AE2E0123C4 [æ³¨æ„] è§£å¯†æ¨¡å¼ï¼šå­å¯†é’¥é¡ºåºå·²åè½¬ [åˆå§‹ç½®æ¢ IP] ç»“æœ: 35FC4D836AB60965 åˆå§‹ L0: 35FC4D83 åˆå§‹ R0: 6AB60965 ------------------------------------------------------------ Round 1: K16: B0AE2E0123C4 L1: 6AB60965 (from old R) f(R,K): 93045CD9 R1: A6F8115A (L XOR f) Round 2: K15: D1AA26910882 L2: A6F8115A (from old R) f(R,K): E5189084 R2: 8FAE99E1 (L XOR f) Round 3: K14: D08CA9300334 L3: 8FAE99E1 (from old R) f(R,K): D46C878B R3: 729496D1 (L XOR f) Round 4: K13: 5925AC827A00 L4: 729496D1 (from old R) f(R,K): AF7A0F53 R4: 20D496B2 (L XOR f) Round 5: K12: 0B6C8D890029 L5: 20D496B2 (from old R) f(R,K): B31E0DF2 R5: C18A9B23 (L XOR f) Round 6: K11: 1F2945505490 L6: C18A9B23 (from old R) f(R,K): D9AFC90B R6: F97B5FB9 (L XOR f) Round 7: K10: 16599908CA0C L7: F97B5FB9 (from old R) f(R,K): 7CBA0E4C R7: BD30956F (L XOR f) Round 8: K9: 1D43D8C80560 L8: BD30956F (from old R) f(R,K): 1887DA46 R8: E1FC85FF (L XOR f) Round 9: K8: 0D50DB08125A L9: E1FC85FF (from old R) f(R,K): 28EFD137 R9: 95DF4458 (L XOR f) Round 10: K7: 2B9359E40D08 L10: 95DF4458 (from old R) f(R,K): 7057F913 R10: 91AB7CEC (L XOR f) Round 11: K6: EE530342A022 L11: 91AB7CEC (from old R) f(R,K): 6448A9B5 R11: F197EDED (L XOR f) Round 12: K5: A6C772205141 L12: F197EDED (from old R) f(R,K): 54E93256 R12: C5424EBA (L XOR f) Round 13: K4: C4F0721E2188 L13: C5424EBA (from old R) f(R,K): 1057B4FD R13: E1C05910 (L XOR f) Round 14: K3: 609E74420607 L14: E1C05910 (from old R) f(R,K): F7D9E90A R14: 329BA7B0 (L XOR f) Round 15: K2: E03606B08081 L15: 329BA7B0 (from old R) f(R,K): E13F4440 R15: 00FF1D50 (L XOR f) Round 16: K1: A0BE86442211 L16: 00FF1D50 (from old R) f(R,K): ED9BF922 R16: DF005E92 (L XOR f) ------------------------------------------------------------ [32ä½äº’æ¢] ç»“æœ (R16 L16): DF005E9200FF1D50 [è§£å¯†ç»“æœ] (Hex): 68656C6C6F206661 ==================== ç»“æŸ DES è§£å¯† ==================== \u0026gt;\u0026gt;\u0026gt; å¤„ç†ç¬¬ 2 å— (Hex): B0B14E7C31FE02AA ==================== å¼€å§‹ DES è§£å¯† (å•å—) =================== = è¾“å…¥æ•°æ® (Hex): B0B14E7C31FE02AA å¯†é’¥ (Hex): 7365637265740000 [å¯†é’¥ç”Ÿæˆ] åŸå§‹å¯†é’¥ (64ä½): 011100110110010101100011011100100 1100101011101000000000000000000 [å¯†é’¥ç”Ÿæˆ] PC-1ç½®æ¢å (56ä½): 0000000000111111001111110010000 0110100110010000000001001 Round 1: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: A0BE86442211 Round 2: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: E03606B08081 Round 3: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 609E74420607 Round 4: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: C4F0721E2188 Round 5: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: A6C772205141 Round 6: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: EE530342A022 Round 7: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 2B9359E40D08 Round 8: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0D50DB08125A Round 9: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: 1D43D8C80560 Round 10: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 16599908CA0C Round 11: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 1F2945505490 Round 12: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 0B6C8D890029 Round 13: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: 5925AC827A00 Round 14: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D08CA9300334 Round 15: å·¦ç§» 2 ä½ -\u0026gt; å­å¯†é’¥: D1AA26910882 Round 16: å·¦ç§» 1 ä½ -\u0026gt; å­å¯†é’¥: B0AE2E0123C4 [æ³¨æ„] è§£å¯†æ¨¡å¼ï¼šå­å¯†é’¥é¡ºåºå·²åè½¬ [åˆå§‹ç½®æ¢ IP] ç»“æœ: 2C3B2C12A3BBACE4 åˆå§‹ L0: 2C3B2C12 åˆå§‹ R0: A3BBACE4 ------------------------------------------------------------ Round 1: K16: B0AE2E0123C4 L1: A3BBACE4 (from old R) f(R,K): 920A0F2E R1: BE31233C (L XOR f) Round 2: K15: D1AA26910882 L2: BE31233C (from old R) f(R,K): 42C8DCE9 R2: E173700D (L XOR f) Round 3: K14: D08CA9300334 L3: E173700D (from old R) f(R,K): DA486AA4 R3: 64794998 (L XOR f) Round 4: K13: 5925AC827A00 L4: 64794998 (from old R) f(R,K): 82D5154B R4: 63A66546 (L XOR f) Round 5: K12: 0B6C8D890029 L5: 63A66546 (from old R) f(R,K): C9BB716D R5: ADC238F5 (L XOR f) Round 6: K11: 1F2945505490 L6: ADC238F5 (from old R) f(R,K): C481D96D R6: A727BC2B (L XOR f) Round 7: K10: 16599908CA0C L7: A727BC2B (from old R) f(R,K): C80AD43B R7: 65C8ECCE (L XOR f) Round 8: K9: 1D43D8C80560 L8: 65C8ECCE (from old R) f(R,K): 21455B31 R8: 8662E71A (L XOR f) Round 9: K8: 0D50DB08125A L9: 8662E71A (from old R) f(R,K): EB40BF7C R9: 8E8853B2 (L XOR f) Round 10: K7: 2B9359E40D08 L10: 8E8853B2 (from old R) f(R,K): 7B44D49F R10: FD263385 (L XOR f) Round 11: K6: EE530342A022 L11: FD263385 (from old R) f(R,K): B1C4E5B3 R11: 3F4CB601 (L XOR f) Round 12: K5: A6C772205141 L12: 3F4CB601 (from old R) f(R,K): FB826C35 R12: 06A45FB0 (L XOR f) Round 13: K4: C4F0721E2188 L13: 06A45FB0 (from old R) f(R,K): 2D61EC83 R13: 122D5A82 (L XOR f) Round 14: K3: 609E74420607 L14: 122D5A82 (from old R) f(R,K): 9A973D7F R14: 9C3362CF (L XOR f) Round 15: K2: E03606B08081 L15: 9C3362CF (from old R) f(R,K): 12526FF1 R15: 007F3573 (L XOR f) Round 16: K1: A0BE86442211 L16: 007F3573 (from old R) f(R,K): E3311305 R16: 7F0271CA (L XOR f) ------------------------------------------------------------ [32ä½äº’æ¢] ç»“æœ (R16 L16): 7F0271CA007F3573 [è§£å¯†ç»“æœ] (Hex): 6E7368616E6E6701 ==================== ç»“æŸ DES è§£å¯† ==================== æœ€ç»ˆéªŒè¯: åŸå§‹æ˜æ–‡: hello fanshanng è§£å¯†æ˜æ–‡: hello fanshanng åŒ¹é…æˆåŠŸ: True ","date":"2025-12-16T16:49:17+08:00","image":"https://s.panlai.com/zb_users/upload/2025/05/20250524082018174804601878294.png-arthumbs","permalink":"https://fanshanng.cn/p/deslearn/","title":"DES å­¦ä¹ ç¬”è®°"},{"content":"ä¸ºäº†æå‡åšå®¢çš„è¶£å‘³æ€§å’Œäº¤äº’ä½“éªŒï¼Œä»Šå¤©ç»™åšå®¢æ·»åŠ äº†ä¸€äº›å°åŠŸèƒ½ã€‚æœ¬æ–‡è®°å½•äº†è¿™äº›åŠŸèƒ½çš„å®ç°æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡ä¿®æ”¹ static/js/custom.js å’Œç›¸å…³æ¨¡æ¿æ–‡ä»¶å®ç°ã€‚\n1. ç½‘ç«™è¿è¡Œæ—¶é—´ (Site Running Time) åœ¨é¡µè„šæ˜¾ç¤ºåšå®¢å·²ç»å®‰å…¨è¿è¡Œäº†å¤šä¹…ï¼Œç»™è®¿å®¢ä¸€ç§æŒä¹…è¿è¥çš„ä¿¡ä»»æ„Ÿã€‚\nå®ç°æ•ˆæœï¼š é¡µè„šæ˜¾ç¤º \u0026ldquo;æœ¬ç«™å·²å®‰å…¨è¿è¡Œ XX å¤© XX å°æ—¶ XX åˆ† XX ç§’\u0026rdquo;ã€‚\nä»£ç ç‰‡æ®µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 function runtime() { window.setTimeout(\u0026#34;runtime()\u0026#34;, 1000); let startTime = new Date(\u0026#39;01/01/2024 00:00:00\u0026#39;); // ä¿®æ”¹ä¸ºä½ çš„å»ºç«™æ—¶é—´ let endTime = new Date(); let timeDiff = endTime.getTime() - startTime.getTime(); // ... è®¡ç®—å¤©ã€æ—¶ã€åˆ†ã€ç§’ ... let timeDisplay = document.getElementById(\u0026#34;run-time\u0026#34;); if(timeDisplay) { timeDisplay.innerHTML = `æœ¬ç«™å·²å®‰å…¨è¿è¡Œ ${days} å¤© ${hours} å°æ—¶ ${minutes} åˆ† ${seconds} ç§’`; } } runtime(); 2. ç½‘é¡µæ ‡é¢˜åŠ¨æ€å˜åŒ– (Dynamic Title) å½“ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæ—¶ï¼Œç½‘é¡µæ ‡é¢˜ä¼šå–èŒï¼›åˆ‡å›æ¥æ—¶ï¼Œåˆä¼šå˜å›æ¥ã€‚ä¸ºäº†å¢åŠ è¶£å‘³æ€§ï¼Œè®¾ç½®äº†éšæœºè¯­å½•ã€‚\nå®ç°æ•ˆæœï¼š\nç¦»å¼€é¡µé¢ï¼šéšæœºæ˜¾ç¤º \u0026ldquo;(ã¤ã‚§âŠ‚) æˆ‘è—å¥½äº†å“¦~\u0026quot;ã€\u0026ldquo;çœ‹ä¸è§æˆ‘\u0026hellip;\u0026rdquo; ç­‰ã€‚ å›åˆ°é¡µé¢ï¼šéšæœºæ˜¾ç¤º \u0026ldquo;(Â´âˆ‡ï½€) è¢«ä½ å‘ç°å•¦~\u0026quot;ã€\u0026quot;(OwO) æŠ“åˆ°ä½ äº†\u0026rdquo; ç­‰ã€‚ ä»£ç ç‰‡æ®µï¼š\n1 2 3 4 5 6 7 8 9 10 11 const hiddenTitles = [\u0026#34;(ã¤ã‚§âŠ‚) æˆ‘è—å¥½äº†å“¦~\u0026#34;, \u0026#34;çœ‹ä¸è§æˆ‘...\u0026#34;, \u0026#34;( .â€¢Ì _Ê– â€¢Ì€.) ç­‰ä½ å›æ¥\u0026#34;, \u0026#34;404 Not Found\u0026#34;]; const visibleTitles = [\u0026#34;(*Â´âˆ‡ï½€*) è¢«ä½ å‘ç°å•¦~\u0026#34;, \u0026#34;(OwO) æŠ“åˆ°ä½ äº†\u0026#34;, \u0026#34;æ¬¢è¿å›æ¥ï¼\u0026#34;, \u0026#34;(HzH) å˜»å˜»\u0026#34;]; document.addEventListener(\u0026#39;visibilitychange\u0026#39;, function() { if (document.hidden) { document.title = getRandomItem(hiddenTitles); } else { document.title = getRandomItem(visibleTitles); setTimeout(() =\u0026gt; { document.title = originTitle; }, 2000); } }); 3. é¼ æ ‡ç‚¹å‡»çˆ±å¿ƒç‰¹æ•ˆ (Click Heart Effect) ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®ï¼Œä¼šå¼¹å‡ºéšæœºé¢œè‰²çš„çˆ±å¿ƒåŠ¨ç”»ï¼Œå¢åŠ ç‚¹å‡»åé¦ˆã€‚\nå®ç°åŸç†ï¼š ç›‘å¬ click äº‹ä»¶ï¼Œåœ¨é¼ æ ‡ç‚¹å‡»åæ ‡å¤„åˆ›å»ºä¸€ä¸ª div å…ƒç´ ï¼Œåº”ç”¨ CSS åŠ¨ç”»ä½¿å…¶å‘ä¸Šæµ®åŠ¨å¹¶æ¶ˆå¤±ã€‚\n4. å¤åˆ¶æˆåŠŸæç¤º (Copy Toast) å½“ç”¨æˆ·å¤åˆ¶åšå®¢å†…å®¹æ—¶ï¼Œä¸å†æ˜¯æ— å£°æ— æ¯ï¼Œè€Œæ˜¯å¼¹å‡ºä¸€ä¸ªå‹å¥½çš„æç¤ºæ¡†ã€‚\nå®ç°æ•ˆæœï¼š å±å¹•ä¸Šæ–¹å¼¹å‡ºé»‘è‰²åŠé€æ˜æç¤ºæ¡†ï¼š\u0026ldquo;å¤åˆ¶æˆåŠŸï¼è½¬è½½è¯·æ³¨æ˜å‡ºå¤„å“¦~\u0026quot;ã€‚\nä»£ç ç‰‡æ®µï¼š\n1 2 3 4 5 6 document.addEventListener(\u0026#39;copy\u0026#39;, function() { const toast = document.createElement(\u0026#39;div\u0026#39;); toast.innerText = \u0026#39;å¤åˆ¶æˆåŠŸï¼è½¬è½½è¯·æ³¨æ˜å‡ºå¤„å“¦~\u0026#39;; // ... è®¾ç½®æ ·å¼å’ŒåŠ¨ç”» ... document.body.appendChild(toast); }); 5. ä¾§è¾¹æ æ‰“å­—æœºç‰¹æ•ˆ (Typewriter Effect) è®©ä¾§è¾¹æ çš„ä¸ªäººç®€ä»‹ï¼ˆSubtitleï¼‰åƒæ‰“å­—æœºä¸€æ ·é€å­—æ˜¾ç¤ºï¼Œæ¯”é™æ€æ–‡å­—æ›´æœ‰çµåŠ¨æ„Ÿã€‚\nå®ç°åŸç†ï¼š\nä¿®æ”¹ layouts/partials/sidebar/left.htmlï¼Œå°†å‰¯æ ‡é¢˜å†…å®¹æ”¾å…¥ data-text å±æ€§ã€‚ ä½¿ç”¨ JS é€’å½’å‡½æ•° typeWriter é€ä¸ªå­—ç¬¦è¯»å–å¹¶æ·»åŠ åˆ° innerHTML ä¸­ã€‚ 6. å…¨å±€æ‚¬æµ®éŸ³ä¹æ’­æ”¾å™¨ (MetingJS) åœ¨é¡µé¢å·¦ä¸‹è§’æ·»åŠ ä¸€ä¸ªæ‚¬æµ®çš„éŸ³ä¹æ’­æ”¾å™¨ï¼Œç›´æ¥åŒæ­¥ç½‘æ˜“äº‘æ­Œå•ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ­Œæ›²é“¾æ¥ã€‚\nå®ç°æ­¥éª¤ï¼š\nåœ¨ layouts/partials/head/custom.html å¼•å…¥ APlayer çš„æ ·å¼ï¼š 1 \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.css\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34;\u0026gt; åœ¨ layouts/partials/footer/footer.html å¼•å…¥ APlayer å’Œ MetingJS è„šæœ¬ï¼š 1 2 \u0026lt;script src=\u0026#34;https://unpkg.com/aplayer@1.10.1/dist/APlayer.min.js\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; defer\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://unpkg.com/meting@2.0.1/dist/Meting.min.js\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; defer\u0026gt;\u0026lt;/script\u0026gt; åœ¨ layouts/partials/sidebar/left.html çš„æœ«å°¾æ·»åŠ  MetingJS æ ‡ç­¾ï¼ˆå¼€å¯ fixed=\u0026quot;true\u0026quot;ï¼‰ï¼š 1 2 3 4 5 6 7 8 9 \u0026lt;!-- æ‚¬æµ®éŸ³ä¹æ’­æ”¾å™¨ (MetingJS) --\u0026gt; \u0026lt;meting-js server=\u0026#34;netease\u0026#34; type=\u0026#34;playlist\u0026#34; id=\u0026#34;17556275859\u0026#34; fixed=\u0026#34;true\u0026#34; list-folded=\u0026#34;true\u0026#34; theme=\u0026#34;#2980b9\u0026#34;\u0026gt; \u0026lt;/meting-js\u0026gt; ä¼˜åŠ¿ï¼š\nè‡ªåŠ¨è§£æï¼šMetingJS ä¼šè‡ªåŠ¨å¤„ç†ç½‘æ˜“äº‘éŸ³ä¹çš„é˜²ç›—é“¾å’ŒçœŸå®åœ°å€è§£æã€‚ å…¨å±€æ‚¬æµ®ï¼šæ’­æ”¾å™¨å›ºå®šåœ¨å·¦ä¸‹è§’ï¼Œä¸å ç”¨é¡µé¢å¸ƒå±€ç©ºé—´ï¼Œä¸”éšæ—¶å¯æ§ã€‚ å®æ—¶åŒæ­¥ï¼šåœ¨ç½‘æ˜“äº‘ APP é‡Œæ›´æ–°æ­Œå•ï¼Œåšå®¢ä¸Šä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°ã€‚ å…³äºéŸ³ä¹ä¸­æ–­é—®é¢˜ï¼š ç”±äºåšå®¢æ˜¯é™æ€ç½‘ç«™ï¼ˆå¤šé¡µæ¶æ„ï¼‰ï¼Œæ¯æ¬¡ç‚¹å‡»é“¾æ¥è·³è½¬éƒ½ä¼šé‡æ–°åŠ è½½é¡µé¢ï¼Œå› æ­¤éŸ³ä¹ä¼šä¸­æ–­ã€‚è¿™æ˜¯é™æ€ç½‘ç«™çš„ç‰¹æ€§ã€‚\n7. æš—è‰²æ¨¡å¼æ»‘åŠ¨å¼€å…³ (Dark Mode Slider) å°†åŸæœ¬å•è°ƒçš„æš—è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’®ï¼ˆæœˆäº®/å¤ªé˜³å›¾æ ‡ï¼‰å‡çº§ä¸ºæ›´ç°ä»£çš„æ»‘åŠ¨å¼€å…³æ ·å¼ã€‚\nå®ç°æ•ˆæœï¼š\nå¤–è§‚ï¼šé‡‡ç”¨åœ†è§’èƒ¶å›Šå½¢çŠ¶ï¼Œå†…éƒ¨åŒ…å«å¤ªé˜³å’Œæœˆäº®å›¾æ ‡ã€‚ åŠ¨ç”»ï¼šç‚¹å‡»åˆ‡æ¢æ—¶ï¼Œæ»‘å—å¹³æ»‘ç§»åŠ¨ï¼ŒèƒŒæ™¯è‰²å’Œå›¾æ ‡é¢œè‰²éšä¹‹æ¸å˜ã€‚ äº¤äº’ï¼šå¤ªé˜³å’Œæœˆäº®å›¾æ ‡åœ¨æ¿€æ´»çŠ¶æ€ä¸‹ä¼šæœ‰ç¼©æ”¾å’Œå˜è‰²æ•ˆæœï¼ˆå¤ªé˜³å˜æ©™è‰²ï¼Œæœˆäº®å˜é‡‘è‰²ï¼‰ã€‚ å®ç°åŸç†ï¼š\nHTML ç»“æ„ï¼šä¿®æ”¹ layouts/partials/sidebar/left.htmlï¼Œå°†åŸæ¥çš„ç®€å• li æ ‡ç­¾æ›¿æ¢ä¸ºåŒ…å«è½¨é“ã€æ»‘å—å’Œå›¾æ ‡çš„å¤æ‚ç»“æ„ã€‚ CSS æ ·å¼ï¼šåœ¨ assets/scss/custom.scss ä¸­æ·»åŠ æ ·å¼ã€‚åˆ©ç”¨ :root[data-scheme=\u0026quot;dark\u0026quot;] é€‰æ‹©å™¨æ¥åŒºåˆ†æ·±è‰²å’Œæµ…è‰²æ¨¡å¼ä¸‹çš„æ ·å¼ï¼Œé€šè¿‡ transition å±æ€§å®ç°å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»ã€‚ é€»è¾‘ä¿æŒï¼šä¿ç•™åŸæœ‰çš„ colorScheme.ts é€»è¾‘ï¼Œç‚¹å‡»äº‹ä»¶ä¾ç„¶ç»‘å®šåœ¨çˆ¶å®¹å™¨ä¸Šï¼Œç¡®ä¿åŠŸèƒ½ä¸å—å½±å“ã€‚ ","date":"2025-12-15T13:30:53+08:00","image":"https://s.panlai.com/upload/20231108125026169941902637945.jpg-arthumbs","permalink":"https://fanshanng.cn/p/blog_up1/","title":"åšå®¢æ–°å¢å°åŠŸèƒ½"},{"content":"","date":"2025-12-15T13:03:22+08:00","image":"https://s.panlai.com/zb_users/upload/2025/05/20250509175822174678470279469.jpg-arthumbs","permalink":"https://fanshanng.cn/p/hugo-password-protection/","title":"Hugo åšå®¢æ·»åŠ æ–‡ç« å¯†ç ä¿æŠ¤åŠŸèƒ½"},{"content":"è½¯ä»¶é€†å‘å·¥ç¨‹ç»„ä¼šï¼šIDA å¸¸è§æ“ä½œä¸åŸºç¡€çŸ¥è¯† é¢å‘è¯¾ç¨‹ä¸å®‰å…¨ç ”ç©¶ï¼Œè¯·éµå®ˆæ‰€åœ¨åœ°æ³•å¾‹ä¸è½¯ä»¶æˆæƒã€‚æ¶‰åŠä¸‹è½½/å¤–é“¾ï¼šæŒ‰æˆæƒä½¿ç”¨æˆ–é€‰å¼€æºæ›¿ä»£ï¼ˆGhidra/Cutterï¼‰ã€‚\nä¸€ã€æ ¸å¿ƒè®¤çŸ¥ï¼šIDA ä½œç”¨ä¸é€†å‘ç›®æ ‡ 1.1 IDA Pro å®šä½ IDA Pro æ˜¯é€†å‘å·¥ç¨‹æ ¸å¿ƒå·¥å…·ï¼Œæ”¯æŒå°†äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆexe/so/elf/dllï¼‰åæ±‡ç¼–ä¸ºæ±‡ç¼–ä»£ç å¹¶ç”Ÿæˆä¼ªä»£ç ï¼Œè¾…åŠ©è§£æç¨‹åºé€»è¾‘ã€‚\n1.2 é€†å‘å…¥é—¨æ ¸å¿ƒç›®æ ‡ å°† â€œä¸å¯è¯»çš„äºŒè¿›åˆ¶æ–‡ä»¶â€ è½¬åŒ–ä¸º â€œå¯ç†è§£çš„é€»è¾‘â€ï¼Œå…·ä½“åŒ…æ‹¬ï¼š\nå®šä½ç¨‹åºå…¥å£ï¼ˆä¸»å‡½æ•°ï¼‰ï¼›\nè¯†åˆ«å…³é”®é€»è¾‘ï¼ˆéªŒè¯ã€åŠ å¯†ç­‰ï¼‰ï¼›\nä¿®æ”¹ç¨‹åºè¡Œä¸ºï¼ˆPatch æ“ä½œï¼‰ï¼›\nè·Ÿè¸ªè¿è¡Œæµç¨‹ï¼ˆåŠ¨æ€è°ƒè¯•ï¼‰ã€‚\näºŒã€ç¯å¢ƒå‡†å¤‡ï¼šIDAå·¥å…·å®‰è£… IDA Pro ç‰ˆæœ¬ï¼šæ¨è 9.1/9.2ï¼ˆç¨³å®šæ€§ä¸æ–°åŠŸèƒ½å…¼é¡¾ï¼‰ï¼Œéœ€åŒ¹é…æ ·æœ¬ä½æ•°ï¼ˆ32 ä½ / 64 ä½ï¼‰ï¼›\né€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šIDA Professional 9.1.7z é“¾æ¥: https://pan.baidu.com/s/1yrROk_2y_jpwky_AsaOQSw?pwd=f4ns æå–ç : f4ns\né€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šida9.2.zip é“¾æ¥: https://pan.baidu.com/s/1YInTZr7qnGNMLvqz9b-5ZQ?pwd=f4ns æå–ç : f4ns\nIDA 9.2çš„å®˜æ–¹æ–‡æ¡£\nä¸‰ã€æ ¸å¿ƒæ“ä½œï¼šé™æ€åˆ†æï¼ˆé€†å‘åŸºç¡€ï¼‰ é™æ€åˆ†ææ— éœ€è¿è¡Œç¨‹åºï¼Œç›´æ¥é€šè¿‡ IDA è§£æä»£ç é€»è¾‘ï¼Œæ˜¯é€†å‘çš„æ ¸å¿ƒç¯èŠ‚ã€‚\n3.1 è§†å›¾åˆ‡æ¢ä¸é«˜é¢‘å¿«æ·é”®ï¼ˆåˆ†ç±»æ±‡æ€»ï¼‰ åŠŸèƒ½ç±»å‹ å¿«æ·é”® ä½œç”¨è¯´æ˜ è§†å›¾åˆ‡æ¢ tab æ±‡ç¼–è§†å›¾ â†” ä¼ªä»£ç è§†å›¾ï¼ˆæ ¸å¿ƒåˆ‡æ¢æ–¹å¼ï¼‰ ç©ºæ ¼ text viewï¼ˆæ–‡æœ¬è§†å›¾ï¼‰ â†” graph viewï¼ˆå›¾è¡¨è§†å›¾ï¼‰ å¯¼èˆªç±» G è·³è½¬è‡³æŒ‡å®šåœ°å€ï¼ˆéœ€è¾“å…¥ç›®æ ‡åœ°å€ï¼‰ Alt+T å…¨å±€æ–‡æœ¬æœç´¢ï¼ˆæœæŒ‡ä»¤ã€å­—ç¬¦ä¸²ã€å‡½æ•°åï¼‰ ç¼–è¾‘ç±»ï¼ˆæ±‡ç¼–ï¼‰ ;ï¼ˆåˆ†å·ï¼‰ ä¸ºæ±‡ç¼–æŒ‡ä»¤æ·»åŠ æ³¨é‡Šï¼ˆä¾¿äºåç»­å›æº¯ï¼‰ U Undefineï¼šå°†ä»£ç è½¬æ¢ä¸º â€œæ•°æ®â€ï¼ˆå¤„ç†èŠ±æŒ‡ä»¤ï¼‰ C Codeï¼šå°†æ•°æ®è½¬æ¢ä¸º â€œä»£ç â€ï¼ˆæ¢å¤è¯¯åˆ¤ä»£ç ï¼‰ ç¼–è¾‘ç±»ï¼ˆä¼ªä»£ç ï¼‰ N å˜é‡ / å‡½æ•°é‡å‘½åï¼ˆå¦‚ sub_401000 â†’ mainï¼‰ Y ä¿®æ”¹å˜é‡ / å‡½æ•°ç±»å‹ï¼ˆå¦‚ void â†’ intï¼Œè¯†åˆ« JNIï¼‰ /ï¼ˆæ–œæ ï¼‰ ä¸ºä¼ªä»£ç æ·»åŠ å¤šè¡Œæ³¨é‡Šï¼ˆå¯è¯»æ€§ä¼˜å…ˆï¼‰ LazyIDA Ctrl+Alt+N ä¸€é”® NOP é€‰ä¸­ä»£ç ï¼ˆè¿‡åè°ƒã€å»èŠ±æŒ‡ä»¤ï¼ŒåŸºç¡€åŠŸèƒ½ï¼‰ å‡½æ•° / å­—ç¬¦ä¸² Shift+F12 æ‰“å¼€å­—ç¬¦ä¸²çª—å£ï¼ˆå®šä½å…³é”®é€»è¾‘æ ¸å¿ƒå·¥å…·ï¼‰ ida9.2æ›´æ–°è·³è½¬ Ctrl-Alt-G å‡½æ•°ã€å±€éƒ¨ç±»å‹ã€åç§°å’Œæ®µè¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢ é‡ç‚¹æç¤ºï¼šç©ºæ ¼ï¼ˆè§†å›¾åˆ‡æ¢ï¼‰ã€Gï¼ˆåœ°å€è·³è½¬ï¼‰ã€N/Yï¼ˆä¼ªä»£ç ç¼–è¾‘ï¼‰ã€Shift+F12ï¼ˆå­—ç¬¦ä¸²æŸ¥è¯¢ï¼‰ä¸ºåŸºç¡€é«˜é¢‘æ“ä½œï¼›LazyIDA è¿›é˜¶åŠŸèƒ½è§ç¬¬å››ç« ä¸“é¡¹ã€‚\n3.2 æ±‡ç¼–ç•Œé¢æ“ä½œè¦ç‚¹ 3.2.1 å¿…è®¤æ±‡ç¼–æŒ‡ä»¤ï¼ˆå¯¹åº” C è¯­è¨€é€»è¾‘ï¼‰ æ±‡ç¼–æŒ‡ä»¤ æ ¸å¿ƒä½œç”¨ å¯¹åº” C è¯­è¨€åœºæ™¯ mov æ•°æ®èµ‹å€¼ï¼ˆmov a,b â†’ a=bï¼‰ å˜é‡èµ‹å€¼ï¼ˆå¦‚ int a = b;ï¼‰ push/pop æ ˆæ“ä½œï¼ˆpushï¼šæ•°æ®å…¥æ ˆï¼›popï¼šæ•°æ®å‡ºæ ˆï¼‰ å‡½æ•°ä¼ å‚ï¼ˆå‚æ•°å…¥æ ˆï¼‰ã€å±€éƒ¨å˜é‡åˆå§‹åŒ–ï¼ˆæ ˆç©ºé—´åˆ†é… / é‡Šæ”¾ï¼‰ call è°ƒç”¨å‡½æ•°ï¼ˆcall sub_401000 â†’ è·³è½¬åˆ° sub_401000 æ‰§è¡Œï¼‰ å‡½æ•°è°ƒç”¨ï¼ˆå¦‚ check_password (input);ï¼‰ ret å‡½æ•°è¿”å›ï¼ˆä»å½“å‰å‡½æ•°è·³å›è°ƒç”¨å¤„ï¼‰ å‡½æ•°æ‰§è¡Œç»“æŸï¼ˆreturn è¯­å¥ï¼‰ jmp æ— æ¡ä»¶è·³è½¬ï¼ˆjmp 0x401200 â†’ å¼ºåˆ¶è·³è½¬åˆ° 0x401200ï¼‰ goto è¯­å¥ï¼ˆå¦‚ goto end;ï¼‰ je/jne æ¡ä»¶è·³è½¬ï¼ˆjeï¼šç­‰äºæ—¶è·³ï¼›jneï¼šä¸ç­‰äºæ—¶è·³ï¼‰ if-elseï¼ˆå¦‚ if (a==b) { \u0026hellip; } else { \u0026hellip; }ï¼‰ã€å¾ªç¯ cmp æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼ˆcmp a,b â†’ è®¡ç®— a - bï¼Œä»…ç½®æ ‡å¿—ä½ä¸ä¿å­˜ç»“æœï¼‰ if åˆ¤æ–­çš„æ¡ä»¶åŸºç¡€ï¼ˆå¦‚ if (a==b)ã€if (a\u0026gt;b) çš„åº•å±‚åˆ¤æ–­ï¼‰ jz é›¶æ ‡å¿—ä½ï¼ˆZF=1ï¼‰æ—¶è·³è½¬ï¼ˆå³ä¸Šä¸€æ­¥ç»“æœä¸º 0 æ—¶è·³ï¼‰ if (ç»“æœ == 0)ï¼ˆå¦‚ if (func_return == 0) { \u0026hellip; }ï¼‰ jnz é›¶æ ‡å¿—ä½ï¼ˆZF=0ï¼‰æ—¶è·³è½¬ï¼ˆå³ä¸Šä¸€æ­¥ç»“æœä¸ä¸º 0 æ—¶è·³ï¼‰ if (ç»“æœï¼= 0)ï¼ˆå¦‚ if (func_return != 0) { \u0026hellip; }ï¼‰ test æŒ‰ä½ä¸è¿ç®—ï¼ˆä¸ä¿å­˜ç»“æœï¼Œä»…ç½®æ ‡å¿—ä½ï¼‰ï¼Œå¸¸ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸º 0 if (å˜é‡ == 0)ï¼ˆå¦‚ test eax,eax â†’ åˆ¤æ–­ eax æ˜¯å¦ä¸º 0ï¼Œå¯¹åº” if (eax == 0)ï¼‰ and æŒ‰ä½ä¸è¿ç®—ï¼ˆa and b â†’ ç»“æœå­˜å› aï¼‰ï¼Œå¯ç”¨äºæ¸…é›¶ã€ä¿ç•™ç‰¹å®šä½ æŒ‰ä½ä¸æ“ä½œï¼ˆå¦‚ a \u0026amp;= b;ï¼‰ã€æ¸…é›¶å˜é‡ï¼ˆå¦‚ a \u0026amp;= 0;ï¼‰ lea è®¡ç®—æœ‰æ•ˆåœ°å€ï¼ˆéåŠ è½½æ•°æ®ï¼‰ï¼Œå¸¸ç”¨äºå–å˜é‡åœ°å€æˆ–ç®€å•è®¡ç®— å–å˜é‡åœ°å€ï¼ˆå¦‚ int *p = \u0026amp;a; â†’ lea eax,[a]ï¼‰ã€ç®€å•è¡¨è¾¾å¼è®¡ç®—ï¼ˆå¦‚ lea eax,[ebx+4] â†’ eax = ebx + 4ï¼‰ add åŠ æ³•è¿ç®—ï¼ˆadd a,b â†’ a = a + bï¼‰ æ•°å€¼åŠ æ³•ï¼ˆå¦‚ a = a + b;ï¼‰ sub å‡æ³•è¿ç®—ï¼ˆsub a,b â†’ a = a - bï¼‰ æ•°å€¼å‡æ³•ï¼ˆå¦‚ a = a - b;ï¼‰ xor æŒ‰ä½å¼‚æˆ–è¿ç®—ï¼ˆa xor b â†’ ç»“æœå­˜å› aï¼‰ï¼Œå¯ç”¨äºæ¸…é›¶ã€äº¤æ¢å˜é‡ æŒ‰ä½å¼‚æˆ–æ“ä½œï¼ˆå¦‚ a ^= b;ï¼‰ã€æ¸…é›¶å˜é‡ï¼ˆå¦‚ xor eax,eax â†’ eax = 0ï¼‰ã€äº¤æ¢å˜é‡ï¼ˆæ— éœ€ä¸´æ—¶å˜é‡ï¼‰ shr é€»è¾‘å³ç§»ï¼ˆshr a,n â†’ a å³ç§» n ä½ï¼Œé«˜ä½è¡¥ 0ï¼‰ æ— ç¬¦å·æ•°é™¤æ³•ï¼ˆå¦‚ a = a \u0026raquo; 1; â†’ a = a / 2ï¼‰ã€å–é«˜ä½å­—èŠ‚ shl é€»è¾‘å·¦ç§»ï¼ˆshl a,n â†’ a å·¦ç§» n ä½ï¼Œä½ä½è¡¥ 0ï¼‰ æ— ç¬¦å·æ•°ä¹˜æ³•ï¼ˆå¦‚ a = a \u0026laquo; 1; â†’ a = a * 2ï¼‰ã€ä½ä½å­—èŠ‚èµ‹å€¼ leave é‡Šæ”¾å½“å‰å‡½æ•°æ ˆå¸§ï¼ˆç­‰ä»·äº mov esp, ebp; pop ebpï¼‰ï¼Œæ¢å¤è°ƒç”¨è€…æ ˆç¯å¢ƒ å‡½æ•°æ‰§è¡Œç»“æŸå‰æ¸…ç†æ ˆç©ºé—´ï¼ˆå¯¹åº” C å‡½æ•°ä¸­å±€éƒ¨å˜é‡é”€æ¯ã€æ ˆå¸§æ¢å¤ï¼Œé€šå¸¸ç´§è·Ÿåœ¨ return å‰ï¼‰ nop æ— æ“ä½œï¼ˆä»…å ç”¨ 1 ä¸ªæŒ‡ä»¤å‘¨æœŸï¼Œä¸ä¿®æ”¹å¯„å­˜å™¨ / å†…å­˜ï¼‰ ä»£ç å­—èŠ‚å¯¹é½ï¼ˆç¼–è¯‘å™¨å¡«å……ç©ºç™½ï¼‰ã€è°ƒè¯•å ä½ï¼ˆé¢„ç•™æŒ‡ä»¤ä½ç½®ï¼‰ã€å»¶æ—¶ï¼ˆåº•å±‚ç®€å•å»¶æ—¶é€»è¾‘ï¼‰ã€å±è”½æ— ç”¨æŒ‡ä»¤ï¼ˆå¦‚ç ´è§£æ—¶ nop æ‰æ ¡éªŒæŒ‡ä»¤ï¼‰ 3.2.2 æ±‡ç¼–ç•Œé¢æ ¸å¿ƒæ“ä½œ æ³¨é‡Šæ·»åŠ ï¼šé€‰ä¸­ç›®æ ‡æŒ‡ä»¤ï¼ŒæŒ‰ã€Œ;ã€è¾“å…¥æ³¨é‡Šå†…å®¹ï¼›\nå…³é”®è¯æœç´¢ï¼šæŒ‰ã€ŒAlt+Tã€è¾“å…¥å…³é”®è¯ï¼ˆå¦‚ password,successï¼‰ï¼Œå®šä½å…³é”®é€»è¾‘ï¼›\näº¤å‰å¼•ç”¨æŸ¥è¯¢ï¼šé€‰ä¸­å‡½æ•°åï¼ˆå¦‚ sub_401000ï¼‰ï¼ŒæŒ‰ã€ŒAlt+F7ã€ï¼ŒæŸ¥çœ‹è°ƒç”¨è¯¥å‡½æ•°çš„æŒ‡ä»¤ä½ç½®ã€‚\n3.3 ä¼ªä»£ç ç•Œé¢æ“ä½œè¦ç‚¹ ä¼ªä»£ç å¯è¯»æ€§ä¼˜äºæ±‡ç¼–ï¼Œæ˜¯é€†å‘åˆ†æçš„ä¸»åŠ›è§†å›¾ã€‚\n3.3.1 æ ¸å¿ƒç¼–è¾‘æ“ä½œ é‡å‘½åï¼ˆNï¼‰ï¼šé€‰ä¸­é»˜è®¤åç§°ï¼ˆå¦‚ v1ã€sub_401000ï¼‰ï¼ŒæŒ‰ã€ŒNã€è¾“å…¥æœ‰æ„ä¹‰åç§°ï¼ˆå¦‚ inputã€checkï¼‰ï¼›\nç±»å‹ä¿®æ”¹ï¼ˆYï¼‰ï¼šé€‰ä¸­å˜é‡ / å‡½æ•°ï¼ŒæŒ‰ã€ŒYã€ä¿®æ”¹ç±»å‹ï¼Œä¾‹å¦‚ï¼š\nJNI å‡½æ•°ï¼ˆsoæ–‡ä»¶åˆ†æï¼‰ï¼šå°† void __cdecl sub_10001234() æ”¹ä¸º JNIEXPORT jint JNICALL Java_com_example_Test_check(JNIEnv *env, jobject thiz, jstring input)ï¼ŒIDA è‡ªåŠ¨è¯†åˆ« JNI å‚æ•°ï¼›\næ•°ç»„ç±»å‹ï¼šå°† int v2 æ”¹ä¸º char v2[]ï¼Œæ˜ç¡®æ•°ç»„é€»è¾‘ï¼›\næ³¨é‡Šæ·»åŠ ï¼šæŒ‰ã€Œ/ã€è¾“å…¥å¤šè¡Œæ³¨é‡Šï¼Œè¡¥å……é€»è¾‘è¯´æ˜ï¼ˆå¦‚ â€œå¯†ç éªŒè¯æ ¸å¿ƒé€»è¾‘ï¼Œè¿”å› 1 è¡¨ç¤ºéªŒè¯é€šè¿‡â€ï¼‰ã€‚ 3.3.2 ä¼ªä»£ç ç”Ÿæˆå¤±è´¥è§£å†³ è‹¥æç¤º â€œCannot generate pseudocodeâ€ï¼Œéœ€ä¿®æ­£ IDA ä»£ç è¯†åˆ«ï¼š\nåˆ‡æ¢è‡³æ±‡ç¼–è§†å›¾ï¼Œå®šä½æŠ¥é”™åœ°å€ï¼›\né€‰ä¸­è¯¯åˆ¤ä¸º â€œæ•°æ®â€ çš„ä»£ç æ®µï¼ŒæŒ‰ã€ŒUã€ï¼ˆundefineï¼‰è½¬ä¸ºæ•°æ®ï¼›\né‡æ–°é€‰ä¸­ç›®æ ‡æ®µï¼ŒæŒ‰ã€ŒCã€ï¼ˆcodeï¼‰è½¬ä¸ºä»£ç ï¼ˆæŒ‰Pè¯†åˆ«æˆå‡½æ•°ï¼‰ï¼›\næŒ‰ã€Œtabã€åˆ‡æ¢å›ä¼ªä»£ç è§†å›¾ï¼Œå³å¯æ­£å¸¸ç”Ÿæˆã€‚\n3.4 ä¸»å‡½æ•°å®šä½æ–¹æ³•ï¼ˆåˆ†åœºæ™¯ï¼‰ åœºæ™¯ 1ï¼šæ ·æœ¬å¸¦ç¬¦å·ï¼ˆå¦‚è°ƒè¯•ç‰ˆ exe/soï¼‰ ä¸€èˆ¬ä¸»ç•Œé¢å·¦ä¾§å°±æ˜¯å‡½æ•°åˆ—è¡¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±æŒ‰ã€ŒShift+F3ã€æ‰“å¼€å‡½æ•°åˆ—è¡¨ï¼›\næœç´¢ç›®æ ‡å‡½æ•°åï¼šC è¯­è¨€ç¨‹åºæœ main/startï¼ŒWindows GUI ç¨‹åºæœ WinMainï¼ŒAndroid so æœ JNI_OnLoadï¼›\nåŒå‡»å‡½æ•°åè·³è½¬è‡³ä¸»å‡½æ•°ã€‚\nåœºæ™¯ 2ï¼šæ ·æœ¬æ— ç¬¦å·ï¼ˆè„±å£³å /release ç‰ˆï¼‰ æŒ‰ã€ŒShift+F12ã€æ‰“å¼€å­—ç¬¦ä¸²çª—å£ï¼Œç­›é€‰å…³é”®å­—ç¬¦ä¸²ï¼ˆå¦‚ â€œsuccessâ€â€œrightâ€â€œflagâ€ï¼‰ï¼›\nå³é”®é€‰ä¸­ç›®æ ‡å­—ç¬¦ä¸² â†’ ã€ŒJump to xrefã€ï¼ˆäº¤å‰å¼•ç”¨ , å¿«æ·é”®æ˜¯[ x ]ï¼‰ï¼Œè·³è½¬è‡³å¼•ç”¨è¯¥å­—ç¬¦ä¸²çš„ä»£ç ï¼›\nå‘ä¸Šè¿½æº¯ä»£ç ï¼Œæ‰¾åˆ° â€œè°ƒç”¨æ¬¡æ•°æœ€å°‘ã€å±‚çº§æœ€é¡¶å±‚â€ çš„å‡½æ•°ï¼ˆé€šå¸¸æ•´ä¸ªç¨‹åºä»…è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”è°ƒç”¨å…¶ä»–å‡½æ•°ï¼‰ï¼Œå³ä¸ºä¸»å‡½æ•°ã€‚\nåœºæ™¯ 3ï¼šDLL/so æ–‡ä»¶ï¼ˆå¯¼å‡ºå‡½æ•°ï¼‰ æŒ‰ã€ŒCtrl+Iã€æ‰“å¼€å¯¼å‡ºè¡¨ï¼›\nç­›é€‰å¯¹å¤–æä¾›çš„å‡½æ•°ï¼ˆå¦‚ DLL çš„ ExportFuncã€so çš„ Java_åŒ…å_ç±»å_æ–¹æ³•åï¼‰ï¼›\næ­¤ç±»å¯¼å‡ºå‡½æ•°ä¸ºå¤–éƒ¨è°ƒç”¨å…¥å£ï¼Œç­‰æ•ˆäº DLL/so çš„ â€œä¸»å‡½æ•°â€ã€‚\né‡ç‚¹æç¤ºï¼šæ— ç¬¦å·æ ·æœ¬ä¼˜å…ˆä½¿ç”¨ã€ŒShift+F12 æ‰¾å…³é”®å­—ç¬¦ä¸²ã€ï¼Œä¸ºæœ€é«˜æ•ˆçš„ä¸»å‡½æ•°å®šä½æ–¹å¼ã€‚\nå››ã€LazyIDA ä¸“é¡¹é€ŸæŸ¥ LazyIDA æ˜¯é€†å‘é«˜é¢‘æ“ä½œçš„ â€œåŠ é€Ÿå™¨â€ï¼Œä»¥ä¸‹æŒ‰ã€Œå¿«æ·é”®ã€ã€Œå³é”®èœå•ã€ã€Œå®æ“å·¥ä½œæµã€åˆ†ç±»ï¼Œè¦†ç›–åœ°å€å¤„ç†ã€Patchã€æ ¼å¼è½¬æ¢ç­‰æ ¸å¿ƒåœºæ™¯ï¼ˆç»„ä¼šé‡ç‚¹æ¼”ç¤ºåŠŸèƒ½ï¼‰ã€‚\n4.1 å¿«æ·é”®é€ŸæŸ¥è¡¨ï¼ˆæŒ‰è§†å›¾ / ä¸Šä¸‹æ–‡åˆ†ç±»ï¼‰ å¿«æ·é”® åŠ¨ä½œ ä½œç”¨è¯´æ˜ é€‚ç”¨è§†å›¾ / ä¸Šä¸‹æ–‡ å¤‡æ³¨ w Copy EA å¤åˆ¶å½“å‰åœ°å€åˆ°å‰ªè´´æ¿ï¼ˆå¦‚ï¼š0x401000ï¼‰ åæ±‡ç¼–è§†å›¾ / è½¬å‚¨è§†å›¾ è¾“å‡ºçª—å£ä¼šæ‰“å°ç¡®è®¤ä¿¡æ¯ Shift+G Goto clip EA è¯»å–å‰ªè´´æ¿åœ°å€ / æ–‡æœ¬ï¼Œæ‰“å¼€ Lazy Jumper çª—å£å¹¶è·³è½¬ åæ±‡ç¼–è§†å›¾ / è½¬å‚¨è§†å›¾ æ”¯æŒ â€œæ–°é•œåƒåŸºå€ + ç›®æ ‡åœ°å€â€ çš„æ— é‡å®šä½è·³è½¬ï¼ŒEsc å…³é—­çª—å£ Ctrl+Alt+N NOP them å¯¹é€‰åŒºæ‰¹é‡å†™ NOPï¼›æ— é€‰åŒºæ—¶å¯¹å½“å‰æŒ‡ä»¤åœ°å€å†™ 1 ä¸ª NOP åæ±‡ç¼–è§†å›¾ è¾“å‡ºåŒºæ‰“å°èµ·æ­¢åœ°å€ä¸å­—èŠ‚æ•°ï¼Œæ¯”åŸºç¡€ Ctrl+N æ›´çµæ´» v Remove return type æŠŠå½“å‰å‡½æ•° / è°ƒç”¨ç‚¹çš„è¿”å›ç±»å‹ä¸´æ—¶æ”¹ä¸º voidï¼ˆå†æ¬¡æŒ‰å¯è¿˜åŸï¼‰ Hex-Rays ä¼ªä»£ç è§†å›¾ é’ˆå¯¹ VDI_FUNC / å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç”Ÿæ•ˆ wï¼ˆä¼ªä»£ç ï¼‰ Copy EA (Hex-Rays) å¤åˆ¶å½“å‰ä¼ªä»£ç ä½ç½®å…³è”çš„ EA Hex-Rays ä¼ªä»£ç è§†å›¾ ä¸åæ±‡ç¼–è§†å›¾çš„ w ä¸å†²çªï¼Œå„è‡ªç”Ÿæ•ˆ cï¼ˆä¼ªä»£ç ï¼‰ Copy name å¤åˆ¶å½“å‰é«˜äº®åç§°ï¼ˆå˜é‡ / å‡½æ•°åç­‰ï¼‰ Hex-Rays ä¼ªä»£ç è§†å›¾ å–è‡ª IDA çš„ get_highlight () æ¥å£ Shift+Gï¼ˆä¼ªä»£ç ï¼‰ Goto clip EA (Hex-Rays) ä»å‰ªè´´æ¿å–åœ°å€å¹¶åœ¨ IDA ä¸­è·³è½¬ Hex-Rays ä¼ªä»£ç è§†å›¾ ä¸åæ±‡ç¼–è§†å›¾çš„ Shift+G è¡Œä¸ºä¸€è‡´ å°æŠ€å·§ï¼šLazy Jumper å¯¹è¯æ¡†ä¸­ï¼ŒæŒ‰ Enter/Return å¯è§¦å‘è·³è½¬ï¼ŒEsc å…³é—­çª—å£ï¼Œæ— éœ€é¼ æ ‡ç‚¹å‡»ï¼ˆç»„ä¼šå®æ“æ¼”ç¤ºé‡ç‚¹ï¼‰ã€‚\n4.2 å³é”®èœå•åŠŸèƒ½ï¼ˆæŒ‰è§†å›¾åˆ†ç±»ï¼‰ 4.2.1 åæ±‡ç¼– / è½¬å‚¨è§†å›¾ï¼ˆé€šç”¨å³é”®èœå•ï¼‰ èœå•é¡¹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ Paste Data å¼¹å‡º â€œç²˜è´´æ•°æ®â€ çª—å£ï¼Œæ”¯æŒ HEX / BASE64 / ASCII ä¸‰ç§è¾“å…¥å¹¶å†™å›å­—èŠ‚ é€‚åˆå¿«é€Ÿæ‰“è¡¥ä¸ï¼Œè¾“å…¥åç‚¹å‡» Apply ç”Ÿæ•ˆï¼ˆç»„ä¼šå®æ“æ¼”ç¤ºï¼‰ Lazy Dumper å¼¹å‡ºè½¬å‚¨çª—å£ï¼šè¾“å…¥åŸºå€ä¸å¤§å°ï¼Œä¿å­˜é€‰å®šèŒƒå›´å­—èŠ‚åˆ°æ–‡ä»¶ æ“ä½œå¤±è´¥ä¼šåœ¨è¾“å‡ºçª—å£æç¤ºåŸå›  Lazy Jumper [Shift + G] æ‰“å¼€è·³è½¬çª—å£ï¼šè¾“å…¥æ–°åŸºå€ / ç›®æ ‡åœ°å€ï¼Œè®¡ç®—åç§»åè·³åˆ°å½“å‰ IDB çš„ç­‰æ•ˆä½ç½® è‡ªåŠ¨è®°å¿†å†å²åŸºå€ï¼Œä¸‹æ¬¡æ‰“å¼€å¯å¿«é€Ÿå¤ç”¨ Copy RVA è®¡ç®—å¹¶å¤åˆ¶å½“å‰åœ°å€çš„ RVAï¼ˆç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼‰ è°ƒè¯•ä¸­æŒ‰ â€œæ¨¡å—åŸºå€â€ è®¡ç®—ï¼Œéè°ƒè¯•æŒ‰ â€œimagebaseâ€ è®¡ç®— NOP them ä¸ Ctrl+Alt+N åŠŸèƒ½ä¸€è‡´ï¼šé€‰åŒºæ‰¹é‡ NOP / æ— é€‰åŒºå•å­—èŠ‚ NOP å¿«é€Ÿè¿‡åè°ƒã€å»èŠ±æŒ‡ä»¤ï¼ˆç»„ä¼šå®æ“æ¼”ç¤ºï¼‰ Get xored data é€‰ä¸­ä¸€æ®µä»£ç â†’è¾“å…¥ 0â€“255 çš„ XOR å€¼ï¼Œè¾“å‡ºå¼‚æˆ–åçš„æ–‡æœ¬ ä»…åªè¯»è¾“å‡ºç»“æœåˆ°è¾“å‡ºçª—å£ï¼Œä¸å†™å›äºŒè¿›åˆ¶æ–‡ä»¶ Fill with NOPs æŠŠé€‰åŒºæ•´æ®µå¡«å……ä¸º NOP å¿…é¡»å…ˆæ¡†é€‰ä»£ç æ®µï¼ˆå•æŒ‡ä»¤ä¸ç”Ÿæ•ˆï¼‰ï¼Œæ¯” NOP them æ›´å½»åº• Convert/ â†’ æ ¼å¼é€‰é¡¹ æŠŠé€‰ä¸­å­—èŠ‚è½¬ä¸ºæŒ‡å®šæ ¼å¼ï¼š- è½¬ä¹‰å­—ç¬¦ä¸²- åå…­è¿›åˆ¶ä¸²- C æ•°ç»„ï¼ˆBYTE/WORD/DWORD/QWORDï¼‰- Python åˆ—è¡¨ï¼ˆåŒä¸Šï¼‰ è½¬æ¢ç»“æœæ‰“å°åˆ° Output çª—å£ï¼Œéœ€æ‰‹åŠ¨å¤åˆ¶ä½¿ç”¨ æ³¨ï¼šGet xored data / Fill with NOPs / Convert/ ä»…åœ¨ â€œå­˜åœ¨é€‰åŒºâ€ æˆ– â€œå½“å‰æŒ‡ä»¤å¤§å° \u0026gt; 1â€ æ—¶æ˜¾ç¤ºã€‚\n4.2.2 ä»…åæ±‡ç¼–è§†å›¾ï¼ˆç‰¹å®šæ¶æ„ä¸“å±èœå•ï¼‰ èœå•é¡¹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ Scan format string vulnerabilities æ‰«æ printf/sprintf/fprintf ç­‰è°ƒç”¨ç‚¹ï¼Œè‹¥æ ¼å¼ä¸²æ¥è‡ªå¯å†™æ®µåˆ™æ ‡è®°ä¸º â€œå¯èƒ½æ¼æ´â€ï¼Œåˆ—è¡¨å±•ç¤ºå¯è·³è½¬ ä»…æ”¯æŒ x86 (32/64)ã€ARM32 æ¶æ„ï¼Œå…¶ä»–æ¶æ„ä¸æŒ‚è½½ 4.2.3 Hex-Rays ä¼ªä»£ç è§†å›¾ï¼ˆå³é”®èœå•ï¼‰ èœå•é¡¹ ä½œç”¨è¯´æ˜ å¤‡æ³¨ Remove return type ä¸å¿«æ·é”® v ä¸€è‡´ï¼šä¸´æ—¶å°†è¿”å›ç±»å‹æ”¹ä¸º voidï¼ˆå†æ¬¡ç‚¹å‡»è¿˜åŸï¼‰ é’ˆå¯¹å¤æ‚å‡½æ•°æŒ‡é’ˆè°ƒç”¨åœºæ™¯ä¼˜åŒ– Copy ea ä¸å¿«æ·é”® wï¼ˆä¼ªä»£ç ï¼‰ä¸€è‡´ï¼šå¤åˆ¶å½“å‰ä¼ªä»£ç å…³è”çš„ EA å¿«é€Ÿå®šä½ä¼ªä»£ç å¯¹åº”çš„æ±‡ç¼–åœ°å€ Copy name ä¸å¿«æ·é”® cï¼ˆä¼ªä»£ç ï¼‰ä¸€è‡´ï¼šå¤åˆ¶é«˜äº®çš„å˜é‡ / å‡½æ•°å é¿å…æ‰‹åŠ¨è¾“å…¥åç§°ï¼Œå‡å°‘æ‹¼å†™é”™è¯¯ Goto clipboard ea ä¸å¿«æ·é”® Shift+Gï¼ˆä¼ªä»£ç ï¼‰ä¸€è‡´ï¼šä»å‰ªè´´æ¿è·³è½¬åœ°å€ ä¼ªä»£ç ä¸­å¿«é€Ÿè·³è½¬åˆ°å¤–éƒ¨å¼•ç”¨çš„åœ°å€ åŒå‡»å¢å¼ºï¼šobj-\u0026gt;func () è¡¨è¾¾å¼ è‡ªåŠ¨è§£æå¹¶è·³è½¬åˆ°ç›®æ ‡ funcï¼›è‹¥æ‰¾ä¸åˆ°åˆ™å°è¯• Class::func å‘½ä¸­æ—¶ç›´æ¥è·³è½¬ï¼Œæœªå‘½ä¸­æ— å“åº”ï¼ˆéœ€æ‰‹åŠ¨å®šä½ï¼‰ 4.3 å¸¸è§å·¥ä½œæµ ä¸€é”® NOP æŸæ®µä»£ç ï¼š æ¡†é€‰ç›®æ ‡ä»£ç æ®µ â†’ å³é”®ç‚¹å‡»ã€ŒFill with NOPsã€ï¼ˆæˆ–æŒ‰ Ctrl+Alt+Nï¼‰â†’ è¾“å‡ºçª—å£ç¡®è®¤ NOP èŒƒå›´ã€‚\nï¼ˆé€‚ç”¨åœºæ™¯ï¼šæ‰¹é‡å»é™¤èŠ±æŒ‡ä»¤ã€è·³è¿‡åè°ƒè¯•æ£€æµ‹ä»£ç ï¼‰\nå¿«é€Ÿæ‰“è¡¥ä¸ï¼š å®šä½éœ€ä¿®æ”¹çš„åœ°å€ â†’ å³é”®ã€ŒPaste Dataã€â†’ é€‰æ‹©è¾“å…¥æ ¼å¼ï¼ˆå¦‚ HEXï¼‰â†’ ç²˜è´´ä¿®æ”¹åçš„å­—èŠ‚ï¼ˆå¦‚å°† 74 æ”¹ä¸º 75ï¼Œje æ”¹ jneï¼‰â†’ ç‚¹å‡»ã€ŒApplyã€â†’ ä¿å­˜ Patch åçš„æ–‡ä»¶ã€‚\nï¼ˆé€‚ç”¨åœºæ™¯ï¼šä¿®æ”¹è·³è½¬æ¡ä»¶ã€ç»•è¿‡éªŒè¯é€»è¾‘ï¼‰\nè·¨é•œåƒåŸºå€è·³è½¬ï¼š å¤åˆ¶å¤–éƒ¨æ ·æœ¬çš„ç›®æ ‡åœ°å€ï¼ˆå¦‚ 0x10001234ï¼‰â†’ åœ¨å½“å‰ IDA æŒ‰ Shift+G â†’ Lazy Jumper çª—å£è¾“å…¥ â€œæ–°é•œåƒåŸºå€ï¼ˆå¦‚ 0x10000000ï¼‰â€ å’Œ â€œç›®æ ‡åœ°å€ï¼ˆ0x10001234ï¼‰â€â†’ æŒ‰ Enter è·³è½¬ã€‚\nï¼ˆé€‚ç”¨åœºæ™¯ï¼šå¯¹æ¯”å¤šä¸ªæ ·æœ¬ã€åˆ†æè„±å£³åä»£ç ï¼‰\näº”ã€Patch/Keypatchï¼ˆä¿®æ”¹ç¨‹åºé€»è¾‘ï¼‰ Patch å³ â€œäºŒè¿›åˆ¶æ‰“è¡¥ä¸â€ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç å®ç°é€»è¾‘è°ƒæ•´ï¼ˆå¦‚è¿‡åè°ƒã€è·³è¿‡éªŒè¯ï¼‰ï¼Œä¾èµ– IDA+LazyIDA+Keypatch ç»„åˆï¼ˆLazyIDA è´Ÿè´£é«˜æ•ˆæ“ä½œï¼ŒKeypatch è´Ÿè´£æŒ‡ä»¤æ±‡ç¼–ï¼‰ã€‚\n5.1 Keypatch æ’ä»¶å®‰è£… å°† Keypatch æ’ä»¶æ–‡ä»¶å¤åˆ¶è‡³ IDA çš„ plugins ç›®å½•ï¼Œé‡å¯ IDA å³å¯ï¼ˆä¸ IDA 9.1/9.2 å…¼å®¹ï¼‰ï¼ŒåŠŸèƒ½ä¸º â€œå¯è§†åŒ–ä¿®æ”¹æ±‡ç¼–æŒ‡ä»¤ï¼Œæ— éœ€æ‰‹åŠ¨è®¡ç®—æœºå™¨ç â€ã€‚\n5.2 æ ¸å¿ƒ Patch æ“ä½œï¼ˆåˆ†åœºæ™¯ï¼‰ åœºæ™¯ 1ï¼šNOP æ‰æ— ç”¨ä»£ç ï¼ˆåŸºç¡€ç‰ˆï¼‰ ï¼ˆLazyIDA å·²å®ç°è¿›é˜¶æ‰¹é‡ NOPï¼Œè§ç¬¬å››ç«  4.3 å·¥ä½œæµï¼‰\né€‚ç”¨åœºæ™¯ï¼šå•æŒ‡ä»¤ NOPã€ç®€å•é€»è¾‘è·³è¿‡ï¼›\næ“ä½œæ­¥éª¤ï¼šé€‰ä¸­æŒ‡ä»¤ â†’ æŒ‰ Ctrl+Nï¼ˆLazyIDA åŸºç¡€åŠŸèƒ½ï¼‰â†’ æŒ‡ä»¤æ›¿æ¢ä¸º NOPã€‚\nåœºæ™¯ 2ï¼šä¿®æ”¹æŒ‡ä»¤ï¼ˆè°ƒæ•´è·³è½¬æ¡ä»¶ï¼‰ é€‚ç”¨åœºæ™¯ï¼šå¼ºåˆ¶è·³è½¬è‡³æ­£ç¡®é€»è¾‘ï¼ˆå¦‚è·³è¿‡éªŒè¯å¤±è´¥åˆ†æ”¯ï¼‰ï¼›\næ“ä½œæ­¥éª¤ï¼š\nåœ¨æ±‡ç¼–è§†å›¾é€‰ä¸­å¾…ä¿®æ”¹æŒ‡ä»¤ï¼ˆå¦‚ je 0x401200ï¼‰ï¼›\nå³é”® â†’ ã€ŒKeypatchã€â†’ è¾“å…¥æ–°æŒ‡ä»¤ï¼ˆå¦‚ jmp 0x401300ï¼‰ï¼›\nç‚¹å‡»ã€ŒAssembleã€â†’ ã€ŒPatch fileã€â†’ ä¿å­˜ä¿®æ”¹åçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\nåœºæ™¯ 3ï¼šæ¢å¤è¯¯åˆ¤ä»£ç ï¼ˆU+C ç»„åˆï¼‰ é€‚ç”¨åœºæ™¯ï¼šIDA å°†æ­£å¸¸ä»£ç è¯¯åˆ¤ä¸ºæ•°æ®ï¼ˆæ˜¾ç¤ºä¸ºåå…­è¿›åˆ¶ï¼‰ï¼›\næ“ä½œæ­¥éª¤ï¼š\né€‰ä¸­è¯¯åˆ¤æ•°æ®æ®µï¼ŒæŒ‰ã€ŒUã€ï¼ˆundefineï¼‰è½¬ä¸ºæ•°æ®ï¼›\né‡æ–°é€‰ä¸­ç›®æ ‡æ®µï¼ŒæŒ‰ã€ŒCã€ï¼ˆcodeï¼‰è½¬ä¸ºä»£ç ï¼›\næŒ‰ã€Œtabã€åˆ‡æ¢å›ä¼ªä»£ç è§†å›¾ï¼Œæ¢å¤è§£æã€‚\n5.3 åœ°å€è·³è½¬æ“ä½œï¼ˆG å¿«æ·é”® + Lazy Jumperï¼‰ åŸºç¡€è·³è½¬ï¼šå·²çŸ¥åœ°å€ï¼ˆå¦‚ 0x401100ï¼‰â†’ æŒ‰ã€ŒGã€â†’ è¾“å…¥åœ°å€è·³è½¬ï¼›\nè¿›é˜¶è·³è½¬ï¼šè·¨åŸºå€ / å‰ªè´´æ¿åœ°å€ â†’ æŒ‰ Wå’ŒShift+Gï¼ˆLazy Jumperï¼‰ç»„åˆâ†’ è¾“å…¥å‚æ•°è·³è½¬ï¼ˆè§ç¬¬å››ç«  4.1ï¼‰ã€‚\nå…­ã€åŠ¨æ€è°ƒè¯•ï¼šè·Ÿè¸ªç¨‹åºè¿è¡Œ åŠ¨æ€è°ƒè¯•é€šè¿‡è¿è¡Œç¨‹åºã€ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿå˜é‡å€¼ä¸å‡½æ•°è°ƒç”¨ï¼Œç²¾å‡†å®šä½æ ¸å¿ƒé€»è¾‘ã€‚\n6.1 æ ¸å¿ƒæ¦‚å¿µ æ–­ç‚¹ï¼šç¨‹åºè¿è¡Œè‡³æŒ‡å®šä½ç½®æš‚åœï¼Œä¾¿äºè§‚å¯Ÿï¼›\nå•æ­¥æ‰§è¡Œï¼šæš‚åœåé€è¡Œæ‰§è¡Œä»£ç ï¼Œè·Ÿè¸ªå˜é‡å˜åŒ–ï¼›\næœ¬åœ°è°ƒè¯•ï¼šåœ¨æœ¬åœ°è®¾å¤‡è¿è¡Œå¹¶è°ƒè¯•ç¨‹åºï¼›\nè¿œç¨‹è°ƒè¯•ï¼šè°ƒè¯•å…¶ä»–è®¾å¤‡ï¼ˆå¦‚ Linux æœåŠ¡å™¨ã€Android æ‰‹æœºï¼‰ä¸Šçš„ç¨‹åºã€‚\n6.2 æ–­ç‚¹ç±»å‹å¯¹æ¯”ï¼ˆåˆ†åœºæ™¯é€‰ç”¨ï¼‰ æ–­ç‚¹ç±»å‹ æ“ä½œæ–¹å¼ åŸç† ä¼˜ç‚¹ ç¼ºç‚¹ è½¯ä»¶æ–­ç‚¹ é€‰ä¸­æŒ‡ä»¤æŒ‰ã€ŒF2ã€ å°†æŒ‡ä»¤æ›¿æ¢ä¸º int3ï¼ˆè°ƒè¯•ä¸­æ–­æŒ‡ä»¤ï¼‰ æ“ä½œç®€å•ã€æ— æ•°é‡é™åˆ¶ æ˜“è¢«ç¨‹åºæ£€æµ‹ï¼ˆint3 ä¸ºç‰¹å¾ï¼‰ ç¡¬ä»¶æ–­ç‚¹ å³é”®æ–­ç‚¹ â†’ ã€ŒEdit breakpointã€â†’ å‹¾é€‰ã€ŒHardware breakpointã€ åˆ©ç”¨ CPU è°ƒè¯•å¯„å­˜å™¨å®ç° éšè”½æ€§å¼ºã€ä¸æ˜“è¢«æ£€æµ‹ æ•°é‡æœ‰é™ï¼ˆé€šå¸¸æœ€å¤š 4 ä¸ªï¼‰ é‡ç‚¹æç¤ºï¼šæ–°æ‰‹ä¼˜å…ˆä½¿ç”¨è½¯ä»¶æ–­ç‚¹ï¼ˆF2ï¼‰ï¼Œé‡åˆ°åè°ƒè¯•æ£€æµ‹æ—¶åˆ‡æ¢ä¸ºç¡¬ä»¶æ–­ç‚¹ï¼ˆç»„ä¼šå®æ“æ¼”ç¤ºï¼‰ã€‚\n6.3 Windows å¹³å°è°ƒè¯•ï¼ˆexe/dllï¼‰ 6.3.1 æœ¬åœ°è°ƒè¯•æ­¥éª¤ IDA åŠ è½½ exe æ–‡ä»¶ï¼Œç­‰å¾…åˆ†æå®Œæˆï¼›\næŒ‰ã€ŒF9ã€ï¼ˆStart processï¼‰å¯åŠ¨ç¨‹åºï¼ˆæ— æ–­ç‚¹æ—¶ç¨‹åºä¼šç›´æ¥è¿è¡Œç»“æŸï¼‰ï¼›\nåœ¨å…³é”®ä½ç½®ï¼ˆå¦‚éªŒè¯å‡½æ•°ã€å­—ç¬¦ä¸²å¼•ç”¨å¤„ï¼‰æŒ‰ã€ŒF2ã€ä¸‹æ–­ç‚¹ï¼Œç¨‹åºè¿è¡Œè‡³æ–­ç‚¹å¤„è‡ªåŠ¨æš‚åœï¼›\nå•æ­¥æ“ä½œï¼š\nF7ï¼šå•æ­¥æ­¥å…¥ï¼ˆè¿›å…¥å‡½æ•°å†…éƒ¨ï¼Œå¦‚ call æŒ‡ä»¤æ—¶è·Ÿè¿›ï¼‰ï¼›\nF8ï¼šå•æ­¥æ­¥è¿‡ï¼ˆä¸è¿›å…¥å‡½æ•°ï¼Œç›´æ¥æ‰§è¡Œå®Œ call æŒ‡ä»¤ï¼‰ï¼›\nF9ï¼šè¿è¡Œè‡³å½“å‰å‡½æ•°ç»“æŸï¼ˆå¿«é€Ÿè·³å‡ºå‡½æ•°ï¼‰ï¼›\nå˜é‡è§‚å¯Ÿï¼šæš‚åœæ—¶ï¼Œé¼ æ ‡æ‚¬åœä¼ªä»£ç ä¸­çš„å˜é‡ï¼ˆå¦‚ input_passï¼‰ï¼Œæ˜¾ç¤ºå½“å‰å˜é‡å€¼ï¼ˆç»„ä¼šå®æ“æ¼”ç¤ºé‡ç‚¹ï¼‰ã€‚ 6.3.2 é™„åŠ è¿›ç¨‹è°ƒè¯•ï¼ˆè°ƒè¯•å·²è¿è¡Œç¨‹åºï¼‰ ç¡®ä¿ç›®æ ‡ç¨‹åºå·²åœ¨æœ¬åœ°è¿è¡Œï¼›\nIDA èœå•æ  â†’ ã€ŒDebuggerã€â†’ ã€ŒAttachã€â†’ ã€ŒLocal Processã€ï¼›\nåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­ç­›é€‰ç›®æ ‡ç¨‹åºï¼ˆæŒ‰åç§°æ£€ç´¢ï¼‰ï¼Œé€‰ä¸­åç‚¹å‡»ã€ŒAttachã€ï¼›\næŒ‰ã€ŒF2ã€ä¸‹æ–­ç‚¹ï¼ŒæŒ‰ã€ŒF9ã€æ¢å¤ç¨‹åºè¿è¡Œï¼Œè§¦å‘æ–­ç‚¹åæŒ‰å•æ­¥æ“ä½œè°ƒè¯•ã€‚\n6.4 Linux å¹³å°è°ƒè¯•ï¼ˆelf/soï¼‰ 6.4.1 è¿œç¨‹è°ƒè¯•æ­¥éª¤ï¼ˆå¦‚è°ƒè¯•æœåŠ¡å™¨ / æ‰‹æœº soï¼‰ ä»æœ¬åœ° IDA å®‰è£…ç›®å½•è·å–è°ƒè¯•æœåŠ¡å™¨ï¼š\næœ¬åœ°è·¯å¾„ï¼šE:\\IDA\\IDA Professional 9.2\\dbgsrv é€‰æ‹©å¯¹åº”ç‰ˆæœ¬ï¼š32 ä½æ ·æœ¬ç”¨ linux_serverï¼Œ64 ä½æ ·æœ¬ç”¨ linux_serverï¼ˆAndroid å¯¹åº” android_server/android_server32ï¼‰ï¼› å°†è°ƒè¯•æœåŠ¡å™¨æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡æœºçš„ã€Œè°ƒè¯•æ ·æœ¬åŒç›®å½•ã€ï¼›\nç»™è°ƒè¯•æœåŠ¡å™¨å’Œæ ·æœ¬æ–‡ä»¶åŠ æƒï¼ˆèµ‹äºˆæ‰§è¡Œæƒé™ï¼‰ï¼š\n1 2 chmod 777 linux_server # è°ƒè¯•æœåŠ¡å™¨åŠ æƒ chmod 777 test.exe # å¾…è°ƒè¯•æ ·æœ¬åŠ æƒ å¯åŠ¨è°ƒè¯•æœåŠ¡å™¨ï¼š\næ–¹å¼ 1ï¼šä½¿ç”¨è‡ªå®šä¹‰ç«¯å£ï¼ˆæ¨èï¼Œé¿å…ç«¯å£å†²çªï¼‰\n1 ./linux_server -p 1234 # 1234 ä¸ºè‡ªå®šä¹‰ç«¯å£ï¼Œå¯æ›¿æ¢ä¸º 1024-65535 ä¹‹é—´æœªå ç”¨ç«¯å£ æ–¹å¼ 2ï¼šä½¿ç”¨é»˜è®¤ç«¯å£ï¼ˆæ— éœ€æŒ‡å®š -pï¼Œé»˜è®¤ç«¯å£ä¸º 23946ï¼‰\n1 ./linux_server å¯åŠ¨æˆåŠŸåï¼Œç»ˆç«¯ä¼šæ˜¾ç¤º â€œListening on port XXXXâ€ï¼ˆXXXX ä¸ºç«¯å£å·ï¼‰ï¼Œä¿æŒç»ˆç«¯çª—å£å¼€å¯ã€‚\n6.5 è°ƒè¯•é¿å‘æŒ‡å— è°ƒè¯•å‰å…³é—­æ€æ¯’è½¯ä»¶ / é˜²ç«å¢™ï¼Œé¿å…ç¨‹åºè¢«æ‹¦æˆªï¼›\nWindows è°ƒè¯• GUI ç¨‹åºæ—¶ï¼Œæ–­ç‚¹ä¸è®¾ç½®åœ¨ UI åˆå§‹åŒ–å‡½æ•°ï¼ˆæ˜“å¯¼è‡´ç¨‹åºå¡ä½ï¼‰ï¼›\nè¿œç¨‹è°ƒè¯•éœ€ç¡®ä¿ç›®æ ‡æœºä¸æœ¬åœ°æœºç½‘ç»œäº’é€šï¼ˆå¦‚åŒä¸€å±€åŸŸç½‘ï¼Œå…³é—­é˜²ç«å¢™ï¼‰ï¼›\nAndroid so è°ƒè¯•ï¼šå…ˆå°† so æ–‡ä»¶ä»æ‰‹æœºæ‹‰å–è‡³æœ¬åœ°ï¼ŒIDA åŠ è½½åè¿œç¨‹é™„åŠ æ‰‹æœºè¿›ç¨‹ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒ\n[ä¸€æ¬¡IDAåŠ¨æ€è°ƒè¯•å®‰å“apkè®°å½•]\n","date":"2025-11-06T13:57:03+08:00","image":"https://s.panlai.com/upload/bizhihui_com_20231112122819169976329926177.png-arthumbs","permalink":"https://fanshanng.cn/p/zuhu1/","title":"è½¯ä»¶é€†å‘å·¥ç¨‹ç»„ä¼šï¼šIDA å¸¸è§æ“ä½œä¸åŸºç¡€çŸ¥è¯†"},{"content":"bbox ä¸»å‡½æ•°ç›®æµ‹æ˜¯ä¸€ä¸ªç±»ä¼¼è¿·å®«ï¼Œç‚¹è¿›å»çœ‹äº†é€»è¾‘ï¼Œå‘ç°æ˜¯æ¨ç®±å­ï¼Œç®€å•æ¥è¯´2æ˜¯äººï¼Œ3æ˜¯ç®±å­ï¼Œ4æ˜¯ç›®çš„åœ°\nè¿™ä¸ªæ˜¯dçš„é€»è¾‘ï¼Œå¦‚æœä¸æ˜¯æœ€å³è¾¹ï¼ˆ19)ï¼Œå°±ä¼š+1ï¼Œy_1æ˜¯æ–°çš„æ¨ªåæ ‡ç´¢å¼•ï¼Œxæ˜¯çºµåæ ‡ç´¢å¼•ï¼Œnåº”è¯¥æ˜¯æŒ‘æˆ˜çš„ä¸ªæ•°ï¼Œ5600/400=14ä¸ªæŒ‘æˆ˜ã€‚ å‰ä¹ä¸ªçš„æœ€çŸ­è·¯å¾„å­—ç¬¦ä¸²æ‹¼æ¥æˆæ˜¯212139211325313,MD5å€¼æ˜¯fec2d316d20dbacbe0cdff8fb6ff07b9,åäº”ä¸ªç›®æµ‹ä¸æ˜¯æ¨ç®±å­ï¼Œæ˜¯qwb!è¿˜æœ‰ä¸€ä¸ªæ˜¯çº¯0å¡«å…… ç»„æˆflagï¼šflag {qwb!_fec2d316d20dbacbe0cdff8fb6ff07b9}\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 11111111111111111111 11111111111111111111 11411111111111111111 11030011111111111111 11011011111111111111 00000211111111111111 11101111111111111111 11101111111111111111 01100110001000100010 01000000001000100010 01000000001000111110 01111111111000000010 00000000001000000010 00001111111000111110 00001000001000100010 01111000001000100010 01000000001111100010 01000000000000000010 01000000001111100010 01000000000000000010//2 00000000000000000000 01111111111111111110 01000000000000000010 01200300040000000010 01000000000000000010 01111111111111101110 01000000000000000010 01000011111000111110 01000010001000100010 01111110001000100010 00000010000000100010 00111110001000111110 00100000001000000010 00100010111000111110 00100030001000100010 00111100001000100010 00400000001000100010 01111111111000100010 01000000000000000010 01000000000000000010//4+8=12 11111111111111111111 14000000000000000001 10111111111111100001 10100000000000100001 10100000000000100001 10103000000000100001 10111011101111100001 10000000000000000001 10111111111111011111 10000000100000000001 10000000000000001001 10000000100000001001 11111111100000001001 10000000000000002001 11111111111111111111 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000//13 11111111111111111111 14000000000000000001 10000001111111000001 10000000300001000001 10000001000001000001 10000001000021000001 10000001111111000001 10000000000000000001 11111111111111111111 10000000100000000001 10000000100000000111 10000000100000000100 10111111100000000100 10000000000000000100 11111111111111111111 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000//9 11111111111111111111 10000000000000000001 10111111111111111001 10100000000000001001 10101111111111111001 10101000000000001001 10101011111111111001 10101010000000000001 10101010111111111101 10001000100000000001 11111111111111111111 10000000000000100001 10000001111111101101 10000001000000001001 11111111111111111111 10000000000000040001 10000001111111110101 10000000000000300001 11111011111111101111 10000000000000020001//21 11111111111111111111 14000003000000000001 10111111111111100001 10100000002000000001 10101111111111101101 10101000001000001001 10101011111011101001 10001010001010001001 10111010101010101101 10100000000000000001 11111111111111101111 10000001000000000001 10000001111111011101 10000001000000301001 11111111400000001001 10000000000000001001 10111111111111111001 10100000000000000001 11111111111111111111 10000000000000000001//6+7=13 11111111111111111111 10000010000000000001 10111111111111111001 10100000000000001001 10101111111111111001 10101000021000000001 10101011111011111101 10101010000010000001 10001010111110111101 11111010100000100001 10000010101111101101 10111110101000001001 10100000101011111001 10101111101010000001 10003000000000111111 11111011111010100001 10000000000010101111 10111111111110001001 14000000000000001001 11111111111111111111//25 11111111111111111111 14000000000002003001 10111011111111111001 10100000000000000001 10101111111011111001 10101400001000001001 10101011111010101001 10101010001010101001 10101010111010101101 10003000100000000001 10111011111111111101 10000001000010000001 11111111111111111101 10003000000000041001 10111111111111111001 10100000001000000001 10101111111011111101 10101000001000001001 10101011111111111001 10000000000000000001//15+5+11=31 11111111111111111111 10000000000000100001 10111111111111111001 10100000000000001001 10101111111111111001 10101000000000000001 10101110111011111101 10001013001010001001 11111002111010101001 10000010100000101001 10111114101111111001 10100000001000000001 10101111101111111101 10101000000000001001 10001111111111111001 11111000000000000001 10000011111111111101 10111110000000000001 10100000000000000001 11111111111111111111//3 11111111111111111111 11111111111111111111 11111111111111111111 11100000000001111111 11101111111101111111 11101111111101111111 11101111111101111111 11101111111101111111 11101111111101111111 11100000000001111111 11111111111101111111 11111111111101111111 11111111111101111111 11111111111101111111 11111111111101111111 11111111111101111111 11111111111101111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11011110111101111111 11011110111101111111 11011110111101111111 11011110111101111111 11011110111101111111 11101110111011111111 11101110111011111111 11101101010111111111 11110101010111111111 11110101010111111111 11111011101111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11101111111111111111 11101111111111111111 11101111111111111111 11101111111111111111 11101111111111111111 11100000000011111111 11101111111011111111 11101111111011111111 11101111111011111111 11101111111011111111 11101111111011111111 11101111111011111111 11100000000011111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111111111111111111 11111110000011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110111011111111 11111110000011111111 11111111111111111111 11111111111111111111 11111111000111111111 11111111010111111111 11111111010111111111 11111111000111111111 11111111111111111111 11111111111111111111 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 00000000000000000000 0000000000000000000 snake æ–‡ä»¶æ‰“å¼€åå‘ç°å¤§æ¦‚æ˜¯ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ åœ¨ç»‘å®šä¸Šä¸‹å·¦å³æ–¹å‘é”®ä¸­ï¼Œå­¦åˆ°windowsçš„è™šæ‹Ÿé”®ä½\nç¬¦å·å¸¸é‡åç§° åå…­è¿›åˆ¶å€¼ asciiå€¼ æè¿° VK_LEFT 0x25 \u0026lsquo;%\u0026rsquo; å‘å·¦é”® VK_UP 0x26 \u0026lsquo;\u0026amp;\u0026rsquo; å‘ä¸Šé”® VK_RIGHT 0x27 \u0026lsquo;\\\u0026rsquo; å‘å³é”® VK_DOWN 0x28 \u0026lsquo;(\u0026rsquo; å‘ä¸‹é”® çœ‹åˆ«äººçš„wpçŸ¥é“ ç„¶åå°±ç›´æ¥ç©ï¼Œä¿è¯æœ€çŸ­è·¯å¾„å°±è¡Œï¼Œåˆ°ç¬¬ååˆ†çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨æ–­ä¸‹æ¥ï¼Œè¿›å…¥lpAddressæŒ‡å‘çš„åœ°å€2373D8A000h\nå†™äº†ä¸€æ®µ idc è„šæœ¬dumpå‡ºæ¥å¾—åˆ°1.bin\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // å®šä¹‰éœ€è¦æå–çš„èµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®é™…åœ°å€ï¼‰ auto start_addr = 0x000002373D8A0000; auto end_addr = 0x000002373D8A047F; auto file_handle, byte_count, i; // åˆ›å»º/æ‰“å¼€1.binæ–‡ä»¶ï¼ˆ\u0026#34;wb\u0026#34;è¡¨ç¤ºäºŒè¿›åˆ¶å†™å…¥æ¨¡å¼ï¼‰ file_handle = fopen(\u0026#34;1.bin\u0026#34;, \u0026#34;wb\u0026#34;); if (file_handle == 0) { Message(\u0026#34;åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼è¯·æ£€æŸ¥è·¯å¾„\\n\u0026#34;); return; } // è®¡ç®—éœ€è¦å¯¼å‡ºçš„å­—èŠ‚æ•°ï¼ˆç»“æŸåœ°å€ - èµ·å§‹åœ°å€ + 1ï¼Œç¡®ä¿åŒ…å«æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰ byte_count = end_addr - start_addr + 1; // å¾ªç¯è¯»å–æ¯ä¸ªåœ°å€çš„å­—èŠ‚å¹¶å†™å…¥æ–‡ä»¶ for (i = 0; i \u0026lt; byte_count; i++) { fputc(Byte(start_addr + i), file_handle); } // å…³é—­æ–‡ä»¶å¹¶æç¤ºæˆåŠŸ fclose(file_handle); Message(\u0026#34;å¯¼å‡ºæˆåŠŸï¼å…±å¯¼å‡º %d å­—èŠ‚åˆ° 1.bin\\n\u0026#34;, byte_count); 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 char __fastcall sub_0(__int64 a1, __int64 a2, __int64 a3, unsigned int *a4) { char *v4; // rdi __int64 n78; // rcx char v7; // [rsp+20h] [rbp+0h] BYREF unsigned int v8; // [rsp+24h] [rbp+4h] int v9; // [rsp+44h] [rbp+24h] _DWORD v10[12]; // [rsp+68h] [rbp+48h] BYREF unsigned int v11; // [rsp+98h] [rbp+78h] unsigned int v12; // [rsp+9Ch] [rbp+7Ch] unsigned int v13; // [rsp+A0h] [rbp+80h] unsigned int v14; // [rsp+A4h] [rbp+84h] unsigned int n0x20; // [rsp+C4h] [rbp+A4h] unsigned int n0x20_1; // [rsp+E4h] [rbp+C4h] _BYTE v17[44]; // [rsp+108h] [rbp+E8h] int n16; // [rsp+134h] [rbp+114h] v4 = \u0026amp;v7; for ( n78 = 78; n78; --n78 ) { *(_DWORD *)v4 = -858993460; v4 += 4; } v8 = 0; v9 = -1640531527; qmemcpy(v10, \u0026#34;W31c0m3. 2 QWBs8\u0026#34;, 16); v11 = *a4; v12 = a4[1]; v13 = a4[2]; v14 = a4[3]; for ( n0x20 = 0; n0x20 \u0026lt; 0x20; ++n0x20 ) { v11 += (v10[v8 \u0026amp; 3] + v8) ^ (v12 + ((v12 \u0026gt;\u0026gt; 5) ^ (16 * v12))); v8 += v9; v12 += (v10[(v8 \u0026gt;\u0026gt; 11) \u0026amp; 3] + v8) ^ (v11 + ((v11 \u0026gt;\u0026gt; 5) ^ (16 * v11))); } for ( n0x20_1 = 0; n0x20_1 \u0026lt; 0x20; ++n0x20_1 ) { v13 += (v10[v8 \u0026amp; 3] + v8) ^ (v14 + ((v14 \u0026gt;\u0026gt; 5) ^ (16 * v14))); v8 += v9; v14 += (v10[(v8 \u0026gt;\u0026gt; 11) \u0026amp; 3] + v8) ^ (v13 + ((v13 \u0026gt;\u0026gt; 5) ^ (16 * v13))); } v11 ^= v13; v12 ^= v14; v14 ^= v11; v13 ^= v12; v17[0] = -104; v17[1] = -96; v17[2] = -39; v17[3] = -104; v17[4] = -70; v17[5] = -105; v17[6] = 27; v17[7] = 113; v17[8] = -101; v17[9] = -127; v17[10] = 68; v17[11] = 47; v17[12] = 85; v17[13] = -72; v17[14] = 55; v17[15] = -33; for ( n16 = 0; n16 \u0026lt; 16; ++n16 ) { if ( *((char *)\u0026amp;v11 + n16) != (char)v17[n16] ) return 0; } return 1; } é­”æ”¹teaï¼Œè„šæœ¬å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 from ctypes import * delta = 0x9e3779b9 sum1 = c_uint32(delta * 64) def decrypt(v, k): v0 = c_uint32(v[0]) v1 = c_uint32(v[1]) for i in range(32): # è§£å¯†è½®æ¬¡è¿ç®— v1.value -= (((v0.value \u0026lt;\u0026lt; 4) ^ (v0.value \u0026gt;\u0026gt; 5)) + v0.value) ^ (sum1.value + k[(sum1.value \u0026gt;\u0026gt; 11) \u0026amp; 3]) sum1.value -= delta v0.value -= (((v1.value \u0026lt;\u0026lt; 4) ^ (v1.value \u0026gt;\u0026gt; 5)) + v1.value) ^ (sum1.value + k[sum1.value \u0026amp; 3]) return v0.value, v1.value def long_to_bytes(n): return n.to_bytes((n.bit_length() + 7) // 8, byteorder=\u0026#39;big\u0026#39;) or b\u0026#39;\\x00\u0026#39; if __name__ == \u0026#39;__main__\u0026#39;: a = [0x98D9A098, 0x711B97BA, 0x2F44819B, 0xDF37B855] k = [0x63313357, 0x2E336D30, 0x51203220, 0x38734257] # é¢„å¤„ç†å¼‚æˆ–æ“ä½œ a[2] ^= a[1] a[3] ^= a[0] a[1] ^= a[3] a[0] ^= a[2] temp = [0] * 2 # åˆ†å—è§£å¯† for i in range(1, -1, -1): temp[0] = a[i * 2] temp[1] = a[i * 2 + 1] res = decrypt(temp, k) a[i * 2] = res[0] a[i * 2 + 1] = res[1] # è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶è¾“å‡º for i in range(len(a)): # ä½¿ç”¨è‡ªå®šä¹‰çš„long_to_byteså¹¶å¤„ç†å­—èŠ‚é¡ºåº print(long_to_bytes(a[i])[::-1].decode(errors=\u0026#39;ignore\u0026#39;), end=\u0026#39;\u0026#39;) #flag{G0@d_Snake} 2024-å¼ºç½‘æ¯-åˆèµ›-Writeup-By-Xp0int\nå¼ºç½‘æ¯ 2024 All RE wp\n2024 å¼ºç½‘æ¯ - Reverse\n2024å¼ºç½‘æ¯ web\u0026amp;re éƒ¨åˆ†wp\nmips 1 strings ./emu | grep -i \u0026#34;qemu.*version\\|version.*qemu\u0026#34; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #ä¸‹è½½å®˜æ–¹å®Œæ•´åŒ…ï¼ˆå·²å«å­æ¨¡å—ï¼‰ wget https://download.qemu.org/qemu-6.2.0.tar.xz # å®˜æ–¹æºï¼Œå­æ¨¡å—éƒ½é½äº† tar -xf qemu-6.2.0.tar.xz cd qemu-6.2.0 #ä¸€æ¬¡æ€§é…ç½® + ç¼–è¯‘ export CFLAGS=\u0026#34;-g -O0\u0026#34; export CXXFLAGS=\u0026#34;-g -O0\u0026#34; ./configure --target-list=x86_64-softmmu \\ --disable-werror \\ --enable-debug \\ --disable-strip make -j$(nproc) ç„¶åå°±å¯ä»¥åœ¨~/qemu-6.2.0/build ç›®å½•ä¸‹æ‰¾åˆ°qemu-system-x86_64\nå³é”®å…¨éƒ¨ import model ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªé­”æ”¹çš„RC4\nmips64é€†å‘æ–°æ‰‹å…¥é—¨ï¼ˆä»jarvisojä¸€é“mips64é¢˜ç›®è¯´èµ·ï¼‰\n","date":"2025-10-07T23:31:14+08:00","image":"https://s.panlai.com/zb_users/upload/2025/04/20250428000432174576987299815.jpg-arthumbs","permalink":"https://fanshanng.cn/p/qwbs8/","title":"2024å¼ºç½‘æ¯å¤ç›˜"},{"content":"0x00 ä»€ä¹ˆæ˜¯Frida fridaå®˜æ–¹æ–‡æ¡£\nå®ƒæ˜¯åŸç”Ÿåº”ç”¨çš„Greasemonkeyï¼Œæˆ–è€…ç”¨æ›´ä¸“ä¸šçš„æœ¯è¯­æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç æ’æ¡©å·¥å…·åŒ…ã€‚å®ƒå…è®¸ä½ å°† JavaScript ä»£ç ç‰‡æ®µæˆ–ä½ è‡ªå·±çš„åº“æ³¨å…¥åˆ° Windowsã€macOSã€GNU/Linuxã€iOSã€watchOSã€tvOSã€Androidã€FreeBSD å’Œ QNX ä¸Šçš„åŸç”Ÿåº”ç”¨ä¸­ã€‚Frida è¿˜æä¾›äº†åŸºäº Frida API æ„å»ºçš„ä¸€äº›ç®€å•å·¥å…·ã€‚è¿™äº›å·¥å…·å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œæˆ–è€…ä½œä¸º API ä½¿ç”¨ç¤ºä¾‹ã€‚\nFridaåŸç†åŠé‡è¦ç»„ä»¶ fridaæ³¨å…¥çš„åŸç†å°±æ˜¯æ‰¾åˆ°ç›®æ ‡è¿›ç¨‹,ä½¿ç”¨ptraceè·Ÿè¸ªç›®æ ‡è¿›ç¨‹è·å–mmapï¼Œdlpoenï¼Œdlsymç­‰å‡½æ•°åº“çš„åç§»è·å–mmapåœ¨ç›®æ ‡è¿›ç¨‹ç”³è¯·ä¸€æ®µå†…å­˜ç©ºé—´å°†åœ¨ç›®æ ‡è¿›ç¨‹ä¸­æ‰¾åˆ°å­˜æ”¾frida-agent-32/64.soçš„ç©ºé—´å¯åŠ¨æ‰§è¡Œå„ç§æ“ä½œç”±agentå»å®ç°\nç»„ä»¶åç§° åŠŸèƒ½æè¿° frida-gum æä¾›äº†inline-hookçš„æ ¸å¿ƒå®ç°ï¼Œè¿˜åŒ…å«äº†ä»£ç è·Ÿè¸ªæ¨¡å—Stalkerï¼Œç”¨äºå†…å­˜è®¿é—®ç›‘æ§çš„MemoryAccessMonitorï¼Œä»¥åŠç¬¦å·æŸ¥æ‰¾ã€æ ˆå›æº¯å®ç°ã€å†…å­˜æ‰«æã€åŠ¨æ€ä»£ç ç”Ÿæˆå’Œé‡å®šä½ç­‰åŠŸèƒ½ frida-core fridahookçš„æ ¸å¿ƒï¼Œå…·æœ‰è¿›ç¨‹æ³¨å…¥ã€è¿›ç¨‹é—´é€šä¿¡ã€ä¼šè¯ç®¡ç†ã€è„šæœ¬ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰åŠŸèƒ½ï¼Œå±è”½éƒ¨åˆ†åº•å±‚çš„å®ç°ç»†èŠ‚å¹¶ç»™æœ€ç»ˆç”¨æˆ·æä¾›å¼€ç®±å³ç”¨çš„æ“ä½œæ¥å£ã€‚åŒ…å«äº†frida-serverã€frida-gadgetã€frida-agentã€frida-helperã€frida-injectç­‰å…³é”®æ¨¡å—å’Œç»„ä»¶ï¼Œä»¥åŠä¹‹é—´çš„äº’ç›¸é€šä¿¡åº•åº§ frida-gadget æœ¬èº«æ˜¯ä¸€ä¸ªåŠ¨æ€åº“ï¼Œå¯ä»¥é€šè¿‡é‡æ‰“åŒ…ä¿®æ”¹åŠ¨æ€åº“çš„ä¾èµ–æˆ–è€…ä¿®æ”¹smaliä»£ç å»å®ç°å‘ä¸‰æ–¹åº”ç”¨æ³¨å…¥gadgetï¼Œä»è€Œå®ç°Fridaçš„æŒä¹…åŒ–æˆ–å…root frida-server æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç±»ä¼¼äºå‰é¢å­¦ä¹ åˆ°çš„android_serverï¼Œéœ€è¦åœ¨ç›®æ ‡è®¾å¤‡ä¸Šè¿è¡Œå¹¶è½¬å‘ç«¯å£ï¼Œåœ¨Frida hookä¸­èµ·åˆ°å…³é”®ä½œç”¨ Fridaä¸Xposedçš„å¯¹æ¯” å·¥å…· ä¼˜ç‚¹ ç¼ºç‚¹ Xposed ç›´æ¥ç¼–å†™Javaä»£ç ï¼ŒJavaå±‚hookæ–¹ä¾¿ï¼Œå¯æ‰“åŒ…æ¨¡å—æŒä¹…åŒ–hook ç¯å¢ƒé…ç½®ç¹çï¼Œå…¼å®¹æ€§è¾ƒå·®ï¼Œéš¾ä»¥Hookåº•å±‚ä»£ç ã€‚ Frida é…ç½®ç®€å•ï¼Œå…é‡å¯hookã€‚æ”¯æŒJavaå±‚å’ŒNativeå±‚çš„hookæ“ä½œ æŒä¹…åŒ–hookç›¸å¯¹éº»çƒ¦ Fridaç¯å¢ƒé…ç½® æ¨èç”¨pythonçš„è™šæ‹Ÿç¯å¢ƒenv â€‹\tPython è™šæ‹Ÿç¯å¢ƒçš„åˆ›å»ºï¼ˆvenvï¼‰\nFridaå®‰è£…ä»¥åŠå¤šç‰ˆæœ¬å¤„ç† 1 pip install frida-tools -i https://pypi.tuna.tsinghua.edu.cn/simple push Frida-server æ³¨æ„è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬ ä¸çŸ¥é“æ‰‹æœºåŸºç¡€æ¡†æ¶ï¼ˆABIï¼‰çš„ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ï¼šadb shell getprop ro.product.cpu.abi arm64-v8a â†’ 64 ä½ ARMï¼ˆä¸»æµæ–°æœºï¼‰ armeabi-v7a â†’ 32 ä½ ARMï¼ˆè€æœºå‹ï¼‰ x86 / x86_64 â†’ Intel æ¶æ„ï¼ˆæ¨¡æ‹Ÿå™¨æˆ–æå°‘æ•°çœŸæœºï¼‰ FIrdaåŸºç¡€çŸ¥è¯† åŸºç¡€å‘½ä»¤ 1.frida-ps -U æŸ¥çœ‹å½“å‰æ‰‹æœºè¿è¡Œçš„è¿›ç¨‹ 2.frida-ps --help æŸ¥çœ‹helpæŒ‡ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 frida-ps --help ä½¿ç”¨æ–¹å¼: frida-ps [é€‰é¡¹] é€‰é¡¹: -h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º -D ID, --device ID è¿æ¥åˆ°å…·æœ‰ç»™å®šIDçš„è®¾å¤‡ -U, --usb è¿æ¥åˆ°USBè®¾å¤‡ -R, --remote è¿æ¥åˆ°è¿œç¨‹frida-server -H HOST, --host HOST è¿æ¥åˆ°HOSTä¸Šçš„è¿œç¨‹frida-server --certificate CERTIFICATE ä¸HOSTè¿›è¡ŒTLSé€šä¿¡ï¼ŒæœŸæœ›çš„CERTIFICATE --origin ORIGIN è¿æ¥åˆ°è®¾ç½®äº†\u0026#34;Origin\u0026#34;å¤´ä¸ºORIGINçš„è¿œç¨‹æœåŠ¡å™¨ --token TOKEN ä½¿ç”¨TOKENéªŒè¯HOST --keepalive-interval INTERVAL è®¾ç½®å¿ƒè·³åŒ…é—´éš”(ç§’)ï¼Œæˆ–è®¾ç½®ä¸º0ä»¥ç¦ç”¨(é»˜è®¤ä¸º-1ï¼Œæ ¹æ®ä¼ è¾“æ–¹å¼è‡ªåŠ¨é€‰æ‹©) --p2p ä¸ç›®æ ‡å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥ --stun-server ADDRESS è®¾ç½®ä¸--p2pä¸€èµ·ä½¿ç”¨çš„STUNæœåŠ¡å™¨åœ°å€ --relay address,username,password,turn-{udp,tcp,tls} æ·»åŠ ä¸--p2pä¸€èµ·ä½¿ç”¨çš„ä¸­ç»§ -O FILE, --options-file FILE åŒ…å«é¢å¤–å‘½ä»¤è¡Œé€‰é¡¹çš„æ–‡æœ¬æ–‡ä»¶ --version æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·å¹¶é€€å‡º -a, --applications åªåˆ—å‡ºåº”ç”¨ç¨‹åº -i, --installed åŒ…æ‹¬æ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨ç¨‹åº -j, --json ä»¥JSONæ ¼å¼è¾“å‡ºç»“æœ 3.æ“ä½œæ¨¡å¼ CLIæ¨¡å¼ï¼šé€šè¿‡å‘½ä»¤è¡Œç›´æ¥å°†JavaScriptè„šæœ¬æ³¨å…¥è¿›ç¨‹ä¸­ã€‚ RPCæ¨¡å¼ï¼šä½¿ç”¨Pythonè¿›è¡ŒJavaScriptè„šæœ¬çš„æ³¨å…¥ï¼Œé€‚åˆå¤æ‚æ•°æ®å¤„ç†ã€‚\n4.æ³¨å…¥æ¨¡å¼ä¸å¯åŠ¨å‘½ä»¤\nSpawnæ¨¡å¼ å°†å¯åŠ¨Appçš„æƒåˆ©äº¤ç”±Fridaæ¥æ§åˆ¶ï¼Œå³ä½¿ç›®æ ‡Appå·²ç»å¯åŠ¨ï¼Œåœ¨ä½¿ç”¨Fridaæ³¨å…¥ç¨‹åºæ—¶è¿˜æ˜¯ä¼šé‡æ–°å¯åŠ¨App\nå½“éœ€è¦ç›‘æ§Appä»å¯åŠ¨å¼€å§‹çš„æ‰€æœ‰è¡Œä¸ºæ—¶ä½¿ç”¨ frida -U -f è¿›ç¨‹å -l hook.js è¿›ç¨‹åå¯ä»¥é€šè¿‡frida-ps -Uæ¥æŸ¥çœ‹\nAttachæ¨¡å¼ åœ¨ç›®æ ‡Appå·²ç»å¯åŠ¨çš„æƒ…å†µä¸‹ï¼ŒFridaé€šè¿‡ptraceæ³¨å…¥ç¨‹åºä»è€Œæ‰§è¡ŒHookçš„æ“ä½œ\nfrida -U è¿›ç¨‹å -l hook.js åœ¨Appå·²ç»å¯åŠ¨ï¼Œæˆ–è€…æˆ‘ä»¬åªå…³å¿ƒç‰¹å®šæ—¶åˆ»æˆ–ç‰¹å®šåŠŸèƒ½çš„è¡Œä¸ºæ—¶ä½¿ç”¨\n5.frida_serverè‡ªå®šä¹‰ç«¯å£\n1 2 3 4 5 frida server é»˜è®¤ç«¯å£ï¼š27042 taimen:/ $ su taimen:/ # cd data/local/tmp/ taimen:/data/local/tmp # ./fs1280 -l 0.0.0.0:6666 6.åŸºç¡€è¯­æ³•\nAPIåç§° æè¿° Java.use(className) è·å–æŒ‡å®šçš„Javaç±»å¹¶ä½¿å…¶åœ¨JavaScriptä»£ç ä¸­å¯ç”¨ã€‚ Java.perform(callback) ç¡®ä¿å›è°ƒå‡½æ•°åœ¨Javaçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ Java.choose(className, callbacks) æšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰å®ä¾‹ã€‚ Java.cast(obj, cls) å°†ä¸€ä¸ªJavaå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªJavaç±»çš„å®ä¾‹ã€‚ Java.enumerateLoadedClasses(callbacks) æšä¸¾è¿›ç¨‹ä¸­å·²ç»åŠ è½½çš„æ‰€æœ‰Javaç±»ã€‚ Java.enumerateClassLoaders(callbacks) æšä¸¾è¿›ç¨‹ä¸­å­˜åœ¨çš„æ‰€æœ‰Javaç±»åŠ è½½å™¨ã€‚ Java.enumerateMethods(targetClassMethod) æšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚ 7.æ—¥å¿—è¾“å‡º\næ—¥å¿—æ–¹æ³• æè¿° åŒºåˆ« console.log() ä½¿ç”¨JavaScriptç›´æ¥è¿›è¡Œæ—¥å¿—æ‰“å° å¤šç”¨äºåœ¨CLIæ¨¡å¼ä¸­ï¼Œconsole.log()ç›´æ¥è¾“å‡ºåˆ°å‘½ä»¤è¡Œç•Œé¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®æ—¶æŸ¥çœ‹ã€‚åœ¨RPCæ¨¡å¼ä¸­ï¼Œconsole.log()åŒæ ·è¾“å‡ºåœ¨å‘½ä»¤è¡Œï¼Œä½†å¯èƒ½è¢«Pythonè„šæœ¬çš„è¾“å‡ºå†…å®¹æ©ç›–ã€‚ send() Fridaçš„ä¸“æœ‰æ–¹æ³•ï¼Œç”¨äºå‘é€æ•°æ®æˆ–æ—¥å¿—åˆ°å¤–éƒ¨Pythonè„šæœ¬ å¤šç”¨äºRPCæ¨¡å¼ä¸­ï¼Œå®ƒå…è®¸JavaScriptè„šæœ¬å‘é€æ•°æ®åˆ°Pythonè„šæœ¬ï¼ŒPythonè„šæœ¬å¯ä»¥è¿›ä¸€æ­¥å¤„ç†æˆ–è®°å½•è¿™äº›æ•°æ®ã€‚ 8.æ—¥å¿—æ•è· Dï¼šè¡¨ç¤ºçº§åˆ« \u0026ldquo;zj2595\u0026quot;è¿™ä¸ªæ˜¯æ ‡ç­¾\n9.Hookæ¡†æ¶æ¨¡æ¿\n1 2 3 4 5 6 7 8 9 10 11 // å®šä¹‰ä¸»å‡½æ•° function main() { // Fridaæä¾›çš„Javaç¯å¢ƒæ“ä½œAPIï¼Œç¡®ä¿åœ¨Javaè™šæ‹Ÿæœºä¸Šä¸‹æ–‡æ‰§è¡Œ Java.perform(function() { // è°ƒç”¨è‡ªå®šä¹‰çš„Hooké€»è¾‘å‡½æ•°ï¼ˆéœ€è¦è‡ªå·±å®ç°ï¼‰ hookTest1(); }); } // ç«‹å³æ‰§è¡Œmainå‡½æ•°ï¼ˆFridaè„šæœ¬å¸¸ç”¨çš„å¯åŠ¨æ–¹å¼ï¼‰ setImmediate(main); Java.perform(callback)Frida çš„æ ¸å¿ƒ API ä¹‹ä¸€ï¼Œç”¨äºåœ¨ç›®æ ‡è¿›ç¨‹çš„Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç ã€‚å› ä¸º Hook Java æ–¹æ³•éœ€è¦è®¿é—® JVM ç¯å¢ƒï¼ŒJava.performä¼šç¡®ä¿å›è°ƒå‡½æ•°ä¸­çš„ä»£ç åœ¨ JVM å°±ç»ªåæ‰§è¡Œï¼Œé¿å…å› ç¯å¢ƒæœªåˆå§‹åŒ–å¯¼è‡´çš„é”™è¯¯ã€‚\n**hookTest1()**è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼ˆéœ€è¦ä½ è‡ªå·±å®ç°å…·ä½“é€»è¾‘ï¼‰ï¼Œç”¨äºç¼–å†™å®é™…çš„ Hook æ“ä½œï¼Œä¾‹å¦‚ï¼š\næ‹¦æˆªæŸä¸ª Java æ–¹æ³•çš„è°ƒç”¨ ä¿®æ”¹æ–¹æ³•çš„å‚æ•°æˆ–è¿”å›å€¼ æ‰“å°æ–¹æ³•è°ƒç”¨æ ˆä¿¡æ¯ç­‰ **setImmediate(main)**ç”¨äºå¯åŠ¨æ•´ä¸ª Hook æµç¨‹ã€‚setImmediateæ˜¯ JavaScript çš„å¼‚æ­¥ APIï¼Œä¼šå°†mainå‡½æ•°æ”¾å…¥äº‹ä»¶å¾ªç¯ä¸­ç«‹å³æ‰§è¡Œï¼ˆç±»ä¼¼setTimeout(fn, 0)ï¼‰ã€‚åœ¨ Frida è„šæœ¬ä¸­ï¼Œè¿™æ˜¯å¯åŠ¨ Hook é€»è¾‘çš„æ ‡å‡†æ–¹å¼ï¼Œç¡®ä¿ä»£ç åœ¨è¿›ç¨‹åˆå§‹åŒ–å®Œæˆåè¿è¡Œã€‚\nFridaå¸¸ç”¨API 1. Hookæ™®é€šæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 //å®šä¹‰ä¸€ä¸ªåä¸ºhookTest1çš„å‡½æ•° function hookTest1(){ //è·å–ä¸€ä¸ªåä¸º\u0026#34;ç±»å\u0026#34;çš„Javaç±»ï¼Œå¹¶å°†å…¶å®ä¾‹èµ‹å€¼ç»™JavaScriptå˜é‡utils var utils = Java.use(\u0026#34;ç±»å\u0026#34;); //ä¿®æ”¹\u0026#34;ç±»å\u0026#34;çš„\u0026#34;method\u0026#34;æ–¹æ³•çš„å®ç°ã€‚è¿™ä¸ªæ–°çš„å®ç°ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆaå’Œbï¼‰ utils.method.implementation = function(a, b){ //å°†å‚æ•°aå’Œbçš„å€¼æ”¹ä¸º123å’Œ456ã€‚ a = 123; b = 456; //è°ƒç”¨ä¿®æ”¹è¿‡çš„\u0026#34;method\u0026#34;æ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼å­˜å‚¨åœ¨`retval`å˜é‡ä¸­ var retval = this.method(a, b); //åœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‚æ•°aï¼Œbçš„å€¼ä»¥åŠ\u0026#34;method\u0026#34;æ–¹æ³•çš„è¿”å›å€¼ console.log(a, b, retval); //è¿”å›\u0026#34;method\u0026#34;æ–¹æ³•çš„è¿”å›å€¼ return retval; } } æ­¤æ¡ˆä¾‹ä¸­ï¼Œç±»åä¿®æ”¹ä¸ºcom.zj.wuaipojie.Demo,å°†å‚æ•°å’Œæ–¹æ³•åéƒ½ä¿®æ”¹ã€‚\næœ€æ–°çš„jadxä¸­å·²ç»å¯ä»¥å°†æ–¹æ³•å¤åˆ¶æˆfridaç‰‡æ®µï¼Œå¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 var Demo = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); Demo[\u0026#34;a\u0026#34;].implementation = function (str) { console.log(`Demo.a is called: str=${str}`); let result = this[\u0026#34;a\u0026#34;](str); console.log(`Demo.a result=${result}`); return result; }; ä½¿ç”¨frida-ps -U æŸ¥çœ‹å½“å‰æ‰‹æœºè¿è¡Œçš„è¿›ç¨‹å¾—åˆ° 1821 wuaipojie\nç„¶åä½¿ç”¨frida -U è¿›ç¨‹å -l hook.jså¯åŠ¨å‘½ä»¤ï¼Œä¸‹å›¾æ˜¯å¦ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­logcat |grep \u0026quot;D.zj2595\u0026quot;è¿›è¡Œçš„æ—¥å¿—æ•è· å¯ä»¥çœ‹åˆ°ï¼Œç»ˆç«¯è¾“å‡ºäº†æ–¹æ³•ä¼ å…¥çš„å‚æ•°å’Œè¾“å‡ºçš„è¿”å›å€¼ åœ¨let result = this[\u0026quot;a\u0026quot;](str);è¿™æ¡è¯­å¥ä¸­å³å¯ä¿®æ”¹æ–¹æ³•çš„è¿”å›å€¼ï¼Œä½†éœ€æ³¨æ„åŸæ–¹æ³•è¿”å›å€¼çš„ç±»å‹ï¼Œè‹¥åŸæ–¹æ³•è¿”å›intï¼Œåº”è¯¥è¿”å›æ•°å­—22ï¼ˆè€Œä¸æ˜¯å­—ç¬¦ä¸²\u0026quot;22\u0026quot;ï¼‰\n2. Hooké‡è½½å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 // .overload() // .overload(\u0026#39;è‡ªå®šä¹‰å‚æ•°\u0026#39;) // .overload(\u0026#39;int\u0026#39;) function hookTest2(){ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //overloadå®šä¹‰é‡è½½å‡½æ•°ï¼Œæ ¹æ®å‡½æ•°çš„å‚æ•°ç±»å‹å¡« utils.Inner.overload(\u0026#39;com.zj.wuaipojie.Demo$Animal\u0026#39;,\u0026#39;java.lang.String\u0026#39;).implementation = function(aï¼Œb){ b = \u0026#34;aaaaaaaaaa\u0026#34;; this.Inner(a,b); console.log(b); } } å†çœ‹ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•°ç±»å‹çš„æ–¹æ³•æ¡ˆä¾‹\nå½“overload()ä¸­æ²¡æœ‰å¡«å…¥å‚æ•°ç±»å‹æˆ–è€…ä½ ä¸çŸ¥é“è¯¥å‚æ•°çš„ç±»å‹æ—¶å€™å¯ä»¥å°è¯•è¿è¡Œåœ¨æŠ¥é”™çš„æç¤ºä¸­å¯ä»¥æ‰¾åˆ°å‚æ•°ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä»Javaæ–‡ä»¶å®šä½åˆ°å¯¹åº”çš„smaliè¯­å¥ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ç›¸åº”çš„å‚æ•°ç±»å‹\næœ‰æ—¶å€™æ–‡ä»¶è¿è¡Œåï¼Œæ²¡æœ‰hookæˆåŠŸï¼Œå¯ä»¥å¤šå°è¯•å‡ æ¬¡\n3. Hookæ„é€ å‡½æ•° 1 2 3 4 5 6 7 8 9 function hookTest3(){ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //ä¿®æ”¹ç±»çš„æ„é€ å‡½æ•°çš„å®ç°ï¼Œ$initè¡¨ç¤ºæ„é€ å‡½æ•° utils.$init.overload(\u0026#39;java.lang.String\u0026#39;).implementation = function(str){ console.log(str); str = \u0026#34;52\u0026#34;; this.$init(str); } } 4. Hookå­—æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 function hookTest5(){ Java.perform(function(){ //é™æ€å­—æ®µçš„ä¿®æ”¹ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //ä¿®æ”¹ç±»çš„é™æ€å­—æ®µ\u0026#34;flag\u0026#34;çš„å€¼ utils.staticField.value = \u0026#34;æˆ‘æ˜¯è¢«ä¿®æ”¹çš„é™æ€å˜é‡\u0026#34;; console.log(utils.staticField.value); //éé™æ€å­—æ®µçš„ä¿®æ”¹ //ä½¿ç”¨`Java.choose()`æšä¸¾ç±»çš„æ‰€æœ‰å®ä¾‹ Java.choose(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, { onMatch: function(obj){ //ä¿®æ”¹å®ä¾‹çš„éé™æ€å­—æ®µ\u0026#34;_privateInt\u0026#34;çš„å€¼ä¸º\u0026#34;123456\u0026#34;ï¼Œå¹¶ä¿®æ”¹éé™æ€å­—æ®µ\u0026#34;privateInt\u0026#34;çš„å€¼ä¸º9999ã€‚ obj._privateInt.value = \u0026#34;123456\u0026#34;; //å­—æ®µåä¸å‡½æ•°åç›¸åŒ å‰é¢åŠ ä¸ªä¸‹åˆ’çº¿ obj.privateInt.value = 9999; }, onComplete: function(){ } }); }); } åœ¨ç¬¬ä¸€æ¬¡çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°obj.privateInt.value = 9999;å¹¶æ²¡æœ‰æˆåŠŸï¼Œå¯èƒ½çš„åŸå› æ˜¯\nprivate ä¿®é¥°ï¼šJava ä¸­ private å­—æ®µåªèƒ½åœ¨å½“å‰ç±»å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨ï¼ˆåŒ…æ‹¬ Frida ç›´æ¥è®¿é—®ï¼‰é»˜è®¤æ²¡æœ‰æƒé™ä¿®æ”¹ï¼› final ä¿®é¥°ï¼šfinal å­—æ®µåˆå§‹åŒ–åä¸å…è®¸é‡æ–°èµ‹å€¼ï¼ˆå³ä½¿æ˜¯ç±»å†…éƒ¨ä¹Ÿä¸è¡Œï¼‰ï¼ŒJava çš„è¯­æ³•è§„åˆ™ä¼šé˜»æ­¢ä¿®æ”¹ã€‚ ç¿»è®ºå›è¯„è®ºçš„æ—¶å€™å‘ç°äº†è¿™ä¸ªå¸–å­ å°è¯•äº†ä¸€ä¸‹ï¼Œç¡®å®å¯ä»¥ï¼ŒçœŸçš„è¦å’Œåˆ«äººå¤šäº¤æµå­¦ä¹ å•Šï¼ˆæ„Ÿæ…¨ï¼‰ é™„ä¸Šä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 function hookTest5(){ Java.perform(function(){ //éé™æ€å­—æ®µçš„ä¿®æ”¹ //ä½¿ç”¨`Java.choose()`æšä¸¾ç±»çš„æ‰€æœ‰å®ä¾‹ Java.choose(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, { onMatch: function(obj){ //ä¿®æ”¹å®ä¾‹çš„éé™æ€å­—æ®µ\u0026#34;_privateInt\u0026#34;çš„å€¼ä¸º\u0026#34;123456\u0026#34;ï¼Œå¹¶ä¿®æ”¹éé™æ€å­—æ®µ\u0026#34;privateInt\u0026#34;çš„å€¼ä¸º9999ã€‚ // obj._privateInt.value = \u0026#34;123456\u0026#34;; //å­—æ®µåä¸å‡½æ•°åç›¸åŒæ—¶ å‰é¢åŠ ä¸ªä¸‹åˆ’çº¿ console.log(\u0026#34;here!\u0026#34;) obj.publicInt.value = 8888; obj.privateInt.value = 9999; //ç”±äºæ ·æœ¬ä»£ç çš„åŸå› ï¼Œéœ€è¦å†ä¸»åŠ¨è°ƒç”¨ä¸€ä¸‹Demoç±»æ—¥å¿—è¾“å‡ºå‡½æ•°test()ï¼Œæ‰èƒ½åœ¨adbçš„logç•Œé¢çœ‹åˆ°è¾“å‡ºæ”¹å˜ obj.test(); console.log(obj.privateInt.value ) }, onComplete: function(){ } }); }); } 5.Hookå†…éƒ¨ç±» 1 2 3 4 5 6 7 8 9 10 11 function hookTest5(){ Java.perform(function(){ //å†…éƒ¨ç±» var innerClass = Java.use(\u0026#34;com.zj.wuaipojie.Demo$innerClass\u0026#34;); console.log(innerClass); innerClass.$init.implementation = function(){ console.log(\u0026#34;eeeeeeee\u0026#34;); } }); } 6. æšä¸¾æ‰€æœ‰ç±»ä¸æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function hookTest6(){ Java.perform(function(){ //æšä¸¾æ‰€æœ‰çš„ç±»ä¸ç±»çš„æ‰€æœ‰æ–¹æ³•,å¼‚æ­¥æšä¸¾ Java.enumerateLoadedClasses({ onMatch: function(name,handle){ //è¿‡æ»¤ç±»å if(name.indexOf(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;) !=-1){ console.log(name); var clazz =Java.use(name); console.log(clazz); var methods = clazz.class.getDeclaredMethods(); console.log(methods); } }, onComplete: function(){} }) }) } 7.æšä¸¾æ‰€æœ‰æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function hookTest7(){ Java.perform(function(){ var Demo = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //getDeclaredMethodsæšä¸¾æ‰€æœ‰æ–¹æ³• var methods =Demo.class.getDeclaredMethods(); for(var j=0; j \u0026lt; methods.length; j++){ var methodName = methods[j].getName(); console.log(methodName); for(var k=0; k\u0026lt;Demo[methodName].overloads.length;k++){ Demo[methodName].overloads[k].implementation = function(){ for(var i=0;i\u0026lt;arguments.length;i++){ console.log(arguments[i]); } return this[methodName].apply(this,arguments); } } } }) } 8.ä¸»åŠ¨è°ƒç”¨ é™æ€æ–¹æ³• 1 2 var ClassName=Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); ClassName.privateFunc(\u0026#34;ä¼ å‚\u0026#34;); ä¸‹å›¾å°±èƒ½æ˜¾ç¤ºå‡ºä¿®æ”¹åçš„åŠ å¯†ç»“æœ\néé™æ€æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 var ret = null; Java.perform(function () { Java.choose(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;,{ //è¦hookçš„ç±» onMatch:function(instance){ ret=instance.privateFunc(\u0026#34;aaaaaaa\u0026#34;); //è¦hookçš„æ–¹æ³• }, onComplete:function(){ //console.log(\u0026#34;result: \u0026#34; + ret); } }); }) //return ret; 0x01 objection ä»€ä¹ˆæ˜¯objection objectionæ˜¯åŸºäºfridaçš„å‘½ä»¤è¡Œhooké›†åˆå·¥å…·, å¯ä»¥è®©ä½ ä¸å†™ä»£ç , æ•²å‡ å¥å‘½ä»¤å°±å¯ä»¥å¯¹javaå‡½æ•°çš„é«˜é¢—ç²’åº¦hook, è¿˜æ”¯æŒRPCè°ƒç”¨ã€‚å¯ä»¥å®ç°è¯¸å¦‚å†…å­˜æœç´¢ã€ç±»å’Œæ¨¡å—æœç´¢ã€æ–¹æ³•hookæ‰“å°å‚æ•°è¿”å›å€¼è°ƒç”¨æ ˆç­‰å¸¸ç”¨åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„ï¼Œé€†å‘å¿…å¤‡ã€å†…å­˜æ¼«æ¸¸ç¥å™¨ã€‚ é¡¹ç›®åœ°å€\nç”±äºobjectionåœ¨2021å°±å·²ç»åœæ­¢æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è¾ƒä½ç‰ˆæœ¬çš„fridaå’Œfrida_toolsï¼Œå»ºè®®é‡æ–°è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå› ä¸ºä¹‹å‰è™šæ‹Ÿç¯å¢ƒç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œä¸å¤ªæ”¯æŒobjectionï¼Œé…ç½®ä¸€ä¸ªæ–°çš„ç¯å¢ƒä¹Ÿæ–¹ä¾¿ç®¡ç† æˆ‘è¿™é‡Œé…ç½®çš„æ˜¯\n1 2 3 4 5 objection 1.11.0 frida 16.2.1 frida-tools 13.2.0 ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºå°±æ˜¯æˆåŠŸäº† objection å‘½ä»¤æ³¨é‡Š 1.helpå‘½ä»¤æ³¨é‡Š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 objection --help(helpå‘½ä»¤) Checking for a newer version of objection... Usage: objection [OPTIONS] COMMAND [ARGS]... _ _ _ _ ___| |_|_|___ ___| |_|_|___ ___ | . | . | | -_| _| _| | . | | |___|___| |___|___|_| |_|___|_|_| |___|(object)inject(ion) Runtime Mobile Exploration by: @leonjza from @sensepost é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šä¿¡å°†é€šè¿‡USBè¿›è¡Œï¼Œé™¤éæä¾›äº†`--network`é€‰é¡¹ã€‚ é€‰é¡¹: -N, --network ä½¿ç”¨ç½‘ç»œè¿æ¥è€Œä¸æ˜¯USBè¿æ¥ã€‚ -h, --host TEXT [é»˜è®¤: 127.0.0.1] -p, --port INTEGER [é»˜è®¤: 27042] -ah, --api-host TEXT [é»˜è®¤: 127.0.0.1] -ap, --api-port INTEGER [é»˜è®¤: 8888] -g, --gadget TEXT è¦è¿æ¥çš„Frida Gadget/è¿›ç¨‹çš„åç§°ã€‚ [é»˜è®¤: Gadget] -S, --serial TEXT è¦è¿æ¥çš„è®¾å¤‡åºåˆ—å·ã€‚ -d, --debug å¯ç”¨å¸¦æœ‰è¯¦ç»†è¾“å‡ºçš„è°ƒè¯•æ¨¡å¼ã€‚(åœ¨å †æ ˆè·Ÿè¸ªä¸­åŒ…æ‹¬ä»£{è¿‡}{æ»¤}ç†æºå›¾) --help æ˜¾ç¤ºæ­¤æ¶ˆæ¯å¹¶é€€å‡ºã€‚ å‘½ä»¤: api ä»¥æ— å¤´æ¨¡å¼å¯åŠ¨objection APIæœåŠ¡å™¨ã€‚ device-type è·å–å…³äºå·²è¿æ¥è®¾å¤‡çš„ä¿¡æ¯ã€‚ explore å¯åŠ¨objectionæ¢ç´¢REPLã€‚ patchapk ä½¿ç”¨frida-gadget.soè¡¥ä¸ä¸€ä¸ªAPKã€‚ patchipa ä½¿ç”¨FridaGadget dylibè¡¥ä¸ä¸€ä¸ªIPAã€‚ run è¿è¡Œå•ä¸ªobjectionå‘½ä»¤ã€‚ signapk ä½¿ç”¨objectionå¯†é’¥å¯¹APKè¿›è¡ŒZipalignå’Œç­¾åã€‚ version æ‰“å°å½“å‰ç‰ˆæœ¬å¹¶é€€å‡ºã€‚ 2.æ³¨å…¥å‘½ä»¤ 1 2 3 4 5 6 objection -g åŒ…å explore - helpï¼šä¸çŸ¥é“å½“å‰å‘½ä»¤çš„æ•ˆæœæ˜¯ä»€ä¹ˆï¼Œåœ¨å½“å‰å‘½ä»¤å‰åŠ helpæ¯”å¦‚:help envï¼Œå›è½¦ä¹‹åä¼šå‡ºç°å½“å‰å‘½ä»¤çš„è§£é‡Šä¿¡æ¯ - æŒ‰ç©ºæ ¼ï¼šä¸çŸ¥é“è¾“å…¥ä»€ä¹ˆå°±æŒ‰ç©ºæ ¼ï¼Œä¼šæœ‰æç¤ºå‡ºæ¥ - jobsï¼šå¯ä»¥è¿›è¡Œå¤šé¡¹hook - æ—¥å¿—ï¼šobjectionçš„æ—¥å¿—æ–‡ä»¶ç”Ÿæˆåœ¨ C:\\Users\\Administrator\\.objection å¯åŠ¨å‰å°±hook\n1 objection -g è¿›ç¨‹å explore --startup-command \u0026#34;android hooking watch class è·¯å¾„.ç±»å\u0026#34; 3.objectionåŸºç¡€api\nmemory list modules -æŸ¥çœ‹å†…å­˜ä¸­åŠ è½½çš„åº“ 1 2 3 4 5 6 7 8 9 10 11 12 memory list modules Save the output by adding `--json modules.json` to this command Name Base Size Path ---------------------------------------------------------------- ------------ ------------------- ------------------------------------------------------------------------------ app_process64 0x57867c9000 40960 (40.0 KiB) /system/bin/app_process64 linker64 0x72e326a000 229376 (224.0 KiB) /system/bin/linker64 libandroid_runtime.so 0x72e164e000 2113536 (2.0 MiB) /system/lib64/libandroid_runtime.so libbase.so 0x72dfa67000 81920 (80.0 KiB) /system/lib64/libbase.so libbinder.so 0x72dec1c000 643072 (628.0 KiB) /system/lib64/libbinder.so libcutils.so 0x72de269000 86016 (84.0 KiB) /system/lib64/libcutils.so libhidlbase.so 0x72df4cc000 692224 (676.0 KiB) /system/lib64/libhidlbase.so liblog.so 0x72e0be1000 98304 (96.0 KiB) /system/lib64/liblog memory list exports soåç§° - æŸ¥çœ‹åº“çš„å¯¼å‡ºå‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 memory list exports liblog.so Save the output by adding `--json exports.json` to this command Type Name Address -------- ------------------------------------ ------------ function android_log_write_int32 0x72e0be77c8 function android_log_write_list_begin 0x72e0be76f0 function __android_log_bswrite 0x72e0be9bd8 function __android_log_security 0x72e0bf2144 function __android_log_bwrite 0x72e0be9a18 function android_log_reset 0x72e0be75ec function android_log_write_string8 0x72e0be7a38 function android_logger_list_free 0x72e0be8c04 function __android_log_print 0x72e0be9728 function __android_logger_property_get_bool 0x72e0bf2248 function android_logger_get_id 0x72e0be8270 function android_logger_set_prune_list 0x72e0be8948 android hooking list activities -æŸ¥çœ‹å†…å­˜ä¸­åŠ è½½çš„activity /android hooking list services -æŸ¥çœ‹å†…å­˜ä¸­åŠ è½½çš„services android intent launch_activity ç±»å -å¯åŠ¨activityæˆ–service(å¯ä»¥ç”¨äºä¸€äº›æ²¡æœ‰éªŒè¯çš„activity,åœ¨ä¸€äº›ç®€å•çš„ctfä¸­æœ‰æ—¶å€™å¯ä»¥å‡ºå¥‡æ•ˆ) å…³é—­sslæ ¡éªŒ android sslpinning disable å…³é—­rootæ£€æµ‹ android root disable 4.objectionå†…å­˜æ¼«æ¸¸\nå†…å­˜æœåˆ®ç±»å®ä¾‹ 1 2 3 4 5 android heap search instances ç±»å(å‘½ä»¤) Class instance enumeration complete for com.zj.wuaipojie.Demo Hashcode Class toString() --------- --------------------- ----------------------------- 215120583 com.zj.wuaipojie.Demo com.zj.wuaipojie.Demo@cd27ac7 è°ƒç”¨å®ä¾‹çš„æ–¹æ³• 1 2 3 4 5 android heap execute \u0026lt;handle\u0026gt; getPublicInt(å®ä¾‹çš„hashcode+æ–¹æ³•å) å¦‚æœæ˜¯å¸¦å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™éœ€è¦è¿›å…¥ç¼–è¾‘å™¨ç¯å¢ƒ android heap evaluate \u0026lt;handle\u0026gt; console.log(clazz.a(\u0026#34;å¾çˆ±ç ´è§£\u0026#34;)); æŒ‰ä½esc+enterè§¦å‘ android hooking list classes -åˆ—å‡ºå†…å­˜ä¸­æ‰€æœ‰çš„ç±»(ç»“æœæ¯”é™æ€åˆ†æçš„æ›´å‡†ç¡®) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 android hooking list classes tw.idv.palatis.xappdebug.MainApplication tw.idv.palatis.xappdebug.xposed.HookMain tw.idv.palatis.xappdebug.xposed.HookMain$a tw.idv.palatis.xappdebug.xposed.HookMain$b tw.idv.palatis.xappdebug.xposed.HookMain$c tw.idv.palatis.xappdebug.xposed.HookMain$d tw.idv.palatis.xappdebug.xposed.HookSelf u v void w xposed.dummy.XResourcesSuperClass xposed.dummy.XTypedArraySuperClass Found 10798 classes android hooking search classes å…³é”®ç±»å -åœ¨å†…å­˜ä¸­æ‰€æœ‰å·²åŠ è½½çš„ç±»ä¸­æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„ç±» 1 2 3 4 5 6 7 8 9 10 11 12 android hooking search classes wuaipojie Note that Java classes are only loaded when they are used, so if the expected class has not been found, it might not have been loaded yet. com.zj.wuaipojie.Demo com.zj.wuaipojie.Demo$Animal com.zj.wuaipojie.Demo$Companion com.zj.wuaipojie.Demo$InnerClass com.zj.wuaipojie.Demo$test$1 com.zj.wuaipojie.MainApplication com.zj.wuaipojie.databinding.ActivityMainBinding ... Found 38 classes android hooking search methods å…³é”®æ–¹æ³•å -åœ¨å†…å­˜ä¸­æ‰€æœ‰å·²åŠ è½½çš„ç±»çš„æ–¹æ³•ä¸­æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„æ–¹æ³•(ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ï¼Œç‰¹åˆ«è€—æ—¶ï¼Œè¿˜å¯èƒ½å´©æºƒ) android hooking list class_methods ç±»å -å†…å­˜æ¼«æ¸¸ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 android hooking list class_methods com.zj.wuaipojie.ui.ChallengeSixth private static final void com.zj.wuaipojie.ui.ChallengeSixth.onCreate$lambda-0(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) private static final void com.zj.wuaipojie.ui.ChallengeSixth.onCreate$lambda-1(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) private static final void com.zj.wuaipojie.ui.ChallengeSixth.onCreate$lambda-2(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) private static final void com.zj.wuaipojie.ui.ChallengeSixth.onCreate$lambda-3(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) protected void com.zj.wuaipojie.ui.ChallengeSixth.onCreate(android.os.Bundle) public final java.lang.String com.zj.wuaipojie.ui.ChallengeSixth.hexToString(java.lang.String) public final java.lang.String com.zj.wuaipojie.ui.ChallengeSixth.unicodeToString(java.lang.String) public final void com.zj.wuaipojie.ui.ChallengeSixth.toastPrint(java.lang.String) public static void com.zj.wuaipojie.ui.ChallengeSixth.$r8$lambda$1lrkrgiCEFWXZDHzLRibYURG1h8(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) public static void com.zj.wuaipojie.ui.ChallengeSixth.$r8$lambda$IUqwMqbTKaOGiTaeOmvy_GjNBso(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) public static void com.zj.wuaipojie.ui.ChallengeSixth.$r8$lambda$Kc_cRYZjjhjsTl6GYNHbgD-i6sE(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) public static void com.zj.wuaipojie.ui.ChallengeSixth.$r8$lambda$PDKm2AfziZQo6Lv1HEFkJWkUsoE(com.zj.wuaipojie.ui.ChallengeSixth,android.view.View) Found 12 method(s) 5.objectionHook\nhookç±»çš„æ‰€æœ‰æ–¹æ³•\n1 android hooking watch class ç±»å hookæ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼å’Œè°ƒç”¨æ ˆ\n1 android hooking watch class_method ç±»å.æ–¹æ³•å --dump-args --dump-return --dump-backtrace hook ç±»çš„æ„é€ æ–¹æ³•\n1 android hooking watch class_method ç±»å.$init hook æ–¹æ³•çš„æ‰€æœ‰é‡è½½\n1 android hooking watch class_method ç±»å.æ–¹æ³•å å‚è€ƒï¼š\nå®ç”¨FRIDAè¿›é˜¶ï¼šå†…å­˜æ¼«æ¸¸ã€hook anywhereã€æŠ“åŒ…\nä½¿ç”¨objectionå¯¹å¾çˆ±ç ´è§£2023æ˜¥èŠ‚å®‰å“åˆçº§é¢˜è¿›è¡Œå¿«é€Ÿè§£é¢˜\ntraceå®æˆ˜javaæ§åˆ¶æµæ··æ·† ç”¨åˆ°çš„å®æˆ˜é¢˜ç›®ï¼šå¾çˆ±ç ´è§£2023æ˜¥èŠ‚çº¢åŒ…é¢˜\nç”¨åˆ°çš„æ··æ·†é¡¹ç›®ï¼šDEXæ§åˆ¶æµæ··æ·† Â· BlackObfuscator\né¡¹ç›®æ•ˆæœå±•ç¤ºï¼š\næ··æ·†å‰ æ··æ·†å å¯¹æŠ—æ–¹æ³•ï¼š\nZenTracer\næ³¨æ„:æ— æ³•æ‰“å°è°ƒç”¨æ ˆï¼Œæ— æ³•hookæ„é€ å‡½æ•°ï¼Œé«˜ç‰ˆæœ¬Fridaä¸ä¸€å®šå…¼å®¹ï¼Œéœ€è¦pyqt5çš„åº“\nr0tracer\nAKAï¼šç²¾ç®€ç‰ˆ objection + Wallbreaker\n0x02 Processã€Moduleã€MemoryåŸºç¡€ 1.Process Process å¯¹è±¡ä»£è¡¨å½“å‰è¢«Hookçš„è¿›ç¨‹ï¼Œèƒ½è·å–è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæšä¸¾æ¨¡å—ï¼Œæšä¸¾èŒƒå›´ç­‰\nAPI å«ä¹‰ Process.id è¿”å›é™„åŠ ç›®æ ‡è¿›ç¨‹çš„ PID Process.isDebuggerAttached() æ£€æµ‹å½“å‰æ˜¯å¦å¯¹ç›®æ ‡ç¨‹åºå·²ç»é™„åŠ  Process.enumerateModules() æšä¸¾å½“å‰åŠ è½½çš„æ¨¡å—ï¼Œè¿”å›æ¨¡å—å¯¹è±¡çš„æ•°ç»„ Process.enumerateThreads() æšä¸¾å½“å‰æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè¿”å›åŒ…å« id, state, context ç­‰å±æ€§çš„å¯¹è±¡æ•°ç»„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 function processInfo() { Java.perform(function() { console.log(\u0026#34;PID:\u0026#34;, Process.id); console.log(\u0026#34;æ¶æ„:\u0026#34;, Process.arch); console.log(\u0026#34;å¹³å°:\u0026#34;, Process.platform); console.log(\u0026#34;è°ƒè¯•å™¨é™„åŠ :\u0026#34;, Process.isDebuggerAttached()); // æšä¸¾æ¨¡å— var modules = Process.enumerateModules(); modules.forEach(function(module) { console.log(\u0026#34;æ¨¡å—:\u0026#34;, module.name, \u0026#34;åŸºå€:\u0026#34;, module.base, \u0026#34;å¤§å°:\u0026#34;, module.size); }); // æšä¸¾çº¿ç¨‹ var threads = Process.enumerateThreads(); threads.forEach(function(thread) { console.log(\u0026#34;çº¿ç¨‹ID:\u0026#34;, thread.id, \u0026#34;çŠ¶æ€:\u0026#34;, thread.state); }); }); } 2.Module Module å¯¹è±¡ä»£è¡¨ä¸€ä¸ªåŠ è½½åˆ°è¿›ç¨‹çš„æ¨¡å—(ä¾‹å¦‚ï¼Œåœ¨ Windows ä¸Šçš„ DLLï¼Œæˆ–åœ¨ Linux/Android ä¸Šçš„ .so æ–‡ä»¶),èƒ½æŸ¥è¯¢æ¨¡å—çš„ä¿¡æ¯ï¼Œå¦‚æ¨¡å—çš„åŸºå€ã€åç§°ã€å¯¼å…¥/å¯¼å‡ºçš„å‡½æ•°ç­‰\nAPI å«ä¹‰ Module.load() åŠ è½½æŒ‡å®šsoæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªModuleå¯¹è±¡ enumerateImports() æšä¸¾æ‰€æœ‰Importåº“å‡½æ•°ï¼Œè¿”å›Moduleæ•°ç»„å¯¹è±¡ enumerateExports() æšä¸¾æ‰€æœ‰Exportåº“å‡½æ•°ï¼Œè¿”å›Moduleæ•°ç»„å¯¹è±¡ enumerateSymbols() æšä¸¾æ‰€æœ‰Symbolåº“å‡½æ•°ï¼Œè¿”å›Moduleæ•°ç»„å¯¹è±¡ Module.findExportByName(exportName)ã€Module.getExportByName(exportName) å¯»æ‰¾æŒ‡å®šsoä¸­exportåº“ä¸­çš„å‡½æ•°åœ°å€ Module.findBaseAddress(name)ã€Module.getBaseAddress(name) è¿”å›soçš„åŸºåœ°å€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 function moduleInfo() { Java.perform(function() { // è·å–æ¨¡å—åŸºå€çš„å¤šç§æ–¹å¼ var base1 = Module.findBaseAddress(\u0026#34;libtarget.so\u0026#34;); var base2 = Process.getModuleByName(\u0026#34;libtarget.so\u0026#34;).base; console.log(\u0026#34;æ¨¡å—åŸºå€:\u0026#34;, base1, base2); // æŸ¥æ‰¾å¯¼å‡ºå‡½æ•° var exportAddr = Module.findExportByName(\u0026#34;libtarget.so\u0026#34;, \u0026#34;target_function\u0026#34;); console.log(\u0026#34;å¯¼å‡ºå‡½æ•°åœ°å€:\u0026#34;, exportAddr); // æšä¸¾å¯¼å…¥è¡¨ var imports = Module.enumerateImports(\u0026#34;libtarget.so\u0026#34;); imports.forEach(function(imp) { console.log(\u0026#34;å¯¼å…¥:\u0026#34;, JSON.stringify(imp)); }); // æšä¸¾å¯¼å‡ºè¡¨ var exports = Module.enumerateExports(\u0026#34;libtarget.so\u0026#34;); exports.forEach(function(exp) { console.log(\u0026#34;å¯¼å‡º:\u0026#34;, JSON.stringify(exp)); }); }); } 3.Memory Memoryæ˜¯ä¸€ä¸ªå·¥å…·å¯¹è±¡ï¼Œæä¾›ç›´æ¥è¯»å–å’Œä¿®æ”¹è¿›ç¨‹å†…å­˜çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿè¯»å–ç‰¹å®šåœ°å€çš„å€¼ã€å†™å…¥æ•°æ®ã€åˆ†é…å†…å­˜ç­‰\næ–¹æ³• åŠŸèƒ½ Memory.copy() å¤åˆ¶å†…å­˜ Memory.scan() æœç´¢å†…å­˜ä¸­ç‰¹å®šæ¨¡å¼çš„æ•°æ® Memory.scanSync() åŒä¸Šï¼Œä½†è¿”å›å¤šä¸ªåŒ¹é…çš„æ•°æ® Memory.alloc() åœ¨ç›®æ ‡è¿›ç¨‹çš„å †ä¸Šç”³è¯·æŒ‡å®šå¤§å°çš„å†…å­˜ï¼Œè¿”å›ä¸€ä¸ªNativePointer Memory.writeByteArray() å°†å­—èŠ‚æ•°ç»„å†™å…¥ä¸€ä¸ªæŒ‡å®šå†…å­˜ Memory.readByteArray è¯»å–å†…å­˜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 function memoryOperations() { Java.perform(function() { try { // åˆ†é…å†…å­˜ var allocated = Memory.alloc(1024); console.log(\u0026#34;åˆ†é…å†…å­˜:\u0026#34;, allocated); // å†™å…¥å­—ç¬¦ä¸² var testStr = \u0026#34;Hello Frida\u0026#34;; Memory.writeUtf8String(allocated, testStr); // è¯»å–å­—ç¬¦ä¸² var readStr = Memory.readCString(allocated); console.log(\u0026#34;è¯»å–å­—ç¬¦ä¸²:\u0026#34;, readStr); // å†…å­˜æ‰«æ var pattern = \u0026#34;48 89 5C 24 ?? 48 89 6C 24\u0026#34;; Memory.scan(Module.findBaseAddress(\u0026#34;libtarget.so\u0026#34;), Process.getModuleByName(\u0026#34;libtarget.so\u0026#34;).size, pattern, { onMatch: function(address, size) { console.log(\u0026#34;æ‰¾åˆ°æ¨¡å¼åœ¨:\u0026#34;, address, \u0026#34;å¤§å°:\u0026#34;, size); }, onError: function(reason) { console.log(\u0026#34;æ‰«æé”™è¯¯:\u0026#34;, reason); }, onComplete: function() { console.log(\u0026#34;æ‰«æå®Œæˆ\u0026#34;); } }); } catch(e) { console.log(\u0026#34;å†…å­˜æ“ä½œé”™è¯¯:\u0026#34;, e); } }); } 0x03 æšä¸¾å¯¼å…¥å¯¼å‡ºè¡¨ å¯¼å‡ºè¡¨ï¼ˆExport Tableï¼‰ï¼šåˆ—å‡ºäº†åº“ä¸­å¯ä»¥è¢«å…¶ä»–ç¨‹åºæˆ–åº“è®¿é—®çš„æ‰€æœ‰å…¬å¼€å‡½æ•°å’Œç¬¦å·çš„åç§°ã€‚ å¯¼å…¥è¡¨ï¼ˆImport Tableï¼‰ï¼šåˆ—å‡ºäº†åº“éœ€è¦ä»å…¶ä»–åº“ä¸­è°ƒç”¨çš„å‡½æ•°å’Œç¬¦å·çš„åç§°ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå¯¼å‡ºè¡¨å‘Šè¯‰å…¶ä»–ç¨‹åºï¼šâ€œè¿™äº›æ˜¯æˆ‘æä¾›çš„åŠŸèƒ½ã€‚â€ï¼Œè€Œå¯¼å…¥è¡¨åˆ™è¡¨ç¤ºï¼šâ€œè¿™äº›æ˜¯æˆ‘éœ€è¦çš„åŠŸèƒ½ã€‚â€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function hookTest1(){ Java.perform(function(){ //æ‰“å°å¯¼å…¥è¡¨ var imports = Module.enumerateImports(\u0026#34;lib52pojie.so\u0026#34;); for(var i =0; i \u0026lt; imports.length;i++){ if(imports[i].name == \u0026#34;vip\u0026#34;){ console.log(JSON.stringify(imports[i])); //é€šè¿‡JSON.stringifyæ‰“å°objectæ•°æ® console.log(imports[i].address); } } //æ‰“å°å¯¼å‡ºè¡¨ var exports = Module.enumerateExports(\u0026#34;lib52pojie.so\u0026#34;); for(var i =0; i \u0026lt; exports.length;i++){ console.log(JSON.stringify(exports[i])); } }) } 0x04 Nativeå‡½æ•°çš„åŸºç¡€Hookæ‰“å° 1.æ•´æ•°å‹ã€å¸ƒå°”å€¼ç±»å‹ã€charç±»å‹Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 function hookTest2(){ Java.perform(function(){ //æ ¹æ®å¯¼å‡ºå‡½æ•°åæ‰“å°åœ°å€ var helloAddr = Module.findExportByName(\u0026#34;lib52pojie.so\u0026#34;,\u0026#34;Java_com_zj_wuaipojie_util_SecurityUtil_checkVip\u0026#34;); console.log(helloAddr); if(helloAddr != null){ //Interceptor.attachæ˜¯Fridaé‡Œçš„ä¸€ä¸ªæ‹¦æˆªå™¨ Interceptor.attach(helloAddr,{ //onEnteré‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹å‚æ•° onEnter: function(args){ //argsä¼ å…¥å‚æ•° console.log(args[0]); //æ‰“å°ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ console.log(this.context.x1); // æ‰“å°å¯„å­˜å™¨å†…å®¹ console.log(args[1].toInt32()); //toInt32()è½¬åè¿›åˆ¶ console.log(args[2].readCString()); //è¯»å–å­—ç¬¦ä¸² charç±»å‹ console.log(hexdump(args[2])); //å†…å­˜dump }, //onLeaveé‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹è¿”å›å€¼ onLeave: function(retval){ //retvalè¿”å›å€¼ console.log(retval); console.log(\u0026#34;retval\u0026#34;,retval.toInt32()); } }) } }) } 2.å­—ç¬¦ä¸²ç±»å‹Hook 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 function hookTest2(){ Java.perform(function(){ //æ ¹æ®å¯¼å‡ºå‡½æ•°åæ‰“å°åœ°å€ var helloAddr = Module.findExportByName(\u0026#34;lib52pojie.so\u0026#34;,\u0026#34;Java_com_zj_wuaipojie_util_SecurityUtil_vipLevel\u0026#34;); if(helloAddr != null){ Interceptor.attach(helloAddr,{ //onEnteré‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹å‚æ•° onEnter: function(args){ //argsä¼ å…¥å‚æ•° // æ–¹æ³•ä¸€ var jString = Java.cast(args[2], Java.use(\u0026#39;java.lang.String\u0026#39;)); console.log(\u0026#34;å‚æ•°:\u0026#34;, jString.toString()); // æ–¹æ³•äºŒ var JNIEnv = Java.vm.getEnv(); var originalStrPtr = JNIEnv.getStringUtfChars(args[2], null).readCString(); console.log(\u0026#34;å‚æ•°:\u0026#34;, originalStrPtr); }, //onLeaveé‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹è¿”å›å€¼ onLeave: function(retval){ //retvalè¿”å›å€¼ var returnedJString = Java.cast(retval, Java.use(\u0026#39;java.lang.String\u0026#39;)); console.log(\u0026#34;è¿”å›å€¼:\u0026#34;, returnedJString.toString()); } }) } }) } 0x05 Nativeå‡½æ•°çš„åŸºç¡€Hookä¿®æ”¹ 1.æ•´æ•°å‹ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 function hookTest3(){ Java.perform(function(){ //æ ¹æ®å¯¼å‡ºå‡½æ•°åæ‰“å°åœ°å€ var helloAddr = Module.findExportByName(\u0026#34;lib52pojie.so\u0026#34;,\u0026#34;Java_com_zj_wuaipojie_util_SecurityUtil_checkVip\u0026#34;); console.log(helloAddr); if(helloAddr != null){ Interceptor.attach(helloAddr,{ onEnter: function(args){ //argså‚æ•° args[0] = ptr(1000); //ç¬¬ä¸€ä¸ªå‚æ•°ä¿®æ”¹ä¸ºæ•´æ•° 1000ï¼Œå…ˆè½¬ä¸ºæŒ‡é’ˆå†èµ‹å€¼ console.log(args[0]); }, onLeave: function(retval){ //retvalè¿”å›å€¼ retval.replace(20000); //è¿”å›å€¼ä¿®æ”¹ console.log(\u0026#34;retval\u0026#34;,retval.toInt32()); } }) } }) } 2.å­—ç¬¦ä¸²ç±»å‹ä¿®æ”¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 function hookTest2(){ Java.perform(function(){ //æ ¹æ®å¯¼å‡ºå‡½æ•°åæ‰“å°åœ°å€ var helloAddr = Module.findExportByName(\u0026#34;lib52pojie.so\u0026#34;,\u0026#34;Java_com_zj_wuaipojie_util_SecurityUtil_vipLevel\u0026#34;); if(helloAddr != null){ Interceptor.attach(helloAddr,{ //onEnteré‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹å‚æ•° onEnter: function(args){ //argsä¼ å…¥å‚æ•° var JNIEnv = Java.vm.getEnv(); var originalStrPtr = JNIEnv.getStringUtfChars(args[2], null).readCString(); console.log(\u0026#34;å‚æ•°:\u0026#34;, originalStrPtr); var modifiedContent = \u0026#34;è‡³å°Š\u0026#34;; var newJString = JNIEnv.newStringUtf(modifiedContent); args[2] = newJString; }, //onLeaveé‡Œå¯ä»¥æ‰“å°å’Œä¿®æ”¹è¿”å›å€¼ onLeave: function(retval){ //retvalè¿”å›å€¼ var returnedJString = Java.cast(retval, Java.use(\u0026#39;java.lang.String\u0026#39;)); console.log(\u0026#34;è¿”å›å€¼:\u0026#34;, returnedJString.toString()); var JNIEnv = Java.vm.getEnv(); var modifiedContent = \u0026#34;æ— æ•Œ\u0026#34;; var newJString = JNIEnv.newStringUtf(modifiedContent); retval.replace(newJString); } }) } }) } 0x06 SOåŸºå€çš„è·å–æ–¹å¼ 1 2 3 var moduleAddr1 = Process.findModuleByName(\u0026#34;lib52pojie.so\u0026#34;).base; var moduleAddr2 = Process.getModuleByName(\u0026#34;lib52pojie.so\u0026#34;).base; var moduleAddr3 = Module.findBaseAddress(\u0026#34;lib52pojie.so\u0026#34;); 0x07 Hookæœªå¯¼å‡ºå‡½æ•°ä¸å‡½æ•°åœ°å€è®¡ç®— 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function hookTest6(){ Java.perform(function(){ //æ ¹æ®å¯¼å‡ºå‡½æ•°åæ‰“å°åŸºå€ var soAddr = Module.findBaseAddress(\u0026#34;lib52pojie.so\u0026#34;); console.log(soAddr); var funcaddr = soAddr.add(0x1071C); console.log(funcaddr); if(funcaddr != null){ Interceptor.attach(funcaddr,{ onEnter: function(args){ //argså‚æ•° }, onLeave: function(retval){ //retvalè¿”å›å€¼ console.log(retval.toInt32()); } }) } }) } å‡½æ•°åœ°å€è®¡ç®—\n1.å®‰å“é‡Œä¸€èˆ¬32 ä½çš„ so ä¸­éƒ½æ˜¯thumbæŒ‡ä»¤ï¼Œ64 ä½çš„ so ä¸­éƒ½æ˜¯armæŒ‡ä»¤\n2.é€šè¿‡IDAé‡Œçš„opcode bytesæ¥åˆ¤æ–­ï¼Œarm æŒ‡ä»¤ä¸º 4 ä¸ªå­—èŠ‚(options -\u0026gt; general -\u0026gt; Number of opcode bytes (non-graph) è¾“å…¥4)\n3.thumb æŒ‡ä»¤ï¼Œå‡½æ•°åœ°å€è®¡ç®—æ–¹å¼ï¼š so åŸºå€ + å‡½æ•°åœ¨ so ä¸­çš„åç§» + 1 arm æŒ‡ä»¤ï¼Œå‡½æ•°åœ°å€è®¡ç®—æ–¹å¼ï¼š so åŸºå€ + å‡½æ•°åœ¨ so ä¸­çš„åç§»\n0x08 Hook_dlopen dlopen/android_dlopen_ext æ˜¯ Android åŠ è½½ SO çš„ç³»ç»Ÿå‡½æ•°ï¼ŒHook åå¯æ•è· SO åŠ è½½æ—¶æœºï¼Œå®ç°å»¶è¿Ÿ Hookï¼ˆé¿å… SO æœªåŠ è½½æ—¶ Hook å¤±è´¥ï¼‰ã€‚\ndlopenæºç  android_dlopen_extæºç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 function hook_dlopen() { var dlopen = Module.findExportByName(null, \u0026#34;dlopen\u0026#34;); Interceptor.attach(dlopen, { onEnter: function (args) { var so_name = args[0].readCString(); if (so_name.indexOf(\u0026#34;lib52pojie.so\u0026#34;) \u0026gt;= 0) this.call_hook = true; }, onLeave: function (retval) { if (this.call_hook) hookTest2(); } }); // é«˜ç‰ˆæœ¬Androidç³»ç»Ÿä½¿ç”¨android_dlopen_ext var android_dlopen_ext = Module.findExportByName(null, \u0026#34;android_dlopen_ext\u0026#34;); Interceptor.attach(android_dlopen_ext, { onEnter: function (args) { var so_name = args[0].readCString(); if (so_name.indexOf(\u0026#34;lib52pojie.so\u0026#34;) \u0026gt;= 0) this.call_hook = true; }, onLeave: function (retval) { if (this.call_hook) hookTest2(); } }); } å‚è€ƒæ–‡æ¡£ï¼š\nIDA\u0026amp;Frida å­¦ä¹ \nFRIDA-APIä½¿ç”¨ç¯‡ï¼šrpcã€Processã€Moduleã€Memoryä½¿ç”¨æ–¹æ³•åŠç¤ºä¾‹\nIDA\u0026amp;Frida å­¦ä¹ \nFrida Hook å¸¸ç”¨å‡½æ•°ã€java å±‚ hookã€so å±‚ hookã€RPCã€ç¾¤æ§\n","date":"2025-09-28T22:21:41+08:00","image":"https://s.panlai.com/zb_users/upload/2025/04/bizhihui_com_202504061743931299117236.jpg-arthumbs","permalink":"https://fanshanng.cn/p/frida/","title":"å®‰å“é€†å‘å…¥é—¨ä¸ƒï¼šFridaå…¥é—¨"},{"content":"ä¸€æ¬¡IDAåŠ¨æ€è°ƒè¯•å®‰å“apkè®°å½• å·¥å…·æ¸…å•ï¼šIDA Pro9.1 å°ç±³æ‰‹æœºï¼ˆMIUI 15.5.2ï¼‰å¾çˆ±ç ´è§£çš„æ•™ç¨‹demoï¼ˆè§£å‹å¯†ç ï¼š52pjï¼‰ ADBç¯å¢ƒ åœ¨IDAç›®å½•ä¸‹çš„dbgsrvï¼Œé€‰æ‹©è·Ÿæ‰‹æœºæ¶æ„ä¸€è‡´çš„server åœ¨mtç®¡ç†å™¨ä¸­ç‚¹å¼€ç›®æ ‡appçš„å±æ€§è¿›è¡Œæ‰‹åŠ¨ææƒ ä¹Ÿå¯ä»¥adbè¿›å…¥ææƒ é‡å‘½åandroid_serverä¸ºasï¼Œå¯ä»¥é˜²æ­¢ä¸€äº›åè°ƒè¯•\næ­¤å¤„è¿è¡Œç¼–è¾‘å¥½çš„.batæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨å‘½ä»¤è¡Œæ›¿ä»£\nè¿è¡ŒæˆåŠŸå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹ç”»é¢ï¼ˆåªéœ€ç‚¹å‡»IDAdebug1.batå³å¯ï¼‰ æ‰“å¼€ida proï¼Œè®¾ç½®Hostnameä¸º127.0.0.1 ä½¿ç”¨é»˜è®¤ç«¯å£å·ä¸º23946 å¯¹checkå‡½æ•°ä¸‹æ–­ç‚¹\nç„¶å\né™„åŠ åˆ°å¯¹åº”è¿›ç¨‹ï¼Œä¼šå‡ºç°å¦‚ä¸‹æ‰€ç¤ºçª—å£ï¼Œé€‰æ‹©same ç„¶åç¨‹åºä¼šåœåœ¨å¦‚å›¾æ‰€ç¤ºçš„åœ°æ–¹ï¼Œè¿™æ—¶å€™è¦ç‚¹å¼€å§‹è°ƒè¯•ï¼ˆè“è‰²å°ä¸‰è§’ï¼‰ï¼Œåœ¨æ‰‹æœºè¾“å…¥ä»»æ„å­—ç¬¦ä¸²åç‚¹å‡»éªŒè¯ ç­‰å¾…ç¨‹åºè¿è¡Œåˆ°æ–­ç‚¹\næ­¥è¿›åˆ°æ¯”è¾ƒå‡½æ•°å¤„\nç‚¹å‡»_wuaipojie0123456å°±å¯ä»¥çœ‹åˆ°æ¯”è¾ƒçš„å€¼ï¼Œå³ä¸ºflag åœ¨ç¬¬ä¸€æ¬¡è°ƒè¯•è¿‡ç¨‹é‡åˆ°äº†åè°ƒè¯•ï¼Œåœ¨JNI_OnLoadä¸­ å°†å¯¹åº”ä»£ç patchæ‰åï¼Œå³é”®ä¿å­˜ ç‚¹å‡»Apply patchesè¦†ç›–æ‰åŸæœ¬çš„soæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªsoæ–‡ä»¶æ›¿æ¢åŸæœ¬çš„apk/lib/arm64-v8aä¸­çš„soæ–‡ä»¶ï¼Œé‡æ–°å®‰è£…è¯¥åº”ç”¨ï¼Œå†æ¬¡è¿è¡Œä¸Šè¿°æ“ä½œï¼Œå³å¯ç»•è¿‡åè°ƒè¯• è¡¥å……å¸¸è§å¯„å­˜å™¨çŸ¥è¯† åœ¨è¿›è¡ŒåŠ¨æ€è°ƒè¯•ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å¯„å­˜å™¨ä»‹ç»ï¼š\nå¯„å­˜å™¨åç§° åŠŸèƒ½ä»‹ç» R0-R12 é€šç”¨å¯„å­˜å™¨ï¼Œç”¨äºå­˜å‚¨ä¸´æ—¶æ•°æ®ã€‚åœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼ŒR0-R3ç”¨äºå­˜å‚¨å‰å››ä¸ªå‚æ•°ï¼Œå…¶ä½™çš„å‚æ•°é€šè¿‡å †æ ˆä¼ é€’ã€‚è¿”å›å€¼ä¹Ÿé€šè¿‡R0å’ŒR1ä¼ é€’ã€‚ R13 (SP) å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ŒæŒ‡å‘å½“å‰å †æ ˆçš„é¡¶éƒ¨ã€‚ R14 (LR) é“¾æ¥å¯„å­˜å™¨ï¼Œå­˜å‚¨å­ç¨‹åºçš„è¿”å›åœ°å€ã€‚ R15 (PC) ç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ CPSR å½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼Œä¿å­˜ç¨‹åºçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚ç®—æœ¯è¿ç®—çš„ç»“æœæ ‡å¿—ã€ä¸­æ–­ç¦æ­¢æ ‡å¿—ç­‰ã€‚ FPSCR æµ®ç‚¹çŠ¶æ€å’Œæ§åˆ¶å¯„å­˜å™¨ï¼Œå¦‚æœä½ åœ¨è°ƒè¯•çš„ä»£ç ä¸­æ¶‰åŠåˆ°æµ®ç‚¹è¿ç®—ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯„å­˜å™¨ä¼šæ¯”è¾ƒé‡è¦ã€‚ å¸¸ç”¨å¿«æ·é”® å¿«æ·é”® åŠŸèƒ½ F2 åœ¨æ‰€åœ¨è¡Œä¸‹æ–­ç‚¹ F5 å¯ä»¥å°†ARMæŒ‡ä»¤è½¬åŒ–ä¸ºå¯è¯»çš„Cä»£ç ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨Yé”®ï¼Œå¯¹JNIEnvæŒ‡é’ˆåšä¸€ä¸ªç±»å‹è½¬æ¢ï¼Œä»è€Œå¯¹JNIé‡Œç»å¸¸ä½¿ç”¨çš„JNIEnvæ–¹æ³•èƒ½å¤Ÿè¯†åˆ« F7 å•æ­¥è¿›å…¥è°ƒè¯• F8 æŒ‰ç…§é¡ºåºä¸€è¡Œä¸€è¡Œï¼Œå•æ­¥è°ƒè¯• F9 ç›´æ¥è·³åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹å¤„ Shift + F12 å¿«é€ŸæŸ¥çœ‹soæ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œåˆ†æè¿‡ç¨‹ä¸­é€šè¿‡ä¸€äº›å…³é”®å­—ç¬¦ä¸²èƒ½å¤Ÿè¿…é€Ÿå®šä½åˆ°å…³é”®å‡½æ•° Ctrl + s æœ‰ä¸¤ä¸ªç”¨é€”ï¼Œåœ¨IDA Viewé¡µé¢ä¸­å¯ä»¥æŸ¥çœ‹æ–‡ä»¶soæ–‡ä»¶çš„æ‰€æœ‰æ®µä¿¡æ¯ï¼Œåœ¨è°ƒè¯•é¡µé¢å¯ä»¥æŸ¥çœ‹ç¨‹åºä¸­æ‰€æœ‰soæ–‡ä»¶æ˜ å°„åˆ°å†…å­˜çš„åŸºåœ°å€ã€‚tips:åœ¨è¿›è¡Œsoè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œå¾ˆæœ‰ç”¨çš„ä¸€ä¸ªå°æŠ€å·§å°±æ˜¯IDAåŒå¼€ï¼Œä¸€ä¸ªç”¨äºè¿›è¡Œé™æ€åˆ†æï¼›ä¸€ä¸ªç”¨äºåŠ¨æ€è°ƒè¯•ã€‚æ¯”å¦‚è¯´è°ƒè¯•è¿‡ç¨‹ä¸­è¦æ‰¾åˆ°ä¸€ä¸ªå‡½æ•°çš„åŠ è½½åˆ°å†…å­˜ä¸­çš„ä½ç½® Esc å›é€€é”®ï¼Œèƒ½å¤Ÿå€’å›ä¸Šä¸€éƒ¨æ“ä½œçš„è§†å›¾ï¼ˆåªæœ‰åœ¨åæ±‡ç¼–çª—å£æ‰æ˜¯è¿™ä¸ªä½œç”¨ï¼Œå¦‚æœæ˜¯åœ¨å…¶ä»–çª—å£æŒ‰ä¸‹escï¼Œä¼šå…³é—­è¯¥çª—å£ï¼‰ g ç›´æ¥è·³åˆ°æŸä¸ªåœ°å€ y æ›´æ”¹å˜é‡çš„ç±»å‹ x å¯¹ç€æŸä¸ªå‡½æ•°ã€å˜é‡æŒ‰è¯¥å¿«æ·é”®ï¼Œå¯ä»¥æŸ¥çœ‹å®ƒçš„äº¤å‰å¼•ç”¨ n æ›´æ”¹å˜é‡çš„åç§° p åˆ›å»ºå‡½æ•° å¯èƒ½é‡åˆ°çš„é—®é¢˜ 1.jdb ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚ â€‹\thttp://t.csdn.cn/paKAt\n1 2 3 4 5 6 7 8 9 10 11 12 java.io.IOException: handshake failed - connection prematurally closed at com.sun.tools.jdi.SocketTransportService.handshake(SocketTransportService.java:136) at com.sun.tools.jdi.SocketTransportService.attach(SocketTransportService.java:232) at com.sun.tools.jdi.GenericAttachingConnector.attach(GenericAttachingConnector.java:116) at com.sun.tools.jdi.SocketAttachingConnector.attach(SocketAttachingConnector.java:90) at com.sun.tools.example.debug.tty.VMConnection.attachTarget(VMConnection.java:519) at com.sun.tools.example.debug.tty.VMConnection.open(VMConnection.java:328) at com.sun.tools.example.debug.tty.Env.init(Env.java:63) at com.sun.tools.example.debug.tty.TTY.main(TTY.java:1066) è‡´å‘½é”™è¯¯: æ— æ³•é™„åŠ åˆ°ç›®æ ‡ VMã€‚ è§£å†³æ–¹æ³•ï¼šæœ‰å¯èƒ½æ˜¯æ‰‹æœºé—®é¢˜ï¼Œå»ºè®®ä½ç‰ˆæœ¬çœŸæœºï¼Œä¸è¦ç”¨æ¨¡æ‹Ÿå™¨ï¼åˆ‡å‘½ä»¤é¡ºåºä¸è¦ä¹±ï¼å¦å¤–ä¹Ÿæœ‰å¯èƒ½è½¯ä»¶æœ‰åè°ƒè¯•ï¼ 3.åŠ¨æ€è°ƒè¯•ä¸­æ‰¾ä¸åˆ°soæ–‡ä»¶ è§£å†³æ–¹æ³•ï¼šå¯ä»¥å°è¯•æ‰‹åŠ¨å¤åˆ¶ä¸€ä»½å¯¹åº”çš„soæ–‡ä»¶æ”¾åˆ°data/app/åŒ…å/libç›®å½•ä¸‹\n4.device offline è§£å†³æ–¹æ³•ï¼šé‡æ–°æ’æ‹”usbï¼Œå†ä¸è¡Œå°±é‡å¯æœºå­\n5.0.0.0.0:23946: bind: Address already in use è§£å†³æ–¹æ¡ˆï¼š adb shell \u0026quot;su -c 'lsof | grep 23946'\u0026quot; //è·å–pid adb shell \u0026quot;su -c 'kill -9 PID'\u0026quot; //è¿™é‡Œçš„pidè¦æ ¹æ®ä¸Šä¸€æ­¥è·å–çš„å¡«å†™\n6.å¸¸è§åè°ƒè¯•\nè°ƒè¯•ç«¯å£æ£€æµ‹\næ£€æµ‹å¸¸è§çš„23946ç«¯å£ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶å¯ä»¥åŠ -pæŒ‡å®šä¸€ä¸ªå¦å¤–çš„ç«¯å£æ¥è¿‡æ‰è¿™ä¸ªæ£€æµ‹\nä¾‹å¦‚ï¼Œä½¿ç”¨./as -p 12345å‘½ä»¤å¯åŠ¨è°ƒè¯•serverï¼Œå°†è°ƒè¯•ç«¯å£æ”¹ä¸º12345ï¼Œç„¶ååœ¨IDA Proä¸­ç›¸åº”åœ°ä¿®æ”¹ç«¯å£å·ä¸º12345è¿›è¡Œè¿æ¥ã€‚\nè°ƒè¯•è¿›ç¨‹åæ£€æµ‹\nå›ºå®šçš„è¿›ç¨‹å android_server gdb_serverç­‰ç­‰ï¼Œæ‰€ä»¥è¦æ”¹ä¸ªåå­—ï¼Œä¾‹å¦‚as64\nptraceæ£€æµ‹\næ¯ä¸ªè¿›ç¨‹åŒæ—¶åˆ»åªèƒ½è¢«1ä¸ªè°ƒè¯•è¿›ç¨‹ptrace ï¼Œä¸»åŠ¨ptraceæœ¬è¿›ç¨‹å¯ä»¥ä½¿å¾—å…¶ä»–è°ƒè¯•å™¨æ— æ³•è°ƒè¯•\nå®ç°ä»£ç ï¼š\n1 2 3 4 int ptrace_protect()//ptraceé™„åŠ è‡ªèº«çº¿ç¨‹ ä¼šå¯¼è‡´æ­¤è¿›ç¨‹TracerPid å˜ä¸ºçˆ¶è¿›ç¨‹çš„TracerPid å³zygote { return ptrace(PTRACE_TRACEME,0,0,0);;//è¿”å›-1å³ä¸ºå·²ç»è¢«è°ƒè¯• } æ¨èä¸€ä¸ªå®‰å“çš„æ˜¾ç¤ºæ§åˆ¶è½¯ä»¶ï¼šQtScrcpy æ‰“å¼€å¦‚ä¸‹æŒ‰é’®åå¯ä»¥å®ç°ç”µè„‘çš„æ¨¡æ‹Ÿç‚¹å‡»ï¼Œéå¸¸å¥½ç”¨ å‚è€ƒæ–‡ä»¶ï¼š\nã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹åäºŒã€å¤§ä½¬å¸®æˆ‘åˆ†æä¸€ä¸‹\nIDAä¿®æ”¹exeå¹¶ä¿å­˜è¿è¡Œ\nä½¿ç”¨IDAè¿›è¡ŒåŠ¨æ€è°ƒè¯•ä¸è¿‡åè°ƒè¯•ï¼ˆä¸Šï¼‰ï¼ˆä¸‰ï¼‰\n","date":"2025-09-26T23:55:59+08:00","image":"https://s.panlai.com/zb_users/upload/2025/06/20250625120242175082416230890.jpg-arthumbs","permalink":"https://fanshanng.cn/p/as_debug/","title":"ä¸€æ¬¡IDAåŠ¨æ€è°ƒè¯•å®‰å“apkè®°å½•"},{"content":"å…³é”®è¯ï¼šELFæ–‡ä»¶å…¥é—¨ã€soæ–‡ä»¶åˆ†æ ã€ARMåŸºç¡€çŸ¥è¯†\n0x00 ELFæ–‡ä»¶å…¥é—¨ ELFï¼ˆExecutable and Linkable Formatï¼‰æ˜¯ä¸€ç§å¯æ‰§è¡Œå’Œå¯é“¾æ¥çš„æ–‡ä»¶æ ¼å¼ï¼Œæ˜¯linuxåº•ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºwindowsä¸‹çš„PEæ–‡ä»¶ï¼Œåœ¨Androidä¸­å¯ä»¥æ¯”ä½œSOï¼Œæ–¹ä¾¿å‡½æ•°çš„ç§»æ¤ï¼Œåœ¨å¸¸ç”¨äºä¿æŠ¤Androidè½¯ä»¶ï¼Œå¢åŠ é€†å‘éš¾åº¦ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºæ”¯æŒç¨‹åºçš„æ‰§è¡Œï¼ˆå¦‚äºŒè¿›åˆ¶ç¨‹åºè¿è¡Œã€åŠ¨æ€åº“åŠ è½½ï¼‰å’Œé“¾æ¥ï¼ˆç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ¨¡å—ç»„åˆï¼‰ï¼Œæ˜¯è·¨å¹³å°äºŒè¿›åˆ¶å…¼å®¹çš„åŸºç¡€ã€‚\nELFæ–‡ä»¶çš„ä¸»è¦ç»„æˆéƒ¨åˆ†åŒ…æ‹¬ï¼š\nELF Headerï¼šæ–‡ä»¶å¤´ï¼Œæè¿°æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯\nProgram Header Tableï¼šç¨‹åºå¤´è¡¨ï¼Œæè¿°è¿›ç¨‹æ˜ åƒçš„å¸ƒå±€\nSection Header Tableï¼šèŠ‚åŒºå¤´è¡¨ï¼Œæè¿°æ–‡ä»¶çš„å„ä¸ªèŠ‚åŒº\nç¨‹åºå¤´è¡¨ä¸åˆ†æ®µå¤´è¡¨å¼•ç”¨çš„æ•°æ®ï¼Œæ¯”å¦‚ .text .dataã€‚\nELF Headerï¼ˆæ–‡ä»¶å¤´ï¼‰ ELF Header æè¿°äº† ELF æ–‡ä»¶çš„æ¦‚è¦ä¿¡æ¯ï¼Œåˆ©ç”¨è¿™ä¸ªæ•°æ®ç»“æ„å¯ä»¥ç´¢å¼•åˆ° ELF æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæ˜¯ELF æ–‡ä»¶çš„ \u0026ldquo;æ€»ç›®å½•\u0026rdquo;ï¼Œå­˜å‚¨æ–‡ä»¶çš„åŸºç¡€å…ƒä¿¡æ¯ï¼Œå¯é€šè¿‡è¿™äº›ä¿¡æ¯ç´¢å¼•åˆ°å…¶ä»–æ‰€æœ‰ç»“æ„ã€‚32 ä½ ELF çš„æ–‡ä»¶å¤´ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #define EI_NIDENT 16 typedef struct { unsigned char e_ident[EI_NIDENT]; ELF32_Half e_type; ELF32_Half e_machine; ELF32_Word e_version; ELF32_Addr e_entry; ELF32_Off e_phoff; ELF32_Off e_shoff; ELF32_Word e_flags; ELF32_Half e_ehsize; ELF32_Half e_phentsize; ELF32_Half e_phnum; ELF32_Half e_shentsize; ELF32_Half e_shnum; ELF32_Half e_shstrndx; } Elf32_Ehdr; ELF å¤´ä¸­çš„ e_shoff é¡¹ç»™å‡ºäº†ä»æ–‡ä»¶å¼€å¤´åˆ°èŠ‚å¤´è¡¨ä½ç½®çš„å­—èŠ‚åç§»ã€‚e_shnum å‘Šè¯‰äº†æˆ‘ä»¬èŠ‚å¤´è¡¨åŒ…å«çš„é¡¹æ•°ï¼›e_shentsize ç»™å‡ºäº†æ¯ä¸€é¡¹çš„å­—èŠ‚å¤§å°ã€‚\nProgram Header Tableï¼ˆç¨‹åºå¤´è¡¨ï¼‰ Program Header Table æ˜¯ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ çš„ç±»å‹æ˜¯ Elf32_Phdrï¼Œæè¿°äº†ä¸€ä¸ªæ®µæˆ–è€…å…¶å®ƒç³»ç»Ÿåœ¨å‡†å¤‡ç¨‹åºæ‰§è¡Œæ—¶æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚\nå…¶ä¸­ï¼ŒELF å¤´ä¸­çš„ e_phentsize å’Œ e_phnum æŒ‡å®šäº†è¯¥æ•°ç»„æ¯ä¸ªå…ƒç´ çš„å¤§å°ä»¥åŠå…ƒç´ ä¸ªæ•°ã€‚ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„æ®µåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªèŠ‚ã€‚ç¨‹åºçš„å¤´éƒ¨åªæœ‰å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶æœ‰æ„ä¹‰ã€‚\nå¯ä»¥è¯´ï¼ŒProgram Header Table å°±æ˜¯ä¸“é—¨ä¸º ELF æ–‡ä»¶è¿è¡Œæ—¶ä¸­çš„æ®µæ‰€å‡†å¤‡çš„ã€‚\nElf32_Phdrçš„å®šä¹‰å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 typedef struct { ELF32_Word p_type; ELF32_Off p_offset; ELF32_Addr p_vaddr; ELF32_Addr p_paddr; ELF32_Word p_filesz; ELF32_Word p_memsz; ELF32_Word p_flags; ELF32_Word p_align; } Elf32_Phdr; å­—æ®µè¯´æ˜ å­—æ®µ è¯´æ˜ p_type è¯¥å­—æ®µä¸ºæ®µçš„ç±»å‹ï¼Œæˆ–è€…è¡¨æ˜äº†è¯¥ç»“æ„çš„ç›¸å…³ä¿¡æ¯ã€‚ p_offset è¯¥å­—æ®µç»™å‡ºäº†ä»æ–‡ä»¶å¼€å§‹åˆ°è¯¥æ®µå¼€å¤´çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»ã€‚ p_vaddr è¯¥å­—æ®µç»™å‡ºäº†è¯¥æ®µç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨å†…å­˜ä¸­çš„è™šæ‹Ÿåœ°å€ã€‚ p_paddr è¯¥å­—æ®µä»…ç”¨äºç‰©ç†åœ°å€å¯»å€ç›¸å…³çš„ç³»ç»Ÿä¸­ï¼Œ ç”±äº â€œSystem Vâ€ å¿½ç•¥äº†åº”ç”¨ç¨‹åºçš„ç‰©ç†å¯»å€ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶çš„è¯¥é¡¹å†…å®¹å¹¶æœªè¢«é™å®šã€‚ p_filesz è¯¥å­—æ®µç»™å‡ºäº†æ–‡ä»¶é•œåƒä¸­è¯¥æ®µçš„å¤§å°ï¼Œå¯èƒ½ä¸º 0ã€‚ p_memsz è¯¥å­—æ®µç»™å‡ºäº†å†…å­˜é•œåƒä¸­è¯¥æ®µçš„å¤§å°ï¼Œå¯èƒ½ä¸º 0ã€‚ p_flags è¯¥å­—æ®µç»™å‡ºäº†ä¸æ®µç›¸å…³çš„æ ‡è®°ã€‚ p_align å¯åŠ è½½çš„ç¨‹åºçš„æ®µçš„ p_vaddr ä»¥åŠ p_offset çš„å¤§å°å¿…é¡»æ˜¯ page çš„æ•´æ•°å€ã€‚è¯¥æˆå‘˜ç»™å‡ºäº†æ®µåœ¨æ–‡ä»¶ä»¥åŠå†…å­˜ä¸­çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœè¯¥å€¼ä¸º 0 æˆ– 1 çš„è¯ï¼Œè¡¨ç¤ºä¸éœ€è¦å¯¹é½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œp_align åº”è¯¥æ˜¯ 2 çš„æ•´æ•°æŒ‡æ•°æ¬¡æ–¹ï¼Œå¹¶ä¸” p_vaddr ä¸ p_offset åœ¨æ¨¡ p_align çš„æ„ä¹‰ä¸‹ï¼Œåº”è¯¥ç›¸ç­‰ã€‚ æ ¸å¿ƒæ„ä¹‰ï¼šæ“ä½œç³»ç»ŸåŠ è½½ ELF æ–‡ä»¶æ—¶ï¼Œæ ¹æ®ç¨‹åºå¤´è¡¨å°† \u0026ldquo;æ®µ\u0026rdquo; æ˜ å°„åˆ°å†…å­˜ï¼Œä¾‹å¦‚ï¼š\np_type=PT_LOADçš„æ®µä¼šè¢«åŠ è½½åˆ°p_vaddræŒ‡å®šçš„å†…å­˜åœ°å€ã€‚ p_flags=0x5ï¼ˆR+Xï¼‰é€šå¸¸å¯¹åº”ä»£ç æ®µï¼ˆå¯æ‰§è¡Œä¸”åªè¯»ï¼‰ï¼Œp_flags=0x6ï¼ˆR+Wï¼‰å¯¹åº”æ•°æ®æ®µã€‚ Section Header Tableï¼ˆèŠ‚åŒºå¤´è¡¨ï¼‰ è¯¥ç»“æ„ç”¨äºå®šä½ ELF æ–‡ä»¶ä¸­çš„æ¯ä¸ªèŠ‚åŒºçš„å…·ä½“ä½ç½®ã€‚æè¿° ELF æ–‡ä»¶åœ¨ç¼–è¯‘é“¾æ¥æ—¶çš„ç»“æ„ï¼ˆå³ \u0026ldquo;èŠ‚åŒº\u0026rdquo; ä¿¡æ¯ï¼‰ï¼Œç”¨äºè°ƒè¯•ã€é™æ€åˆ†æç­‰åœºæ™¯ã€‚æ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ªElf32_Shdrç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 typedef struct { ELF32_Word sh_name; ELF32_Word sh_type; ELF32_Word sh_flags; ELF32_Addr sh_addr; ELF32_Off sh_offset; ELF32_Word sh_size; ELF32_Word sh_link; ELF32_Word sh_info; ELF32_Word sh_addralign; ELF32_Word sh_entsize; } Elf32_Shdr; æˆå‘˜ è¯´æ˜ å–å€¼ è¯´æ˜ sh_name sh_nameèŠ‚åç§°ï¼Œæ˜¯èŠ‚åŒºå¤´å­—ç¬¦ä¸²è¡¨èŠ‚åŒºä¸­ï¼ˆSection Header String Table Sectionï¼‰çš„ç´¢å¼•ï¼Œå› æ­¤è¯¥å­—æ®µå®é™…æ˜¯ä¸€ä¸ªæ•°å€¼ã€‚åœ¨å­—ç¬¦ä¸²è¡¨ä¸­çš„å…·ä½“å†…å®¹æ˜¯ä»¥ NULL ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚ 0 æ— åç§° sh_type sh_typeæ ¹æ®èŠ‚çš„å†…å®¹å’Œè¯­ä¹‰è¿›è¡Œåˆ†ç±»ï¼Œå…·ä½“çš„ç±»å‹ä¸‹é¢ä¼šä»‹ç»ã€‚ SHT_NULL é™åˆ¶ sh_flags sh_flagsæ¯ä¸€æ¯”ç‰¹ä»£è¡¨ä¸åŒçš„æ ‡å¿—ï¼Œæè¿°èŠ‚æ˜¯å¦å¯å†™ï¼Œå¯æ‰§è¡Œï¼Œéœ€è¦åˆ†é…å†…å­˜ç­‰å±æ€§ã€‚ 0 æ— æ ‡å¿— sh_addr sh_addrå¦‚æœèŠ‚åŒºå°†å‡ºç°åœ¨è¿›ç¨‹çš„å†…å­˜æ˜ åƒä¸­ï¼Œæ­¤æˆå‘˜ç»™å‡ºèŠ‚åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åº”è¯¥åœ¨è¿›ç¨‹é•œåƒä¸­çš„ä½ç½®ã€‚å¦åˆ™ï¼Œæ­¤å­—æ®µä¸º 0ã€‚ 0 æ— åœ°å€ sh_offset sh_offsetç»™å‡ºèŠ‚åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸æ–‡ä»¶å¼€å§‹å¤„ä¹‹é—´çš„åç§»ã€‚SHT_NOBITS ç±»å‹çš„èŠ‚åŒºä¸å ç”¨æ–‡ä»¶çš„ç©ºé—´ï¼Œå› æ­¤å…¶ sh_offset æˆå‘˜ç»™å‡ºçš„æ˜¯æ¦‚å¿µæ€§çš„åç§»ã€‚ 0 æ— æ–‡ä»¶åç§» sh_size sh_sizeæ­¤æˆå‘˜ç»™å‡ºèŠ‚åŒºçš„å­—èŠ‚å¤§å°ã€‚é™¤éèŠ‚åŒºçš„ç±»å‹æ˜¯ SHT_NOBITS ï¼Œå¦åˆ™è¯¥èŠ‚å ç”¨æ–‡ä»¶ä¸­çš„ sh_size å­—èŠ‚ã€‚ç±»å‹ä¸º SHT_NOBITS çš„èŠ‚åŒºé•¿åº¦å¯èƒ½éé›¶ï¼Œä¸è¿‡å´ä¸å ç”¨æ–‡ä»¶ä¸­çš„ç©ºé—´ã€‚ 0 æ— å¤§å° sh_link sh_linkæ­¤æˆå‘˜ç»™å‡ºèŠ‚åŒºå¤´éƒ¨è¡¨ç´¢å¼•é“¾æ¥ï¼Œå…¶å…·ä½“çš„è§£é‡Šä¾èµ–äºèŠ‚åŒºç±»å‹ã€‚ SHN_UNDEF æ— é“¾æ¥ä¿¡æ¯ sh_info sh_infoæ­¤æˆå‘˜ç»™å‡ºé™„åŠ ä¿¡æ¯ï¼Œå…¶è§£é‡Šä¾èµ–äºèŠ‚åŒºç±»å‹ã€‚ 0 æ— è¾…åŠ©ä¿¡æ¯ sh_addralign sh_addralignæŸäº›èŠ‚åŒºçš„åœ°å€éœ€è¦å¯¹é½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªèŠ‚åŒºæœ‰ä¸€ä¸ª doubleword ç±»å‹çš„å˜é‡ï¼Œé‚£ä¹ˆç³»ç»Ÿå¿…é¡»ä¿è¯æ•´ä¸ªèŠ‚åŒºæŒ‰åŒå­—å¯¹é½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsh_addr%sh_addralign=0ã€‚ç›®å‰å®ƒä»…å…è®¸ä¸º 0ï¼Œä»¥åŠ 2 çš„æ­£æ•´æ•°å¹‚æ•°ã€‚ 0 å’Œ 1 è¡¨ç¤ºæ²¡æœ‰å¯¹é½çº¦æŸã€‚ 0 æ— å¯¹é½è¦æ±‚ å¸¸è§èŠ‚åŒºï¼ˆSectionsï¼‰ èŠ‚åŒºæ˜¯ ELF æ–‡ä»¶çš„å®é™…æ•°æ®è½½ä½“ï¼Œå¸¸è§ç±»å‹åŠä½œç”¨å¦‚ä¸‹ï¼š\nèŠ‚åŒºå æè¿° .text ä»£ç æ®µï¼Œå­˜æ”¾ç¨‹åºçš„æŒ‡ä»¤ .data æ•°æ®æ®µï¼Œå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ .rodata åªè¯»æ•°æ®æ®µï¼Œå­˜æ”¾åªè¯»æ•°æ® .bss æœªåˆå§‹åŒ–æ•°æ®æ®µï¼Œå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ .symtab ç¬¦å·è¡¨ï¼Œå­˜æ”¾ç¬¦å·ä¿¡æ¯ .strtab å­—ç¬¦ä¸²è¡¨ï¼Œå­˜æ”¾å­—ç¬¦ä¸²æ•°æ® .dynsym åŠ¨æ€ç¬¦å·è¡¨ï¼Œå­˜æ”¾åŠ¨æ€é“¾æ¥éœ€è¦çš„ç¬¦å·ä¿¡æ¯ .dynamic åŠ¨æ€é“¾æ¥ä¿¡æ¯ï¼Œå­˜æ”¾åŠ¨æ€é“¾æ¥å™¨éœ€è¦çš„ä¿¡æ¯ æ®µä¸èŠ‚åŒºçš„å…³ç³»\næ®µï¼ˆSegmentï¼‰ï¼šé¢å‘è¿è¡Œæ—¶ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚åŒºç»„æˆï¼ˆå¦‚.textå’Œ.rodataå¯åˆå¹¶ä¸ºä¸€ä¸ª \u0026ldquo;ä»£ç æ®µ\u0026rdquo;ï¼‰ã€‚ èŠ‚åŒºï¼ˆSectionï¼‰ï¼šé¢å‘ç¼–è¯‘æ—¶ï¼ŒæŒ‰åŠŸèƒ½åˆ’åˆ†çš„æœ€å°æ•°æ®å•å…ƒã€‚ ä¾‹å¦‚ï¼šä¸€ä¸ªPT_LOADæ®µå¯èƒ½åŒ…å«.textï¼ˆä»£ç ï¼‰å’Œ.rodataï¼ˆåªè¯»æ•°æ®ï¼‰ä¸¤ä¸ªèŠ‚åŒºï¼Œå…±åŒæ˜ å°„åˆ°å†…å­˜çš„åªè¯»å¯æ‰§è¡ŒåŒºåŸŸã€‚\n0x01 ARMåŸºç¡€çŸ¥è¯† \u0026ldquo;x86ã€armã€RISC-V\u0026rdquo; éƒ½æ˜¯ æŒ‡ä»¤é›†æ¶æ„ ( CPUæ¶æ„ )ã€‚ARM æ˜¯ä¸»æµçš„ RISCï¼ˆç²¾ç®€æŒ‡ä»¤é›†ï¼‰æ¶æ„ï¼Œå¹¿æ³›ç”¨äºåµŒå…¥å¼è®¾å¤‡ï¼ˆå¦‚ Android æ‰‹æœºï¼‰ã€‚\næŒ‡ä»¤é›†ç‰¹ç‚¹\nå›ºå®šæŒ‡ä»¤é•¿åº¦ï¼ˆ32 ä½ ARM æŒ‡ä»¤ï¼ŒThumb æ¨¡å¼ä¸º 16 ä½ï¼‰ã€‚\nå¤§éƒ¨åˆ†æŒ‡ä»¤å¯æ¡ä»¶æ‰§è¡Œï¼ˆå¦‚ADDNE R0, R1, R2ï¼šä»…å½“æ ‡å¿—ä½ä¸ä¸º 0 æ—¶æ‰§è¡ŒåŠ æ³•ï¼‰ã€‚\nå¯„å­˜å™¨æ“ä½œä¼˜å…ˆï¼ˆç®—æœ¯ / é€»è¾‘è¿ç®—é€šå¸¸åŸºäºå¯„å­˜å™¨ï¼Œå†…å­˜è®¿é—®éœ€ä¸“ç”¨æŒ‡ä»¤ï¼‰ã€‚\næ ¸å¿ƒå¯„å­˜å™¨\nâ€‹\tARM32 æ¶æ„æœ‰ 16 ä¸ªé€šç”¨å¯„å­˜å™¨ï¼ˆR0-R15ï¼‰ï¼Œå…¶ä¸­ï¼š\nR0-R3ï¼šå‡½æ•°è°ƒç”¨å‚æ•° / è¿”å›å€¼å¯„å­˜å™¨ã€‚ R4-R11ï¼šé€šç”¨å¯„å­˜å™¨ï¼ˆéœ€æ‰‹åŠ¨ä¿å­˜ï¼‰ã€‚ R12ï¼ˆIPï¼‰ï¼šä¸´æ—¶å¯„å­˜å™¨ã€‚ R13ï¼ˆSPï¼‰ï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆæŒ‡å‘æ ˆé¡¶ï¼‰ã€‚ R14ï¼ˆLRï¼‰ï¼šé“¾æ¥å¯„å­˜å™¨ï¼ˆå­˜å‚¨å‡½æ•°è¿”å›åœ°å€ï¼‰ã€‚ R15ï¼ˆPCï¼‰ï¼šç¨‹åºè®¡æ•°å™¨ï¼ˆå­˜å‚¨ä¸‹ä¸€æ¡æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼‰ã€‚ å¸¸è§å¯»å€æ–¹å¼ å¯»å€æ–¹å¼ æè¿° ç«‹å³æ•°å¯»å€ ç›´æ¥ä½¿ç”¨ç«‹å³æ•°å€¼ä½œä¸ºæ“ä½œæ•°ï¼Œä¾‹å¦‚ï¼šMOV R0, #5 å¯„å­˜å™¨ç›´æ¥å¯»å€ ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼ä½œä¸ºæ“ä½œæ•°ï¼Œä¾‹å¦‚ï¼šMOV R0, R1 å¯„å­˜å™¨é—´æ¥å¯»å€ ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼ä½œä¸ºå†…å­˜åœ°å€ï¼Œè®¿é—®è¯¥åœ°å€ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šLDR R0, [R1] å¯„å­˜å™¨ç›¸å¯¹å¯»å€ ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼åŠ ä¸Šä¸€ä¸ªç«‹å³åç§»é‡ä½œä¸ºå†…å­˜åœ°å€ï¼Œä¾‹å¦‚ï¼šLDR R0, [R1, #4] å¯„å­˜å™¨å˜å€å¯»å€ ä½¿ç”¨ä¸¤ä¸ªå¯„å­˜å™¨ä¸­çš„å€¼ç›¸åŠ ä½œä¸ºå†…å­˜åœ°å€ï¼Œä¾‹å¦‚ï¼šLDR R0, [R1, R2] å¸¦æœ‰å˜å€å¯„å­˜å™¨çš„å¯„å­˜å™¨ç›¸å¯¹å¯»å€ ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼åŠ ä¸Šå¦ä¸€ä¸ªå¯„å­˜å™¨çš„å€¼ä¹˜ä»¥ä¸€ä¸ªæ¯”ä¾‹å› å­ä½œä¸ºå†…å­˜åœ°å€ï¼Œä¾‹å¦‚ï¼šLDR R0, [R1, R2, LSL #2] å †æ ˆå¯»å€ ä½¿ç”¨å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ˆå¦‚SPï¼‰è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼šPUSH {R0, R1} æˆ– POP {R0, R1} å‹æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ æŒ‡ä»¤ç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ æè¿° å‹æ ˆ PUSH {R0, R1} å°†å¯„å­˜å™¨R0å’ŒR1çš„å†…å®¹å‹å…¥å †æ ˆä¸­ å‹æ ˆ PUSH {R0-R5} å°†å¯„å­˜å™¨R0åˆ°R5çš„å†…å®¹å‹å…¥å †æ ˆä¸­ å‹æ ˆ STMDB SP!, {R0-R5} å°†å¯„å­˜å™¨R0åˆ°R5çš„å†…å®¹å‹å…¥å †æ ˆä¸­ï¼ˆä¸PUSHç­‰æ•ˆï¼‰ å‡ºæ ˆ POP {R0, R1} ä»å †æ ˆä¸­å¼¹å‡ºæ•°æ®ï¼Œæ¢å¤åˆ°å¯„å­˜å™¨R0å’ŒR1ä¸­ å‡ºæ ˆ POP {R0-R5} ä»å †æ ˆä¸­å¼¹å‡ºæ•°æ®ï¼Œæ¢å¤åˆ°å¯„å­˜å™¨R0åˆ°R5ä¸­ è·³è½¬æŒ‡ä»¤ æŒ‡ä»¤ç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ æè¿° æ— æ¡ä»¶è·³è½¬ B label æ— æ¡ä»¶è·³è½¬åˆ°æ ‡ç­¾labelæŒ‡å‘çš„ä½ç½® å­ç¨‹åºè°ƒç”¨ BL label è°ƒç”¨å­ç¨‹åºï¼Œå°†å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å­˜å…¥é“¾æ¥å¯„å­˜å™¨ï¼ˆLRï¼‰ï¼Œç„¶åè·³è½¬åˆ°æ ‡ç­¾labelæŒ‡å‘çš„ä½ç½® å­ç¨‹åºè¿”å› BX LR è¿”å›å­ç¨‹åºè°ƒç”¨å‰çš„ä½ç½®ï¼Œè·³è½¬åˆ°é“¾æ¥å¯„å­˜å™¨ï¼ˆLRï¼‰ä¸­å­˜å‚¨çš„åœ°å€ å¯„å­˜å™¨è·³è½¬ BX Rn è·³è½¬åˆ°å¯„å­˜å™¨Rnä¸­å­˜å‚¨çš„åœ°å€ ç®—æœ¯è¿ç®—æŒ‡ä»¤ æ±‡ç¼–ä¸­ä¹Ÿå¯ä»¥è¿›è¡Œç®—æœ¯è¿ç®—ï¼Œ æ¯”å¦‚åŠ å‡ä¹˜é™¤ï¼Œå¸¸ç”¨çš„è¿ç®—æŒ‡ä»¤ç”¨æ³•å¦‚è¡¨ æ‰€ç¤ºï¼š\næŒ‡ä»¤ è®¡ç®—å…¬å¼ å¤‡æ³¨ ADD Rd, Rn, Rm Rd = Rn + Rm åŠ æ³•è¿ç®—ï¼ŒæŒ‡ä»¤ä¸º ADD ADD Rd, Rn, #immed Rd = Rn + #immed åŠ æ³•è¿ç®—ï¼ŒæŒ‡ä»¤ä¸º ADD ADC Rd, Rn, Rm Rd = Rn + Rm + è¿›ä½ å¸¦è¿›ä½çš„åŠ æ³•è¿ç®—ï¼ŒæŒ‡ä»¤ä¸º ADC ADC Rd, Rn, #immed Rd = Rn + #immed + è¿›ä½ å¸¦è¿›ä½çš„åŠ æ³•è¿ç®—ï¼ŒæŒ‡ä»¤ä¸º ADC SUB Rd, Rn, Rm Rd = Rn - Rm å‡æ³• SUB Rd, #immed Rd = Rd - #immed å‡æ³• SUB Rd, Rn, #immed Rd = Rn - #immed å‡æ³• SBC Rd, Rn, #immed Rd = Rn - #immed - å€Ÿä½ å¸¦å€Ÿä½çš„å‡æ³• SBC Rd, Rn ,Rm Rd = Rn - Rm - å€Ÿä½ å¸¦å€Ÿä½çš„å‡æ³• MUL Rd, Rn, Rm Rd = Rn * Rm ä¹˜æ³• (32 ä½) UDIV Rd, Rn, Rm Rd = Rn / Rm æ— ç¬¦å·é™¤æ³• SDIV Rd, Rn, Rm Rd = Rn / Rm æœ‰ç¬¦å·é™¤æ³• é€»è¾‘è¿ç®— æ±‡ç¼–è¯­è¨€çš„æ—¶å€™ä¹Ÿå¯ä»¥ä½¿ç”¨é€»è¾‘è¿ç®—æŒ‡ä»¤ï¼Œå¸¸ç”¨çš„è¿ç®—æŒ‡ä»¤ç”¨æ³•å¦‚è¡¨ æ‰€ç¤ºï¼š 0x02 Android soæ–‡ä»¶åˆ†æ 1.SO æ–‡ä»¶æ¦‚è¿° SO æ–‡ä»¶æ˜¯ Unix/Linux ç³»ç»Ÿä¸­çš„åŠ¨æ€åº“æ–‡ä»¶ï¼Œè¢«ç§°ä¸ºå…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆShared Object Fileï¼‰ï¼Œåç¼€åä¸º .soï¼Œå®ƒæ˜¯ ELF çš„ä¸€ç§ï¼Œå¦å¤–å±äº ELF ç±»å‹çš„è¿˜æœ‰å¯é‡å®šä½æ–‡ä»¶ï¼ˆRelocatable Fileï¼‰ä»¥åŠæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼ˆCore Dump Fileï¼‰ã€‚\nSO æ–‡ä»¶é€šå¸¸ç”¨äºæé«˜å¼€å‘æ•ˆç‡ã€æ–¹ä¾¿å¿«é€Ÿç§»æ¤ä»£ç ï¼Œä»¥åŠä¿æŠ¤ Android åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘ï¼Œå¢åŠ é€†å‘å·¥ç¨‹çš„éš¾åº¦ã€‚ä¸åŒçš„ CPU æ¶æ„ï¼ˆå¦‚ ARMã€x86 ç­‰ï¼‰éœ€è¦ä¸åŒç‰ˆæœ¬çš„ SO æ–‡ä»¶æ¥é€‚é…å…¶æŒ‡ä»¤é›†å’Œè¿è¡Œç¯å¢ƒã€‚\nELF æ–‡ä»¶ç±»å‹ å…¸å‹åç¼€ æ ¸å¿ƒç”¨é€” é€†å‘ / å¼€å‘åœºæ™¯ä¸¾ä¾‹ ä¸ ARM çš„å…³è” å¯æ‰§è¡Œæ–‡ä»¶ æ— ï¼ˆå¦‚/bin/lsï¼‰ ç›´æ¥è¿è¡Œçš„ç¨‹åº åˆ†æ Linux/ARM åµŒå…¥å¼è®¾å¤‡çš„äºŒè¿›åˆ¶é€»è¾‘ ARM32/64 ä½è®¾å¤‡çš„å¯æ‰§è¡Œæ–‡ä»¶éœ€å¯¹åº”æ¶æ„ å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆSOï¼‰ .so ä¾›å…¶ä»–ç¨‹åºåŠ¨æ€è°ƒç”¨çš„åº“ï¼ˆä»£ç å¤ç”¨ + ä¿æŠ¤ï¼‰ é€†å‘ Android çš„libnative.soï¼ˆæ ¸å¿ƒé€»è¾‘è½½ä½“ï¼‰ Android SO åˆ†armeabi-v7aï¼ˆARM32ï¼‰ã€arm64-v8aï¼ˆARM64ï¼‰ ç›®æ ‡æ–‡ä»¶ .o ç¼–è¯‘åçš„ä¸­é—´æ–‡ä»¶ï¼ˆæœªé“¾æ¥ï¼‰ åˆ†æç¼–è¯‘åçš„å•ä¸ªæ¨¡å—ä»£ç ï¼ˆå¦‚ NDK ç¼–è¯‘çš„xxx.oï¼‰ ARM ç¼–è¯‘å™¨ï¼ˆå¦‚arm-linux-androideabi-gccï¼‰ç”Ÿæˆå¯¹åº”.o æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ .core ç¨‹åºå´©æºƒæ—¶çš„å†…å­˜å¿«ç…§ åˆ†æ SO å´©æºƒåŸå› ï¼ˆå¦‚ç©ºæŒ‡é’ˆè®¿é—®å¯¼è‡´çš„ core dumpï¼‰ ARM è®¾å¤‡å´©æºƒæ—¶ç”Ÿæˆçš„ core éœ€ç”¨ ARM æ¶æ„çš„ gdb åˆ†æ Android æ˜¯åŸºäº Linux å†…æ ¸å¼€å‘çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ Android å¹³å°ä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å’Œ Unix/Linux æ˜¯ä¸€è‡´çš„ã€‚\nsoæ–‡ä»¶å¤§ä½“ä¸Šå¯åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œä¸€èˆ¬æ¥è¯´ä»ä¸Šå¾€ä¸‹æ˜¯ELFå¤´éƒ¨-\u0026gt;Pargarmå¤´éƒ¨-\u0026gt;èŠ‚åŒº(Section)-\u0026gt;èŠ‚åŒºå¤´ï¼Œå…¶ä¸­ï¼Œé™¤äº†ELFå¤´éƒ¨åœ¨æ–‡ä»¶ä½ç½®å›ºå®šä¸å˜å¤–ï¼Œå…¶ä½™ä¸‰éƒ¨åˆ†çš„ä½ç½®éƒ½ä¸å›ºå®šã€‚\næ•´ä½“ç»“æ„å›¾å‚è€ƒéè™«å¤§ä½¬çš„å›¾ï¼š\n2.SO æ–‡ä»¶çš„åŠ è½½æ–¹æ³• Android é€šè¿‡ Java å±‚çš„Systemç±»åŠ è½½ SOï¼Œæ ¸å¿ƒæ–¹æ³•æœ‰ä¸¤ç§ï¼š\næ–¹æ³• ç­¾å ç‰¹ç‚¹ é€‚ç”¨åœºæ™¯ loadLibrary System.loadLibrary(String name) è‡ªåŠ¨æ‹¼æ¥æ–‡ä»¶åï¼ˆname â†’ libname.soï¼‰ï¼Œä»é»˜è®¤è·¯å¾„ï¼ˆå¦‚/data/app/.../libï¼‰åŠ è½½ã€‚ åº”ç”¨å†…ç½® SO çš„å¸¸è§„åŠ è½½ã€‚ load System.load(String path) éœ€ä¼ å…¥ SO çš„ç»å¯¹è·¯å¾„ï¼ˆå¦‚/sdcard/libtest.soï¼‰ã€‚ æ’ä»¶åŒ–åŠ è½½ã€åŠ¨æ€ä¸‹è½½çš„ SOã€‚ 3.SO æ–‡ä»¶çš„åŠ è½½æµç¨‹ loadLibrary åŠ è½½æµç¨‹ è°ƒç”¨ System.loadLibrary(String libName) æ—¶ï¼Œå®é™…ä¸Šä¼šè°ƒç”¨ Runtime.getRuntime().loadLibrary(String libName)ã€‚ Runtime.loadLibrary(String libName) ä¼šè¿›ä¸€æ­¥è°ƒç”¨ Runtime.loadLibrary(String libName, ClassLoader loader)ï¼Œå…¶ä¸­ loader æ˜¯å½“å‰çº¿ç¨‹çš„ç±»åŠ è½½å™¨ã€‚ é€šè¿‡ç±»åŠ è½½å™¨æ‰¾åˆ°å¯¹åº”çš„ SO æ–‡ä»¶è·¯å¾„ï¼Œç„¶åè°ƒç”¨ doLoad(String name, ClassLoader loader) æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚ load åŠ è½½æµç¨‹ è°ƒç”¨ System.load(String pathName) æ—¶ï¼Œå®é™…ä¸Šä¼šè°ƒç”¨ Runtime.getRuntime().load(String pathName)ã€‚ Runtime.load(String pathName) ä¼šè°ƒç”¨ Runtime.load(String pathName, ClassLoader loader)ï¼ŒåŒæ ·ä¼šè°ƒç”¨ doLoad(String name, ClassLoader loader) æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚ æ ¸å¿ƒåŠ è½½æµç¨‹ï¼šdoLoad è·¯å¾„å¤„ç†ï¼šdoLoad æ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„è·¯å¾„å’Œç±»åŠ è½½å™¨ï¼Œç¡®å®š SO æ–‡ä»¶çš„å®é™…è·¯å¾„ã€‚ åŠ¨æ€é“¾æ¥åº“åŠ è½½ï¼šè°ƒç”¨ dlopen å‡½æ•°åŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚ JNI_OnLoad è°ƒç”¨ï¼šå¦‚æœ SO æ–‡ä»¶ä¸­å®šä¹‰äº† JNI_OnLoad å‡½æ•°ï¼Œåˆ™åœ¨åŠ è½½å®Œæˆåè°ƒç”¨è¯¥å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚ å‚è€ƒæ–‡ä»¶ï¼š\nAndroid so(ELF)æ–‡ä»¶è§£æ\nã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹åã€ä¸æ˜¯æˆ‘è¯´ï¼Œæœ‰äº†IDAè¿˜è¦ä»€ä¹ˆå¥³æœ‹å‹ï¼Ÿ\nandroid åŠ è½½soè¿‡ç¨‹åˆ†æ\n[ctfwiki]so ä»‹ç» ","date":"2025-09-25T22:07:51+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/20250925233532.png","permalink":"https://fanshanng.cn/p/ar6/","title":"å®‰å“é€†å‘å…¥é—¨å…­ï¼šso(ELF)æ–‡ä»¶åˆ†æä¸ARMåŸºç¡€çŸ¥è¯†"},{"content":"ä¸€ã€æ‰‹æœºç«¯ä¸‹è½½å¹¶é…ç½®å…‰é€Ÿè™šæ‹Ÿæœº 3.8.2 1.ä¸‹è½½æ¨¡æ‹Ÿå™¨ï¼šåœ¨æ‰‹æœºåº”ç”¨å•†åº—æˆ–å®˜æ–¹æ¸ é“ï¼Œæœç´¢å¹¶ä¸‹è½½ â€œå…‰é€Ÿè™šæ‹Ÿæœº 3.8.2â€ ç‰ˆæœ¬ï¼Œå®‰è£…å®Œæˆåæ‰“å¼€ï¼Œæ­¤æ—¶ä¼šæŒ‡å¯¼è¿›è¡Œè§£é™¤å®‰å“è¿›ç¨‹é™åˆ¶ï¼Œè·Ÿç€æ­¥éª¤æ¥å³å¯ã€‚\n2.åˆ›å»ºå®‰å“ 10 å®ä¾‹ï¼šè¿›å…¥æ¨¡æ‹Ÿå™¨ä¸»ç•Œé¢ï¼Œç‚¹å‡» â€œæ–°å»ºå®ä¾‹â€ï¼Œåœ¨ç³»ç»Ÿç‰ˆæœ¬é€‰é¡¹ä¸­é€‰æ‹© â€œå®‰å“ 10â€ï¼Œç­‰å¾…å®ä¾‹åˆ›å»ºå®Œæˆï¼ˆè¿‡ç¨‹éœ€è€å¿ƒç­‰å¾…ï¼Œé¿å…ä¸­é€”é€€å‡º)ã€‚\n3.å¼€å¯ root ç›¸å…³æƒé™ï¼š\nè¿›å…¥å·²åˆ›å»ºçš„å®‰å“ 10 å®ä¾‹ï¼Œåœ¨å®ä¾‹æµ®çª—å†…æ‰¾åˆ° â€œè®¾ç½®â€ å›¾æ ‡ï¼Œè¿›å…¥åä¾æ¬¡å¼€å¯ â€œMagisk æ”¯æŒâ€ å’Œ â€œè¶…çº§ç”¨æˆ·â€ åŠŸèƒ½ã€‚ 4.è°ƒæ•´ç½‘ç»œè®¾ç½®ï¼š\nå› ä½¿ç”¨æ‰‹æœºè‡ªèº«æµé‡ï¼ˆè·¯ç”±å™¨ä¸æ”¯æŒè¿œç¨‹ adbï¼‰ï¼Œéœ€å…³é—­ç½‘ç»œéš”ç¦»ï¼šè¿›å…¥æµ®çª—å†…çš„ â€œè®¾ç½® - ç½‘ç»œè®¾ç½®â€ï¼Œæ‰¾åˆ° â€œæœ¬åœ°ç½‘ç»œéš”ç¦»â€ é€‰é¡¹ï¼Œå°†å…¶å…³é—­ï¼ˆé˜²æ­¢æµé‡ç½‘ç»œè¢«éš”ç¦»ï¼Œå½±å“åç»­è¿æ¥ï¼‰ã€‚ äºŒã€å®‰è£… Magisk25.0 å®Œæˆ root ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ Magiskï¼šåœ¨å®‰å“ 10 å®ä¾‹å†…ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® Magisk å®˜ç½‘æ—§ç‰ˆæœ¬é¡µé¢ï¼Œä¸‹è½½ â€œMagisk25.0â€ å®‰è£…åŒ…ï¼ˆé«˜ç‰ˆæœ¬ä¸å…¼å®¹å…‰é€Ÿè™šæ‹Ÿæœº 3.8.2ï¼Œéœ€ä¸¥æ ¼é€‰æ‹© 25.0 ç‰ˆæœ¬ï¼Œå…¶ä½™ä½ç‰ˆæœ¬æœªæ›¾å°è¯•ï¼Œå¯èƒ½ä¹Ÿæ”¯æŒï¼‰ã€‚ å®‰è£… Magiskï¼š\næ‰¾åˆ°ä¸‹è½½å¥½çš„ Magisk25.0 å®‰è£…åŒ…ï¼Œç‚¹å‡»Magiskå¤„çš„â€œå®‰è£…â€ï¼Œå¼¹å‡ºå®‰è£…ç•Œé¢åç›´æ¥ç‚¹å‡» â€œä¸‹ä¸€æ­¥â€ï¼Œåœ¨å®‰è£…æ–¹å¼ä¸­é€‰æ‹© â€œç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰â€ï¼Œç­‰å¾…å®‰è£…è¿›åº¦å®Œæˆã€‚ é‡å¯éªŒè¯ rootï¼š å®‰è£…å®Œæˆåï¼ŒæŒ‰ç…§æç¤ºé‡å¯å®‰å“ 10 å®ä¾‹ï¼›é‡å¯åå…ˆå…³é—­å®ä¾‹å†…çš„ â€œè¶…çº§ç”¨æˆ·â€ åŠŸèƒ½ï¼Œå†é‡å¯ï¼Œæ­¤æ—¶ root æ“ä½œå®Œæˆï¼ˆå¯é€šè¿‡å®ä¾‹å†…çš„ Magisk åº”ç”¨æŸ¥çœ‹ â€œå·²å®‰è£…â€ çŠ¶æ€ï¼Œç¡®è®¤ root æˆåŠŸï¼‰ã€‚ ä¸‰ã€åœ¨å®‰å“ 10 å®ä¾‹å†…å¼€å¯å¼€å‘è€…æ¨¡å¼ä¸ USB è°ƒè¯• è¿›å…¥ â€œå…³äºæ‰‹æœºâ€ï¼šåœ¨å®‰å“ 10 å®ä¾‹å†…æ‰“å¼€ â€œè®¾ç½®â€ï¼Œæ»‘åŠ¨è‡³åº•éƒ¨æ‰¾åˆ° â€œå…³äºæ‰‹æœºâ€ é€‰é¡¹ï¼Œç‚¹å‡»è¿›å…¥ã€‚\nè§¦å‘å¼€å‘è€…æ¨¡å¼ï¼šåœ¨ â€œå…³äºæ‰‹æœºâ€ é¡µé¢ä¸­ï¼Œæ‰¾åˆ° â€œç‰ˆæœ¬å·â€ é€‰é¡¹ï¼Œè¿ç»­ç‚¹å‡» 7 æ¬¡ â€œç‰ˆæœ¬å·â€ï¼Œæ­¤æ—¶ä¼šå¼¹å‡º â€œæ‚¨ç°åœ¨å¤„äºå¼€å‘è€…æ¨¡å¼ï¼â€ çš„æç¤ºï¼ˆè‹¥å¼¹å‡ºéªŒè¯å¯†ç  / æŒ‡çº¹ï¼ŒæŒ‰å®ä¾‹å†…è®¾ç½®å®ŒæˆéªŒè¯å³å¯ï¼‰ã€‚\nå¼€å¯ USB è°ƒè¯•ï¼šè¿”å› â€œè®¾ç½®â€ ä¸»ç•Œé¢ï¼Œæ‰¾åˆ° â€œç³»ç»Ÿâ€ é€‰é¡¹ï¼›ç‚¹å‡»è¿›å…¥ â€œå¼€å‘è€…é€‰é¡¹â€ï¼Œæ‰¾åˆ° â€œUSB è°ƒè¯•â€ é€‰é¡¹å¹¶å¼€å¯ï¼ˆéƒ¨åˆ†ç³»ç»Ÿéœ€å‹¾é€‰ â€œå…è®¸ USB è°ƒè¯•â€ å¼¹çª—ï¼Œç‚¹å‡» â€œç¡®å®šâ€ å³å¯ï¼‰ã€‚\nå››ã€ç”µè„‘ç«¯é€šè¿‡ adb è¿œç¨‹è¿æ¥æ‰‹æœº å‡†å¤‡å·¥ä½œï¼šç¡®ä¿ç”µè„‘å·²æå‰ä¸‹è½½å¹¶é…ç½®å¥½ adb ç¯å¢ƒï¼ˆadb å·¥å…·åŒ…è·¯å¾„å·²æ·»åŠ è‡³ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¯é€šè¿‡ â€œcmd è¾“å…¥ adb \u0026ndash;versionâ€ éªŒè¯é…ç½®ï¼‰ã€‚\nå»ºç«‹ç½‘ç»œè¿æ¥ï¼š\næ‰“å¼€æ‰‹æœºçš„ â€œä¸ªäººçƒ­ç‚¹â€ï¼Œå°†ç”µè„‘è¿æ¥è‡³è¯¥çƒ­ç‚¹ï¼ˆç¡®ä¿æ‰‹æœºä¸ç”µè„‘å¤„äºåŒä¸€çƒ­ç‚¹ç½‘ç»œï¼Œæ›¿ä»£ä¸æ”¯æŒ adb çš„è·¯ç”±å™¨ï¼‰ã€‚ è·å–æ‰‹æœº IPï¼š åœ¨æ‰‹æœº â€œè®¾ç½® - æ— çº¿å’Œç½‘ç»œ - ä¸ªäººçƒ­ç‚¹â€ ä¸­ï¼ŒæŸ¥çœ‹çƒ­ç‚¹çš„ â€œå·²è¿æ¥è®¾å¤‡â€ æˆ– â€œç½‘ç»œè¯¦æƒ…â€ï¼Œè®°å½•æ‰‹æœºå½“å‰çš„ IP åœ°å€ï¼ˆå¦‚ 10.77.xx.xxï¼‰ã€‚ æ‰§è¡Œ adb è¿æ¥å‘½ä»¤ï¼š æ‰“å¼€ç”µè„‘çš„å‘½ä»¤æç¤ºç¬¦ï¼ˆCMDï¼‰ï¼Œè¾“å…¥å‘½ä»¤ï¼šadb connect æ‰‹æœºIP:6556ï¼ˆå°† â€œæ‰‹æœº IPâ€ æ›¿æ¢ä¸ºå®é™…è®°å½•çš„åœ°å€ï¼Œå¦‚adb connect 10.77.xx.xx:6556ï¼‰ã€‚\nè‹¥ä¸€åˆ‡æ­£å¸¸æ­¤æ—¶æ‰‹æœºä¼šå¼¹å‡ºæç¤ºï¼Œç‚¹å‡»ç¡®è®¤å³å¯ã€‚\nè‹¥å‘½ä»¤è¡Œæ˜¾ç¤º â€œconnected to æ‰‹æœº IP:6556â€ï¼Œåˆ™è¡¨ç¤ºè¿œç¨‹ adb è°ƒè¯•è¿æ¥æˆåŠŸï¼Œå¯å¼€å§‹è¿›è¡Œåç»­è°ƒè¯•æ“ä½œã€‚\nä¸‹è½½ç”¨çš„æ¨¡æ‹Ÿå™¨ä»¥åŠmagiskï¼š\nhttps://pan.baidu.com/s/1ePYYJIPQXNRKJyA9qJclWA?pwd=kdcq æå–ç : kdcq\n","date":"2025-09-23T00:37:06+08:00","image":"https://s.panlai.com/upload/bizhihui_com_20231111141953169968359310619.jpg-arthumbs","permalink":"https://fanshanng.cn/p/gs/","title":"å…‰é€Ÿè™šæ‹Ÿæœº3.8.2 rootåŠadbè¿œç¨‹è¿æ¥æ“ä½œ"},{"content":"å…³é”®è¯ï¼šXposedåŸç†å’Œå¸¸ç”¨apiã€Android Studioå®‰è£…ä»¥åŠç¯å¢ƒé…ç½®ã€hookã€å€ŸåŠ©lspatchå®ç°å…rootæ³¨å…¥ã€SimpleHookå¿«é€Ÿhook\n0x00 ä»€ä¹ˆæ˜¯Xposed Xposed æ˜¯ä¸€æ¬¾æ— éœ€ä¿®æ”¹ APK å³å¯å½±å“ç¨‹åºè¿è¡Œçš„ Hook æ¡†æ¶ï¼ŒåŸºäºå®ƒå¯ä»¥å¼€å‘åŠŸèƒ½å¼ºå¤§çš„æ’ä»¶ APPï¼Œå®ç°å¯¹ç›®æ ‡åº”ç”¨çš„æ³¨å…¥ã€æ‹¦æˆªã€ä¿®æ”¹ç­‰æ“ä½œï¼Œä¸”å¤šä¸ªåŠŸèƒ½ä¸å†²çªçš„æ¨¡å—å¯åŒæ—¶è¿è¡Œã€‚\nç®€å•æ¥è¯´ï¼ŒXposed çš„æ ¸å¿ƒæ˜¯ â€œåœ¨ä¸æ”¹å˜åŸåº”ç”¨ä»£ç çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€å¹²é¢„å…¶è¿è¡Œé€»è¾‘â€ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºå®‰å“é€†å‘ã€åŠŸèƒ½æ‰©å±•çš„é‡è¦å·¥å…·ã€‚\nXposed (ç»´åŸºç™¾ç§‘)\n0x01 XposedåŸç† Xposed çš„æ ¸å¿ƒæ˜¯åŠ«æŒ Zygote è¿›ç¨‹ï¼ˆå®‰å“ç³»ç»Ÿçš„è¿›ç¨‹å­µåŒ–å™¨ï¼Œæ‰€æœ‰åº”ç”¨è¿›ç¨‹éƒ½ç”±å®ƒåˆ›å»ºï¼‰ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š\nç”¨è‡ªå®šä¹‰å®ç°çš„app_processæ›¿æ¢ç³»ç»ŸåŸç”Ÿçš„app_processï¼› åŠ è½½é¢å¤–çš„ XposedBridge.jar åŒ…ï¼Œå°†ç¨‹åºå…¥å£ä»ç³»ç»Ÿé»˜è®¤çš„com.android.internal.os.ZygoteInit.main()æ›¿æ¢ä¸ºde.robv.android.xposed.XposedBridge.main()ï¼› æ”¹é€ åçš„ Zygote è¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰ Dalvik/ART è™šæ‹Ÿæœºéƒ½ä¼šè¢« Hookï¼Œä»è€Œå®ç°å¯¹æ‰€æœ‰åº”ç”¨è¿›ç¨‹çš„åŠ¨æ€å¹²é¢„ã€‚ é€šä¿—æ¥è®²ï¼Œhookå°±æ˜¯ç‹¸çŒ«æ¢å¤ªå­\n0x02 Xposedçš„å‘å±•åŠå…rootæ¡†æ¶ éšç€å®‰å“ç‰ˆæœ¬è¿­ä»£ï¼ŒXposed è¡ç”Ÿå‡ºå¤šä¸ªåˆ†æ”¯ï¼Œä¸‹è¡¨æ•´ç†äº†ä¸»æµæ¡†æ¶çš„ç‰¹ç‚¹ï¼š\nåç§° åœ°å€ æ”¯æŒç‰ˆæœ¬ æ˜¯å¦å…root xposed https://github.com/rovo89/Xposed 2.3-8.1 å¦ EDXposed https://github.com/ElderDrivers/EdXposed 8.0-10 å¦ LSPosed https://github.com/LSPosed/LSPosed 8.1-13 å¦ VirtualXposed https://github.com/android-hacker/VirtualXposed 5.0-10.0 æ˜¯ å¤ªæ https://www.coolapk.com/apk/me.weishu.exp 5.0-13 æ˜¯ ä¸¤ä»ª https://www.coolapk.com/apk/io.twoyi 8.1-13 æ˜¯ å¤©é‰´ https://github.com/Katana-Official/SPatch-Update 6-10 æ˜¯ 0x03 Xposedå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ åŠŸèƒ½å¢å¼ºï¼šä¿®æ”¹åº”ç”¨å¸ƒå±€ï¼ˆå¦‚ä¸Šå¸æ¨¡å¼ï¼‰ã€å»é™¤å¹¿å‘Šï¼ˆå¦‚çŸ¥ä¹å»å¹¿å‘Šæ¨¡å—ï¼‰ï¼›\næ•°æ®å¹²é¢„ï¼šåŠ«æŒå‚æ•° / è¿”å›å€¼ï¼ˆå¦‚å¾®ä¿¡é˜²æ’¤å›ã€æ­¥æ•°ä¿®æ”¹ã€ä¸€é”®æ–°æœºï¼‰ï¼›\nè‡ªåŠ¨åŒ–æ“ä½œï¼šå¾®ä¿¡è‡ªåŠ¨æŠ¢çº¢åŒ…ã€æŠ–éŸ³è‡ªåŠ¨æ“ä½œç­‰ï¼›\né€†å‘è¾…åŠ©ï¼šåŠ¨æ€åˆ†æåº”ç”¨é€»è¾‘ã€ç»•è¿‡åŠ å¯† / éªŒè¯ï¼ˆå¦‚XServerï¼‰ã€‚\n2022 æœ€å¥½çš„Xposedæ¨¡å—: GravityBox, Pixelify, XPrivacyLua\nåŸºäºXposedçš„æŠ–éŸ³çˆ¬è™«ï¼ŒæŠ–éŸ³é£æ§åè‡ªåŠ¨ä¸€é”®æ–°æœºï¼Œæ¨¡æ‹Ÿä¸€ä¸ªå…¨æ–°çš„è¿è¡Œç¯å¢ƒ\nåŸºäºxposedçš„fridaæŒä¹…åŒ–æ–¹æ¡ˆ\nA Xposed Module for Android Penetration Test, with NanoHttpd.\nGravityBox\nXposed-Modules-Repo]\nä¸€ä¸ªæ—¨åœ¨ä½¿QQå˜å¾—æ›´å¥½ç”¨çš„å¼€æºXposedæ¨¡å—\næœæ¯”å¤§å–‡å­\nå“”å“©æ¼«æ¸¸\næ›²å¢ƒ\nè‡ªåŠ¨åŒ–åˆ›å»ºXposedæ¨¡å—åŠé’©å­ï¼Œè®©Xposedæ¨¡å—ç¼–å†™æ—¶åªéœ€å…³æ³¨é’©å­å®ç°\n0x04 Xposedç¯å¢ƒé…ç½® è¿™é‡Œä¸‹è½½çš„æ˜¯æ­£å·±æä¾›çš„Ubuntuè™šæ‹Ÿæœº å¯†ç :toor\nå†…ç½®:\nFridaå¼€å‘ç¯å¢ƒ åŠ¨æ€åˆ†æåŠå¼€å‘å·¥å…·ï¼šandroid-studio åŠ¨æ€åˆ†æå·¥å…·ï¼šddms é™æ€åˆ†æå·¥å…·ï¼šjadx1.4.4 åŠ¨é™æ€åˆ†æå·¥å…·ï¼šjeb åŠ¨æ€åˆ†æå·¥å…·ï¼šé›†æˆHyperPwn é™æ€åˆ†æå·¥å…·ï¼š010 editor æŠ“åŒ…å·¥å…·ï¼šCharles æŠ“åŒ…å·¥å…·ï¼šWireShark åŠ¨æ€åˆ†æå·¥å…·:unidbg 1.Android Studioåˆ›å»ºæ–°é¡¹ç›®\n2.å°†ä¸‹è½½çš„xposedBridgeApi.jaråŒ…æ‹–è¿›libsæ–‡ä»¶å¤¹\n3.å³å‡»jaråŒ…ï¼Œé€‰æ‹©add as library\n4.ä¿®æ”¹AndroidManifest.xmlæ–‡ä»¶é…ç½®\nå°†å¦‚ä¸‹ä»£ç å¤åˆ¶åˆ°xmlæ–‡ä»¶ä¸­ï¼Œå¦‚å›¾\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;!-- æ˜¯å¦æ˜¯xposedæ¨¡å—ï¼Œxposedæ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­æ˜¯å¦æ˜¯æ¨¡å— --\u0026gt; \u0026lt;meta-data android:name=\u0026#34;xposedmodule\u0026#34; android:value=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;!-- æ¨¡å—æè¿°ï¼Œæ˜¾ç¤ºåœ¨xposedæ¨¡å—åˆ—è¡¨é‚£é‡Œç¬¬äºŒè¡Œ --\u0026gt; \u0026lt;meta-data android:name=\u0026#34;xposeddescription\u0026#34; android:value=\u0026#34;è¿™æ˜¯ä¸€ä¸ªXposedæ¨¡å—\u0026#34; /\u0026gt; \u0026lt;!-- æœ€ä½xposedç‰ˆæœ¬å·(libæ–‡ä»¶åå¯çŸ¥) --\u0026gt; \u0026lt;meta-data android:name=\u0026#34;xposedminversion\u0026#34; android:value=\u0026#34;89\u0026#34; /\u0026gt; 5.ä¿®æ”¹build.gradle,å°†æ­¤å¤„ä¿®æ”¹ä¸ºcompileOnly é»˜è®¤çš„æ˜¯implementation\nimplementation ä½¿ç”¨è¯¥æ–¹å¼ä¾èµ–çš„åº“å°†ä¼šå‚ä¸ç¼–è¯‘å’Œæ‰“åŒ…\ncompileOnly åªåœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼Œä¸ä¼šå‚ä¸æ‰“åŒ…\n6.æ–°å»º\u0026ndash;\u0026gt;Folder\u0026ndash;\u0026gt;Assets Folderï¼Œåˆ›å»ºxposed_init(ä¸è¦åç¼€å):åªæœ‰ä¸€è¡Œä»£ç ï¼Œå°±æ˜¯è¯´æ˜å…¥å£ç±»\n7.æ–°å»ºHookç±»ï¼Œå®ç°IXposedHookLoadPackageæ¥å£ï¼Œç„¶ååœ¨handleLoadPackageå‡½æ•°å†…ç¼–å†™Hooké€»è¾‘\n1 2 3 4 5 6 7 8 9 import de.robv.android.xposed.IXposedHookLoadPackage; import de.robv.android.xposed.callbacks.XC_LoadPackage; public class Hook implements IXposedHookLoadPackage { @Override public void handleLoadPackage(XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable { } } ç»§æ‰¿äº†IXposedHookLoadPackagä¾¿æ‹¥æœ‰äº†hookçš„èƒ½åŠ›\n0x05 Xposedå¸¸ç”¨API 1.Hookæ™®é€šæ–¹æ³• ä¿®æ”¹è¿”å›å€¼\n1 2 3 4 5 6 7 XposedHelpers.findAndHookMethod(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, loadPackageParam.classLoader, \u0026#34;a\u0026#34;, String.class, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); param.setResult(999); } }); ä¿®æ”¹å‚æ•°\n1 2 3 4 5 6 7 XposedHelpers.findAndHookMethod(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, loadPackageParam.classLoader, \u0026#34;a\u0026#34;, String.class, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); String a = \u0026#34;pt\u0026#34;; param.args[0] = a; } }); 2.Hookå¤æ‚\u0026amp;è‡ªå®šä¹‰å‚æ•° 1 2 3 4 5 6 7 8 Class a = loadPackageParam.classLoader.loadClass(\u0026#34;ç±»å\u0026#34;); XposedBridge.hookAllMethods(a, \u0026#34;æ–¹æ³•å\u0026#34;, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); } }); 3.Hookæ›¿æ¢å‡½æ•° ä½¿ç”¨XC_MethodReplacementç›´æ¥æ›¿æ¢åŸæ–¹æ³•ï¼š\n1 2 3 4 5 6 7 Class a = classLoader.loadClass(\u0026#34;ç±»å\u0026#34;) XposedBridge.hookAllMethods(a,\u0026#34;æ–¹æ³•å\u0026#34;,new XC_MethodReplacement() { @Override protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable { return \u0026#34;\u0026#34;; } }); ä¸Šå›¾ä¸­æ—¥å¿—è¿™é‡Œçš„ â€œè¿™æ˜¯æ›¿æ¢å‡½æ•°â€ å°±è¢«æ›¿æ¢æ— äº†\n4.HookåŠ å›ºé€šæ€ åŠ å›ºåº”ç”¨ä¼šåŠ¨æ€åŠ è½½ dexï¼Œéœ€åœ¨Application.attachæ—¶è·å–åŠ è½½åçš„ç±»åŠ è½½å™¨ï¼š\n1 2 3 4 5 6 7 8 XposedHelpers.findAndHookMethod(Application.class, \u0026#34;attach\u0026#34;, Context.class, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { Context context = (Context) param.args[0]; ClassLoader classLoader = context.getClassLoader(); //hooké€»è¾‘åœ¨è¿™é‡Œé¢å†™ } }); 5.Hookå˜é‡ é™æ€å˜é‡ä¸å®ä¾‹å˜é‡ é™æ€å˜é‡(static)ï¼šç±»è¢«åˆå§‹åŒ–ï¼ŒåŒæ­¥è¿›è¡Œåˆå§‹åŒ– éé™æ€å˜é‡ï¼šç±»è¢«å®ä¾‹åŒ–(äº§ç”Ÿä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™)ï¼Œè¿›è¡Œåˆå§‹åŒ– 6.Hookæ„é€ å‡½æ•° æ— å‚æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 XposedHelpers.findAndHookConstructor(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, classLoader, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); } @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); } }); æœ‰å‚æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 XposedHelpers.findAndHookConstructor(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, classLoader, String.class, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); } @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); } }); 7.Hook multiDexæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 XposedHelpers.findAndHookMethod(Application.class, \u0026#34;attach\u0026#34;, Context.class, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { ClassLoader cl= ((Context)param.args[0]).getClassLoader(); Class\u0026lt;?\u0026gt; hookclass=null; try { hookclass=cl.loadClass(\u0026#34;ç±»å\u0026#34;); }catch (Exception e){ Log.e(\u0026#34;zj2595\u0026#34;,\u0026#34;æœªæ‰¾åˆ°ç±»\u0026#34;,e); return; } XposedHelpers.findAndHookMethod(hookclass, \u0026#34;æ–¹æ³•å\u0026#34;, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { } }); } }); 8.ä¸»åŠ¨è°ƒç”¨ é™æ€æ–¹æ³•\n1 2 Class clazz = XposedHelpers.findClass(\u0026#34;ç±»å\u0026#34;,lpparam.classLoader); XposedHelpers.callStaticMethod(clazz,\u0026#34;æ–¹æ³•å\u0026#34;,å‚æ•°(éå¿…é¡»)); å®ä¾‹æ–¹æ³•\n1 2 Class clazz = XposedHelpers.findClass(\u0026#34;ç±»å\u0026#34;,lpparam.classLoader); XposedHelpers.callMethod(clazz.newInstance(),\u0026#34;æ–¹æ³•å\u0026#34;,å‚æ•°(éå¿…é¡»)); 9.Hookå†…éƒ¨ç±» å†…éƒ¨ç±»åæ ¼å¼ä¸ºå¤–éƒ¨ç±»$å†…éƒ¨ç±»ï¼ˆå¦‚com.zj.wuaipojie.Demo$InnerClassï¼‰\n1 2 3 4 5 6 7 XposedHelpers.findAndHookMethod(\u0026#34;com.zj.wuaipojie.Demo$InnerClass\u0026#34;, lpparam.classLoader, \u0026#34;innerFunc\u0026#34;,String.class, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); } }); 10.åå°„å¤§æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Class clazz = XposedHelpers.findClass(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, lpparam.classLoader); XposedHelpers.findAndHookMethod(\u0026#34;com.zj.wuaipojie.Demo$InnerClass\u0026#34;, lpparam.classLoader, \u0026#34;innerFunc\u0026#34;,String.class, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); //ç¬¬ä¸€æ­¥æ‰¾åˆ°ç±» //æ‰¾åˆ°æ–¹æ³•ï¼Œå¦‚æœæ˜¯ç§æœ‰æ–¹æ³•å°±è¦setAccessibleè®¾ç½®è®¿é—®æƒé™ //invokeä¸»åŠ¨è°ƒç”¨æˆ–è€…setä¿®æ”¹å€¼(å˜é‡) Class democlass = Class.forName(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;,false,lpparam.classLoader); Method demomethod = democlass.getDeclaredMethod(\u0026#34;refl\u0026#34;); demomethod.setAccessible(true); demomethod.invoke(clazz.newInstance()); } }); 11.éå†æ‰€æœ‰ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 XposedHelpers.findAndHookMethod(ClassLoader.class, \u0026#34;loadClass\u0026#34;, String.class, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); Class clazz = (Class) param.getResult(); String clazzName = clazz.getName(); //æ’é™¤éåŒ…åçš„ç±» if(clazzName.contains(\u0026#34;com.zj.wuaipojie\u0026#34;)){ Method[] mds = clazz.getDeclaredMethods(); for(int i =0;i\u0026lt;mds.length;i++){ final Method md = mds[i]; int mod = mds[i].getModifiers(); //å»é™¤æŠ½è±¡ã€nativeã€æ¥å£æ–¹æ³• if(!Modifier.isAbstract(mod) \u0026amp;\u0026amp; !Modifier.isNative(mod) \u0026amp;\u0026amp;!Modifier.isAbstract(mod)){ XposedBridge.hookMethod(mds[i], new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); Log.d(\u0026#34;zj2595\u0026#34;,md.toString()); } }); } } } } }); 0x06 Xposedå¦™ç”¨ å­—ç¬¦ä¸²èµ‹å€¼å®šä½:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 XposedHelpers.findAndHookMethod(\u0026#34;android.widget.TextView\u0026#34;, lpparam.classLoader, \u0026#34;setText\u0026#34;, CharSequence.class, new XC_MethodHook() { @Override protected void beforeHookedMethod(MethodHookParam param) throws Throwable { super.beforeHookedMethod(param); Log.d(\u0026#34;zj2595\u0026#34;,param.args[0].toString()); if(param.args[0].equals(\u0026#34;å·²è¿‡æœŸ\u0026#34;)){ printStackTrace(); } } }); private static void printStackTrace() { Throwable ex = new Throwable(); StackTraceElement[] stackElements = ex.getStackTrace(); for (int i = 0; i \u0026lt; stackElements.length; i++) { StackTraceElement element = stackElements[i]; Log.d(\u0026#34;zj2595\u0026#34;,\u0026#34;at \u0026#34; + element.getClassName() + \u0026#34;.\u0026#34; + element.getMethodName() + \u0026#34;(\u0026#34; + element.getFileName() + \u0026#34;:\u0026#34; + element.getLineNumber() + \u0026#34;)\u0026#34;); } } ç‚¹å‡»äº‹ä»¶ç›‘å¬\n1 2 3 4 5 6 7 8 9 10 11 Class clazz = XposedHelpers.findClass(\u0026#34;android.view.View\u0026#34;, lpparam.classLoader); XposedBridge.hookAllMethods(clazz, \u0026#34;performClick\u0026#34;, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); Object listenerInfoObject = XposedHelpers.getObjectField(param.thisObject, \u0026#34;mListenerInfo\u0026#34;); Object mOnClickListenerObject = XposedHelpers.getObjectField(listenerInfoObject, \u0026#34;mOnClickListener\u0026#34;); String callbackType = mOnClickListenerObject.getClass().getName(); Log.d(\u0026#34;zj2595\u0026#34;,callbackType); } }); æ”¹å†™å¸ƒå±€\nåœ¨ Activity åˆå§‹åŒ–åä¿®æ”¹ UI å…ƒç´ ï¼ˆå¦‚éšè—å›¾ç‰‡ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 XposedHelpers.findAndHookMethod(\u0026#34;com.zj.wuaipojie.ui.ChallengeSixth\u0026#34;, lpparam.classLoader, \u0026#34;onCreate\u0026#34;, Bundle.class, new XC_MethodHook() { @Override protected void afterHookedMethod(MethodHookParam param) throws Throwable { super.afterHookedMethod(param); View img = (View)XposedHelpers.callMethod(param.thisObject, \u0026#34;findViewById\u0026#34;, 0x7f0800de); img.setVisibility(View.GONE); } }); ä¿®æ”¹å‰ ä¿®æ”¹å 0x07 Lsposed å…rootå®ç° Lsposedï¼šLSPosed æ¡†æ¶çš„æ—  Root å®ç°æ–¹æ¡ˆï¼Œé€šè¿‡å°† dex æ–‡ä»¶ä¸ so æ–‡ä»¶æ’å…¥åˆ°ç›®æ ‡ APKï¼ˆå®‰å“åº”ç”¨å®‰è£…åŒ…ï¼‰ä¸­ï¼Œå®ç° Xposed APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰çš„é›†æˆã€‚ æ ¸å¿ƒåŸç†ï¼šé‡æ‰“åŒ…ç›®æ ‡ APKï¼Œå°†æ¨¡å—ä»£ç é›†æˆåˆ°å…¶ä¸­ï¼Œé¿å…å¯¹ç³»ç»Ÿç¯å¢ƒçš„ä¾èµ–ã€‚ 0x07 Xposedå¿«é€ŸHook\u0026mdash;\u0026ndash;SimpleHook SimpleHook æ˜¯ GitHub ç”¨æˆ· littleWhiteDuck å¼€å‘çš„ä¸€æ¬¾ Android è½»é‡å‹ Hook å·¥å…·ï¼Œæ ¸å¿ƒå®šä½æ˜¯ â€œç®€å•æ˜“ç”¨â€â€”â€” æ— éœ€å¤æ‚é…ç½®å³å¯å®ç°å¸¸è§ Hook éœ€æ±‚ï¼Œé€‚åˆå¯¹ Hook æ“ä½œå¤æ‚åº¦è¦æ±‚ä½çš„ç”¨æˆ·ï¼›è‹¥éœ€å¤æ‚åŠŸèƒ½ï¼ˆå¦‚è‡ªå®šä¹‰è„šæœ¬ï¼‰æˆ–æ›´å¤šæ‰©å±•èƒ½åŠ›ï¼Œå®˜æ–¹æ¨èæ­é… jshookï¼ˆå¤æ‚åŠŸèƒ½ï¼‰ã€æ›²å¢ƒï¼ˆç”µè„‘ç«¯æµè§ˆå™¨æ“ä½œï¼‰æˆ–ç®—æ³•åŠ©æ‰‹ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰ä½¿ç”¨ã€‚\nä½¿ç”¨æ­¥éª¤ï¼š åœ¨ LSPosed ä¸­å¯ç”¨ SimpleHook æ¨¡å—ï¼› é€‰æ‹©ç›®æ ‡åº”ç”¨ï¼Œæ·»åŠ  Hook é…ç½®ï¼ˆç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ç­‰ï¼‰ï¼› é‡å¯åº”ç”¨ï¼Œé…ç½®ç”Ÿæ•ˆã€‚ å·¥å…·è¦†ç›–å¤šç§å¸¸è§ Hook åœºæ™¯ï¼Œéƒ¨åˆ†å…³é”®æ¨¡å¼åŠç¤ºä¾‹å¦‚ä¸‹ï¼š\næ¨¡å¼ç±»å‹ åŠŸèƒ½è¯´æ˜ å…³é”®ç‰¹ç‚¹ Hook è¿”å›å€¼ ä¿®æ”¹ç›®æ ‡æ–¹æ³•çš„è¿”å›ç»“æœï¼Œæ”¯æŒåŸºæœ¬ç±»å‹ï¼ˆå¦‚ booleanã€intï¼‰ã€å­—ç¬¦ä¸²åŠ null å‚æ•°ç±»å‹ç•™ç©ºè¡¨ç¤ºæ— å‚ï¼Œå¤šå‚æ•°ç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼ˆå¦‚ java.lang.String,intï¼‰ Hook è¿”å›å€¼ + è¿›é˜¶åŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡ JSON æ ¼å¼å°†æ•°æ®è½¬ä¸ºç›®æ ‡å¯¹è±¡ï¼ˆä¾èµ– Gsonï¼‰ éœ€å¡«å†™ â€œè¿”å›å€¼ç±»åâ€ï¼Œä¿®æ”¹å€¼ä¸º JSON å­—ç¬¦ä¸²ï¼ˆå¦‚ {\u0026quot;isHook\u0026quot;:false,\u0026quot;level\u0026quot;:10000}ï¼‰ Hook å‚æ•°å€¼ ä¿®æ”¹ç›®æ ‡æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼Œæ”¯æŒéƒ¨åˆ†å‚æ•°æˆ–å…¨éƒ¨å‚æ•°ä¿®æ”¹ æœªä¿®æ”¹çš„å‚æ•°ç•™ç©ºï¼ˆå¦‚ä»…æ”¹ç¬¬ 2ã€3 ä¸ªå‚æ•°ï¼Œä¿®æ”¹å€¼å¡« ,å•¦å•¦å•¦,99ï¼‰ ä¸­æ–­æ‰§è¡Œ æ‹¦æˆªç›®æ ‡æ–¹æ³•æ‰§è¡Œï¼Œä½¿å…¶ä¸è§¦å‘åŸæœ‰é€»è¾‘ æ— éœ€å¡«å†™ä¿®æ”¹å€¼ï¼Œä»…éœ€é…ç½®ç±»åã€æ–¹æ³•ååŠå‚æ•°ç±»å‹ ç‰¹æ®Šæ–¹æ³• Hook - æ„é€ æ–¹æ³•ï¼šæ–¹æ³•åå¡«å†™ \u0026lt;init\u0026gt;- æ‰€æœ‰åŒåæ–¹æ³•ï¼šå‚æ•°ç±»å‹å¡« *- ç±»å†…æ‰€æœ‰æ–¹æ³•ï¼šæ–¹æ³•åå¡« * é€‚é…ä¸åŒåœºæ™¯ä¸‹çš„æ‰¹é‡æˆ–ç‰¹æ®Šæ–¹æ³• Hook éœ€æ±‚ å˜é‡ Hook - é™æ€å˜é‡ï¼šæ”¯æŒ before/after ä¸¤ä¸ª Hook ç‚¹ï¼ˆæ–¹æ³•æ‰§è¡Œå‰åä¿®æ”¹ï¼‰- å®ä¾‹å˜é‡ï¼šä»…æ”¯æŒåœ¨æœ¬ç±»æ–¹æ³•æ‰§è¡Œåä¿®æ”¹ï¼Œä¸å¯è·¨ç±» ä»…æ”¯æŒåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼Œéœ€å¡«å†™ â€œå˜é‡æ‰€åœ¨ç±»åâ€â€œå˜é‡åâ€ è®°å½•ç±»æ¨¡å¼ï¼ˆ3 ç§ï¼‰ è®°å½•å‚æ•°å€¼ã€è®°å½•è¿”å›å€¼ã€è®°å½•å‚è¿”ï¼ˆå‚æ•° + è¿”å›å€¼ï¼‰ æ•°ç»„æˆ– List ç±»å‹å‚æ•° / è¿”å›å€¼ä¼šè‡ªåŠ¨è½¬ä¸º JSON æ ¼å¼ï¼Œä¾¿äºæŸ¥çœ‹ è¯¥è½¯ä»¶è¿˜æ»¡è¶³è‡ªå®šä¹‰hookï¼Œå…·ä½“ç»†èŠ‚è¯·å‰å¾€SimpleHookå­¦ä¹ ã€‚\nå‚è€ƒæ–‡æ¡£ ã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹ä¸ƒã€Sorryï¼Œä¼šHookçœŸçš„å¯ä»¥ä¸ºæ‰€æ¬²ä¸º-Xposedå¿«é€Ÿä¸Šæ‰‹(ä¸Š)\nã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹å…«ã€Sorryï¼Œä¼šHookçœŸçš„å¯ä»¥ä¸ºæ‰€æ¬²ä¸º-xposedå¿«é€Ÿä¸Šæ‰‹(ä¸‹)\næºç ç¼–è¯‘ï¼ˆ2ï¼‰â€”â€”Xopsedæºç ç¼–è¯‘è¯¦è§£ Xposed HookæŠ€å·§ï¼Œä»£{è¿‡}{æ»¤}ç†abstract Xposed callMethod å¦‚ä½•ä¼ å…¥æ¥å£å‚æ•°\nXPOSEDé­”æ”¹ä¸€ï¼šè·å–ç‰¹å¾ Lsposed æŠ€æœ¯åŸç†æ¢è®¨ \u0026amp;\u0026amp; åŸºæœ¬å®‰è£…ä½¿ç”¨\n","date":"2025-09-21T23:31:39+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/20250921233613.png","permalink":"https://fanshanng.cn/p/ar5/","title":"å®‰å“é€†å‘å…¥é—¨äº”ï¼šXposedå’Œhookå…¥é—¨"},{"content":"å®‰å“é€†å‘å…¥é—¨å›› å…³é”®è¯ï¼šapkç­¾åã€apkæ ¡éªŒåŠå¯¹æŠ—æ–¹æ³•ã€PMä»£ç†ã€ioé‡å®šå‘\nå­¦ä¹ é“¾æ¥ï¼šhttps://www.52pojie.cn/thread-1731181-1-1.html\n0x00 APKç­¾å æ ¡éªŒæ˜¯å¼€å‘è€…åœ¨æ•°æ®ä¼ é€æ—¶é‡‡ç”¨çš„ä¸€ç§æ ¡æ­£æ•°æ®çš„ä¸€ç§æ–¹å¼ å¸¸è§çš„æ ¡éªŒæœ‰:ç­¾åæ ¡éªŒ(æœ€å¸¸è§)ã€dexcrcæ ¡éªŒã€apkå®Œæ•´æ€§æ ¡éªŒã€è·¯å¾„æ–‡ä»¶æ ¡éªŒç­‰\nä»€ä¹ˆæ˜¯APKç­¾å? æˆ‘å»ºè®®ç›´æ¥å»çœ‹ Android å®˜æ–¹æ–‡æ¡£ ä¸­å…³äº APKç­¾å çš„å®‰å…¨ç‰¹æ€§ä»‹ç»ã€‚\nAPKç­¾åæ˜¯å¼€å‘è€…ä½¿ç”¨ç§é’¥å¯¹å®‰å“åº”ç”¨è¿›è¡Œæ•°å­—ç­¾åçš„è¿‡ç¨‹ï¼Œç¡®ä¿åº”ç”¨çš„å®Œæ•´æ€§å’Œæ¥æºï¼Œé˜²æ­¢è¢«ç¯¡æ”¹ã€‚åªæœ‰ç»è¿‡ç­¾åçš„åº”ç”¨æ‰èƒ½åœ¨å®‰å“è®¾å¤‡ä¸Šå®‰è£…å’Œè¿è¡Œï¼Œç­¾åè¿˜å¸®åŠ©ç³»ç»Ÿè¯†åˆ«åº”ç”¨çš„å¼€å‘è€…ï¼Œå¹¶ç¡®ä¿åº”ç”¨åœ¨ç‹¬ç«‹çš„æ²™ç›’ç¯å¢ƒä¸­å®‰å…¨è¿è¡Œã€‚ Android ç›®å‰æ”¯æŒä»¥ä¸‹å››ç§åº”ç”¨ç­¾åæ–¹æ¡ˆï¼š v1 æ–¹æ¡ˆï¼šåŸºäº JAR ç­¾åã€‚ v2 æ–¹æ¡ˆï¼šAPK ç­¾åæ–¹æ¡ˆ v2ï¼ˆåœ¨ Android 7.0 ä¸­å¼•å…¥ï¼‰ v3 æ–¹æ¡ˆï¼šAPK ç­¾åæ–¹æ¡ˆ v3ï¼ˆåœ¨ Android 9 ä¸­å¼•å…¥ï¼‰ v4 æ–¹æ¡ˆï¼šAPK ç­¾åæ–¹æ¡ˆ v4ï¼ˆåœ¨ Android 11 ä¸­å¼•å…¥ï¼‰ ç­¾åæ–¹æ¡ˆ æ¨å‡ºç‰ˆæœ¬ æ ¡éªŒèŒƒå›´ å®‰å…¨ä¼˜åŠ¿ å±€é™æ€§ é€‚ç”¨åœºæ™¯ v1ï¼ˆJAR ç­¾åï¼‰ Android 1.0 ä»…æ ¡éªŒ APK å†…å•ä¸ªæ–‡ä»¶ï¼ˆMETA-INF ä¸‹ç­¾åæ–‡ä»¶ï¼‰ å…¼å®¹æ‰€æœ‰å®‰å“ç‰ˆæœ¬ å¯ç¯¡æ”¹æœªç­¾åæ–‡ä»¶ï¼ˆå¦‚æ–°å¢æ–‡ä»¶ï¼‰ éœ€å…¼å®¹ Android 6.0 åŠä»¥ä¸‹è®¾å¤‡ v2 Android 7.0 æ ¡éªŒæ•´ä¸ª APKï¼ˆé€šè¿‡ â€œç­¾åå—â€ æ ¡éªŒ APK å®Œæ•´æ€§ï¼‰ æ›´é«˜æ•ˆï¼ˆæ— éœ€è§£å‹ï¼‰ã€é˜²ç¯¡æ”¹æ–°å¢æ–‡ä»¶ ä¸å…¼å®¹ Android 6.0 åŠä»¥ä¸‹ ç›®æ ‡è®¾å¤‡ä¸º Android 7.0+ v3 Android 9.0 åœ¨ v2 åŸºç¡€ä¸Šæ”¯æŒ â€œç­¾åè½®æ¢â€ï¼ˆæ›´æ¢ç­¾åæ— éœ€å¸è½½æ—§ç‰ˆï¼‰ æ”¯æŒç­¾åæ›´æ–°ï¼ˆå¦‚ä¼ä¸šåº”ç”¨æ¢è¯ä¹¦ï¼‰ ä¾èµ– Android 9.0+ éœ€è¦ç­¾åæ›´æ–°çš„åº”ç”¨ï¼ˆå¦‚ä¼ä¸šçº§ APPï¼‰ v4 Android 11.0 ç”Ÿæˆå•ç‹¬çš„ç­¾åæ–‡ä»¶ï¼ˆ.apksigï¼‰ï¼Œæ”¯æŒå¢é‡æ›´æ–°æ ¡éªŒ ä¼˜åŒ–å¤§æ–‡ä»¶å®‰è£…æ•ˆç‡ï¼ˆä»…æ ¡éªŒå˜æ›´éƒ¨åˆ†ï¼‰ ä¾èµ– Android 11.0+ å¤§å‹åº”ç”¨ï¼ˆå¦‚æ¸¸æˆï¼‰çš„å¢é‡æ›´æ–° v4ç­¾åç”Ÿæˆçš„.apksigæ–‡ä»¶å¿…é¡»é…åˆadb install --incrementalä½¿ç”¨ï¼Œå¸¸è§„APKå®‰è£…ä¸ä¼šè§¦å‘æ­¤æ ¡éªŒã€‚é€†å‘ä¸­è¾ƒå°‘é‡åˆ°ï¼Œä¸»è¦ç”¨äºGoogle Playå¢é‡æ›´æ–°ã€‚ ä¸€æ¬¡è®©ä½ ææ‡‚Androidåº”ç”¨ç­¾å è¿™ç¯‡æ–‡ç« è®²äº†ç­¾åæ­¥éª¤å’ŒåŸç†ç›¸å…³çŸ¥è¯†ï¼Œå€¼å¾—ä¸€çœ‹ APP çš„ç­¾åæ£€éªŒ ç³»ç»Ÿæ›´å¤šçš„åªæ˜¯å¯¹ APK åšå®Œæ•´æ€§æ ¡éªŒï¼Œèº«ä»½æ ¡éªŒå¾ˆå®¹æ˜“é€šè¿‡å¸è½½æ–¹å¼æ¥è§£å†³ï¼Œå› æ­¤è®¸å¤š APP ä¸ºäº†é˜²æ­¢è‡ªèº«è¢«ä¿®æ”¹å’Œç ´è§£ï¼Œä¼šå¯¹è‡ªèº«è¿›è¡Œé¢å¤–çš„æ ¡éªŒï¼Œç¡®ä¿æ²¡æœ‰è¢«ä¿®æ”¹ã€‚\næˆ‘ä»¬ä¸€èˆ¬ç§°æ­¤ç±»æ£€æŸ¥è‡ªèº«æ˜¯å¦è¢«ä¿®æ”¹çš„ä¿æŠ¤æŠ€æœ¯ä¸ºç­¾åæ ¡éªŒï¼Œå…¶æ ¡éªŒåŸç†å‡ ä¹ä¹Ÿéƒ½æ˜¯åŸºäºæ–‡ä»¶å®Œæ•´æ€§æ£€éªŒä¸ç­¾åèº«ä»½ä¿¡æ¯éªŒè¯ã€‚\n1 2 3 4 5 kill/killProcess-----kill/KillProcess()å¯ä»¥æ€æ­»å½“å‰åº”ç”¨æ´»åŠ¨çš„è¿›ç¨‹ï¼Œè¿™ä¸€æ“ä½œå°†ä¼šæŠŠæ‰€æœ‰è¯¥è¿›ç¨‹å†…çš„èµ„æºï¼ˆåŒ…æ‹¬çº¿ç¨‹å…¨éƒ¨æ¸…ç†æ‰ï¼‰.å½“ç„¶ï¼Œç”±äºActivityManageræ—¶åˆ»ç›‘å¬ç€è¿›ç¨‹ï¼Œä¸€æ—¦å‘ç°è¿›ç¨‹è¢«éæ­£å¸¸Killï¼Œå®ƒå°†ä¼šè¯•å›¾å»é‡å¯è¿™ä¸ªè¿›ç¨‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œæœ‰æ—¶å€™å½“æˆ‘ä»¬è¯•å›¾è¿™æ ·å»ç»“æŸæ‰åº”ç”¨æ—¶ï¼Œå‘ç°å®ƒåˆè‡ªåŠ¨é‡æ–°å¯åŠ¨çš„åŸå› . system.exit-----æ€æ­»äº†æ•´ä¸ªè¿›ç¨‹ï¼Œè¿™æ—¶å€™æ´»åŠ¨æ‰€å çš„èµ„æºä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚ finish----------ä»…ä»…é’ˆå¯¹Activityï¼Œå½“è°ƒç”¨finish()æ—¶ï¼Œåªæ˜¯å°†æ´»åŠ¨æ¨å‘åå°ï¼Œå¹¶æ²¡æœ‰ç«‹å³é‡Šæ”¾å†…å­˜ï¼Œæ´»åŠ¨çš„èµ„æºå¹¶æ²¡æœ‰è¢«æ¸…ç† æ™®é€šè·å–ç­¾åæ ¡éªŒä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 private boolean SignCheck() { String trueSignMD5 = \u0026#34;d0add9987c7c84aeb7198c3ff26ca152\u0026#34;; String nowSignMD5 = \u0026#34;\u0026#34;; try { // å¾—åˆ°ç­¾åçš„MD5 PackageInfo packageInfo = getPackageManager().getPackageInfo(getPackageName(),PackageManager.GET_SIGNATURES); Signature[] signs = packageInfo.signatures; String signBase64 = Base64Util.encodeToString(signs[0].toByteArray()); nowSignMD5 = MD5Utils.MD5(signBase64); } catch (PackageManager.NameNotFoundException e) { e.printStackTrace(); } return trueSignMD5.equals(nowSignMD5); } ç³»ç»Ÿå°†åº”ç”¨çš„ç­¾åä¿¡æ¯å°è£…åœ¨PackageInfoä¸­ï¼Œè°ƒç”¨ PackageManager çš„getPackageInfo(String packageName, int flags)å³å¯è·å–æŒ‡å®šåŒ…åçš„ç­¾åä¿¡æ¯.\n0x01 ç­¾åæ ¡éªŒå¯¹æŠ— æ–¹æ³•ä¸€:æ ¸å¿ƒç ´è§£æ’ä»¶ï¼Œä¸ç­¾åå®‰è£…åº”ç”¨ æ–¹æ³•äºŒ:ä¸€é”®è¿‡ç­¾åå·¥å…·ï¼Œä¾‹å¦‚MTã€NPã€ARMProã€CNFIXã€Modexçš„å»é™¤ç­¾åæ ¡éªŒåŠŸèƒ½ æ–¹æ³•ä¸‰:å…·ä½“åˆ†æç­¾åæ ¡éªŒé€»è¾‘(æ‰‹æ’•ç­¾åæ ¡éªŒ) æ–¹æ³•å››:ioé‡å®šå‘\u0026ndash;VA\u0026amp;SVCï¼šptrace+seccomp SVCçš„TraceHookæ²™ç®±çš„å®ç°\u0026amp;æ— ç—•Hookå®ç°æ€è·¯ æ–¹æ³•äº”:å»ä½œè€…å®¶ä¸¥åˆ‘æ‹·æ‰“æ‹¿åˆ°.jksæ–‡ä»¶å’Œå¯†ç \n0x02 æ‰‹åŠ¨å®ç°PMä»£{è¿‡}{æ»¤}ç† 1.ä»€ä¹ˆæ˜¯PMS æ€è·¯æºè‡ªï¼šAndroidä¸­Hook åº”ç”¨ç­¾åæ–¹æ³•\nPackageManagerServiceï¼ˆç®€ç§°PMSï¼‰ï¼Œæ˜¯Androidç³»ç»Ÿæ ¸å¿ƒæœåŠ¡ä¹‹ä¸€ï¼Œå¤„ç†åŒ…ç®¡ç†ç›¸å…³çš„å·¥ä½œï¼Œå¸¸è§çš„æ¯”å¦‚å®‰è£…ã€å¸è½½åº”ç”¨ç­‰ã€‚\næ ¸å¿ƒåŸç†\nå®‰å“åº”ç”¨è·å–ç­¾åçš„æµç¨‹ï¼šåº”ç”¨è°ƒç”¨PackageManager.getPackageInfo() â†’ ç³»ç»Ÿé€šè¿‡PMSï¼ˆPackageManagerServiceï¼‰æŸ¥è¯¢ç­¾åä¿¡æ¯å¹¶è¿”å›ï¼› PM ä»£ç†çš„æœ¬è´¨ï¼šé€šè¿‡ Hook æ›¿æ¢PMSçš„è¿”å›ç»“æœ â€”â€” å½“åº”ç”¨æŸ¥è¯¢ç­¾åæ—¶ï¼Œè¿”å›åŸå§‹åˆæ³•ç­¾åï¼ˆè€Œéä¿®æ”¹å APK çš„ç­¾åï¼‰ï¼Œä»è€Œç»•è¿‡æ ¡éªŒã€‚ ä½¿ç”¨æ¡ä»¶ä¸é™åˆ¶\nç¯å¢ƒè¦æ±‚ï¼šéœ€è¦ root æƒé™ï¼ˆä¿®æ”¹ç³»ç»ŸæœåŠ¡ï¼‰æˆ–é€šè¿‡ Xposed/LSPosed æ¡†æ¶ï¼ˆæ— éœ€ rootï¼Œä½†éœ€æ¨¡å—æ”¯æŒï¼‰ï¼› å±€é™æ€§ï¼šä»…å¯¹é€šè¿‡PackageManagerè·å–ç­¾åçš„æ ¡éªŒæœ‰æ•ˆï¼Œè‹¥åº”ç”¨ç›´æ¥è¯»å– APK æ–‡ä»¶è®¡ç®—ç­¾åï¼ˆå¦‚è¯»å–/data/app/xxx.apkçš„ç­¾åï¼‰ï¼Œåˆ™ PM ä»£ç†æ— æ•ˆï¼ˆéœ€ç»“åˆIOé‡å®šå‘ï¼Œå°†åº”ç”¨è®¿é—®çš„APKè·¯å¾„ï¼ˆå¦‚/data/app/åŒ…å/base.apkï¼‰é‡å®šå‘åˆ°ä¿ç•™åŸå§‹ç­¾åçš„ä¼ªé€ APKæ–‡ä»¶ï¼ˆä»…åŒ…å«ç­¾åæ‰€éœ€æ–‡ä»¶ï¼Œå¦‚META-INF/ï¼‰ã€‚ 2.å®ç°æ–¹æ³•ä»¥åŠåŸç†è§£æ HOOK PMSä»£ç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 package com.zj.hookpms; import java.lang.reflect.Field; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import android.content.Context; import android.content.pm.PackageManager; import android.util.Log; public class ServiceManagerWraper { public final static String ZJ = \u0026#34;ZJ595\u0026#34;; public static void hookPMS(Context context, String signed, String appPkgName, int hashCode) { try { // è·å–å…¨å±€çš„ActivityThreadå¯¹è±¡ Class\u0026lt;?\u0026gt; activityThreadClass = Class.forName(\u0026#34;android.app.ActivityThread\u0026#34;); Method currentActivityThreadMethod = activityThreadClass.getDeclaredMethod(\u0026#34;currentActivityThread\u0026#34;); Object currentActivityThread = currentActivityThreadMethod.invoke(null); // è·å–ActivityThreadé‡Œé¢åŸå§‹çš„sPackageManager Field sPackageManagerField = activityThreadClass.getDeclaredField(\u0026#34;sPackageManager\u0026#34;); sPackageManagerField.setAccessible(true); Object sPackageManager = sPackageManagerField.get(currentActivityThread); // å‡†å¤‡å¥½ä»£{è¿‡}{æ»¤}ç†å¯¹è±¡, ç”¨æ¥æ›¿æ¢åŸå§‹çš„å¯¹è±¡ Class\u0026lt;?\u0026gt; iPackageManagerInterface = Class.forName(\u0026#34;android.content.pm.IPackageManager\u0026#34;); Object proxy = Proxy.newProxyInstance( iPackageManagerInterface.getClassLoader(), new Class\u0026lt;?\u0026gt;[]{iPackageManagerInterface}, new PmsHookBinderInvocationHandler(sPackageManager, signed, appPkgName, 0)); // 1. æ›¿æ¢æ‰ActivityThreadé‡Œé¢çš„ sPackageManager å­—æ®µ sPackageManagerField.set(currentActivityThread, proxy); // 2. æ›¿æ¢ ApplicationPackageManageré‡Œé¢çš„ mPMå¯¹è±¡ PackageManager pm = context.getPackageManager(); Field mPmField = pm.getClass().getDeclaredField(\u0026#34;mPM\u0026#34;); mPmField.setAccessible(true); mPmField.set(pm, proxy); } catch (Exception e) { Log.d(ZJ, \u0026#34;hook pms error:\u0026#34; + Log.getStackTraceString(e)); } } public static void hookPMS(Context context) { String Sign = \u0026#34;åŸåŒ…çš„ç­¾åä¿¡æ¯\u0026#34;; hookPMS(context, Sign, \u0026#34;com.zj.hookpms\u0026#34;, 0); } } ActivityThreadçš„é™æ€å˜é‡sPackageManager ApplicationPackageManagerå¯¹è±¡é‡Œé¢çš„mPMå˜é‡\n0x03 IOé‡å®šå‘ ä»€ä¹ˆæ˜¯IOé‡å®šå‘ï¼Ÿ\nI/Oé‡å®šå‘æ˜¯æŒ‡æ”¹å˜ç¨‹åºçš„æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰å’Œæ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆstderrï¼‰çš„é»˜è®¤è®¾å¤‡ï¼Œå°†å…¶ä¸å…¶ä»–è®¾å¤‡æˆ–æ–‡ä»¶è¿›è¡Œå…³è”ã€‚é€šè¿‡I/Oé‡å®šå‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¨‹åºçš„è¾“å…¥ä»é”®ç›˜è½¬å‘æ–‡ä»¶æˆ–å…¶ä»–è®¾å¤‡ï¼Œå°†ç¨‹åºçš„è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ–‡ä»¶æˆ–å…¶ä»–è®¾å¤‡è€Œä¸æ˜¯å±å¹•ä¸Šã€‚\nä¾‹ï¼šåœ¨è¯»Aæ–‡ä»¶çš„æ—¶å€™æŒ‡å‘Bæ–‡ä»¶\nå¹³å¤´å“¥çš„æ ¸å¿ƒä»£ç  Virtual Engine for Android(Support 12.0 in business version)\nIOé‡å®šå‘å¯ä»¥å¹²å˜›ï¼Ÿ\n1ï¼Œå¯ä»¥è®©æ–‡ä»¶åªè¯»ï¼Œä¸å¯å†™\n2ï¼Œç¦æ­¢è®¿é—®æ–‡ä»¶\n3ï¼Œè·¯å¾„æ›¿æ¢\nå…·ä½“å®ç°ï¼š è¿‡ç­¾åæ£€æµ‹(è¯»å–åŸåŒ…) é£æ§å¯¹æŠ—(ä¾‹:ä¸€ä¸ªæ–‡ä»¶è®°å½•Appå¯åŠ¨çš„æ¬¡æ•°) è¿‡Rootæ£€æµ‹ï¼ŒXposedæ£€æµ‹(æ–‡ä»¶ä¸å¯å–)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 using namespace std; string packname; string origpath; string fakepath; int (*orig_open)(const char *pathname, int flags, ...); int (*orig_openat)(int,const char *pathname, int flags, ...); FILE *(*orig_fopen)(const char *filename, const char *mode); static long (*orig_syscall)(long number, ...); int (*orig__NR_openat)(int,const char *pathname, int flags, ...); void* (*orig_dlopen_CI)(const char *filename, int flag); void* (*orig_dlopen_CIV)(const char *filename, int flag, const void *extinfo); void* (*orig_dlopen_CIVV)(const char *name, int flags, const void *extinfo, void *caller_addr); static inline bool needs_mode(int flags) { return ((flags \u0026amp; O_CREAT) == O_CREAT) || ((flags \u0026amp; O_TMPFILE) == O_TMPFILE); } bool startsWith(string str, string sub){ return str.find(sub)==0; } bool endsWith(string s,string sub){ return s.rfind(sub)==(s.length()-sub.length()); } bool isOrigAPK(string path){ if(path==origpath){ return true; } return false; } //è¯¥å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶è¿›è¡Œæ‹¦æˆªï¼Œå¹¶åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶å°†æ–‡ä»¶è·¯å¾„æ›¿æ¢ä¸ºå¦ä¸€ä¸ªè·¯å¾„ //fake_open å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š //pathnameï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ‰“å¼€çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ //flagsï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰“å¼€æ–‡ä»¶çš„æ–¹å¼ï¼Œä¾‹å¦‚åªè¯»ã€åªå†™ã€è¯»å†™ç­‰ã€‚ //modeï¼ˆå¯é€‰å‚æ•°ï¼‰ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰“å¼€æ–‡ä»¶æ—¶åº”ç”¨çš„æƒé™æ¨¡å¼ã€‚ int fake_open(const char *pathname, int flags, ...) { mode_t mode = 0; if (needs_mode(flags)) { va_list args; va_start(args, flags); mode = static_cast\u0026lt;mode_t\u0026gt;(va_arg(args, int)); va_end(args); } //LOGI(\u0026#34;open, path: %s, flags: %d, mode: %d\u0026#34;,pathname, flags ,mode); string cpp_path= pathname; if(isOrigAPK(cpp_path)){ LOGI(\u0026#34;libc_open, redirect: %s, ---\u0026gt;: %s\u0026#34;,pathname, fakepath.data()); return orig_open(\u0026#34;/data/user/0/com.zj.wuaipojie/files/base.apk\u0026#34;, flags, mode); } return orig_open(pathname, flags, mode); } //è¯¥å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶è¿›è¡Œæ‹¦æˆªï¼Œå¹¶åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶å°†æ–‡ä»¶è·¯å¾„æ›¿æ¢ä¸ºå¦ä¸€ä¸ªè·¯å¾„ //fake_openat å‡½æ•°æœ‰å››ä¸ªå‚æ•°ï¼š //fdï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¦æ‰“å¼€çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ //pathnameï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ‰“å¼€çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ //flagsï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰“å¼€æ–‡ä»¶çš„æ–¹å¼ï¼Œä¾‹å¦‚åªè¯»ã€åªå†™ã€è¯»å†™ç­‰ã€‚ //modeï¼ˆå¯é€‰å‚æ•°ï¼‰ï¼šä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰“å¼€æ–‡ä»¶æ—¶åº”ç”¨çš„æƒé™æ¨¡å¼ã€‚ //openat å‡½æ•°çš„ä½œç”¨ç±»ä¼¼äº open å‡½æ•°ï¼Œä½†æ˜¯å®ƒä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ–‡ä»¶è·¯å¾„æœ¬èº«ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥åœ¨æ‰“å¼€æ–‡ä»¶æ—¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè€Œä¸å¿…æä¾›å®Œæ•´çš„æ–‡ä»¶è·¯å¾„ã€‚ //ä¾‹å¦‚ï¼Œå¦‚æœè¦æ‰“å¼€ç›¸å¯¹äºå½“å‰ç›®å½•çš„æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ openat å‡½æ•°ï¼Œè€Œä¸æ˜¯ open å‡½æ•°ï¼Œå› ä¸º open å‡½æ•°åªèƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚ // int fake_openat(int fd, const char *pathname, int flags, ...) { mode_t mode = 0; if (needs_mode(flags)) { va_list args; va_start(args, flags); mode = static_cast\u0026lt;mode_t\u0026gt;(va_arg(args, int)); va_end(args); } LOGI(\u0026#34;openat, fd: %d, path: %s, flags: %d, mode: %d\u0026#34;,fd ,pathname, flags ,mode); string cpp_path= pathname; if(isOrigAPK(cpp_path)){ LOGI(\u0026#34;libc_openat, redirect: %s, ---\u0026gt;: %s\u0026#34;,pathname, fakepath.data()); return orig_openat(fd,fakepath.data(), flags, mode); } return orig_openat(fd,pathname, flags, mode); } FILE *fake_fopen(const char *filename, const char *mode) { string cpp_path= filename; if(isOrigAPK(cpp_path)){ return orig_fopen(fakepath.data(), mode); } return orig_fopen(filename, mode); } //è¯¥å‡½æ•°çš„åŠŸèƒ½æ˜¯åœ¨æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ—¶è¿›è¡Œæ‹¦æˆªï¼Œå¹¶åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ä¿®æ”¹ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ã€‚ //syscall å‡½æ•°æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¯ç¨‹åºè®¿é—®å†…æ ¸åŠŸèƒ½çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä½¿ç”¨ syscall å‡½æ•°å¯ä»¥è°ƒç”¨å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒä»¬ç”¨äºå®ç°æ“ä½œç³»ç»Ÿçš„å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ã€åˆ›å»ºè¿›ç¨‹ã€åˆ†é…å†…å­˜ç­‰ã€‚ // static long fake_syscall(long number, ...) { void *arg[7]; va_list list; va_start(list, number); for (int i = 0; i \u0026lt; 7; ++i) { arg[i] = va_arg(list, void *); } va_end(list); if (number == __NR_openat){ const char *cpp_path = static_cast\u0026lt;const char *\u0026gt;(arg[1]); LOGI(\u0026#34;syscall __NR_openat, fd: %d, path: %s, flags: %d, mode: %d\u0026#34;,arg[0] ,arg[1], arg[2], arg[3]); if (isOrigAPK(cpp_path)){ LOGI(\u0026#34;syscall __NR_openat, redirect: %s, ---\u0026gt;: %s\u0026#34;,arg[1], fakepath.data()); return orig_syscall(number,arg[0], fakepath.data() ,arg[2],arg[3]); } } return orig_syscall(number, arg[0], arg[1], arg[2], arg[3], arg[4], arg[5], arg[6]); } //å‡½æ•°çš„åŠŸèƒ½æ˜¯è·å–å½“å‰åº”ç”¨çš„åŒ…åã€APK æ–‡ä»¶è·¯å¾„ä»¥åŠåº“æ–‡ä»¶è·¯å¾„ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ //å‡½æ•°è°ƒç”¨ GetObjectClass å’Œ GetMethodID å‡½æ•°æ¥è·å– context å¯¹è±¡çš„ç±»å‹ä»¥åŠ getPackageName æ–¹æ³•çš„ IDã€‚ç„¶åï¼Œå‡½æ•°è°ƒç”¨ CallObjectMethod å‡½æ•°æ¥è°ƒç”¨ getPackageName æ–¹æ³•ï¼Œè·å–å½“å‰åº”ç”¨çš„åŒ…åã€‚æœ€åï¼Œå‡½æ•°ä½¿ç”¨ GetStringUTFChars å‡½æ•°å°†åŒ…åè½¬æ¢ä¸º C å­—ç¬¦ä¸²ï¼Œå¹¶å°†åŒ…åä¿å­˜åœ¨ packname å…¨å±€å˜é‡ä¸­ //æ¥ç€ï¼Œå‡½æ•°ä½¿ç”¨ fakepath å…¨å±€å˜é‡ä¿å­˜äº† /data/user/0/\u0026lt;packname\u0026gt;/files/base.apk è¿™æ ·çš„è·¯å¾„ï¼Œå…¶ä¸­ \u0026lt;packname\u0026gt; æ˜¯å½“å‰åº”ç”¨çš„åŒ…åã€‚ //ç„¶åï¼Œå‡½æ•°å†æ¬¡è°ƒç”¨ GetObjectClass å’Œ GetMethodID å‡½æ•°æ¥è·å– context å¯¹è±¡çš„ç±»å‹ä»¥åŠ getApplicationInfo æ–¹æ³•çš„ IDã€‚ç„¶åï¼Œå‡½æ•°è°ƒç”¨ CallObjectMethod å‡½æ•°æ¥è°ƒç”¨ getApplicationInfo æ–¹æ³•ï¼Œè·å–å½“å‰åº”ç”¨çš„ ApplicationInfo å¯¹è±¡ã€‚ //å®ƒå…ˆè°ƒç”¨ GetObjectClass å‡½æ•°è·å– ApplicationInfo å¯¹è±¡çš„ç±»å‹ï¼Œç„¶åè°ƒç”¨ GetFieldID å‡½æ•°è·å– sourceDir å­—æ®µçš„ IDã€‚æ¥ç€ï¼Œå‡½æ•°ä½¿ç”¨ GetObjectField å‡½æ•°è·å– sourceDir å­—æ®µçš„å€¼ï¼Œå¹¶ä½¿ç”¨ GetStringUTFChars å‡½æ•°å°†å…¶è½¬æ¢ä¸º C å­—ç¬¦ä¸²ã€‚æœ€åï¼Œå‡½æ•°å°† C å­—ç¬¦ä¸²ä¿å­˜åœ¨ origpath å…¨å±€å˜é‡ä¸­ï¼Œè¡¨ç¤ºå½“å‰åº”ç”¨çš„ APK æ–‡ä»¶è·¯å¾„ã€‚ //æœ€åï¼Œå‡½æ•°ä½¿ç”¨ GetFieldID å’Œ GetObjectField å‡½æ•°è·å– nativeLibraryDir å­—æ®µçš„å€¼ï¼Œå¹¶ä½¿ç”¨ GetStringUTFChars å‡½æ•°å°†å…¶è½¬æ¢ä¸º C å­—ç¬¦ä¸²ã€‚å‡½æ•°æœ€åè°ƒç”¨ LOGI å‡½æ•°æ‰“å°åº“æ–‡ä»¶è·¯å¾„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å°†å…¶ä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ã€‚ extern \u0026#34;C\u0026#34; JNIEXPORT void JNICALL Java_com_zj_wuaipojie_util_SecurityUtil_hook(JNIEnv *env, jclass clazz, jobject context) { jclass conext_class = env-\u0026gt;GetObjectClass(context); jmethodID methodId_pack = env-\u0026gt;GetMethodID(conext_class, \u0026#34;getPackageName\u0026#34;, \u0026#34;()Ljava/lang/String;\u0026#34;); auto packname_js = reinterpret_cast\u0026lt;jstring\u0026gt;(env-\u0026gt;CallObjectMethod(context, methodId_pack)); const char *pn = env-\u0026gt;GetStringUTFChars(packname_js, 0); packname = string(pn); env-\u0026gt;ReleaseStringUTFChars(packname_js, pn); //LOGI(\u0026#34;packname: %s\u0026#34;, packname.data()); fakepath= \u0026#34;/data/user/0/\u0026#34;+ packname +\u0026#34;/files/base.apk\u0026#34;; jclass conext_class2 = env-\u0026gt;GetObjectClass(context); jmethodID methodId_pack2 = env-\u0026gt;GetMethodID(conext_class2,\u0026#34;getApplicationInfo\u0026#34;,\u0026#34;()Landroid/content/pm/ApplicationInfo;\u0026#34;); jobject application_info = env-\u0026gt;CallObjectMethod(context,methodId_pack2); jclass pm_clazz = env-\u0026gt;GetObjectClass(application_info); jfieldID package_info_id = env-\u0026gt;GetFieldID(pm_clazz,\u0026#34;sourceDir\u0026#34;,\u0026#34;Ljava/lang/String;\u0026#34;); auto sourceDir_js = reinterpret_cast\u0026lt;jstring\u0026gt;(env-\u0026gt;GetObjectField(application_info,package_info_id)); const char *sourceDir = env-\u0026gt;GetStringUTFChars(sourceDir_js, 0); origpath = string(sourceDir); LOGI(\u0026#34;sourceDir: %s\u0026#34;, sourceDir); jfieldID package_info_id2 = env-\u0026gt;GetFieldID(pm_clazz,\u0026#34;nativeLibraryDir\u0026#34;,\u0026#34;Ljava/lang/String;\u0026#34;); auto nativeLibraryDir_js = reinterpret_cast\u0026lt;jstring\u0026gt;(env-\u0026gt;GetObjectField(application_info,package_info_id2)); const char *nativeLibraryDir = env-\u0026gt;GetStringUTFChars(nativeLibraryDir_js, 0); LOGI(\u0026#34;nativeLibraryDir: %s\u0026#34;, nativeLibraryDir); //LOGI(\u0026#34;%s\u0026#34;, \u0026#34;Start Hook\u0026#34;); //å¯åŠ¨hook void *handle = dlopen(\u0026#34;libc.so\u0026#34;,RTLD_NOW); auto pagesize = sysconf(_SC_PAGE_SIZE); auto addr = ((uintptr_t)dlsym(handle,\u0026#34;open\u0026#34;) \u0026amp; (-pagesize)); auto addr2 = ((uintptr_t)dlsym(handle,\u0026#34;openat\u0026#34;) \u0026amp; (-pagesize)); auto addr3 = ((uintptr_t)fopen) \u0026amp; (-pagesize); auto addr4 = ((uintptr_t)syscall) \u0026amp; (-pagesize); //è§£é™¤éƒ¨åˆ†æœºå‹openè¢«ä¿æŠ¤ mprotect((void*)addr, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC); mprotect((void*)addr2, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC); mprotect((void*)addr3, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC); mprotect((void*)addr4, pagesize, PROT_READ | PROT_WRITE | PROT_EXEC); DobbyHook((void *)dlsym(handle,\u0026#34;open\u0026#34;), (void *)fake_open, (void **)\u0026amp;orig_open); DobbyHook((void *)dlsym(handle,\u0026#34;openat\u0026#34;), (void *)fake_openat, (void **)\u0026amp;orig_openat); DobbyHook((void *)fopen, (void *)fake_fopen, (void**)\u0026amp;orig_fopen); DobbyHook((void *)syscall, (void *)fake_syscall, (void **)\u0026amp;orig_syscall); } 1 2 3 4 5 6 7 sget-object p10, Lcom/zj/wuaipojie/util/ContextUtils;-\u0026gt;INSTANCE:Lcom/zj/wuaipojie/util/ContextUtils; invoke-virtual {p10}, Lcom/zj/wuaipojie/util/ContextUtils;-\u0026gt;getContext()Landroid/content/Context; move-result-object p10 invoke-static {p10}, Lcom/zj/wuaipojie/util/SecurityUtil;-\u0026gt;hook(Landroid/content/Context;)V 0x04 å…¶ä»–å¸¸è§æ ¡éªŒ rootæ£€æµ‹ï¼š\nååˆ¶æ‰‹æ®µ 1.ç®—æ³•åŠ©æ‰‹ã€å¯¹è¯æ¡†å–æ¶ˆç­‰æ’ä»¶ä¸€é”®hook 2.åˆ†æå…·ä½“çš„æ£€æµ‹ä»£ç  3.åˆ©ç”¨IOé‡å®šå‘ä½¿æ–‡ä»¶ä¸å¯è¯» 4.ä¿®æ”¹Andoirdæºç ï¼Œå»é™¤å¸¸è§æŒ‡çº¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 fun isDeviceRooted(): Boolean { return checkRootMethod1() || checkRootMethod2() || checkRootMethod3() } fun checkRootMethod1(): Boolean { val buildTags = android.os.Build.TAGS return buildTags != null \u0026amp;\u0026amp; buildTags.contains(\u0026#34;test-keys\u0026#34;) } fun checkRootMethod2(): Boolean { val paths = arrayOf(\u0026#34;/system/app/Superuser.apk\u0026#34;, \u0026#34;/sbin/su\u0026#34;, \u0026#34;/system/bin/su\u0026#34;, \u0026#34;/system/xbin/su\u0026#34;, \u0026#34;/data/local/xbin/su\u0026#34;, \u0026#34;/data/local/bin/su\u0026#34;, \u0026#34;/system/sd/xbin/su\u0026#34;, \u0026#34;/system/bin/failsafe/su\u0026#34;, \u0026#34;/data/local/su\u0026#34;, \u0026#34;/su/bin/su\u0026#34;) for (path in paths) { if (File(path).exists()) return true } return false } fun checkRootMethod3(): Boolean { var process: Process? = null return try { process = Runtime.getRuntime().exec(arrayOf(\u0026#34;/system/xbin/which\u0026#34;, \u0026#34;su\u0026#34;)) val bufferedReader = BufferedReader(InputStreamReader(process.inputStream)) bufferedReader.readLine() != null } catch (t: Throwable) { false } finally { process?.destroy() } } å®šä¹‰äº†ä¸€ä¸ª isDeviceRooted() å‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨äº†ä¸‰ä¸ªæ£€æµ‹ root çš„æ–¹æ³•ï¼šcheckRootMethod1()ã€checkRootMethod2() å’Œ checkRootMethod3()ã€‚\ncheckRootMethod1() æ–¹æ³•æ£€æŸ¥è®¾å¤‡çš„ build tags æ˜¯å¦åŒ…å« test-keysã€‚è¿™é€šå¸¸æ˜¯ç”¨äºæµ‹è¯•çš„è®¾å¤‡ï¼Œå› æ­¤å¦‚æœæ£€æµ‹åˆ°è¿™ä¸ªæ ‡è®°ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè®¾å¤‡å·²è¢« rootã€‚\ncheckRootMethod2() æ–¹æ³•æ£€æŸ¥è®¾å¤‡æ˜¯å¦å­˜åœ¨ä¸€äº›ç‰¹å®šçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸è¢«ç”¨äºæ‰§è¡Œ root æ“ä½œã€‚å¦‚æœæ£€æµ‹åˆ°è¿™äº›æ–‡ä»¶ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè®¾å¤‡å·²è¢« rootã€‚\ncheckRootMethod3() æ–¹æ³•ä½¿ç”¨ Runtime.exec() æ–¹æ³•æ¥æ‰§è¡Œ which su å‘½ä»¤ï¼Œç„¶åæ£€æŸ¥å‘½ä»¤çš„è¾“å‡ºæ˜¯å¦ä¸ä¸ºç©ºã€‚å¦‚æœè¾“å‡ºä¸ä¸ºç©ºï¼Œåˆ™å¯ä»¥è®¤ä¸ºè®¾å¤‡å·²è¢« rootã€‚\næ¨¡æ‹Ÿå™¨æ£€æµ‹\n1 2 3 fun isEmulator(): Boolean { return Build.FINGERPRINT.startsWith(\u0026#34;generic\u0026#34;) || Build.FINGERPRINT.startsWith(\u0026#34;unknown\u0026#34;) || Build.MODEL.contains(\u0026#34;google_sdk\u0026#34;) Build.MODEL.contains(\u0026#34;Emulator\u0026#34;) || Build.MODEL.contains(\u0026#34;Android SDK built for x86\u0026#34;) || Build.MANUFACTURER.contains(\u0026#34;Genymotion\u0026#34;) || Build.HOST.startsWith(\u0026#34;Build\u0026#34;) || Build.PRODUCT == \u0026#34;google_sdk\u0026#34; } é€šè¿‡æ£€æµ‹ç³»ç»Ÿçš„ Build å¯¹è±¡æ¥åˆ¤æ–­å½“å‰è®¾å¤‡æ˜¯å¦ä¸ºæ¨¡æ‹Ÿå™¨ã€‚å…·ä½“æ–¹æ³•æ˜¯æ£€æµ‹ Build.FINGERPRINT å±æ€§æ˜¯å¦åŒ…å«å­—ç¬¦ä¸² \u0026quot;generic\u0026quot;ã€‚\næ¨¡æ‹Ÿå™¨æ£€æµ‹å¯¹æŠ—\nåè°ƒè¯•æ£€æµ‹\nå®‰å“ç³»ç»Ÿè‡ªå¸¦è°ƒè¯•æ£€æµ‹å‡½æ•° 1 2 3 4 5 6 fun checkForDebugger() { if (Debug.isDebuggerConnected()) { // å¦‚æœè°ƒè¯•å™¨å·²è¿æ¥ï¼Œåˆ™ç»ˆæ­¢åº”ç”¨ç¨‹åº System.exit(0) } } debuggableå±æ€§ 1 2 3 4 5 6 public boolean getAppCanDebug(Context context)//ä¸Šä¸‹æ–‡å¯¹è±¡ä¸ºxxActivity.this { boolean isDebug = context.getApplicationInfo() != null \u0026amp;\u0026amp; (context.getApplicationInfo().flags \u0026amp; ApplicationInfo.FLAG_DEBUGGABLE) != 0; return isDebug; } ptraceæ£€æµ‹ 1 2 3 4 int ptrace_protect()//ptraceé™„åŠ è‡ªèº«çº¿ç¨‹ ä¼šå¯¼è‡´æ­¤è¿›ç¨‹TracerPid å˜ä¸ºçˆ¶è¿›ç¨‹çš„TracerPid å³zygote { return ptrace(PTRACE_TRACEME,0,0,0);;//è¿”å›-1å³ä¸ºå·²ç»è¢«è°ƒè¯• } æ¯ä¸ªè¿›ç¨‹åŒæ—¶åˆ»åªèƒ½è¢«1ä¸ªè°ƒè¯•è¿›ç¨‹ptrace ï¼Œä¸»åŠ¨ptraceæœ¬è¿›ç¨‹å¯ä»¥ä½¿å¾—å…¶ä»–è°ƒè¯•å™¨æ— æ³•è°ƒè¯•\nè°ƒè¯•è¿›ç¨‹åæ£€æµ‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 int SearchObjProcess() { FILE* pfile=NULL; char buf[0x1000]={0}; pfile=popen(\u0026#34;ps\u0026#34;,\u0026#34;r\u0026#34;); if(NULL==pfile) { //LOGA(\u0026#34;SearchObjProcess popenæ‰“å¼€å‘½ä»¤å¤±è´¥!\\n\u0026#34;); return -1; } // è·å–ç»“æœ //LOGA(\u0026#34;popenæ–¹æ¡ˆ:\\n\u0026#34;); while(fgets(buf,sizeof(buf),pfile)) { char* strA=NULL; char* strB=NULL; char* strC=NULL; char* strD=NULL; strA=strstr(buf,\u0026#34;android_server\u0026#34;);//é€šè¿‡æŸ¥æ‰¾åŒ¹é…å­ä¸²åˆ¤æ–­ strB=strstr(buf,\u0026#34;gdbserver\u0026#34;); strC=strstr(buf,\u0026#34;gdb\u0026#34;); strD=strstr(buf,\u0026#34;fuwu\u0026#34;); if(strA || strB ||strC || strD) { return 1; // æ‰§è¡Œåˆ°è¿™é‡Œï¼Œåˆ¤å®šä¸ºè°ƒè¯•çŠ¶æ€ } } pclose(pfile); return 0; } [åŸåˆ›]å¯¹å®‰å“åè°ƒè¯•å’Œæ ¡éªŒæ£€æµ‹çš„ä¸€äº›å®è·µä¸ç»“è®º\nfridaæ£€æµ‹ ä¸€äº›Fridaæ£€æµ‹æ‰‹æ®µ\n0x05 smaliè¯­æ³•\u0026mdash;\u0026ndash;èµ‹å€¼ 1.Intå‹èµ‹å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 .method private static final onCreate$lambda-0(Lcom/zj/wuaipojie/ui/SmaliLearn;Landroid/widget/TextView;Landroid/widget/TextView;Landroid/widget/TextView;Landroid/view/View;)V .registers 9 .line 21 invoke-virtual {p0}, Lcom/zj/wuaipojie/ui/SmaliLearn;-\u0026gt;isVip()I move-result p4 //åˆ¤æ–­vipçš„å€¼åˆ†åˆ«å¯¹åº”ä¸ç”¨çš„ä¼šå‘˜çš„ç­‰çº§ if-eqz p4, :cond_35 const/4 v0, 0x1 if-eq p4, v0, :cond_2d const/4 v0, 0x4 if-eq p4, v0, :cond_25 const/16 v0, 0x10 if-eq p4, v0, :cond_1d const/16 v0, 0x63 if-eq p4, v0, :cond_15 goto :goto_3c :cond_15 const-string p4, \u0026#34;è‡³å°Šä¼šå‘˜\u0026#34; .line 26 check-cast p4, Ljava/lang/CharSequence; invoke-virtual {p1, p4}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V goto :goto_3c :cond_1d const-string p4, \u0026#34;è¶…çº§ä¼šå‘˜\u0026#34; .line 25 check-cast p4, Ljava/lang/CharSequence; invoke-virtual {p1, p4}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V goto :goto_3c :cond_25 const-string p4, \u0026#34;å¤§ä¼šå‘˜\u0026#34; .line 24 check-cast p4, Ljava/lang/CharSequence; invoke-virtual {p1, p4}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V goto :goto_3c :cond_2d const-string p4, \u0026#34;ä¼šå‘˜\u0026#34; .line 23 check-cast p4, Ljava/lang/CharSequence; invoke-virtual {p1, p4}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V goto :goto_3c :cond_35 const-string p4, \u0026#34;éä¼šå‘˜\u0026#34; .line 22 check-cast p4, Ljava/lang/CharSequence; invoke-virtual {p1, p4}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V .line 28 //åˆ¤æ–­vipEndTimeçš„æ—¶é—´æˆ³æ˜¯å¦å°äºç³»ç»Ÿæ—¶é—´ :goto_3c new-instance p1, Ljava/util/Date; invoke-direct {p1}, Ljava/util/Date;-\u0026gt;\u0026lt;init\u0026gt;()V invoke-virtual {p1}, Ljava/util/Date;-\u0026gt;getTime()J move-result-wide v0 .line 29 new-instance p1, Ljava/text/SimpleDateFormat; const-string p4, \u0026#34;yyyy-MM-dd\u0026#34; invoke-direct {p1, p4}, Ljava/text/SimpleDateFormat;-\u0026gt;\u0026lt;init\u0026gt;(Ljava/lang/String;)V .line 30 invoke-virtual {p0}, Lcom/zj/wuaipojie/ui/SmaliLearn;-\u0026gt;vipEndTime()J move-result-wide v2 cmp-long p4, v2, v0 if-gez p4, :cond_5c const-string p1, \u0026#34;å·²è¿‡æœŸ\u0026#34; .line 31 check-cast p1, Ljava/lang/CharSequence; invoke-virtual {p2, p1}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V goto :goto_6d .line 33 :cond_5c invoke-virtual {p0}, Lcom/zj/wuaipojie/ui/SmaliLearn;-\u0026gt;vipEndTime()J move-result-wide v0 invoke-static {v0, v1}, Ljava/lang/Long;-\u0026gt;valueOf(J)Ljava/lang/Long; move-result-object p4 invoke-virtual {p1, p4}, Ljava/text/SimpleDateFormat;-\u0026gt;format(Ljava/lang/Object;)Ljava/lang/String; move-result-object p1 check-cast p1, Ljava/lang/CharSequence; invoke-virtual {p2, p1}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V .line 35 :goto_6d iget p0, p0, Lcom/zj/wuaipojie/ui/SmaliLearn;-\u0026gt;vip_coin:I if-eqz p0, :cond_74 .line 36 invoke-static {p0}, Ljava/lang/String;-\u0026gt;valueOf(I)Ljava/lang/String; move-result-object p0 check-cast p0, Ljava/lang/CharSequence; invoke-virtual {p3, p0}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V :cond_74 return-void .end method const/4å’Œconst/16çš„åŒºåˆ«ï¼Ÿ\nconst/4 æœ€å¤§åªå…è®¸å­˜æ”¾4ä¸ªäºŒè¿›åˆ¶ä½(4bit)ï¼Œ\nconst/16 æœ€å¤§å€¼å…è®¸å­˜æ”¾16ä¸ªäºŒè¿›åˆ¶ä½(16bit)ï¼Œ ç¬¬ä¸€ä½(å³æœ€é«˜ä½)é»˜è®¤ä¸ºç¬¦å·ä½ã€‚å•ä½æ¢ç®— 1byte=8bit ä¸¾ä¾‹è¯´æ˜ä¸‹å¯„å­˜å™¨çš„å–å€¼èŒƒå›´: # ä»¥ä¸‹æ•°æ®å®šä¹‰é«˜ä½é»˜è®¤ä¸ºç¬¦å·ä½\nconst/4 v0,0x2 # æœ€å¤§åªå…è®¸å­˜æ”¾åŠå­—èŠ‚æ•°æ® å–å€¼èŒƒå›´ä¸º -8 and 7\nconst/16 v0 , 0xABCD # å®šä¹‰ä¸€ä¸ªå¯„å­˜å™¨å˜é‡ï¼Œæœ€å¤§åªå…è®¸å­˜æ”¾16ä½æ•°æ® æ¯”å¦‚shortç±»å‹æ•°æ® å–å€¼èŒƒå›´ä¸º-32768~32767\nconst v0 , 0xA# å®šä¹‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œ æœ€å¤§åªå…è®¸å­˜æ”¾32ä½æ•°æ®,æ¯”å¦‚intç±»å‹æ•°æ® å°†æ•°å­—10èµ‹å€¼ç»™v0 å–å€¼èŒƒå›´-2147483647~2147483647\nconst/high16 #å®šä¹‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œ æœ€å¤§åªå…è®¸å­˜æ”¾é«˜16ä½æ•°å€¼ æ¯”å¦‚0xFFFF0000æœ«å››ä½è¡¥0 å­˜å…¥é«˜å››ä½0XFFFF\n2.Longå‹èµ‹å€¼ const-wide vx, lit32 è¡¨ç¤ºå°†ä¸€ä¸ª 32 ä½çš„å¸¸é‡å­˜å‚¨åˆ° vx ä¸ vx+1 ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ â€”â€” å³ä¸€ä¸ª long ç±»å‹çš„æ•°æ®\n1 2 3 4 5 6 7 .method public final vipEndTime()J .registers 3 const-wide v0, 0x1854460ef29L return-wide v0 .end method -ä¼šå‘˜åˆ°æœŸæ—¶é—´å°±æ˜¯2022å¹´12æœˆ24æ—¥ã€‚é‚£ä¹ˆ1854460ef29L æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿä¹Ÿå°±æ˜¯ï¼ˆ2022å¹´12æœˆ24æ—¥-1970å¹´1æœˆ1æ—¥ï¼‰Ã—365å¤©Ã—24å°æ—¶Ã—60åˆ†é’ŸÃ—60ç§’Ã—1000æ¯«ç§’ï¼Œè½¬æ¢æˆ16è¿›åˆ¶å°±å¤§æ¦‚æ˜¯é‚£ä¸ªæ•°äº†\nåœ¨çº¿æ—¶é—´æˆ³è½¬æ¢\n3.å˜é‡èµ‹å€¼(æ­£åˆ™) 1 2 3 4 5 6 7 8 9 10 11 12 iget p0, p0, Lcom/zj/wuaipojie/ui/SmaliLearn;-\u0026gt;vip_coin:I if-eqz p0, :cond_74 .line 36 invoke-static {p0}, Ljava/lang/String;-\u0026gt;valueOf(I)Ljava/lang/String; move-result-object p0 check-cast p0, Ljava/lang/CharSequence; invoke-virtual {p3, p0}, Landroid/widget/TextView;-\u0026gt;setText(Ljava/lang/CharSequence;)V *. ** è¿™ä¸ªè¡¨ç¤ºä»»æ„å¯„å­˜å™¨ï¼Œä»€ä¹ˆå¯„å­˜å™¨éƒ½èƒ½åŒ¹é…ï¼Œæ‰€ä»¥ä½ æ­£åˆ™æŸ¥æ‰¾çš„æ—¶å€™åªéœ€æŠŠå¯„å­˜å™¨æ›¿æ¢æˆè¿™ä¸ªå°±å¯ä»¥äº† (.*) è¿™é‡Œå¤šäº†ä¸ªè‹±æ–‡å°æ‹¬å·ï¼Œæ¡†å“ªä¸ªå°±æ˜¯å¯¹å“ªä¸ªå¯„å­˜å™¨èµ‹å€¼ã€‚ å‚è€ƒæ–‡ç« ï¼š\nAPK ç­¾åï¼šv1 v2 v3 v4 å¦‚ä½•æŠŠç­¾åæ ¡éªŒåšåˆ°æè‡´ Android PMS HOOK [å®æˆ˜ç ´è§£]ç™½æ-åŠ¨æ€ä»£{è¿‡}{æ»¤}ç†Hookç­¾åæ ¡éªŒ [åŸåˆ›]å¯¹å®‰å“åè°ƒè¯•å’Œæ ¡éªŒæ£€æµ‹çš„ä¸€äº›å®è·µä¸ç»“è®º æ–°ç‰ˆMTå»ç­¾åŠå¯¹æŠ— ã€å°ç™½æ•™ç¨‹ã€‘æ­£åˆ™åŒ¹é…çš„å†™æ³• å¤šè¡ŒåŒ¹é… æ‰¹é‡èµ‹å€¼ smalié€†å‘ ç®€å•å®ç”¨\né€†å‘ä¹‹Smaliå…¥é—¨å­¦ä¹ \n","date":"2025-07-20T12:02:51+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/20250720124723.png","permalink":"https://fanshanng.cn/p/ar4/","title":"å®‰å“é€†å‘å…¥é—¨å››"},{"content":"å®‰å“é€†å‘å…¥é—¨ä¸‰ å­¦ä¹ å…³é”®è¯: Jebã€åŠ¨æ€è°ƒè¯•ã€Logæ’æ¡©\nå­¦ä¹ é“¾æ¥ï¼šã€Šå®‰å“é€†å‘è¿™æ¡£äº‹ã€‹äº”ã€1000-7=ï¼Ÿ\u0026amp;åŠ¨æ€è°ƒè¯•\u0026amp;Logæ’æ¡©\nJEBå­¦ä¹  ç¯å¢ƒé…ç½®\nJavaç¯å¢ƒé…ç½®ï¼Œæˆ‘è¿™é‡Œä¸ç»†è®²ã€‚æ²¡æœ‰é…ç½®è¿‡javaç¯å¢ƒçš„æˆ‘å»ºè®®å»çœ‹çœ‹ å¤šä¸ª JDK ç‰ˆæœ¬ï¼ˆJava 8ã€Java 17ã€Java 21ï¼‰ä¸‹è½½å’Œåˆ‡æ¢ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘çš„å»ºè®®æ˜¯ä¸€å¼€å§‹å°±åšå¥½javaå¤šç‰ˆæœ¬å…±å­˜çš„å‡†å¤‡ ä¸‹è½½JEB\nJEB (Java Editor for Android) æ˜¯ä¸€æ¬¾ç”¨äºå®‰å“åº”ç”¨é€†å‘å·¥ç¨‹çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åˆ†æå’Œä¿®æ”¹å®‰å“åº”ç”¨çš„å­—èŠ‚ç ã€‚\njebæ¨èjdk-11æˆ–jdk-17ï¼ˆæˆ‘ç”¨çš„æ˜¯jdk-11ï¼‰\nä¸‹è½½æ•™ç¨‹å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šJEBåŠ¨æ€è°ƒè¯•Smali-çœŸæœº/æ¨¡æ‹Ÿå™¨ï¼ˆè¯¦ç»†ï¼Œæ–°æ‰‹å¿…çœ‹ï¼‰\næœ¬æ¬¡å­¦ä¹ ä¸‹è½½æ­£å·±æä¾›çš„jebå®‰è£…åŒ…ï¼Œä¸‹è½½å¥½å°±å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦æ¿€æ´»å°±å»çœ‹ä¸Šé¢çš„æ–‡ç« \nåŠ¨æ€è°ƒè¯• ç†Ÿæ‚‰IDAçš„é€†å‘äººåº”è¯¥çŸ¥é“åŠ¨æ€è°ƒè¯•æ˜¯ä»€ä¹ˆï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯AndroidåŠ¨æ€è°ƒè¯•ï¼Œ\nä¿®æ”¹æ–¹æ³•ï¼š\nä¿®æ”¹debugæƒé™ **æ–¹æ³•ä¸€:**åœ¨AndroidManifest.xmlé‡Œæ·»åŠ å¯è°ƒè¯•æƒé™\n1 android:debuggable=\u0026#34;true\u0026#34; **æ–¹æ³•äºŒï¼š**XappDebugæ¨¡å—hookå¯¹åº”çš„app\n**æ–¹æ³•ä¸‰ï¼š**Magiskå‘½ä»¤(é‡å¯å¤±æ•ˆ)\n1 2 3 4 5 6 7 1. adb shell #adbè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ 2. su #åˆ‡æ¢è‡³è¶…çº§ç”¨æˆ· 3. magisk resetprop ro.debuggable 1 4. stop;start; #ä¸€å®šè¦é€šè¿‡è¯¥æ–¹å¼é‡å¯ **æ–¹æ³•å››:**åˆ·å…¥MagiskHide Props Configæ¨¡å—\nä¸€èˆ¬æ¥è¯´ï¼Œåœ¨4é€‰é¡¹ä¸­å¦‚æœæœ‰ro.debuggableé‚£å°±ç›´æ¥ä¿®æ”¹\næ²¡æœ‰çš„è¯å°±é€‰5\nç«¯å£è½¬å‘ä»¥åŠå¼€å¯adbæƒé™ ç‰ˆæœ¬å·ç‚¹å‡»ä¸ƒæ¬¡å¼€å¯å¼€å‘è€…æ¨¡å¼å¹¶å¼€å¯adbè°ƒè¯•æƒé™ æœ‰æ—¶å€™é‡æ–°è¿›å…¥æ¨¡æ‹Ÿå™¨çš„æ—¶å€™usbè°ƒè¯•ä¼šå–æ¶ˆï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ ä¸‹æ–­ç‚¹ ctrl+bä¸‹æ–­ç‚¹\ndebugæ¨¡å¼å¯åŠ¨ 1 adb shell am start -D -n com.zj.wuaipojie/.ui.MainActivity adb shell am start -D -n adb shell am start -D -n åŒ…å/ç±»å am start -n è¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªactivity am start -D è¡¨ç¤ºå°†åº”ç”¨è®¾ç½®ä¸ºå¯è°ƒè¯•æ¨¡å¼\nJebé™„åŠ è°ƒè¯•è¿›ç¨‹ å¸¸ç”¨å¿«æ·é”®ï¼š F6 è¿›å…¥æ–¹æ³• F6 è·³è¿‡æ–¹æ³• F7 ä»æ–¹æ³•ä¸­è·³å‡ºæ¥ R è¿è¡Œåˆ°å…‰æ ‡å¤„\nè¿è¡Œåˆ°æ–­ç‚¹ æ­¥è¿› å¾—åˆ°å‚æ•°å€¼ï¼š5qKA5q61DAUM\nLogæ’æ¡© å®šä¹‰ï¼šLog æ’æ¡©æ˜¯åœ¨åç¼–è¯‘ APK åçš„ Smali ä»£ç ä¸­æ’å…¥æ—¥å¿—è¾“å‡ºè¯­å¥ï¼Œé€šè¿‡Log.v()ç­‰æ–¹æ³•å°†å…³é”®å˜é‡ã€å‡½æ•°è°ƒç”¨è¿‡ç¨‹æ‰“å°åˆ°ç³»ç»Ÿæ—¥å¿—ï¼Œé€‚ç”¨äºæ— æ³•åŠ¨æ€è°ƒè¯•æˆ–éœ€è¦è¿½è¸ªåå°é€»è¾‘çš„åœºæ™¯ã€‚\n1 invoke-static {å¯¹åº”å¯„å­˜å™¨}, Lcom/mtools/LogUtils;-\u0026gt;v(Ljava/lang/Object;)V åœ¨åº”ç”¨é‡Œéšæœºè¾“å…¥å­—ç¬¦ä¸²ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿— ","date":"2025-06-26T01:03:40+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/20250720124652.png","permalink":"https://fanshanng.cn/p/ar3/","title":"å®‰å“é€†å‘å…¥é—¨ä¸‰"},{"content":"0x00 smaliåŠå…¶è¯­æ³• smaliæ˜¯Dalvikçš„å¯„å­˜å™¨è¯­è¨€ï¼Œsmaliä»£ç æ˜¯dexåç¼–è¯‘è€Œæ¥çš„ã€‚ Smaliæ˜¯Dalvikè™šæ‹Ÿæœºå’ŒARTè¿è¡Œæ—¶çš„å¯„å­˜å™¨æŒ‡ä»¤è¯­è¨€ï¼Œç›¸å½“äºAndroidå¹³å°çš„æ±‡ç¼–è¯­è¨€ã€‚å½“APKè¢«åç¼–è¯‘æ—¶ï¼ŒDEXæ–‡ä»¶ä¼šè½¬æ¢ä¸ºSmaliä»£ç ï¼ˆ.smaliæ–‡ä»¶ï¼‰ï¼Œå®ƒæ˜¯é€†å‘åˆ†æçš„æ ¸å¿ƒè½½ä½“ã€‚\nå…³é”®å­—\nåç§° æ³¨é‡Š .class ç±»å .super çˆ¶ç±»åï¼Œç»§æ‰¿çš„ä¸Šçº§ç±»ååç§° .source æºå .field å˜é‡ .method æ–¹æ³•å .register å¯„å­˜å™¨ .end method æ–¹æ³•åçš„ç»“æŸ public å…¬æœ‰ protected åŠå…¬å¼€ï¼Œåªæœ‰åŒä¸€å®¶äººæ‰èƒ½ç”¨ private ç§æœ‰ï¼Œåªèƒ½è‡ªå·±ä½¿ç”¨ .parameter æ–¹æ³•å‚æ•° .prologue æ–¹æ³•å¼€å§‹ .line xxx ä½äºç¬¬xxxè¡Œ æ•°æ®ç±»å‹å¯¹åº”\nsmaliç±»å‹ javaç±»å‹ æ³¨é‡Š V void æ— è¿”å›å€¼ Z boolean å¸ƒå°”å€¼ç±»å‹ï¼Œè¿”å›0æˆ–1 B byte å­—èŠ‚ç±»å‹ï¼Œè¿”å›å­—èŠ‚ S short çŸ­æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­— C char å­—ç¬¦ç±»å‹ï¼Œè¿”å›å­—ç¬¦ I int æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­— J long ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰ é•¿æ•´æ•°ç±»å‹ï¼Œè¿”å›æ•°å­— F float å•æµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­— D double ï¼ˆ64ä½ éœ€è¦2ä¸ªå¯„å­˜å™¨å­˜å‚¨ï¼‰ åŒæµ®ç‚¹ç±»å‹ï¼Œè¿”å›æ•°å­— string String æ–‡æœ¬ç±»å‹ï¼Œè¿”å›å­—ç¬¦ä¸² Lxxx/xxx/xxx object å¯¹è±¡ç±»å‹ï¼Œè¿”å›å¯¹è±¡ å¸¸ç”¨æŒ‡ä»¤\nå…³é”®å­— æ³¨é‡Š const é‡å†™æ•´æ•°å±æ€§ï¼ŒçœŸå‡å±æ€§å†…å®¹ï¼Œåªèƒ½æ˜¯æ•°å­—ç±»å‹ const-string é‡å†™å­—ç¬¦ä¸²å†…å®¹ const-wide é‡å†™é•¿æ•´æ•°ç±»å‹ï¼Œå¤šç”¨äºä¿®æ”¹åˆ°æœŸæ—¶é—´ã€‚ return è¿”å›æŒ‡ä»¤ if-eq å…¨ç§°equal(a=b)ï¼Œæ¯”è¾ƒå¯„å­˜å™¨abå†…å®¹ï¼Œç›¸åŒåˆ™è·³ if-ne å…¨ç§°not equal(a!=b)ï¼Œabå†…å®¹ä¸ç›¸åŒåˆ™è·³ if-eqz å…¨ç§°equal zero(a=0)ï¼Œzå³æ˜¯0çš„æ ‡è®°ï¼Œaç­‰äº0åˆ™è·³ if-nez å…¨ç§°not equal zero(a!=0)ï¼Œaä¸ç­‰äº0åˆ™è·³ if-ge å…¨ç§°greater equal(a\u0026gt;=b)ï¼Œaå¤§äºæˆ–ç­‰äºåˆ™è·³ if-le å…¨ç§°little equal(a\u0026lt;=b)ï¼Œaå°äºæˆ–ç­‰äºåˆ™è·³ goto å¼ºåˆ¶è·³åˆ°æŒ‡å®šä½ç½® switch åˆ†æ”¯è·³è½¬ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªåˆ†æ”¯çº¿ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤è·³è½¬åˆ°é€‚å½“ä½ç½® iget è·å–å¯„å­˜å™¨æ•°æ® â€œvipç»ˆç»“è€…â€ å®šä½æ–¹æ³•ï¼š\næœç´¢å¼¹çª—å…³é”®å­—ï¼ˆç”¨jd-guiæœç´¢å­—ç¬¦ä¸²ï¼‰ã€æŠ“å–æŒ‰é’®idï¼ˆæœ¬è´¨ä¸å‰ä¸€ä¸ªæ–¹æ³•ä¸€æ ·ï¼‰\nï¼ˆå­—ç¬¦ä¸²æœ‰æ—¶å€™æ˜¯ç”¨unicodeæ˜¾ç¤ºï¼Œæœå…³é”®æ–‡å­—æœä¸åˆ°çš„è¯å¯ä»¥è¯•è¯•æœå¯¹åº”çš„unicodeï¼‰\nï¼ˆæ­¤å¤„æ¼”ç¤ºçš„æ˜¯æŠ“å–æŒ‰é’®idï¼‰\nä¿®æ”¹æ–¹æ³•ï¼š\nä¿®æ”¹åˆ¤æ–­ã€å¼ºåˆ¶è·³è½¬ã€ä¿®æ”¹å¯„å­˜å™¨çš„å€¼ (è¿™é‡Œä¸åè°ƒè¯•ä¸­ä¿®æ”¹æ ‡å¿—ä½æˆ–è€…ä¿®æ”¹è·³è½¬æŒ‡ä»¤ç±»ä¼¼)\ndemoä»£ç ä¾‹å­ï¼ˆæ³¨é‡Šä¸ºæ­£å·±æ‰€å†™ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 //ä¸€ä¸ªç§æœ‰ã€é™æ€ã€ä¸å¯å˜çš„æ–¹æ³• æ–¹æ³•å .method private static final onCreate$lambda-2(Lkotlin/jvm/internal/Ref$IntRef;Lcom/zj/wuaipojie/ui/ChallengeSecond;Landroid/widget/ImageView;Landroid/widget/ImageView;Landroid/widget/ImageView;Landroid/view/View;)Z //(è¿™é‡Œé¢æ˜¯æ–¹æ³•çš„å‚æ•°)è¿™é‡Œæ˜¯æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼Œè¡¨ç¤ºå¸ƒå°”å€¼ç±»å‹ï¼Œè¿”å›å‡æˆ–çœŸ .registers 7 //å¯„å­˜å™¨æ•°é‡ .line 33 //ä»£ç æ‰€åœ¨çš„è¡Œæ•° iget p0, p0, Lkotlin/jvm/internal/Ref$IntRef;-\u0026gt;element:I //è¯»å–p0(ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå‚è€ƒå¯„å­˜å™¨çŸ¥è¯†)ä¸­elementçš„å€¼èµ‹å€¼ç»™p0 const/4 p5, 0x1 //p5èµ‹å€¼1 const/16 v0, 0xa //v0èµ‹å€¼10ï¼Œåœ¨16è¿›åˆ¶é‡Œaè¡¨ç¤º10 if-ge p0, v0, :cond_15 //åˆ¤æ–­p0çš„å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äºv0çš„å€¼(å³p0çš„å€¼æ˜¯å¦å¤§äºæˆ–ç­‰äº10)ï¼Œå¦‚æœå¤§äºæˆ–ç­‰äºåˆ™è·³è½¬åˆ°:cond_15 .line 34 //ä»¥ä¸‹æ˜¯å¸¸è§çš„Toastå¼¹çª—ä»£ç  check-cast p1, Landroid/content/Context; //æ£€æŸ¥Contextå¯¹è±¡å¼•ç”¨ const-string p0, \u0026#34;è¯·å…ˆè·å–10ä¸ªç¡¬å¸å“¦\u0026#34; //å¼¹çª—æ–‡æœ¬ä¿¡æ¯ï¼ŒæŠŠ\u0026#34;\u0026#34;é‡Œçš„å­—ç¬¦ä¸²æ•°æ®èµ‹å€¼ç»™p0 check-cast p0, Ljava/lang/CharSequence; //æ£€æŸ¥CharSequenceå¯¹è±¡å¼•ç”¨ invoke-static {p1, p0, p5}, Landroid/widget/Toast;-\u0026gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast; //å°†å¼¹çª—æ–‡æœ¬ã€æ˜¾ç¤ºæ—¶é—´ç­‰ä¿¡æ¯ä¼ ç»™p1 move-result-object p0 //ç»“æœä¼ é€’ç»™p0 invoke-virtual {p0}, Landroid/widget/Toast;-\u0026gt;show()V //å½“çœ‹åˆ°è¿™ä¸ªToast;-\u0026gt;showä½ å°±åº”è¯¥ååº”è¿‡æ¥è¿™é‡Œæ˜¯å¼¹çª—ä»£ç  goto :goto_31 //è·³è½¬åˆ°:goto_31 :cond_15 //è·³è½¬çš„ä¸€ä¸ªåœ°å€ invoke-virtual {p1}, Lcom/zj/wuaipojie/ui/ChallengeSecond;-\u0026gt;isvip()Z //åˆ¤æ–­isvipæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦ä¸ºçœŸ(å³ç»“æœæ˜¯å¦ä¸º1) move-result p0 //ç»“æœèµ‹å€¼ç»™p0 if-eqz p0, :cond_43 //å¦‚æœç»“æœä¸º0åˆ™è·³è½¬cond_43åœ°å€ const p0, 0x7f0d0018 //åœ¨arscä¸­çš„idç´¢å¼•ï¼Œè¿™ä¸ªå€¼å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ .line 37 invoke-virtual {p2, p0}, Landroid/widget/ImageView;-\u0026gt;setImageResource(I)V //è®¾ç½®å›¾ç‰‡èµ„æº const p0, 0x7f0d0008 .line 38 invoke-virtual {p3, p0}, Landroid/widget/ImageView;-\u0026gt;setImageResource(I)V const p0, 0x7f0d000a .line 39 invoke-virtual {p4, p0}, Landroid/widget/ImageView;-\u0026gt;setImageResource(I)V .line 40 sget-object p0, Lcom/zj/wuaipojie/util/SPUtils;-\u0026gt;INSTANCE:Lcom/zj/wuaipojie/util/SPUtils; check-cast p1, Landroid/content/Context; const/4 p2, 0x2 //p2èµ‹å€¼2 const-string p3, \u0026#34;level\u0026#34; //spçš„ç´¢å¼• invoke-virtual {p0, p1, p3, p2}, Lcom/zj/wuaipojie/util/SPUtils;-\u0026gt;saveInt(Landroid/content/Context;Ljava/lang/String;I)V //å†™å…¥æ•°æ® goto :goto_50 //è·³è½¬åœ°å€ :cond_43 check-cast p1, Landroid/content/Context; const-string p0, \u0026#34;\\u8bf7\\u5148\\u5145\\u503c\\u5927\\u4f1a\\u5458\\u54e6\\uff01\u0026#34; //è¯·å…ˆå……å€¼å¤§ä¼šå‘˜å“¦ï¼ check-cast p0, Ljava/lang/CharSequence; invoke-static {p1, p0, p5}, Landroid/widget/Toast;-\u0026gt;makeText(Landroid/content/Context;Ljava/lang/CharSequence;I)Landroid/widget/Toast; move-result-object p0 invoke-virtual {p0}, Landroid/widget/Toast;-\u0026gt;show()V :goto_50 return p5 //è¿”å›p5çš„å€¼ .end method //æ–¹æ³•ç»“æŸ //åˆ¤æ–­æ˜¯å¦æ˜¯å¤§ä¼šå‘˜çš„æ–¹æ³• .method public final isvip()Z .registers 2 const/4 v0, 0x0 //v0èµ‹å€¼0 return v0 //è¿”å›v0çš„å€¼ .end method å¯„å­˜å™¨æœºåˆ¶ å‘½åè§„åˆ™ï¼šv0-vN æœ¬åœ°å¯„å­˜å™¨ï¼Œp0-pN å‚æ•°å¯„å­˜å™¨ å…³é”®ç‰¹æ€§ï¼š éé™æ€æ–¹æ³•ä¸­ p0 å›ºå®šè¡¨ç¤ºthisæŒ‡é’ˆ é™æ€æ–¹æ³•ä¸­ p0 å¯¹åº”ç¬¬ä¸€ä¸ªå‚æ•° 64ä½ç±»å‹(long/double)å ç”¨ä¸¤ä¸ªè¿ç»­å¯„å­˜å™¨ï¼ˆå¦‚v0-v1ï¼‰ è¿™é‡Œå¯ä»¥åˆ‡æ¢æˆSmaliè¯­è¨€ï¼ˆä½†æ˜¯javaä»£ç æ›´å¥½çœ‹ä¸€ç‚¹ï¼‰\n0x02 activityçš„åˆ‡æ¢ ç»„ä»¶ æè¿° Activity(æ´»åŠ¨) åœ¨åº”ç”¨ä¸­çš„ä¸€ä¸ªActivityå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç•Œé¢ï¼Œæ„æ€å¯ä»¥ç†è§£ä¸ºâ€œæ´»åŠ¨â€ï¼Œå³ä¸€ä¸ªæ´»åŠ¨å¼€å§‹ï¼Œä»£è¡¨ Activityç»„ä»¶å¯åŠ¨ï¼Œæ´»åŠ¨ç»“æŸï¼Œä»£è¡¨ä¸€ä¸ªActivityçš„ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ä¸€ä¸ªAndroidåº”ç”¨å¿…é¡»é€šè¿‡Activityæ¥è¿è¡Œå’Œå¯åŠ¨ï¼ŒActivityçš„ç”Ÿå‘½å‘¨æœŸäº¤ç»™ç³»ç»Ÿç»Ÿä¸€ç®¡ç†ã€‚ Service(æœåŠ¡) Serviceå®ƒå¯ä»¥åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œæ“ä½œè€Œæ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç»„ä»¶ï¼Œä¸ä¾èµ–ä»»ä½•ç”¨æˆ·ç•Œé¢ï¼Œä¾‹å¦‚åå°æ’­æ”¾éŸ³ä¹ï¼Œåå°ä¸‹è½½æ–‡ä»¶ç­‰ã€‚ Broadcast Receiver(å¹¿æ’­æ¥æ”¶å™¨) ä¸€ä¸ªç”¨äºæ¥æ”¶å¹¿æ’­ä¿¡æ¯ï¼Œå¹¶åšå‡ºå¯¹åº”å¤„ç†çš„ç»„ä»¶ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„ç³»ç»Ÿå¹¿æ’­ï¼šé€šçŸ¥æ—¶åŒºæ”¹å˜ã€ç”µé‡ä½ã€ç”¨æˆ·æ”¹å˜äº†è¯­è¨€é€‰é¡¹ç­‰ã€‚ Content Provider(å†…å®¹æä¾›è€…) ä½œä¸ºåº”ç”¨ç¨‹åºä¹‹é—´å”¯ä¸€çš„å…±äº«æ•°æ®çš„é€”å¾„ï¼ŒContent Providerä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å­˜å‚¨å¹¶æ£€ç´¢æ•°æ®ä»¥åŠå‘å…¶ä»–åº”ç”¨ç¨‹åºæä¾›è®¿é—®æ•°æ®çš„æ¥å£ã€‚Androidå†…ç½®çš„è®¸å¤šæ•°æ®éƒ½æ˜¯ä½¿ç”¨Content Providerå½¢å¼ï¼Œä¾›å¼€å‘è€…è°ƒç”¨çš„ï¼ˆå¦‚è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡ï¼Œé€šè®¯å½•ç­‰ï¼‰ å¹¿å‘Šæ‹¦æˆªå®æˆ˜ å¯åŠ¨å¹¿å‘Šæµç¨‹ï¼š å¯åŠ¨Activity-\u0026gt;å¹¿å‘ŠActivity-\u0026gt;ä¸»é¡µActivity\nä¿®æ”¹æ–¹æ³•ï¼š\n1.ä¿®æ”¹åŠ è½½æ—¶é—´\næ­¤å°èŠ‚ä¸­ç”¨åˆ°äº†mtç®¡ç†å™¨çš„Activityç®¡ç†å™¨ï¼Œå¯ä»¥ç”¨äºè®°å½•å¹¿å‘Šç”¨åˆ°çš„AdActivityç±» ç„¶åé€šè¿‡ç±»åæœç´¢å¯ä»¥å®šä½åˆ°ä»£ç ä½ç½®\nè½¬æ¢æˆjava é˜…è¯»javaä»£ç ï¼Œç„¶åå¯ä»¥çŸ¥é“æœ‰ä¸€ä¸ª3000æ¯«ç§’å¹¿å‘Šæ˜¾ç¤ºæ—¶é—´ï¼Œé€€å›åˆ°smaliä»£ç ä¸­ä¿®æ”¹ä¸ºé›¶å³å¯ã€‚\n2.Acitivityåˆ‡æ¢å®šä½ï¼Œä¿®æ”¹Intentçš„Activityç±»åï¼ˆç›´æ¥åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 \u0026lt;!---å£°æ˜å®ç°åº”ç”¨éƒ¨åˆ†å¯è§†åŒ–ç•Œé¢çš„ Activityï¼Œå¿…é¡»ä½¿ç”¨ AndroidManifest ä¸­çš„ \u0026lt;activity\u0026gt; å…ƒç´ è¡¨ç¤ºæ‰€æœ‰ Activityã€‚ç³»ç»Ÿä¸ä¼šè¯†åˆ«å’Œè¿è¡Œä»»ä½•æœªè¿›è¡Œå£°æ˜çš„Activityã€‚-----\u0026gt; \u0026lt;activity android:label=\u0026#34;@string/app_name\u0026#34; android:name=\u0026#34;com.zj.wuaipojie.ui.MainActivity\u0026#34; android:exported=\u0026#34;true\u0026#34;\u0026gt; \u0026lt;!--å½“å‰Activityæ˜¯å¦å¯ä»¥è¢«å¦ä¸€ä¸ªApplicationçš„ç»„ä»¶å¯åŠ¨ï¼štrueå…è®¸è¢«å¯åŠ¨ï¼›falseä¸å…è®¸è¢«å¯åŠ¨--\u0026gt; \u0026lt;!---æŒ‡æ˜è¿™ä¸ªactivityå¯ä»¥ä»¥ä»€ä¹ˆæ ·çš„æ„å›¾(intent)å¯åŠ¨---\u0026gt; \u0026lt;intent-filter\u0026gt; \u0026lt;!--è¡¨ç¤ºactivityä½œä¸ºä¸€ä¸ªä»€ä¹ˆåŠ¨ä½œå¯åŠ¨ï¼Œandroid.intent.action.MAINè¡¨ç¤ºä½œä¸ºä¸»activityå¯åŠ¨---\u0026gt; \u0026lt;action android:name=\u0026#34;android.intent.action.MAIN\u0026#34; /\u0026gt; \u0026lt;!--è¿™æ˜¯actionå…ƒç´ çš„é¢å¤–ç±»åˆ«ä¿¡æ¯ï¼Œandroid.intent.category.LAUNCHERè¡¨ç¤ºè¿™ä¸ªactivityä¸ºå½“å‰åº”ç”¨ç¨‹åºä¼˜å…ˆçº§æœ€é«˜çš„Activity--\u0026gt; \u0026lt;category android:name=\u0026#34;android.intent.category.LAUNCHER\u0026#34; /\u0026gt; \u0026lt;/intent-filter\u0026gt; \u0026lt;/activity\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.ChallengeFirst\u0026#34; /\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.ChallengeFifth\u0026#34; android:exported=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.ChallengeFourth\u0026#34; android:exported=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.ChallengeThird\u0026#34; android:exported=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.ChallengeSecond\u0026#34; android:exported=\u0026#34;false\u0026#34; /\u0026gt; \u0026lt;activity android:name=\u0026#34;com.zj.wuaipojie.ui.AdActivity\u0026#34; /\u0026gt; â€‹\n3.åœ¨classes.dexæ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶ä¿®æ”¹\nå›¾ä¸€ä¸ºä¹‹å‰çš„æŸ¥æ‰¾å†…å®¹ï¼Œå›¾äºŒæ˜¯ç±»çš„ä¸€ä¸ªsmaliè·¯å¾„ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 switch (position) { case 0: Intent intent = new Intent(); intent.setClass(it.getContext(), ChallengeFirst.class); it.getContext().startActivity(intent); return; case 1: Intent intent2 = new Intent(); intent2.setClass(it.getContext(), ChallengeSecond.class); it.getContext().startActivity(intent2); return; case 2: Intent intent3 = new Intent(); //newä¸€ä¸ªIntentï¼Œ intent3.setClass(it.getContext(), AdActivity.class); //ä¼ å…¥è¦åˆ‡æ¢çš„Acitivityçš„ç±»å it.getContext().startActivity(intent3); //å¯åŠ¨å¯¹åº”çš„Activity return; case 3: Intent intent4 = new Intent(); intent4.setClass(it.getContext(), ChallengeFourth.class); it.getContext().startActivity(intent4); return; default: return; } 0x03 Activityç”Ÿå‘½å‘¨æœŸ å‡½æ•°åç§° æè¿° onCreate() ä¸€ä¸ªActivityå¯åŠ¨åç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¸¸ç”¨æ¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡ŒActivityçš„ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ä¾‹å¦‚åˆ›å»ºViewï¼Œç»‘å®šæ•°æ®ï¼Œæ³¨å†Œç›‘å¬ï¼ŒåŠ è½½å‚æ•°ç­‰ã€‚ onStart() å½“Activityæ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶ï¼Œæ­¤æ–¹æ³•è¢«è°ƒç”¨ä½†æ­¤æ—¶è¿˜æ— æ³•è¿›è¡Œä¸ç”¨æˆ·çš„äº¤äº’æ“ä½œã€‚ onResume() è¿™ä¸ªæ–¹æ³•åœ¨onStart()ä¹‹åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨Activityå‡†å¤‡å¥½ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ—¶å€™è°ƒç”¨ï¼Œæ­¤æ—¶çš„Activityä¸€å®šä½äºActivityæ ˆé¡¶ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€ã€‚ onPause() è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ç³»ç»Ÿå‡†å¤‡å»å¯åŠ¨æˆ–è€…æ¢å¤å¦å¤–ä¸€ä¸ªActivityçš„æ—¶å€™è°ƒç”¨ï¼Œé€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œä¸€äº›é‡Šæ”¾èµ„æºçš„æ–¹æ³•ï¼Œä»¥åŠä¿å­˜ä¸€äº›å…³é”®æ•°æ®ã€‚ onStop() è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨Activityå®Œå…¨ä¸å¯è§çš„æ—¶å€™è°ƒç”¨çš„ã€‚ onDestroy() è¿™ä¸ªæ–¹æ³•åœ¨Activityé”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œä¹‹åActivityçš„çŠ¶æ€ä¸ºé”€æ¯çŠ¶æ€ã€‚ onRestart() å½“Activityä»åœæ­¢stopçŠ¶æ€æ¢è¿›å…¥startçŠ¶æ€æ—¶è°ƒç”¨çŠ¶æ€ã€‚ 0x04 å¼¹çª—å®šä½\u0026amp;å †æ ˆåˆ†æ ä¿®æ”¹æ–¹æ³•ï¼š 1.ä¿®æ”¹xmlä¸­çš„versioncode 2.Hookå¼¹çª—(æ¨èç®—æ³•åŠ©æ‰‹å¼€å¯å¼¹çª—å®šä½) è¿™é‡Œdemoä¸­çš„å¹¿å‘Šè¿”å›é”®è¢«åŠ«æŒï¼Œåªèƒ½è·Ÿç€å¹¿å‘Šèµ°ï¼Œå°±éœ€è¦hook\n3.ä¿®æ”¹dexå¼¹çª—ä»£ç  åœ¨ç®—æ³•åŠ©æ‰‹é‡Œæ‰¾åˆ°æœ€æ–°çš„æ—¥å¿—ï¼Œæ‰¾åˆ°å¯¹åº”æ‰“æ–¹æ³•åï¼Œç„¶åæœç´¢æŸ¥æ‰¾å¯¹åº”-\u0026gt;show()ä»£ç ï¼Œåˆ æ‰æˆ–è€…æ³¨é‡Šæ‰å°±è¡Œ\n4.æŠ“åŒ…ä¿®æ”¹å“åº”ä½“(ä¹Ÿå¯ä»¥è·¯ç”±å™¨æ‹¦æˆª) 0x05 å¸ƒå±€ä¼˜åŒ– 1.å¼€å‘è€…åŠ©æ‰‹æŠ“å¸ƒå±€ 2.MTç®¡ç†å™¨xmlæœç´¢å®šä½ 3.ä¿®æ”¹xmlä»£ç  ç”¨çš„è½¯ä»¶ï¼šå¼€å‘åŠ©æ‰‹ï¼ˆå¯ä»¥è¯†åˆ«åˆ°å›¾ç‰‡ä¿¡æ¯ï¼‰ï¼Œé€šè¿‡æœç´¢Veiw idï¼ˆhexï¼‰ï¼Œå¯ä»¥æŸ¥æ‰¾åˆ°å¯¹åº”çš„xmlæ–‡ä»¶ï¼Œæ³¨æ„è¿™é‡Œæ˜¯xmlæ–‡ä»¶ä¸æ˜¯ä¹‹å‰çš„dexæ–‡ä»¶é‡Œæœç´¢ã€‚ æ­¤å¤„æ—¢å¯ä»¥ä¿®æ”¹å›¾ç‰‡æ˜¾ç¤ºçš„é•¿å®½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åŠ å…¥ä¸‹é¢è¿™æ®µä»£ç éšè—ï¼ˆå¸ƒå±€éšè—ï¼Œæ–‡å­—å›¾ç‰‡éƒ½å¯ä»¥éšè—ï¼‰ã€‚\n1 android:visibility=\u0026#34;gone\u0026#34; ","date":"2025-06-01T01:03:40+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/20250601010933131.png","permalink":"https://fanshanng.cn/p/ar2/","title":"å®‰å“é€†å‘å…¥é—¨äºŒ"},{"content":"çƒ­èº«é¢˜ re1 flag{1c98572d-7f7b-4fbf-8750-4a2986c695ce}\næ³¨æ„åˆ°å¦‚ä¸‹ä»£ç æ˜¯å…³é”®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 v29 = *(_WORD *)v16; v30 = sub_7FF7D5E81800(v4, 1i64); if ( !v30 ) sub_7FF7D5E9AFA0(1i64, v4); v31 = (_BYTE *)v30; for ( i = 0i64; i != v4; ++i ) { HIWORD(v33) = (v29 \u0026gt;\u0026gt; 2) ^ (v29 \u0026gt;\u0026gt; 3) ^ (v29 \u0026gt;\u0026gt; 1); LOWORD(v33) = v29; v29 = v33 \u0026gt;\u0026gt; 1; v34 = __ROL1__(v33, 4); v35 = (4 * (v34 \u0026amp; 0x33)) | (v34 \u0026gt;\u0026gt; 2) \u0026amp; 0x33; v31[i] = *(_BYTE *)(v16 + i) ^ (i + ((2 * (v35 \u0026amp; 0x55)) | (v35 \u0026gt;\u0026gt; 1) \u0026amp; 0x55)); } if ( v4 == 42 \u0026amp;\u0026amp; !memcmp(v31, \u0026amp;unk_7FF7D5E9C458, 42ui64) ) { sub_7FF7D5E817E0(v31, 42i64, 1i64); v39 = \u0026amp;off_7FF7D5E9C4A0; Src = (void *)1; v41 = 8i64; v42 = 0i64; sub_7FF7D5E85750(\u0026amp;v39); } else { sub_7FF7D5E817E0(v31, v4, 1i64); v39 = (void **)\u0026amp;off_7FF7D5E9C488; Src = (void *)1; v41 = 8i64; v42 = 0i64; sub_7FF7D5E85750(\u0026amp;v39); } å…¶å®å°±æ˜¯å¯¹è¾“å…¥åšäº†xorï¼Œç”¨çš„åºåˆ—ä¹Ÿæ˜¯ç”±è¾“å…¥çš„å‰ä¸¤ä¸ªå­—èŠ‚+ä¸‹æ ‡ç”Ÿæˆï¼Œé‚£ä¹ˆz3å°±æ˜¯ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•ã€‚å·æ‡’ç”¨AIå†™çš„ä»£ç ã€‚æ³¨æ„éœ€è¦é™åˆ¶å¼€å¤´å­—ç¬¦æ˜¯flagæ‰èƒ½è§£å‡ºå”¯ä¸€è§£ï¼Œæˆ–è€…ç”¨cfbbçš„è¿™ä¸ªåŠæ³•è·å–æ‰€æœ‰è§£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 from z3 import * def rol1_byte(value: int, shift: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34;Rotate left 1 byte (8 bits) with carry-over\u0026#34;\u0026#34;\u0026#34; shift %= 8 return ((value \u0026lt;\u0026lt; shift) | (value \u0026gt;\u0026gt; (8 - shift))) \u0026amp; 0xFF def transform_data(input_data: bytes) -\u0026gt; bytearray: \u0026#34;\u0026#34;\u0026#34; Replicates the transformation logic from the original code: - Processes each byte with a custom bit manipulation algorithm - Uses a rolling state (v29) that affects subsequent bytes - Applies XOR with transformed index values \u0026#34;\u0026#34;\u0026#34; n = len(input_data) output = bytearray(n) v29 = (input_data[1] \u0026lt;\u0026lt; 8) | input_data[0] for i in range(n): # HIWORD/LOWORD simulation (assuming v33 is 32-bit) hiword = (v29 \u0026gt;\u0026gt; 2) ^ (v29 \u0026gt;\u0026gt; 3) ^ (v29 \u0026gt;\u0026gt; 1) loword = v29 v33 = (hiword \u0026lt;\u0026lt; 16) | (loword \u0026amp; 0xFFFF) v29 = v33 \u0026gt;\u0026gt; 1 # Bit manipulation steps v34 = rol1_byte(v33 \u0026amp; 0xFF, 4) # __ROL1__(v33, 4) v35 = (4 * (v34 \u0026amp; 0x33)) | ((v34 \u0026gt;\u0026gt; 2) \u0026amp; 0x33) # Final XOR operation transformed_index = i + ((2 * (v35 \u0026amp; 0x55)) | ((v35 \u0026gt;\u0026gt; 1) \u0026amp; 0x55)) output[i] = input_data[i] ^ (transformed_index \u0026amp; 0xFF) return output # ç›®æ ‡å¯†æ–‡ Buf2 = bytes([ 0x00, 0xA1, 0xFB, 0x53, 0x1C, 0xFA, 0xF0, 0x1B, 0x06, 0x40, 0xD4, 0x8C, 0x16, 0xF4, 0x90, 0x27, 0x42, 0xB9, 0x8B, 0x0F, 0x02, 0xD7, 0x31, 0xB7, 0x26, 0x12, 0x06, 0x7E, 0xAE, 0xDF, 0xDA, 0x68, 0xAF, 0x35, 0xCC, 0xB7, 0xB0, 0xD0, 0x9A, 0x59, 0x2B, 0x0B ]) # åˆ›å»º Z3 æ±‚è§£å™¨ solver = Solver() # å®šä¹‰è¾“å…¥å˜é‡ï¼ˆæ¯ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ª 8 ä½æ— ç¬¦å·æ•´æ•°ï¼‰ input_bytes = [BitVec(f\u0026#39;byte_{i}\u0026#39;, 8) for i in range(len(Buf2))] # åˆå§‹åŒ–çŠ¶æ€å˜é‡ v29 (32-bit) #v29 = BitVecVal(0, 32) v29 = Concat(input_bytes[1], input_bytes[0]) for i in range(len(Buf2)): # HIWORD/LOWORD è®¡ç®— hiword = (v29 \u0026gt;\u0026gt; 2) ^ (v29 \u0026gt;\u0026gt; 3) ^ (v29 \u0026gt;\u0026gt; 1) loword = v29 v33 = Concat(Extract(15, 0, hiword), Extract(15, 0, loword)) # æ›´æ–° v29 v29 = v33 \u0026gt;\u0026gt; 1 # ROL1(v33, 4) - å–æœ€ä½å­—èŠ‚å¹¶å¾ªç¯å·¦ç§»4ä½ v34_lowbyte = Extract(7, 0, v33) v34 = RotateLeft(v34_lowbyte, 4) # v35 = (4 * (v34 \u0026amp; 0x33)) | ((v34 \u0026gt;\u0026gt; 2) \u0026amp; 0x33) # ä¿®æ­£åçš„è®¡ç®—æ–¹å¼ï¼š part1 = (v34 \u0026amp; 0x33) \u0026lt;\u0026lt; 2 part2 = (v34 \u0026gt;\u0026gt; 2) \u0026amp; 0x33 v35 = part1 | part2 # transformed_index = i + ((2 * (v35 \u0026amp; 0x55)) | ((v35 \u0026gt;\u0026gt; 1) \u0026amp; 0x55)) part_a = (v35 \u0026amp; 0x55) \u0026lt;\u0026lt; 1 part_b = (v35 \u0026gt;\u0026gt; 1) \u0026amp; 0x55 transformed_index = i + (part_a | part_b) # æ·»åŠ çº¦æŸï¼šinput_byte ^ (transformed_indexçš„ä½8ä½) == cipher_byte solver.add(input_bytes[i] ^ Extract(7, 0, transformed_index) == Buf2[i]) # æ£€æŸ¥æ˜¯å¦æœ‰è§£ solver.add(input_bytes[0] == ord(\u0026#39;f\u0026#39;)) solver.add(input_bytes[1] == ord(\u0026#39;l\u0026#39;)) solver.add(input_bytes[2] == ord(\u0026#39;a\u0026#39;)) solver.add(input_bytes[3] == ord(\u0026#39;g\u0026#39;)) def get_models(s, count = 1): result = [] while len(result) \u0026lt; count and s.check() == sat: m = s.model() sol = bytes([m[input_bytes[i]].as_long() for i in range(len(Buf2))]) result.append(sol) # Create a new constraint the blocks the current model block = [] for d in m: # d is a declaration if d.arity() \u0026gt; 0: raise Z3Exception(\u0026#34;uninterpreted functions are not supported\u0026#34;) # create a constant from declaration c = d() if is_array(c) or c.sort().kind() == Z3_UNINTERPRETED_SORT: raise Z3Exception(\u0026#34;arrays and uninterpreted sorts are not supported\u0026#34;) block.append(c != m[d]) s.add(Or(block)) return result m = get_models(solver, 1000) print(m) è¡¥ä¸€ä¸ªcè¯­è¨€è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdint.h\u0026gt; int main() { unsigned char output[42] = { 0x00, 0xA1, 0xFB, 0x53, 0x1C, 0xFA, 0xF0, 0x1B, 0x06, 0x40, 0xD4, 0x8C, 0x16, 0xF4, 0x90, 0x27, 0x42, 0xB9, 0x8B, 0x0F, 0x02, 0xD7, 0x31, 0xB7, 0x26, 0x12, 0x06, 0x7E, 0xAE, 0xDF, 0xDA, 0x68, 0xAF, 0x35, 0xCC, 0xB7, 0xB0, 0xD0, 0x9A, 0x59, 0x2B, 0x0B }; unsigned char input[42] = { 0 }; input[0] = \u0026#39;f\u0026#39;; input[1] = \u0026#39;l\u0026#39;; uint16_t v29 = (input[1] \u0026lt;\u0026lt; 8) | input[0]; for (int i = 0; i \u0026lt; 42; ++i) { uint32_t v33= (((v29 \u0026gt;\u0026gt; 2) ^ (v29 \u0026gt;\u0026gt; 3) ^ (v29 \u0026gt;\u0026gt; 1)) \u0026lt;\u0026lt; 16) | v29; v29 = (v33 \u0026gt;\u0026gt; 1) \u0026amp; 0xFFFF; uint8_t v34 = ((v33 \u0026amp; 0xFF) \u0026lt;\u0026lt; 4) | ((v33 \u0026amp; 0xFF) \u0026gt;\u0026gt; 4); // å¾ªç¯å·¦ç§»4ä½ uint8_t v35 = (4 * (v34 \u0026amp; 0x33)) | ((v34 \u0026gt;\u0026gt; 2) \u0026amp; 0x33); uint8_t combined = (2 * (v35 \u0026amp; 0x55)) | ((v35 \u0026gt;\u0026gt; 1) \u0026amp; 0x55); uint8_t index = (i + combined) \u0026amp; 0xFF; input[i] = output[i] ^ index; } for (int i = 0; i \u0026lt; 42; ++i) { printf(\u0026#34;%c\u0026#34;, input[i]); } return 0; } re2 flag{cdb0444318e24beb8f374e9181599072}\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdint.h\u0026gt; #include \u0026lt;string.h\u0026gt; int main() { uint8_t v8[16] = { 0x0F, 0x0E, 0x0D, 0x0C, 0x0B, 0x0A, 0x09, 0x08, 0x07, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 0x00 }; uint8_t v9[16] = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10 }; const char* target = \u0026#34;cge87k?9\u0026lt;\u0026gt;?@=pss393=\u0026gt;;8@:Cp@DAuH\u0026#34;; uint8_t enc[32]; memcpy(enc, target, 32); uint8_t flag[33]; for (int i = 0; i \u0026lt; 32; i += 16) { // å…ˆå‡å»v9[j] for (int j = 0; j \u0026lt; 16; j++) { flag[i + j] = enc[i + j] - v9[j]; } // åè½¬å—ä»¥å®ç°é€†ç½®æ¢ for (int j = 0; j \u0026lt; 8; j++) { int pos1 = i + j; int pos2 = i + 15 - j; uint8_t temp = flag[pos1]; flag[pos1] = flag[pos2]; flag[pos2] = temp; } } flag[32] = \u0026#39;\\0\u0026#39;; printf(\u0026#34;flag{%s}\\n\u0026#34;, flag); return 0; } //flag{cdb0444318e24beb8f374e9181599072} å¾ˆç®€å•çš„ä¸€é“é¢˜ï¼Œå”¯ä¸€å°±æ˜¯æ¶‰åŠåˆ°ä¸€å®šçš„sseè¯­å¥\n","date":"2025-05-30T23:34:46+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/a0457db2a018c2ee683618e3e5a3b90e_720.jpg","permalink":"https://fanshanng.cn/p/jqctf/","title":"äº¬éº’ctf 2025ï¼ˆå¤ç›˜ä¸­ï¼‰"},{"content":"hookéšè®° æ­¤æ–‡ç›®å‰ä¸ºæ‘˜å½•ä»–äºº\nhookï¼ˆé’©å­ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æœºåˆ¶ï¼Œåœ¨æ“ä½œç³»ç»Ÿã€ç¼–ç¨‹é‡Œä¹Ÿä¼šç”¨åˆ°ã€‚\nhookçš„ä½œç”¨æ˜¯è®©ç¨‹åºèƒ½å¤Ÿåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ’å…¥è‡ªå®šä¹‰ä»£ç ï¼Œæˆ–è€…å¯¹ç³»ç»Ÿè¡Œä¸ºè¿›è¡Œæ‹¦æˆªå’Œä¿®æ”¹ã€‚å®ƒæ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå€ŸåŠ©é¢„ç•™æ¥å£ï¼Œå®ç°å¯¹ç³»ç»Ÿæˆ–æ¡†æ¶åŸæœ‰æµç¨‹çš„æ‰©å±•ä¸å¢å¼ºã€‚\nJavaä¸­æœ‰ä¸€ç§æœºåˆ¶ï¼Œå«åšåŠ¨æ€ä»£ç†ï¼ˆDynamic Proxyï¼‰ï¼Œå®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„è¿è¡Œæ—¶é’©å­ï¼ˆRuntime Hookï¼‰ï¼Œå› ä¸ºå®ƒå…è®¸ä½ åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œæ‹¦æˆªå¹¶å¢å¼ºå¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ã€‚\nåœ¨ç¼–ç¨‹ä¸­ï¼ŒHookï¼ˆé’©å­ï¼‰çš„æœ¬è´¨æ˜¯ä¸€ç§ â€œç¨‹åºæ‹¦æˆªæœºåˆ¶â€ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„å‰æä¸‹ï¼Œä»‹å…¥å¹¶æ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚è¿™ç§æœºåˆ¶é€šè¿‡æ³¨å…¥è‡ªå®šä¹‰é€»è¾‘åˆ°ç°æœ‰ç³»ç»Ÿçš„ç‰¹å®šç‚¹æ¥å®ç°å¢å¼ºæˆ–ä¿®æ”¹åŠŸèƒ½çš„ç›®çš„ã€‚\nä»¥JavaScriptä¸ºä¾‹ï¼Œ æºä»£ç \n1 2 3 4 5 6 function add(a,b){ return a + b } res = add(1,3) console.log(\u0026#34;ç»“æœ: \u0026#34; + res) ç»“æœæ˜¾è€Œæ˜“è§ï¼Œæ˜¯4.\nä½†æ˜¯ï¼Œæˆ‘ä»¬æƒ³åœ¨ä¸æ”¹å˜è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œaddæ–¹æ³•æ—¶ï¼Œåœ¨å…¶å‰é¢æ‰“å°â€addæ–¹æ³•æ‰§è¡Œâ€œï¼Œç»“æŸæ—¶æ‰“å°â€addæ–¹æ³•ç»“æŸâ€œï¼Œå¹¶è®©è¿”å›çš„ç»“æœ+1ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function add(a, b) { return a + b; } const hook = { originalAdd: add // ç«‹å³ä¿å­˜å¼•ç”¨ }; // é‡æ–°å®šä¹‰addå‡½æ•° add = function(a, b) { console.log(\u0026#34;addæ–¹æ³•è°ƒç”¨å‰\u0026#34;); let res = hook.originalAdd(a, b); console.log(\u0026#34;addæ–¹æ³•è°ƒç”¨å\u0026#34;); return res + 1; }; let res = add(1, 3); console.log(\u0026#34;ç»“æœ: \u0026#34; + res); // è¾“å‡º5 ç»“æœå¦‚å›¾ï¼š\nè°ƒç”¨çš„ä»£ç å¹¶æœªå˜åŒ–ï¼Œä½†æ˜¯ç»“æœå‘å£°æ”¹å˜äº†ã€‚ ä¸Šè¿°çš„æ¡ˆä¾‹å°±æ˜¯ä¸€ä¸ªhookçš„è¿‡ç¨‹ã€‚ å®ƒå…ˆå°†åŸå‡½æ•°å¯¹è±¡çš„å¼•ç”¨ï¼ˆå³å†…å­˜åœ°å€ï¼‰ä¿å­˜èµ·æ¥ï¼Œç„¶ååœ¨æ–°å‡½æ•°ä¸­è°ƒç”¨åŸaddå‡½æ•°ï¼Œæœ€åä»¤addæŒ‡å‘ä¸€ä¸ªæ–°å‡½æ•°ã€‚\n","date":"2025-05-30T10:26:28+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/1.jpg","permalink":"https://fanshanng.cn/p/hk/","title":"Hook"},{"content":"å®‰å“é€†å‘å…¥é—¨ä¸€ 0x01 å‰ç½® ä¸‹è½½migisk\nMagiskï¼ˆä¿—ç§°é¢å…·ï¼‰ï¼Œæ˜¯ä¸€ä¸ªROOTå·¥å…·ã€‚\nå®ƒæä¾›äº†å¤šç§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š 1 2 3 4 MagiskSU: æä¾›åº”ç”¨ç¨‹åºçš„ root è®¿é—®æƒé™ã€‚ Magisk æ¨¡å—: é€šè¿‡å®‰è£…æ¨¡å—æ¥ä¿®æ”¹åªè¯»åˆ†åŒºã€‚ MagiskBoot: ç”¨äºè§£åŒ…å’Œé‡æ–°æ‰“åŒ… Android å¯åŠ¨é•œåƒçš„æœ€å®Œæ•´å·¥å…·ã€‚ Zygisk: åœ¨æ¯ä¸ª Android åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ä¸­è¿è¡Œä»£ç ã€‚ ä¸è¦å»Magiskä¸­æ–‡ç½‘,è¿™é‡Œç”¨çš„æ˜¯æ­£å·±æä¾›çš„å®‰è£…åŒ…\nè¿™é‡Œå¦‚æœä¸‹è½½å¤±è´¥çš„è¯ï¼Œå¯ä»¥å»è®¾ç½®é‡Œä¿®æ”¹ä¸‹å›¾é€‰é¡¹\n0x02 apkçš„æ–‡ä»¶ç»“æ„ Apkç»“æ„ apk å…¨ç§° Android Packageï¼Œå®ƒç›¸å½“äºä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œåªè¦åœ¨ç”µè„‘ä¸Šå°†apkåç¼€æ”¹ä¸ºzipå³å¯è§£å‹ã€‚\næ–‡ä»¶ æ³¨é‡Š assetsç›®å½• å­˜æ”¾APKçš„é™æ€èµ„æºæ–‡ä»¶ï¼Œæ¯”å¦‚è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œå›¾ç‰‡ç­‰ lib ç›®å½• armeabi-v7aåŸºæœ¬é€šç”¨æ‰€æœ‰androidè®¾å¤‡ï¼Œarm64-v8aåªé€‚ç”¨äº64ä½çš„androidè®¾å¤‡ï¼Œx86å¸¸è§ç”¨äºandroidæ¨¡æ‹Ÿå™¨ï¼Œå…¶ç›®å½•ä¸‹çš„.soæ–‡ä»¶æ˜¯cæˆ–c++ç¼–è¯‘çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ META-INFç›®å½• ä¿å­˜åº”ç”¨çš„ç­¾åä¿¡æ¯ï¼Œç­¾åä¿¡æ¯å¯ä»¥éªŒè¯APKæ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œç›¸å½“äºAPKçš„èº«ä»½è¯(éªŒè¯æ–‡ä»¶æ˜¯å¦åˆè¢«ä¿®æ”¹) resç›®å½• resç›®å½•å­˜æ”¾èµ„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬å›¾ç‰‡ï¼Œå­—ç¬¦ä¸²ç­‰ç­‰ï¼ŒAPKçš„è„¸è›‹ç”±ä»–çš„layoutæ–‡ä»¶è®¾è®¡ AndroidManifest.xmlæ–‡ä»¶ APKçš„åº”ç”¨æ¸…å•ä¿¡æ¯ï¼Œå®ƒæè¿°äº†åº”ç”¨çš„åå­—ï¼Œç‰ˆæœ¬ï¼Œæƒé™ï¼Œå¼•ç”¨çš„åº“æ–‡ä»¶ç­‰ç­‰ä¿¡æ¯ classes.dexæ–‡ä»¶ classes.dexæ˜¯javaæºç ç¼–è¯‘åç”Ÿæˆçš„javaå­—èŠ‚ç æ–‡ä»¶ï¼ŒAPKè¿è¡Œçš„ä¸»è¦é€»è¾‘ resources.arscæ–‡ä»¶ resources.arscæ˜¯ç¼–è¯‘åçš„äºŒè¿›åˆ¶èµ„æºæ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜ å°„è¡¨ï¼Œæ˜ å°„ç€èµ„æºå’Œidï¼Œé€šè¿‡Ræ–‡ä»¶ä¸­çš„idå°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„èµ„æº demoå®ä¾‹ä¸­å¦å¤–å‡ºç°çš„kotlinä»£è¡¨è¿™ä¸ªapkæ–‡ä»¶å¤§æ¦‚æ˜¯æœ‰kotlinè¯­è¨€ç¼–å†™ï¼ŒOkHttp æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æº HTTP å®¢æˆ·ç«¯åº“ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶ç½‘ç»œè¯·æ±‚ã€‚ Kotlin æ˜¯ä¸€ç§åœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„é™æ€ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œè¢«ç§°ä¹‹ä¸º Android ä¸–ç•Œçš„Swiftï¼Œç”± JetBrains è®¾è®¡å¼€å‘å¹¶å¼€æºã€‚\nKotlin å¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘æˆ JavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰ JVM çš„è®¾å¤‡ä¸Šè¿è¡Œã€‚\nåœ¨Google I/O 2017ä¸­ï¼ŒGoogle å®£å¸ƒ Kotlin æˆä¸º Android å®˜æ–¹å¼€å‘è¯­è¨€ã€‚\n0x03 åŒå¼€åŠåŸç† æŒ‡æ‰‹æœºåŒæ—¶è¿è¡Œä¸¤ä¸ªæˆ–å¤šä¸ªç›¸åŒçš„åº”ç”¨\nã€VirtualAPP åŒå¼€ç³»åˆ—08ã€‘å¦‚ä½•å®ç°å¤šå¼€ - UID\né€šè¿‡åœ¨å®¿ä¸»å®¹å™¨ä¸Šé¢æ–°å»ºä¸€ä¸ªè¿›ç¨‹ä¾›æ’ä»¶ APK å¯„å®¿ï¼Œç„¶åé€šè¿‡ hook ä¸€äº›ç³»ç»Ÿæ¥å£æ¬ºéª—åº”ç”¨â€”è®©è™šæ‹ŸåŒ–ååº”ç”¨ä»¥ä¸ºè‡ªå·±æ˜¯æ­£å¸¸è¿è¡Œçš„ç‹¬ç«‹ APPï¼Œæ¬ºéª—ç³»ç»Ÿâ€”è®©ç³»ç»Ÿè®¤ä¸ºæ­¤è™šæ‹ŸåŒ–åº”ç”¨æ˜¯ä¸€ä¸ªå·²æ­£å¸¸å®‰è£…åœ¨ç³»ç»Ÿçš„åº”ç”¨ã€‚\nåŸç† è§£é‡Š ä¿®æ”¹åŒ…å è®©æ‰‹æœºç³»ç»Ÿè®¤ä¸ºè¿™æ˜¯2ä¸ªAPPï¼Œè¿™æ ·çš„è¯å°±èƒ½ç”Ÿæˆ2ä¸ªæ•°æ®å­˜å‚¨è·¯å¾„ï¼Œæ­¤æ—¶çš„å¤šå¼€å°±ç­‰äºä½ æ‰“å¼€äº†ä¸¤ä¸ªäº’ä¸å¹²æ‰°çš„APP ä¿®æ”¹Framework å¯¹äºæœ‰ç³»ç»Ÿä¿®æ”¹æƒé™çš„å‚å•†ï¼Œå¯ä»¥ä¿®æ”¹Frameworkæ¥å®ç°åŒå¼€çš„ç›®çš„ï¼Œä¾‹å¦‚ï¼šå°ç±³è‡ªå¸¦å¤šå¼€ é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯å®ç° è™šæ‹ŸFrameworkå±‚ã€è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€æ¨¡æ‹ŸAndroidå¯¹ç»„ä»¶çš„ç®¡ç†ã€è™šæ‹Ÿåº”ç”¨è¿›ç¨‹ç®¡ç† ç­‰ä¸€æ•´å¥—è™šæ‹ŸæŠ€æœ¯ï¼Œå°†APKå¤åˆ¶ä¸€ä»½åˆ°è™šæ‹Ÿç©ºé—´ä¸­è¿è¡Œï¼Œä¾‹å¦‚ï¼šå¹³è¡Œç©ºé—´ ä»¥æ’ä»¶æœºåˆ¶è¿è¡Œ åˆ©ç”¨åå°„æ›¿æ¢ï¼ŒåŠ¨æ€ä»£{è¿‡}{æ»¤}ç†ï¼Œhookäº†ç³»ç»Ÿçš„å¤§éƒ¨åˆ†ä¸systemâ€”serverè¿›ç¨‹é€šè®¯çš„å‡½æ•°ï¼Œä»¥æ­¤ä½œä¸ºâ€œæ¬ºä¸Šç’ä¸‹â€çš„ç›®çš„ï¼Œæ¬ºéª—ç³»ç»Ÿâ€œä»¥ä¸ºâ€åªæœ‰ä¸€ä¸ªapkåœ¨è¿è¡Œï¼Œç’è¿‡æ’ä»¶è®©å…¶â€œè®¤ä¸ºâ€è‡ªå·±å·²ç»å®‰è£…ã€‚ä¾‹å¦‚ï¼šVirtualApp 0x04 æ±‰åŒ–APK 1.Arscæ±‰åŒ–\n2.xmlæ±‰åŒ–\n3.Dexæ±‰åŒ– (æ•™ç¨‹é‡Œçš„æ±‰åŒ–æ’ä»¶éœ€è¦vipï¼Œæˆ‘è¿™é‡Œæ˜¯æ‰‹åŠ¨æ”¹çš„ï¼ŒçŸ¥é“åŸç†å°±è¡Œ)\næ•™ç¨‹ä¸­ç”¨åˆ°çš„ä¸»è¦å°±æ˜¯åœ¨mtç®¡ç†å™¨æˆ–è€…npç®¡ç†å™¨ä¸­å¯¹æ–‡ä»¶è¿›è¡Œå­—ç¬¦ä¸²æœç´¢ï¼ˆç®¡ç†å™¨ä¸­è®¾ç½®äº†è‡ªåŠ¨ç­¾åï¼‰ï¼Œå¦‚æœæ‰‹åŠ¨çš„è¯ï¼Œå¯ä»¥åç¼–è¯‘æ”¹æºç ç­‰ apkå®‰è£…åŒ…å¿«é€Ÿåç¼–è¯‘ï¼Œå¤šç§åç¼–è¯‘åŠå¤±è´¥çš„è§£å†³æ–¹æ¡ˆ\nè¿™æ˜¯æ±‰åŒ–å‰â¬‡\nè¿™æ˜¯æ±‰åŒ–ï¼ˆæ‰‹æ”¹ï¼‰åâ¬‡\n0x05 åˆè¯†AndroidManifest.xml AndroidManifest.xmlæ˜¯Androidåº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼Œå®ƒæè¿°äº†packageä¸­æš´éœ²çš„ç»„ä»¶ï¼ˆactivities, services, ç­‰ç­‰ï¼‰ï¼Œä»–ä»¬å„è‡ªçš„å®ç°ç±»ï¼Œå„ç§èƒ½è¢«å¤„ç†çš„æ•°æ®å’Œå¯åŠ¨ä½ç½®ã€‚ é™¤äº†èƒ½å£°æ˜ç¨‹åºä¸­çš„Activities, ContentProviders, Services, å’ŒIntent Receivers,è¿˜èƒ½æŒ‡å®špermissionså’Œinstrumentationï¼ˆå®‰å…¨æ§åˆ¶å’Œæµ‹è¯•ï¼‰ã€‚\næ³¨ï¼šè¿™é‡Œæ–‡ä»¶åä¸èƒ½ä¿®æ”¹\nAndroidManifest.xml æœ€å…¨è¯¦è§£ AndroidManifest.xmlæ–‡ä»¶ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…ƒç´ ï¼š\nå…ƒç´  åŠŸèƒ½æè¿° action æ·»åŠ ä¸€ä¸ªactionåˆ°intent filter activity å£°æ˜ activityç»„ä»¶ activity-alias å£°æ˜activityåˆ«å application å£°æ˜åº”ç”¨ç¨‹åº category æ·»åŠ ä¸€ä¸ªcategoryåç§°åˆ°intent filter compatible-screens å®šä¹‰åº”ç”¨æ‰€å…¼å®¹çš„æ¯ç§å±å¹•é…ç½® data æ·»åŠ æ•°æ®å®šä¹‰åˆ°intent filter grant-uri-permission å®šä¹‰åº”ç”¨æ•°æ®çš„å­é›†ä»¥ä¾›çˆ¶å†…å®¹æä¾›è€…æœ‰æƒé™å¯ä»¥è®¿é—® instrumentation å£°æ˜Instrumentationå·¥å…·ç±»å¹¶æ˜¯æ‚¨å¯ä»¥ç›‘æ§åº”ç”¨ç¨‹åºçš„äº¤äº’ç³»ç»Ÿ intent-filter å®šä¹‰activityã€serviceæˆ–è€…æ˜¯broadcast receiverå¯ä»¥å“åº”çš„æ„å›¾ï¼ˆintentï¼‰ç±»å‹ï¼Œ manifest AndroidManifest.xmlæ–‡ä»¶ä¸­çš„æ ¹å…ƒç´  meta-data ä¸€æ¡é¢å¤–æ·»åŠ çš„åç§°-å€¼å¯¹ï¼Œå¯ä»¥ç»™çˆ¶ç»„ä»¶æä¾›ä»»æ„çš„æ•°æ®ã€‚ path-permission åœ¨content providerå†…å®šä¹‰æ‰€éœ€è·¯å¾„å’Œæƒé™ç‰¹å®šå­é›†æ•°æ® permission å£°æ˜ä¸€ä¸ªå®‰å…¨æƒé™ï¼Œå¯ä»¥ç”¨æ¥é™åˆ¶è®¿é—®ç‰¹å®šåº”ç”¨çš„ç»„ä»¶æˆ–åŠŸèƒ½ permission-group å£°æ˜ä¸€ä¸ªç›¸å…³æƒé™çš„é€»è¾‘ç»„åç§° permission-tree å£°æ˜æƒé™æ ‘çš„åŸºç¡€åç§° provider å£°æ˜ä¸€ä¸ªå†…å®¹æä¾›è€…(content provider)ç»„ä»¶ receiver å£°æ˜ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨(broadcast receiver)ç»„ä»¶ service å£°æ˜ä¸€ä¸ªæœåŠ¡(service)ç»„ä»¶ supports-gl-texture å£°æ˜ä¸€ç§åº”ç”¨å•ä¸€æ”¯æŒçš„GLçº¹ç†(texture)å‹ç¼©æ ¼å¼ supports-screens å£°æ˜åº”ç”¨æ‰€æ”¯æŒçš„å±å¹•å°ºå¯¸å¤§å°ä»¥åŠåœ¨å¯ç”¨å…¼å®¹æ¨¡å¼ä¸‹ç³»ç»Ÿå±å¹•è¶…å‡ºåº”ç”¨æ‰€æ”¯æŒçš„å°ºå¯¸ uses-configuration å£°æ˜åº”ç”¨ç¨‹åºçš„è½¯ç¡¬ä»¶éœ€æ±‚ uses-feature å£°æ˜åº”ç”¨ç¨‹åºéœ€è¦ç”¨åˆ°çš„è½¯ã€ç¡¬ä»¶ç‰¹æ€§ã€‚ uses-library æŒ‡å®šåº”ç”¨ç¨‹åºå¿…é¡»å¼•ç”¨çš„å…±äº«åº“ uses-permission æŒ‡å®šäº†è®©åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œç”¨æˆ·å¿…é¡»æˆäºˆçš„ç³»ç»Ÿæƒé™ã€‚ uses-permission-sdk-23 æŒ‡å®šäº†åº”ç”¨ç¨‹åºåœ¨Android 6.0ä»¥ä¸Šæ‰€éœ€çš„ç‰¹å®šæƒé™ uses-sdk é€šè¿‡APIæ•´æ•°å€¼æ¥å£°æ˜åº”ç”¨ç¨‹åºæ‰€å…¼å®¹çš„Androidå¹³å°ç‰ˆ MTç®¡ç†å™¨ä½¿ç”¨æ‰‹å†Œ\nAndroidé€†å‘0åŸºç¡€å…¥é—¨-APKå…¨é¢è§£æ,åŠ¨è°ƒä¸è„±å£³\n","date":"2025-05-25T16:15:22+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/preview.jpg","permalink":"https://fanshanng.cn/p/ar1/","title":"å®‰å“é€†å‘å­¦ä¹ ä¸€"},{"content":"å¹¶éæ˜¯wpï¼Œè€Œæ˜¯åšé¢˜è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•\nluck_guy ä¸»å‡½æ•° â‘ .Case2 å’Œ case3 åªæ˜¯ä¸€ä¸ªæ‰“å°å‡½æ•°ã€‚ â‘¡.strcat æ˜¯è¿æ¥å­—ç¬¦ä¸²å‡½æ•°ï¼Œæ‰€ä»¥ case4 æ˜¯å¯¹ s èµ‹å€¼å¹¶å°† s ä¸ f2 è¿›è¡Œæ‹¼æ¥ã€‚ â‘¢.case5 æ˜¯å¯¹ f2 è¿›è¡Œå¤„ç†ï¼šj ä¸ºå¥‡æ•°ï¼Œf2 å‡ 2ï¼›j ä¸ºå¶æ•°ï¼Œf2 å‡ 1ã€‚ â‘£.Case1 æ˜¯è¦å¾—åˆ° flagï¼Œé¦–å…ˆmemsetå‡½æ•°å…ˆå¯¹ s è¿›è¡Œåˆå§‹åŒ–ï¼Œs å˜æˆäº†ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæ‰€ä»¥ä¹‹åçš„ strcat å‡½æ•°ç›¸å½“äºç›´æ¥æŠŠ f1 å¤åˆ¶åˆ°äº† s é‡Œï¼Œå†ä¹‹åçš„ strcat å‡½æ•°å°† s ä¸ f2 è¿æ¥ç›¸å½“äº f1 ä¸ f2 è¿æ¥ï¼Œæœ€ç»ˆæ‰“å°å‡ºæ¥çš„ flag å°±æ˜¯ f1 åŠ ä¸Š f2ã€‚ s=0x7F666F6067756369LLï¼ŒæŒ‰ré”®å°†å®ƒè½¬æ¢ä¸ºå­—ç¬¦å°±æ˜¯â€œ\\x7Ffo`guciâ€ï¼Œè¿™é‡Œè¦æ³¨æ„æ˜¯å°ç«¯åºå­˜å‚¨ï¼æ‰€ä»¥è¦æŠŠå­—ç¬¦é¡ºåºåè¿‡æ¥ï¼Œå°±æ˜¯â€œicug`of\\x7Fâ€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #include \u0026lt;iostream\u0026gt; using namespace std; int main() { char f2[] = \u0026#34;icug`of\\x7F\u0026#34;; for (int j = 0; j \u0026lt; 8; ++j) { if ( j % 2 == 1 ) f2[j]-=2; else f2[j]--; } printf(\u0026#34;%s\u0026#34;,f2); return 0; } åˆ®å¼€æœ‰å¥– åŠ å¯†é€»è¾‘å…¶å®æŒºæ¸…æ™°çš„ä¸€é“é¢˜ï¼Œå¿«é€Ÿæ’åº+base64ç¼–ç ï¼Œå¿«é€Ÿæ’åºè¿™é‡Œä¸æ‡‚çš„è¯å¯ä»¥å»é—®aiï¼Œä¸è¿‡è¿˜æ˜¯è¦è‡ªå·±åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥æŠŠä»£ç å¤åˆ¶ä¸‹æ¥åœ¨vscodeä¸­è¿è¡Œä¸€éçœ‹çœ‹ç»“æœ ä½†æ˜¯ç¬¬ä¸€æ¬¡ç–‘æƒ‘çš„åœ°æ–¹æ˜¯åŠ å¯†æ’åºé‚£ä¸ªæ•°ç»„a1åªåˆå§‹åŒ–äº†ä¸¤ä¸ªæ•°ï¼Œä½†æ˜¯å®ƒçš„ç»“æŸç´¢å¼•å´æ˜¯åã€‚è¿™é‡Œå­¦åˆ°çš„çŸ¥è¯†æ˜¯ï¼š\næ ¹æ®è¿™æ®µåˆå§‹åŒ–ï¼ŒçŸ¥é“è¿™æ®µçš„åœ°å€æ˜¯è¿ç»­çš„ã€‚æ‰€ä»¥å®é™…ä¸Šæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º11çš„æ•°ç»„ï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸åŠ¨è°ƒï¼ŒF9ç‚¹å¼€åè°ƒä¸äº†ä¸€ç‚¹ ç„¶åå°±æ˜¯\nå¯¹æ¯”åˆ¤æ–­çš„æ—¶å€™è¿™é‡Œç”¨çš„æ˜¯åœ°å€å¤„çš„å€¼ä¹Ÿå°±æ˜¯è¯´æ˜¯æ’åºåçš„å€¼\nç„¶åè¦æä¸€å˜´çš„æ˜¯\nå…·ä½“å¯ä»¥å»çœ‹è¿™é‡Œ WinMainå‡½æ•° ï¼ˆwinbase.hï¼‰ WinMain å‡½æ•°ï¼ˆWindowså›¾å½¢åº”ç”¨ç¨‹åºå…¥å£ç‚¹ï¼‰\n1 2 3 4 5 6 int __clrcall WinMain( [in] HINSTANCE hInstance, [in, optional] HINSTANCE hPrevInstance, [in] LPSTR lpCmdLine, [in] int nShowCmd ); å‚æ•°ï¼š hInstanceï¼šå½“å‰åº”ç”¨ç¨‹åºå®ä¾‹çš„å¥æŸ„ã€‚ hPrevInstanceï¼šä¸Šä¸€ä¸ªå®ä¾‹çš„å¥æŸ„ï¼ˆåœ¨ç°ä»£Windowsä¸­å§‹ç»ˆä¸ºNULLï¼‰ã€‚ lpCmdLineï¼šå‘½ä»¤è¡Œå‚æ•°ï¼Œä¸åŒ…æ‹¬ç¨‹åºåç§°ã€‚ nShowCmdï¼šæ§åˆ¶çª—å£æ˜¾ç¤ºæ–¹å¼çš„æ ‡å¿—ã€‚ è¿”å›å€¼ï¼šç¨‹åºçš„é€€å‡ºçŠ¶æ€ç ï¼Œé€šå¸¸è¿”å› WM_QUIT æ¶ˆæ¯çš„ wParam å‚æ•°å€¼ã€‚\neasyre è„±å£³åçš„ä¸»å‡½æ•° åˆ†ææ¯”è¾ƒè¯­å¥ï¼Œå¤§è‡´çŒœåˆ°v5å°±æ˜¯è¾“å…¥çš„å‡½æ•°ï¼Œè¿™é‡Œçš„æ„æ€æ˜¯è¾“å…¥å­—ç¬¦çš„asciiå€¼+1åä½œä¸ºç´¢å¼•è¿›è¡Œåˆ¤æ–­\npythonä¸­çš„find()å‡½æ•°æ˜¯æ‰¾åˆ°å¯¹åº”çš„ä¸‹æ ‡å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 U U9 U9X U9X_ U9X_1 U9X_1S U9X_1S_ U9X_1S_W U9X_1S_W6 U9X_1S_W6@ U9X_1S_W6@T U9X_1S_W6@T? [GUET-CTF2019]re è€ƒz3å¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 from z3 import * solver = Solver() # ä½¿ç”¨Intç±»å‹è€ŒéBitVecï¼Œå¹¶æ·»åŠ å­—ç¬¦èŒƒå›´çº¦æŸ a1 = [Int(f\u0026#39;a1_{i}\u0026#39;) for i in range(32)] # æ·»åŠ æ‰€æœ‰ç­‰å¼çº¦æŸ solver.add(1629056 * a1[0] == 166163712) solver.add(6771600 * a1[1] == 731332800) solver.add(3682944 * a1[2] == 357245568) solver.add(10431000 * a1[3] == 1074393000) solver.add(3977328 * a1[4] == 489211344) solver.add(5138336 * a1[5] == 518971936) solver.add(7532250 * a1[7] == 406741500) solver.add(5551632 * a1[8] == 294236496) solver.add(3409728 * a1[9] == 177305856) solver.add(13013670 * a1[10] == 650683500) solver.add(6088797 * a1[11] == 298351053) solver.add(7884663 * a1[12] == 386348487) solver.add(8944053 * a1[13] == 438258597) solver.add(5198490 * a1[14] == 249527520) solver.add(4544518 * a1[15] == 445362764) solver.add(3645600 * a1[17] == 174988800) solver.add(10115280 * a1[16] == 981182160) solver.add(9667504 * a1[18] == 493042704) solver.add(5364450 * a1[19] == 257493600) solver.add(13464540 * a1[20] == 767478780) solver.add(5488432 * a1[21] == 312840624) solver.add(14479500 * a1[22] == 1404511500) solver.add(6451830 * a1[23] == 316139670) solver.add(6252576 * a1[24] == 619005024) solver.add(7763364 * a1[25] == 372641472) solver.add(7327320 * a1[26] == 373693320) solver.add(8741520 * a1[27] == 498266640) solver.add(8871876 * a1[28] == 452465676) solver.add(4086720 * a1[29] == 208422720) solver.add(9374400 * a1[30] == 515592000) solver.add(5759124 * a1[31] == 719890500) # ç¡®ä¿æ¯ä¸ªå­—ç¬¦åœ¨0-255èŒƒå›´å†…ï¼ˆASCIIï¼‰ for c in a1: solver.add(c \u0026gt;= 0, c \u0026lt;= 255) if solver.check() == sat: model = solver.model() flag = \u0026#39;\u0026#39;.join([chr(model[c].as_long()) for c in a1]) # type: ignore print(\u0026#34;\u0026#34;, flag) else: print(\u0026#34;æ— è§£\u0026#34;) # flag{e65421110ba03099a1c039337} ä½†æ˜¯ç–‘æƒ‘çš„æ˜¯å°‘äº†ä¸€ä½ï¼Œæœ€åçœ‹åˆ«äººé¢˜è§£éƒ½æ˜¯çˆ†ç ´å‡ºæ¥çš„ï¼ˆï¼Œa1[6]=\u0026lsquo;1\u0026rsquo;, æ‰€ä»¥æ­£ç¡®çš„åº”è¯¥æ˜¯flag{e165421110ba03099a1c039337}\nCrackRTF è¿™é“é¢˜çš„è€ƒç‚¹æ˜¯rtfæ–‡ä»¶,ä¸»è¦çš„é€»è¾‘æ˜¯å…ˆè¾“å…¥å…­ä¸ªæ•°å­—æ‹¼æ¥@DBAppç„¶ååˆ¤æ–­hash-sha1ç¼–ç ï¼Œè¿™é‡Œçˆ†ç ´å‡ºçš„ç»“æœæ˜¯123321ï¼Œç„¶åæ˜¯é•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²ï¼Œæ‹¼æ¥åœ¨ä¸€èµ·è¿›è¡ŒMD5ç¼–ç ï¼Œç”±äºMD5ç¼–ç ä¸å¯é€†ï¼Œæˆ‘å°è¯•è¿‡çˆ†ç ´ï¼Œç”Ÿæˆæ‰€æœ‰ 6 ä½ç»„åˆï¼Œæ€»æ•°ä¸º 95^6 â‰ˆ 735 äº¿æ¬¡ï¼Œé‚æ”¾å¼ƒã€‚\nRTFæ˜¯Rich Text Formatçš„ç¼©å†™ï¼Œæ„å³å¤šæ–‡æœ¬æ ¼å¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 char __cdecl sub_4014D0(LPCSTR Destination) { LPCVOID lpBuffer; // [esp+50h] [ebp-1Ch] DWORD NumberOfBytesWritten; // [esp+58h] [ebp-14h] BYREF DWORD nNumberOfBytesToWrite; // [esp+5Ch] [ebp-10h] HGLOBAL hResData; // [esp+60h] [ebp-Ch] HRSRC hResInfo; // [esp+64h] [ebp-8h] HANDLE hFile; // [esp+68h] [ebp-4h] hFile = 0; hResData = 0; nNumberOfBytesToWrite = 0; NumberOfBytesWritten = 0; hResInfo = FindResourceA(0, (LPCSTR)0x65, \u0026#34;AAA\u0026#34;);// FindResourceA å‡½æ•°ç”¨äºæŸ¥æ‰¾ç¨‹åºèµ„æºä¸­çš„ä¸€ä¸ªèµ„æºã€‚ // ç¬¬ä¸€ä¸ªå‚æ•°ä¸º NULLï¼Œè¡¨ç¤ºæŸ¥æ‰¾å½“å‰è¿›ç¨‹çš„èµ„æºã€‚ // ç¬¬äºŒä¸ªå‚æ•°ä¸ºèµ„æºæ ‡è¯†ç¬¦ï¼Œè¿™é‡Œæ˜¯ 0x65ã€‚ // ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºèµ„æºç±»å‹ï¼Œè¿™é‡Œæ˜¯ \u0026#34;AAA\u0026#34;ã€‚ if ( !hResInfo ) return 0; nNumberOfBytesToWrite = SizeofResource(0, hResInfo);// SizeofResource å‡½æ•°ç”¨äºè·å–èµ„æºçš„å¤§å°ã€‚ // å¦‚æœèµ„æºå¤§å°ä¸º 0ï¼Œè¡¨ç¤ºèµ„æºæ— æ•ˆã€‚ hResData = LoadResource(0, hResInfo); // LoadResource å‡½æ•°ç”¨äºåŠ è½½èµ„æºã€‚ if ( !hResData ) return 0; lpBuffer = LockResource(hResData); // LockResource å‡½æ•°ç”¨äºé”å®šèµ„æºï¼Œå¹¶è¿”å›èµ„æºçš„æŒ‡é’ˆã€‚ sub_401005(Destination, (int)lpBuffer, nNumberOfBytesToWrite);// å¼‚æˆ– hFile = CreateFileA(\u0026#34;dbapp.rtf\u0026#34;, GENERIC_ALL, 0, 0, CREATE_ALWAYS, FILE_READ_ATTRIBUTES, 0);// CreateFileA å‡½æ•°ç”¨äºåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€‚ // æ–‡ä»¶åä¸º \u0026#34;dbapp.rtf\u0026#34;ã€‚ // æ‰“å¼€æ¨¡å¼ä¸º CREATE_ALWAYSï¼Œè¡¨ç¤ºå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨åˆ™è¦†ç›–ã€‚ // æ–‡ä»¶è®¿é—®æƒé™ä¸º GENERIC_ALLï¼Œè¡¨ç¤ºå®Œå…¨è®¿é—®æƒé™ã€‚ if ( hFile == (HANDLE)-1 ) // å¦‚æœæ–‡ä»¶åˆ›å»ºå¤±è´¥ï¼Œè¿”å› 0ã€‚ return 0; if ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, \u0026amp;NumberOfBytesWritten, 0) ) return 0; CloseHandle(hFile); // å…³é—­æ–‡ä»¶å¥æŸ„ã€‚ return 1; } è¿™é‡Œå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„ä¸œè¥¿æ‹¼æ¥åä¸â€œAAAâ€æ–‡ä»¶ä¸­çš„è¯»å–çš„å‰å‡ ä½å¼‚æˆ–\nä»ç½‘ä¸Šæ‰¾åˆ°rtfçš„ç¤ºä¾‹æ–‡ä»¶ä¸‹ä¸‹æ¥å¯¹æ¯”å‘ç°å‰å‡ ä½éƒ½æ˜¯ä¸€æ ·çš„\næŠŠå‰å‡ ä½æˆªä¸‹æ¥ï¼Œç„¶åè¿›è¡Œå¼‚æˆ–å¤„ç†å°±èƒ½å¾—åˆ°å‰å…­ä½~!3a@0123321,å¾ˆæ˜æ˜¾**~!3a@0**ä¸ºæ‰€æ±‚ã€‚äºæ˜¯åœ¨idaä¸­åŠ¨è°ƒï¼Œç”Ÿæˆrtfæ–‡ä»¶ï¼Œæ‰“å¼€åå¾—åˆ°flag ezpy.exe 1. åˆå§‹ä¾¦å¯Ÿ (Initial Reconnaissance) æ‹¿åˆ°é¢˜ç›®æ–‡ä»¶ ezpy.exe åï¼Œé¦–å…ˆéœ€è¦ç¡®å®šå…¶æ–‡ä»¶ç±»å‹ã€‚\næŸ¥å£³/è¯†åˆ«: è¿™æ˜¯ä¸€ä¸ª Windows å¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šå¸¸ Python é€†å‘é¢˜ç›®éƒ½æ˜¯ç”± PyInstaller æˆ– py2exe æ‰“åŒ…çš„ã€‚ ç‰¹å¾: æ–‡ä»¶å›¾æ ‡ã€å­—ç¬¦ä¸²ä¿¡æ¯é€šå¸¸ä¼šæš´éœ²å®ƒæ˜¯ PyInstaller æ‰“åŒ…çš„ã€‚ è§£åŒ…: ä½¿ç”¨å·¥å…· pyinstxtractor.py å¯¹ ezpy.exe è¿›è¡Œè§£åŒ…ã€‚ 1 python pyinstxtractor.py ezpy.exe è§£åŒ…åå¾—åˆ° ezpy.exe_extracted æ–‡ä»¶å¤¹ã€‚\n2. Python å±‚åˆ†æ (Python Layer Analysis) åœ¨è§£åŒ…åçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¯»æ‰¾å…¥å£ç‚¹ã€‚é€šå¸¸ä¸ EXE åŒåçš„ .pyc æ–‡ä»¶æ˜¯å…¥å£è„šæœ¬ã€‚\nç›®æ ‡æ–‡ä»¶: ezpy.pyc ç‰ˆæœ¬è¯†åˆ«: æ£€æŸ¥æ–‡ä»¶å¤´ Magic Number ä¸º 3571ï¼Œç¡®è®¤ä¸º Python 3.13ã€‚ 2.1 åç¼–è¯‘æŒ‘æˆ˜ å°è¯•ä½¿ç”¨ä¼ ç»Ÿçš„ uncompyle6 æˆ– decompyle3 å¤±è´¥ï¼ŒåŸå› å¦‚ä¸‹ï¼š\nç‰ˆæœ¬è¿‡æ–°: è¿™äº›å·¥å…·ä¸»è¦æ”¯æŒåˆ° Python 3.8/3.9ï¼Œæ— æ³•è§£æ Python 3.13 çš„æ–°æŒ‡ä»¤é›†ï¼ˆå¦‚ CACHE, RESUME ç­‰ï¼‰ã€‚ å·¥å…·æŠ¥é”™: å¼ºåˆ¶è¿è¡Œä¼šæŠ›å‡º Magic Number ä¸åŒ¹é…æˆ– Crashã€‚ 2.2 å­—èŠ‚ç åˆ†ææ–¹æ¡ˆ é’ˆå¯¹é«˜ç‰ˆæœ¬ Pythonï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹ä¸¤ç§æœ‰æ•ˆæ–¹æ¡ˆï¼š\næ–¹æ¡ˆ Aï¼šä½¿ç”¨ xdis åº“çš„ pydisasm (æ¨è) å¦‚æœç¯å¢ƒä¸­å®‰è£…äº† xdis (pip install xdis)ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ pydisasm å‘½ä»¤ï¼Œå®ƒå¯¹å¤šç‰ˆæœ¬ Python æ”¯æŒæå¥½ã€‚\n1 pydisasm ezpy.pyc æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Python å†…ç½® dis æ¨¡å— (åŸç”Ÿ) åˆ©ç”¨å½“å‰ç¯å¢ƒçš„ Python 3.13 è§£é‡Šå™¨ï¼Œç¼–å†™è„šæœ¬æ‰‹åŠ¨åæ±‡ç¼–ã€‚è¿™æ˜¯æœ€å‡†ç¡®çš„æ–¹æ³•ã€‚\n1 2 3 4 5 import marshal, dis with open(\u0026#34;ezpy.pyc\u0026#34;, \u0026#34;rb\u0026#34;) as f: f.seek(16) # è·³è¿‡ 16 å­—èŠ‚æ–‡ä»¶å¤´ code = marshal.load(f) dis.dis(code) 2.3 é€»è¾‘è¿˜åŸ é€šè¿‡åˆ†æåæ±‡ç¼–è¾“å‡ºï¼ˆå…³é”®æŒ‡ä»¤å¦‚ä¸‹ï¼‰ï¼š\nIMPORT_NAME (mypy): å¯¼å…¥æ‰©å±•æ¨¡å—ã€‚ LOAD_GLOBAL (input) + CALL: è·å–è¾“å…¥ã€‚ LOAD_GLOBAL (check) + CALL: è°ƒç”¨ mypy.check()ã€‚ POP_JUMP_IF_FALSE: æ ¹æ®æ£€æŸ¥ç»“æœè·³è½¬åˆ†æ”¯ã€‚ è¿˜åŸåçš„ Python æºç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 try: from mypy import check except ImportError: print(\u0026#39;Error: Cannot import mypy module\u0026#39;) exit(1) def main(): user_input = input(\u0026#39;Please input your flag: \u0026#39;).strip() if check(user_input): print(\u0026#39;Correct!\u0026#39;) else: print(\u0026#39;Wrong!\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: main() ç»“è®ºï¼šæ ¸å¿ƒæ ¡éªŒé€»è¾‘ä¸‹æ²‰åˆ°äº† mypy æ¨¡å—ä¸­ã€‚åœ¨è§£åŒ…ç›®å½•ä¸­æ‰¾åˆ°äº† mypy.cp313-win_amd64.pydï¼Œè¿™æ˜¯ä¸€ä¸ª C++ ç¼–å†™çš„ Python æ‰©å±•ï¼ˆæœ¬è´¨æ˜¯ DLLï¼‰ã€‚\n3. Native å±‚åˆ†æ (C Extension Analysis) ä½¿ç”¨ IDA Pro (æˆ–é€šè¿‡ MCP è¿æ¥) åˆ†æ mypy.cp313-win_amd64.pydã€‚\n3.1 å®šä½å…³é”®å‡½æ•° Python æ‰©å±•é€šå¸¸å¯¼å‡ºä¸€ä¸ªåˆå§‹åŒ–å‡½æ•° PyInit_mypyã€‚\næ‰¾åˆ° PyInit_mypyã€‚ æŸ¥çœ‹å…¶è¿”å›çš„ PyModuleDef ç»“æ„ä½“ã€‚ åœ¨ PyModuleDef ä¸­æ‰¾åˆ° m_methods (æ–¹æ³•è¡¨)ã€‚ æ–¹æ³•è¡¨ä¸­åŒ…å«æ¨¡å—å¯¼å‡ºçš„å‡½æ•°åå’Œå¯¹åº”çš„ C å‡½æ•°åœ°å€ã€‚ å‘ç°å¯¼å‡ºå‡½æ•° \u0026quot;check\u0026quot; å¯¹åº”åœ°å€ 0x36F4D1519 (åç§»åœ°å€)ã€‚ 3.2 åˆ†æ check å‡½æ•° (sub_36F4D1519) åç¼–è¯‘è¯¥å‡½æ•°ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š\nå‚æ•°è§£æ: æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ã€‚ é•¿åº¦æ£€æŸ¥: æ£€æŸ¥è¾“å…¥é•¿åº¦æ˜¯å¦ä¸º 25ã€‚ å¯†é’¥å‡†å¤‡: ä»£ç ä¸­ç¡¬ç¼–ç äº†å­—ç¬¦ä¸² \u0026quot;ISCTF2025\u0026quot;ã€‚ åŠ å¯†ç®—æ³•: è°ƒç”¨äº†ä¸€ä¸ªå­å‡½æ•° sub_36F4D149Cã€‚ åˆ†æè¯¥å­å‡½æ•°ï¼Œå‘ç°å…¸å‹çš„ RC4 ç®—æ³•ç‰¹å¾ï¼ˆ256æ¬¡å¾ªç¯åˆå§‹åŒ– S ç›’ï¼Œå¼‚æˆ–äº¤æ¢ï¼‰ã€‚ å¯†é’¥ä¸º \u0026quot;ISCTF2025\u0026quot;ã€‚ æ¯”è¾ƒé€»è¾‘: å°†ç”¨æˆ·è¾“å…¥ç»è¿‡ RC4 åŠ å¯†åçš„å¯†æ–‡ï¼Œä¸å…¨å±€å˜é‡ byte_36F4D4050 å¤„çš„å­—èŠ‚æ•°ç»„è¿›è¡Œé€å­—èŠ‚æ¯”è¾ƒã€‚ 4. æ•°æ®æå– (Data Extraction) æˆ‘ä»¬éœ€è¦æå–ç”¨äºæ¯”è¾ƒçš„å¯†æ–‡æ•°æ®ã€‚\nç›®æ ‡åœ°å€: 0x36F4D4050 æ•°æ®é•¿åº¦: 25 å­—èŠ‚ (ç”±è¾“å…¥é•¿åº¦é™åˆ¶æ¨æ–­)ã€‚ æå–å›°éš¾: åœ¨åŠ¨æ€è°ƒè¯•æˆ– MCP å·¥å…·å—é™ï¼ˆæ— æ³•ç›´æ¥è¯»å–å†…å­˜å­—èŠ‚ï¼‰çš„æƒ…å†µä¸‹ï¼Œéœ€è¦é™æ€æå–ã€‚ é™æ€æå–æ–¹æ³•: è®¡ç®— RVA (ç›¸å¯¹è™šæ‹Ÿåœ°å€): 0x36F4D4050 - åŸºå€ 0x36F4D0000 = 0x4050ã€‚ æŸ¥çœ‹ PE èŠ‚è¡¨ (Section Table): .rdata èŠ‚çš„è™šæ‹Ÿåœ°å€ (Virtual Address) é€šå¸¸åŒ…å«æ­¤èŒƒå›´ã€‚ è®¡ç®—æ–‡ä»¶åç§» (File Offset) = RVA - èŠ‚è™šæ‹Ÿåœ°å€ + èŠ‚åŸå§‹æ•°æ®åç§» (PointerToRawData)ã€‚ ç¼–å†™è„šæœ¬ (inspect_pe.py) è¯»å–æ–‡ä»¶å¹¶æå–è¿™ 25 ä¸ªå­—èŠ‚ã€‚ æå–åˆ°çš„å¯†æ–‡ (Hex): 1d d5 38 33 af b5 51 f3 2c 6b 6e fe 41 24 43 d2 71 cf a4 4c e3 9a 9a b5 31\n5. è§£å¯† (Decryption) RC4 æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ŒåŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ç›¸åŒã€‚\nç®—æ³•: RC4 å¯†é’¥: ISCTF2025 å¯†æ–‡: ä¸Šè¿°æå–çš„ 25 å­—èŠ‚ã€‚ ç¼–å†™è„šæœ¬ (solve_flag.py) è¿è¡Œè§£å¯†ï¼š\n1 2 3 key = b\u0026#34;ISCTF2025\u0026#34; ciphertext = [...] # æå–çš„æ•°æ® print(rc4(key, ciphertext)) æœ€ç»ˆ Flag: ISCTF{Y0U_GE7_7HE_PYD!!!}\næ€»ç»“ (Summary) è¿™æ˜¯ä¸€é“å…¸å‹çš„ Python + C æ‰©å±•é€†å‘é¢˜ã€‚\nå…¥å£: PyInstaller è§£åŒ…ã€‚ å®šä½: å‘ç°é€»è¾‘ä¸‹æ²‰åˆ° .pyd (DLL)ã€‚ é€†å‘: è¯†åˆ«æ ‡å‡†åŠ å¯†ç®—æ³• (RC4)ã€‚ æ•°æ®: ä»äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æå–åŠ å¯†å¸¸é‡ã€‚ è¿˜åŸ: ç¼–å†™è„šæœ¬è§£å¯†ã€‚ ","date":"2025-05-22T21:08:17+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/2.jpg","permalink":"https://fanshanng.cn/p/buuctf/","title":"Buuctfåˆ·é¢˜è®°å½•"},{"content":"BigBanana ç¬¬ä¸€æ¬¡åšvmé¢˜ï¼Œåšäº†æŒºä¹…å°±æ¥å¥½å¥½è®°å½•ä¸€ä¸‹ é‚£CTFï¼Œé‚£VMreï¼Œé‚£äº›äº‹ï¼ˆä¸€ï¼‰ VMé€†å‘ï¼Œä¸€ç¯‡å°±å¤Ÿäº† è¿™ä¸¤ç¯‡æ–‡ç« è®©æˆ‘æ”¶è·å¾ˆå¤§ï¼Œäº†è§£äº†åŸºç¡€çš„vmç»„æˆç»“æ„ï¼Œå’ŒåŸºç¡€çš„è§£é¢˜æ–¹æ³•ã€‚\nè¿™é“é¢˜è™½è¯´æ˜¯vmé¢˜ï¼Œä½†åˆä¸å®Œå…¨æ˜¯ï¼Œæ€»ä½“ç»“æ„å¾ˆç®€å•ï¼Œä¸€ä¸ªç±»ä¼¼äº VM çš„ä¸œè¥¿ï¼Œæœ‰ä¸€ä¸ªæ ˆã€ä¸€ä¸ªæŒ‡ä»¤åºåˆ—å’Œ 4 ä¸ªå¯„å­˜å™¨ã€‚ æ‰“å¼€ä¸»å‡½æ•°èƒ½å¾ˆæ˜æ˜¾çš„çœ‹åˆ°æ“ä½œå­—èŠ‚ç ä¸å¯¹åº”çš„handleå‡½æ•°ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„æ˜¯å·²ç»å‡ä¸€åçš„ç»“æœ å†æŸ¥çœ‹å‡½æ•°è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜æ˜¯æœ‰ç‚¹çœ‹ä¸æ‡‚å¤„ç†å‡½æ•°çš„ä½œç”¨ï¼Œå¹¶ä¸”æå–å‡ºæ¥çš„opcodeæ˜¯byteç±»å‹ä¸æ˜¯dwordï¼ˆbyteç±»å‹ä¹Ÿèƒ½åšï¼Œåé¢ä¼šè®²ï¼‰ æå–å‡ºopcodeåï¼Œèƒ½å¾ˆæ˜æ˜¾çœ‹åˆ°ï¼Œå‰é¢å¾ˆé•¿ä¸€æ®µéƒ½æ˜¯ç”¨æ¥æ‰“å°ä¸€æ®µè¯çš„ï¼Œæ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä¸»è¦æ˜¯eip=2888åé¢çš„ï¼ˆå³inputåé¢çš„) æ€è·¯æ–‡æ¡£å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 F4, 01 â½´å³æ•°åŠ æ³• F4æ˜¯R1åŠ  ï¼Œ01æ˜¯R2åŠ  F3 ä¸¤ä¸ªæ•°å¼‚æˆ– èµ‹å€¼ç»™R1 F2 cmp åâ¾¯è·Ÿç€åº”è¯¥çš„ç»“æœ FE å¯¹cmpçš„ç»“æœè¿›è¡Œcheck F0 æŠŠä¸Šâ¼€æ¬¡ç»“æœä¿å­˜ 10 getcharå¹¶æ¨ä¸Šæ ˆ F8 push æ ˆ[0]å­—ç¬¦ å‡ºR2 F7 push æ ˆ[1]å­—ç¬¦ å‡ºR1 è¿™é‡Œf8(R2)æŒ‡å‘694e694dï¼Œf7(R1)æŒ‡å‘74632d4c 10 10 f8 f7 f4 694e694d 01 74632d4c f4 00 f3 f2 1d2d440f fe (R1+694e694d+00)^(R2+74632d4c)=1d2d440f,æ£€æŸ¥ï¼Œä¿å­˜ 66 f0 10 f8 f4 16 01 21 f4 114514 f3 f2 74747250 fe æ­¤æ—¶è¾“å…¥çš„å€¼å¼¹åˆ°R2é‡Œäº† æ‰€ä»¥å°±æ˜¯(input+21)^(74632d4c(R1å³å‰ä¸€ä¸ªå­—ç¬¦)+16+114514) 66 f0 10 f8 f4 21 01 2c f4 228a28 f3 f2 228a4d fe 66 f0 10 f8 f4 2c 01 0b f4 33cf3c f3 f2 33cfaa fe 66 f0 10 f8 f4 0b 01 16 f4 451450 f3 f2 4514cb fe 66 f0 10 f8 f4 16 01 21 f4 565964 f3 f2 565966 fe 66 f0 10 f8 f4 21 01 2c f4 679e78 f3 f2 679fbc fe 66 f0 10 f8 f4 2c 01 0b f4 78e38c f3 f2 78e4cc fe 66 f0 10 f8 f4 0b 01 16 f4 8a28a0 f3 f2 8a2949 fe 66 f0 10 f8 f4 16 01 21 f4 9b6db4 f3 f2 9b6ec8 fe 66 f0 10 f8 f4 21 01 2c f4 acb2c8 f3 f2 acb3e0 fe 66 f0 10 f8 f4 2c 01 0b f4 bdf7dc f3 f2 bdf8f6 fe 66 f0 10 f8 f4 0b 01 16 f4 cf3cf0 f3 f2 cf3d22 fe 66 f0 10 f8 f4 16 01 21 f4 e08204 f3 f2 e082eb fe 66 f0 10 f8 f4 21 01 2c f4 f1c718 f3 f2 f1c745 fe 66 f0 10 f8 f4 2c 01 0b f4 1030c2c f3 f2 1030c9c fe 66 f0 10 f8 f4 0b 01 16 f4 1145140 f3 f2 114518e fe 66 f0 10 f8 f4 16 01 21 f4 1259654 f3 f2 1259634 fe 66 f0 10 f8 f4 21 01 2c f4 136db68 f3 f2 136dc9c fe 66 f0 10 f8 f4 2c 01 0b f4 148207c f3 f2 148217d fe 66 f0 10 f8 f4 0b 01 16 f4 1596590 f3 f2 15965ae fe 66 f0 10 f8 f4 16 01 21 f4 16aaaa4 f3 f2 16aabb8 fe 66 f0 10 f8 f4 21 01 2c f4 17befb8 f3 f2 17bf02f fe 66 f0 10 f8 f4 2c 01 0b f4 18d34cc f3 f2 18d352a fe 66 f0 10 f8 f4 0b 01 16 f4 19e79e0 f3 f2 19e7ae7 fe 66 f0 10 f8 f4 16 01 21 f4 1afbef4 f3 f2 1afbf19 fe 66 f0 10 f8 f4 21 01 2c f4 1c10408 f3 f2 1c1043c fe 66 f0 10 f8 f4 2c 01 0b f4 1d2491c f3 f2 1d249a4 fe 66 f0 10 f8 f4 0b 01 16 f4 1e38e30 f3 f2 1e38e3e fe 66 f0 10 f8 f4 16 01 21 f4 1f4d344 f3 f2 1f4d3b0 fe 66 f0 10 f8 f4 21 01 2c f4 2061858 f3 f2 2061853 fe 66 f0 10 f8 f4 2c 01 0b f4 2175d6c f3 f2 2175e76 fe 66 f0 10 f8 f4 0b 01 16 f4 228a280 f3 f2 228a241 fe 66 f0 10 f8 f4 16 01 21 f4 239e794 f3 f2 239e866 fe 66 f0 10 f8 f4 21 01 2c f4 24b2ca8 f3 f2 24b2d81 fe 66 f0 10 f8 f4 2c 01 0b f4 25c71bc f3 f2 25c72f0 fe 66 f0 10 f8 f4 0b 01 16 f4 26db6d0 f3 f2 26db738 fe 66 f0 10 f8 f4 16 01 21 f4 27efbe4 f3 f2 27efcfc fe 66 f0 10 f8 f4 21 01 2c f4 29040f8 f3 f2 29041f1 fe 66 f0 10 f8 f4 2c 01 0b f4 2a1860c f3 f2 2a186e7 fe 66 f0 10 f8 f4 0b 01 16 f4 2b2cb20 f3 f2 2b2cbe3 fe 66 f0 10 f8 f4 16 01 21 f4 2c41034 f3 f2 2c4105d fe 66 f0 10 f8 f4 21 01 2c f4 2d55548 f3 f2 2d55595 fe 66 f0 10 f8 f4 2c 01 0b f4 2e69a5c f3 f2 2e69a7b fe èµ·åˆæˆ‘æ˜¯æå–å‡ºçš„byteç±»å‹çš„opcodeï¼Œå­¦ç€åˆ«çš„å¸ˆå‚…åšå¾—çˆ†ç ´ï¼Œè¿™é‡Œé™„ä¸€ä»½å¸¦æ³¨é‡Šçš„çˆ†ç ´ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 #define _CRT_SECURE_NO_WARNINGS 0 #include \u0026lt;iostream\u0026gt; #include \u0026lt;stack\u0026gt; using namespace std; // å®šä¹‰æŒ‡ä»¤åˆ—è¡¨ï¼Œå­˜å‚¨è™šæ‹Ÿæœºçš„æŒ‡ä»¤ //unsigned char intr_list[] = { 246, 0, 0, 0, 108, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, ... }; unsigned char intr_list[] = { 246, 0, 0, 0, 108, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 71, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 13, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 5, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 19, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 10, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 2, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 1, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 74, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 21, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 18, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 19, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 8, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 15, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 11, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 14, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 18, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 0, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 2, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 21, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 21, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 22, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 2, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 7, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 14, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 4, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 10, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 10, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 15, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 17, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 19, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 31, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 74, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 31, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 10, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 18, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 5, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 5, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 8, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 15, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 1, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 7, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 10, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 0, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 14, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 18, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 20, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 3, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 17, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 21, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 8, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 7, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 19, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 9, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 31, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 70, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 0, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 246, 0, 0, 0, 47, 0, 0, 0, 246, 0, 0, 0, 102, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 247, 0, 0, 0, 248, 0, 0, 0, 243, 0, 0, 0, 17, 0, 0, 0, 16, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 247, 0, 0, 0, 244, 0, 0, 0, 77, 105, 78, 105, 1, 0, 0, 0, 76, 45, 99, 116, 244, 0, 0, 0, 0, 0, 0, 0, 243, 0, 0, 0, 242, 0, 0, 0, 15, 68, 45, 29, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 20, 69, 17, 0, 243, 0, 0, 0, 242, 0, 0, 0, 80, 114, 116, 116, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 40, 138, 34, 0, 243, 0, 0, 0, 242, 0, 0, 0, 77, 138, 34, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 60, 207, 51, 0, 243, 0, 0, 0, 242, 0, 0, 0, 170, 207, 51, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 80, 20, 69, 0, 243, 0, 0, 0, 242, 0, 0, 0, 203, 20, 69, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 100, 89, 86, 0, 243, 0, 0, 0, 242, 0, 0, 0, 102, 89, 86, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 120, 158, 103, 0, 243, 0, 0, 0, 242, 0, 0, 0, 188, 159, 103, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 140, 227, 120, 0, 243, 0, 0, 0, 242, 0, 0, 0, 204, 228, 120, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 160, 40, 138, 0, 243, 0, 0, 0, 242, 0, 0, 0, 73, 41, 138, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 180, 109, 155, 0, 243, 0, 0, 0, 242, 0, 0, 0, 200, 110, 155, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 200, 178, 172, 0, 243, 0, 0, 0, 242, 0, 0, 0, 224, 179, 172, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 220, 247, 189, 0, 243, 0, 0, 0, 242, 0, 0, 0, 246, 248, 189, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 240, 60, 207, 0, 243, 0, 0, 0, 242, 0, 0, 0, 34, 61, 207, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 4, 130, 224, 0, 243, 0, 0, 0, 242, 0, 0, 0, 235, 130, 224, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 24, 199, 241, 0, 243, 0, 0, 0, 242, 0, 0, 0, 69, 199, 241, 0, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 44, 12, 3, 1, 243, 0, 0, 0, 242, 0, 0, 0, 156, 12, 3, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 64, 81, 20, 1, 243, 0, 0, 0, 242, 0, 0, 0, 142, 81, 20, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 84, 150, 37, 1, 243, 0, 0, 0, 242, 0, 0, 0, 52, 150, 37, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 104, 219, 54, 1, 243, 0, 0, 0, 242, 0, 0, 0, 156, 220, 54, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 124, 32, 72, 1, 243, 0, 0, 0, 242, 0, 0, 0, 125, 33, 72, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 144, 101, 89, 1, 243, 0, 0, 0, 242, 0, 0, 0, 174, 101, 89, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 164, 170, 106, 1, 243, 0, 0, 0, 242, 0, 0, 0, 184, 171, 106, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 184, 239, 123, 1, 243, 0, 0, 0, 242, 0, 0, 0, 47, 240, 123, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 204, 52, 141, 1, 243, 0, 0, 0, 242, 0, 0, 0, 42, 53, 141, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 224, 121, 158, 1, 243, 0, 0, 0, 242, 0, 0, 0, 231, 122, 158, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 244, 190, 175, 1, 243, 0, 0, 0, 242, 0, 0, 0, 25, 191, 175, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 8, 4, 193, 1, 243, 0, 0, 0, 242, 0, 0, 0, 60, 4, 193, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 28, 73, 210, 1, 243, 0, 0, 0, 242, 0, 0, 0, 164, 73, 210, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 48, 142, 227, 1, 243, 0, 0, 0, 242, 0, 0, 0, 62, 142, 227, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 68, 211, 244, 1, 243, 0, 0, 0, 242, 0, 0, 0, 176, 211, 244, 1, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 88, 24, 6, 2, 243, 0, 0, 0, 242, 0, 0, 0, 83, 24, 6, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 108, 93, 23, 2, 243, 0, 0, 0, 242, 0, 0, 0, 118, 94, 23, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 128, 162, 40, 2, 243, 0, 0, 0, 242, 0, 0, 0, 65, 162, 40, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 148, 231, 57, 2, 243, 0, 0, 0, 242, 0, 0, 0, 102, 232, 57, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 168, 44, 75, 2, 243, 0, 0, 0, 242, 0, 0, 0, 129, 45, 75, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 188, 113, 92, 2, 243, 0, 0, 0, 242, 0, 0, 0, 240, 114, 92, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 208, 182, 109, 2, 243, 0, 0, 0, 242, 0, 0, 0, 56, 183, 109, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 228, 251, 126, 2, 243, 0, 0, 0, 242, 0, 0, 0, 252, 252, 126, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 248, 64, 144, 2, 243, 0, 0, 0, 242, 0, 0, 0, 241, 65, 144, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 12, 134, 161, 2, 243, 0, 0, 0, 242, 0, 0, 0, 231, 134, 161, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 11, 0, 0, 0, 1, 0, 0, 0, 22, 0, 0, 0, 244, 0, 0, 0, 32, 203, 178, 2, 243, 0, 0, 0, 242, 0, 0, 0, 227, 203, 178, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 22, 0, 0, 0, 1, 0, 0, 0, 33, 0, 0, 0, 244, 0, 0, 0, 52, 16, 196, 2, 243, 0, 0, 0, 242, 0, 0, 0, 93, 16, 196, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 33, 0, 0, 0, 1, 0, 0, 0, 44, 0, 0, 0, 244, 0, 0, 0, 72, 85, 213, 2, 243, 0, 0, 0, 242, 0, 0, 0, 149, 85, 213, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, 0, 0, 0, 16, 0, 0, 0, 248, 0, 0, 0, 244, 0, 0, 0, 44, 0, 0, 0, 1, 0, 0, 0, 11, 0, 0, 0, 244, 0, 0, 0, 92, 154, 230, 2, 243, 0, 0, 0, 242, 0, 0, 0, 123, 154, 230, 2, 254, 0, 0, 0, 102, 0, 0, 0, 240, }; // å®šä¹‰ç­”æ¡ˆæ•°ç»„ï¼Œå­˜å‚¨å¯èƒ½çš„è¾“å…¥å€¼ unsigned char ans[0x1000]; // å½“å‰ç­”æ¡ˆæ•°ç»„çš„ç´¢å¼• int ans_i; // æŒ‡ä»¤åˆ—è¡¨çš„èµ·å§‹ç´¢å¼•ï¼Œ0xb40 / 4 æ˜¯å°†åœ°å€ 0xb40 è½¬æ¢ä¸ºæŒ‡ä»¤ç´¢å¼• int idx = 0xb40 / 4; // å®šä¹‰ä¸€ä¸ªæ ˆï¼Œç”¨äºå­˜å‚¨ä¸­é—´å€¼ stack\u0026lt;int\u0026gt; s; // æ£€æŸ¥å½“å‰ç­”æ¡ˆæ•°ç»„æ˜¯å¦æ»¡è¶³è™šæ‹Ÿæœºçš„æŒ‡ä»¤é€»è¾‘ int check() { unsigned char tmp; // å½“å‰æŒ‡ä»¤ç´¢å¼• int now_idx = idx; // å½“å‰ç­”æ¡ˆæ•°ç»„çš„ç´¢å¼• int now_ans_i = 0; // å°†æŒ‡ä»¤åˆ—è¡¨è½¬æ¢ä¸º int ç±»å‹çš„æŒ‡é’ˆï¼Œæ–¹ä¾¿è®¿é—® int* intr_list_i = (int*)intr_list; // å®šä¹‰ä¸€äº›å˜é‡ï¼Œç”¨äºå­˜å‚¨ä¸­é—´å€¼ int p1 = 0, p2 = 0, p3 = 0, p4 = 0; // æ ‡å¿—ä½ï¼Œç”¨äºæ§åˆ¶æ¡ä»¶è·³è½¬ int flag = 0; // æ¸…ç©ºæ ˆ while (!s.empty()) s.pop(); // éå†æŒ‡ä»¤åˆ—è¡¨ï¼Œç›´åˆ°é‡åˆ°ç»ˆæ­¢æŒ‡ä»¤ï¼ˆå€¼ä¸º 0ï¼‰ while (intr_list_i[now_idx] != 0) { // æ ¹æ®æŒ‡ä»¤ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œ switch (intr_list_i[now_idx]) { case 1: // å°† p2 çš„å€¼åŠ ä¸ŠæŒ‡ä»¤ä¸­çš„å€¼ p2 += intr_list_i[now_idx + 1]; // è·³è¿‡æŒ‡ä»¤ä¸­çš„å€¼ now_idx += 2; break; case 16: // ä»ç­”æ¡ˆæ•°ç»„ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦å¹¶å‹å…¥æ ˆ tmp = ans[now_ans_i++]; s.push(tmp); now_idx += 1; break; case 17: // æ‰“å° p1 çš„å€¼ printf(\u0026#34;%c\u0026#34;, p1); now_idx += 1; break; case 240: // å°† p2 çš„å€¼èµ‹ç»™ p1 p1 = p2; now_idx += 1; break; case 241: // å°† p2 çš„å€¼èµ‹ç»™ p4 p4 = p2; now_idx += 1; break; case 242: // æ¯”è¾ƒ p1 å’ŒæŒ‡ä»¤ä¸­çš„å€¼ if (p1 == intr_list_i[now_idx + 1]) { flag = 1; // å¦‚æœç›¸ç­‰ï¼Œè®¾ç½®æ ‡å¿—ä½ if (now_ans_i == ans_i) // å¦‚æœç­”æ¡ˆæ•°ç»„å·²å…¨éƒ¨å¤„ç† return 1; // è¿”å› 1ï¼Œè¡¨ç¤ºéªŒè¯é€šè¿‡ } else { flag = 0; // å¦‚æœä¸ç›¸ç­‰ï¼Œæ¸…é™¤æ ‡å¿—ä½ } now_idx += 2; break; case 243: // å°† p1 å’Œ p2 è¿›è¡Œå¼‚æˆ–æ“ä½œ p1 ^= p2; now_idx += 1; break; case 244: // å°† p1 çš„å€¼åŠ ä¸ŠæŒ‡ä»¤ä¸­çš„å€¼ p1 += intr_list_i[now_idx + 1]; now_idx += 2; break; case 245: // ä»æŒ‡ä»¤ä¸­è¯»å–ä¸¤ä¸ªå€¼ï¼Œè¿›è¡Œå‡æ³•æ“ä½œ intr_list_i[now_idx + 1] -= intr_list_i[now_idx + 2]; now_idx += 3; break; case 246: // å°†æŒ‡ä»¤ä¸­çš„å€¼å‹å…¥æ ˆ s.push(intr_list_i[now_idx + 1]); now_idx += 2; break; case 247: // ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼èµ‹ç»™ p1 p1 = s.top(); s.pop(); now_idx += 1; break; case 248: // ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼èµ‹ç»™ p2 p2 = s.top(); s.pop(); now_idx += 1; break; case 249: // ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼èµ‹ç»™ p3 p3 = s.top(); s.pop(); now_idx += 1; break; case 250: // ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼èµ‹ç»™ p4 p4 = s.top(); s.pop(); now_idx += 1; break; case 254: // å¦‚æœæ ‡å¿—ä½ä¸º 0ï¼Œè¿”å› 0ï¼Œè¡¨ç¤ºéªŒè¯å¤±è´¥ if (flag == 0) { return 0; } now_idx += 2; break; case 255: // æ¡ä»¶è·³è½¬ï¼Œå¦‚æœæ ‡å¿—ä½ä¸º 1ï¼Œåˆ™è·³è¿‡æŒ‡ä»¤ä¸­çš„å€¼ if (flag) now_idx += intr_list_i[now_idx + 1]; now_idx += 2; break; default: break; } } return 1; // å¦‚æœæ‰€æœ‰æŒ‡ä»¤éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å› 1ï¼Œè¡¨ç¤ºéªŒè¯é€šè¿‡ } // æ·±åº¦ä¼˜å…ˆæœç´¢å‡½æ•°ï¼Œç”¨äºç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„è¾“å…¥å€¼ int dfs() { ans_i++; // å¢åŠ ç­”æ¡ˆæ•°ç»„çš„ç´¢å¼• for (unsigned char ch = 0; ch \u0026lt;= 0x7f; ch++) { // éå†æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦å€¼ ans[ans_i - 1] = ch; // å°†å½“å‰å­—ç¬¦å€¼èµ‹ç»™ç­”æ¡ˆæ•°ç»„ if (check()) { // è°ƒç”¨ check å‡½æ•°éªŒè¯å½“å‰ç­”æ¡ˆæ•°ç»„æ˜¯å¦æ»¡è¶³æ¡ä»¶ if (ans_i == 45 || dfs()) // å¦‚æœç­”æ¡ˆæ•°ç»„é•¿åº¦è¾¾åˆ° 45 æˆ–é€’å½’è°ƒç”¨ dfs è¿”å› 1 return 1; // è¿”å› 1ï¼Œè¡¨ç¤ºæ‰¾åˆ°è§£ } } ans_i--; // å›æº¯ï¼Œå‡å°‘ç­”æ¡ˆæ•°ç»„çš„ç´¢å¼• return 0; // è¿”å› 0ï¼Œè¡¨ç¤ºå½“å‰è·¯å¾„æ— æ³•æ‰¾åˆ°è§£ } // æ·±åº¦ä¼˜å…ˆæœç´¢çš„åˆå§‹åŒ–å‡½æ•° void dfs_init() { ans_i = 2; // åˆå§‹åŒ–ç­”æ¡ˆæ•°ç»„çš„ç´¢å¼•ä¸º 2 for (unsigned char ch1 = 0; ch1 \u0026lt;= 0x7f; ch1++) { // éå† ans[0] çš„æ‰€æœ‰å¯èƒ½å€¼ for (unsigned char ch2 = 0; ch2 \u0026lt;= 0x7f; ch2++) { // éå† ans[1] çš„æ‰€æœ‰å¯èƒ½å€¼ ans[0] = ch1; // å°†å½“å‰å€¼èµ‹ç»™ ans[0] ans[1] = ch2; // å°†å½“å‰å€¼èµ‹ç»™ ans[1] if (check() \u0026amp;\u0026amp; dfs()) { // è°ƒç”¨ check å‡½æ•°éªŒè¯å½“å‰ç­”æ¡ˆæ•°ç»„æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œå¹¶é€’å½’è°ƒç”¨ dfs cout \u0026lt;\u0026lt; ans \u0026lt;\u0026lt; endl; // å¦‚æœæ‰¾åˆ°è§£ï¼Œæ‰“å°ç­”æ¡ˆæ•°ç»„ return; // é€€å‡ºå‡½æ•° } } } } // ä¸»å‡½æ•° int main() { setbuf(stdout, 0); // ç¦ç”¨è¾“å‡ºç¼“å†² dfs_init(); // è°ƒç”¨åˆå§‹åŒ–å‡½æ•°å¯åŠ¨æ·±åº¦ä¼˜å…ˆæœç´¢ return 0; } è¿™ä»½ä»£ç ç”¨çš„dfsçˆ†ç ´çš„ï¼Œæœ‰çš„å¸ˆå‚…ç”¨çš„z3ä¹Ÿæ˜¯å¯ä»¥çˆ†ç ´å‡ºæ¥çš„ ç„¶åå°±æ˜¯ä¸€ä»½äº†è§£äº†ä¸»è¦é€»è¾‘åï¼Œç”¨çš„dwordçš„opcodeå†™çš„ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 raw_data = [ 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x114514,0xf3,0xf2,0x74747250,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x228a28,0xf3,0xf2,0x228a4d,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x33cf3c,0xf3,0xf2,0x33cfaa,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x451450,0xf3,0xf2,0x4514cb,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x565964,0xf3,0xf2,0x565966,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x679e78,0xf3,0xf2,0x679fbc,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x78e38c,0xf3,0xf2,0x78e4cc,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x8a28a0,0xf3,0xf2,0x8a2949,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x9b6db4,0xf3,0xf2,0x9b6ec8,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0xacb2c8,0xf3,0xf2,0xacb3e0,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0xbdf7dc,0xf3,0xf2,0xbdf8f6,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0xcf3cf0,0xf3,0xf2,0xcf3d22,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0xe08204,0xf3,0xf2,0xe082eb,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0xf1c718,0xf3,0xf2,0xf1c745,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x1030c2c,0xf3,0xf2,0x1030c9c,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x1145140,0xf3,0xf2,0x114518e,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x1259654,0xf3,0xf2,0x1259634,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x136db68,0xf3,0xf2,0x136dc9c,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x148207c,0xf3,0xf2,0x148217d,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x1596590,0xf3,0xf2,0x15965ae,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x16aaaa4,0xf3,0xf2,0x16aabb8,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x17befb8,0xf3,0xf2,0x17bf02f,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x18d34cc,0xf3,0xf2,0x18d352a,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x19e79e0,0xf3,0xf2,0x19e7ae7,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x1afbef4,0xf3,0xf2,0x1afbf19,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x1c10408,0xf3,0xf2,0x1c1043c,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x1d2491c,0xf3,0xf2,0x1d249a4,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x1e38e30,0xf3,0xf2,0x1e38e3e,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x1f4d344,0xf3,0xf2,0x1f4d3b0,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x2061858,0xf3,0xf2,0x2061853,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x2175d6c,0xf3,0xf2,0x2175e76,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x228a280,0xf3,0xf2,0x228a241,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x239e794,0xf3,0xf2,0x239e866,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x24b2ca8,0xf3,0xf2,0x24b2d81,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x25c71bc,0xf3,0xf2,0x25c72f0,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x26db6d0,0xf3,0xf2,0x26db738,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x27efbe4,0xf3,0xf2,0x27efcfc,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x29040f8,0xf3,0xf2,0x29041f1,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x2a1860c,0xf3,0xf2,0x2a186e7,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x0b,0x01,0x16,0xf4,0x2b2cb20,0xf3,0xf2,0x2b2cbe3,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x16,0x01,0x21,0xf4,0x2c41034,0xf3,0xf2,0x2c4105d,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x21,0x01,0x2c,0xf4,0x2d55548,0xf3,0xf2,0x2d55595,0xfe, 0x66,0xf0,0x10,0xf8,0xf4,0x2c,0x01,0x0b,0xf4,0x2e69a5c,0xf3,0xf2,0x2e69a7b,0xfe ] list_f4 = [] list_01 = [] list_ans = [] for i in range(len(raw_data) - 1): # é¿å…ç´¢å¼•è¶Šç•Œ if raw_data[i] == 0xf4: list_f4.append(raw_data[i + 1]) if raw_data[i] == 0x01: list_01.append(raw_data[i + 1]) if raw_data[i] == 0xf2: list_ans.append(raw_data[i + 1]) #print([hex(x) for x in list_f4]) #print([hex(x) for x in list_01]) #rint(len(list_ans) - 1) #print(len(list_f4) - 1) #print(len(list_01) - 1) list =\u0026#34;\u0026#34; len = len(list_ans) - 1#42 #print(len) a=125 for i in range(len): a=(list_ans[len]^(a+list_01[len]))-list_f4[len*2]-list_f4[len*2+1]-list_f4[len*2] list+=chr(a) len-=1 flag=list[::-1] print(\u0026#34;mi\u0026#34;+flag+\u0026#34;}\u0026#34;,end=\u0026#34; \u0026#34;) #ä¸‹é¢ä¹Ÿæ˜¯çˆ†ç ´ï¼Œä¹Ÿæ˜¯å¯ä»¥å‚è€ƒçš„ä¸€ä»½æ€è·¯ \u0026#39;\u0026#39;\u0026#39; flag = \u0026#34;mi\u0026#34; ll = 0x74632DB5 for i in range(43): succeed = False for c in range(0,256): aa = c temp_ll = ll + list_f4[i*2] + list_f4[i*2+1] aa += list_01[i] if aa ^ temp_ll == list_ans[i]: ll = aa flag += chr(c) print(i,flag) succeed = True break if not succeed: print(\u0026#34;err\u0026#34;,i) \u0026#39;\u0026#39;\u0026#39; s1gn1n åœ¨å­—ç¬¦ä¸²åˆ—è¡¨çœ‹åˆ°ä¸€ä¸ªbase64çš„å­—ç¬¦ä¸²ï¼Œäº¤å‰å¼•ç”¨å°±èƒ½åˆ°ä¸»è¦åŠ å¯†å‡½æ•°ï¼Œå¤§æ¦‚çš„é€»è¾‘å°±æ˜¯è¾“å‡ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†å®ƒé“¾è¡¨åŒ–ï¼Œä¸­åºéå†ï¼Œç„¶åå°†ä¸­åºéå†çš„ç»“æœè¿›è¡Œbase64ç¼–ç ï¼Œç„¶åæœ‰ä¸ªå¼‚æˆ–ï¼Œæœ€åå°±æ˜¯æ±‚å’Œåˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸ºé›¶ï¼Œä¸ºé›¶å°±æ­£ç¡®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 import base64 from typing import Optional, List, Dict def get_left_count(n: int) -\u0026gt; int: \u0026#34;\u0026#34;\u0026#34;ç²¾ç¡®è®¡ç®—å®Œå…¨äºŒå‰æ ‘å·¦å­æ ‘èŠ‚ç‚¹æ•°\u0026#34;\u0026#34;\u0026#34; if n \u0026lt;= 0: return 0 h = 1 while (2 ** (h) - 1) \u0026lt; n: # ä¿®æ­£é«˜åº¦è®¡ç®—é€»è¾‘ h += 1 h -= 1 # å®é™…é«˜åº¦ last_level = n - (2 ** h - 1) left_max = 2 ** (h - 1) if h \u0026gt;= 1 else 0 left_actual = min(last_level, left_max) total = (2 ** (h) - 1) // 2 + left_actual #print(f\u0026#34;get_left_count(n={n}) h={h}, last_level={last_level}, left_max={left_max}, left_actual={left_actual}, return {total}\u0026#34;) return total def build_level_map(in_order: str, start: int, end: int, level_pos: int, level_map: Dict[int, str], depth=0): if start \u0026gt; end: #print(f\u0026#34; {\u0026#39; \u0026#39;*depth}start={start} \u0026gt; end={end}, return\u0026#34;) return n = end - start + 1 left_size = get_left_count(n) root_pos = start + left_size # print(f\u0026#34;{\u0026#39; \u0026#39;*depth}build_level_map: start={start}, end={end}, n={n}, left_size={left_size}, root_pos={root_pos}, level_pos={level_pos}\u0026#34;) # è¾¹ç•Œæ£€æŸ¥ if root_pos \u0026lt; start or root_pos \u0026gt; end: #print(f\u0026#34; {\u0026#39; \u0026#39;*depth}Invalid root_pos={root_pos}, start={start}, end={end}\u0026#34;) return level_map[level_pos] = in_order[root_pos] # print(f\u0026#34; {\u0026#39; \u0026#39;*depth}Mapped level_pos={level_pos} -\u0026gt; char \u0026#39;{in_order[root_pos]}\u0026#39;\u0026#34;) # é€’å½’å·¦å­æ ‘ build_level_map(in_order, start, root_pos-1, 2*level_pos+1, level_map, depth+1) # é€’å½’å³å­æ ‘ build_level_map(in_order, root_pos+1, end, 2*level_pos+2, level_map, depth+1) def in_order_to_level_order(in_order_str: str) -\u0026gt; str: level_map: Dict[int, str] = {} build_level_map(in_order_str, 0, len(in_order_str)-1, 0, level_map) #print(\u0026#34;\\nå±‚åºæ˜ å°„è¡¨:\u0026#34;, level_map) if not level_map: return \u0026#39;\u0026#39; max_index = max(level_map.keys()) level_order = [] for i in range(max_index + 1): level_order.append(level_map.get(i, \u0026#39;\u0026#39;)) # åˆ é™¤æœ«å°¾çš„ç©ºå­—ç¬¦ä¸² while level_order and level_order[-1] == \u0026#39;\u0026#39;: level_order.pop() return \u0026#39;\u0026#39;.join(level_order) class Node: def __init__(self, value: str): self.value = value self.left: Optional[Node] = None self.right: Optional[Node] = None def build_tree_from_level_order(level_order: List[str]) -\u0026gt; Optional[Node]: if not level_order: return None root = Node(level_order[0]) queue = [root] i = 1 while queue and i \u0026lt; len(level_order): current = queue.pop(0) # å¤„ç†å·¦å­èŠ‚ç‚¹ if i \u0026lt; len(level_order) and level_order[i]: current.left = Node(level_order[i]) queue.append(current.left) i += 1 # å¤„ç†å³å­èŠ‚ç‚¹ if i \u0026lt; len(level_order) and level_order[i]: current.right = Node(level_order[i]) queue.append(current.right) i += 1 return root def in_order_traversal(root: Optional[Node], result: List[str]): if root: in_order_traversal(root.left, result) result.append(root.value) in_order_traversal(root.right, result) XOR_DATA = [ 0x58, 0x69, 0x7B, 0x06, 0x1E, 0x38, 0x2C, 0x20, 0x04, 0x0F, 0x01, 0x07, 0x31, 0x6B, 0x08, 0x0E, 0x7A, 0x0A, 0x72, 0x72, 0x26, 0x37, 0x6F, 0x49, 0x21, 0x16, 0x11, 0x2F, 0x1A, 0x0D, 0x3C, 0x1F, 0x2B, 0x32, 0x1A, 0x34, 0x37, 0x7F, 0x03, 0x44, 0x16, 0x0E, 0x01, 0x28, 0x1E, 0x68, 0x64, 0x23, 0x17, 0x09, 0x3D, 0x64, 0x6A, 0x69, 0x63, 0x18, 0x18, 0x0A, 0x15, 0x70 ] char_list = [] char_list.append(chr(XOR_DATA[0])) for j in range(1, len(XOR_DATA)): XOR_DATA[j]=XOR_DATA[j] ^ XOR_DATA[j - 1] char_list.append(chr(XOR_DATA[j] )) result = \u0026#39;\u0026#39;.join(char_list) #X1JLRjFfbmlkZ197MG5GaV9pQGVycnRMfTNzM21ucmlDZ2VubkV2X1RJRXM= #print(result) dec = base64.b64decode(result) #print(dec) #b\u0026#39;_RKF1_nidg_{0nFi_i@errtL}3s3mnriCgennEv_TIEs\u0026#39; dec =\u0026#34;_RKF1_nidg_{0nFi_i@errtL}3s3mnriCgennEv_TIEs\u0026#34; a1 = in_order_to_level_order(dec) print(a1) #miniLCTF{esrevER_gnir33nignE_Is_K1nd_0F_@rt} ","date":"2025-05-22T21:08:17+08:00","image":"https://s.panlai.com/zb_users/upload/2025/05/20250517050947174742978738940.jpg-arthumbs","permalink":"https://fanshanng.cn/p/minil/","title":"MiniL"},{"content":"fridaåŸºç¡€çŸ¥è¯† åŸºç¡€å‘½ä»¤ 1.frida-ps -U æŸ¥çœ‹å½“å‰æ‰‹æœºè¿è¡Œçš„è¿›ç¨‹ 2.frida-ps --help æŸ¥çœ‹helpæŒ‡ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 frida-ps --help ä½¿ç”¨æ–¹å¼: frida-ps [é€‰é¡¹] é€‰é¡¹: -h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡º -D ID, --device ID è¿æ¥åˆ°å…·æœ‰ç»™å®šIDçš„è®¾å¤‡ -U, --usb è¿æ¥åˆ°USBè®¾å¤‡ -R, --remote è¿æ¥åˆ°è¿œç¨‹frida-server -H HOST, --host HOST è¿æ¥åˆ°HOSTä¸Šçš„è¿œç¨‹frida-server --certificate CERTIFICATE ä¸HOSTè¿›è¡ŒTLSé€šä¿¡ï¼ŒæœŸæœ›çš„CERTIFICATE --origin ORIGIN è¿æ¥åˆ°è®¾ç½®äº†\u0026#34;Origin\u0026#34;å¤´ä¸ºORIGINçš„è¿œç¨‹æœåŠ¡å™¨ --token TOKEN ä½¿ç”¨TOKENéªŒè¯HOST --keepalive-interval INTERVAL è®¾ç½®å¿ƒè·³åŒ…é—´éš”(ç§’)ï¼Œæˆ–è®¾ç½®ä¸º0ä»¥ç¦ç”¨(é»˜è®¤ä¸º-1ï¼Œæ ¹æ®ä¼ è¾“æ–¹å¼è‡ªåŠ¨é€‰æ‹©) --p2p ä¸ç›®æ ‡å»ºç«‹ç‚¹å¯¹ç‚¹è¿æ¥ --stun-server ADDRESS è®¾ç½®ä¸--p2pä¸€èµ·ä½¿ç”¨çš„STUNæœåŠ¡å™¨åœ°å€ --relay address,username,password,turn-{udp,tcp,tls} æ·»åŠ ä¸--p2pä¸€èµ·ä½¿ç”¨çš„ä¸­ç»§ -O FILE, --options-file FILE åŒ…å«é¢å¤–å‘½ä»¤è¡Œé€‰é¡¹çš„æ–‡æœ¬æ–‡ä»¶ --version æ˜¾ç¤ºç¨‹åºç‰ˆæœ¬å·å¹¶é€€å‡º -a, --applications åªåˆ—å‡ºåº”ç”¨ç¨‹åº -i, --installed åŒ…æ‹¬æ‰€æœ‰å·²å®‰è£…çš„åº”ç”¨ç¨‹åº -j, --json ä»¥JSONæ ¼å¼è¾“å‡ºç»“æœ æ“ä½œæ¨¡å¼ CLIæ¨¡å¼ï¼šé€šè¿‡å‘½ä»¤è¡Œç›´æ¥å°†JavaScriptè„šæœ¬æ³¨å…¥è¿›ç¨‹ä¸­ã€‚ RPCæ¨¡å¼ï¼šä½¿ç”¨Pythonè¿›è¡ŒJavaScriptè„šæœ¬çš„æ³¨å…¥ï¼Œé€‚åˆå¤æ‚æ•°æ®å¤„ç†ã€‚ 4.æ³¨å…¥æ¨¡å¼ä¸å¯åŠ¨å‘½ä»¤\nSpawnæ¨¡å¼ å°†å¯åŠ¨Appçš„æƒåˆ©äº¤ç”±Fridaæ¥æ§åˆ¶ï¼Œå³ä½¿ç›®æ ‡Appå·²ç»å¯åŠ¨ï¼Œåœ¨ä½¿ç”¨Fridaæ³¨å…¥ç¨‹åºæ—¶è¿˜æ˜¯ä¼šé‡æ–°å¯åŠ¨App\nå½“éœ€è¦ç›‘æ§Appä»å¯åŠ¨å¼€å§‹çš„æ‰€æœ‰è¡Œä¸ºæ—¶ä½¿ç”¨ frida -U -f è¿›ç¨‹å -l hook.js è¿›ç¨‹åå¯ä»¥é€šè¿‡frida-ps -Uæ¥æŸ¥çœ‹\nAttachæ¨¡å¼ åœ¨ç›®æ ‡Appå·²ç»å¯åŠ¨çš„æƒ…å†µä¸‹ï¼ŒFridaé€šè¿‡ptraceæ³¨å…¥ç¨‹åºä»è€Œæ‰§è¡ŒHookçš„æ“ä½œ\nfrida -U è¿›ç¨‹å -l hook.js åœ¨Appå·²ç»å¯åŠ¨ï¼Œæˆ–è€…æˆ‘ä»¬åªå…³å¿ƒç‰¹å®šæ—¶åˆ»æˆ–ç‰¹å®šåŠŸèƒ½çš„è¡Œä¸ºæ—¶ä½¿ç”¨\n5.åŸºç¡€è¯­æ³• Java.use(className)ï¼šè·å–æŒ‡å®šçš„Javaç±»å¹¶ä½¿å…¶åœ¨JavaScriptä»£ç ä¸­å¯ç”¨ã€‚ Java.perform(callback)ï¼šç¡®ä¿å›è°ƒå‡½æ•°åœ¨Javaçš„ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ Java.choose(className, callbacks)ï¼šæšä¸¾æŒ‡å®šç±»çš„æ‰€æœ‰å®ä¾‹ã€‚ Java.cast(obj, cls)ï¼šå°†ä¸€ä¸ªJavaå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªJavaç±»çš„å®ä¾‹ã€‚\n6.æ—¥å¿—è¾“å‡º console.log()ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œè¾“å‡ºæ—¥å¿—ã€‚ send()ï¼šå°†æ—¥å¿—å‘é€åˆ°å¤–éƒ¨Pythonè„šæœ¬è¿›è¡Œå¤„ç†ã€‚\næ—¥å¿—æ•è· Dï¼šè¡¨ç¤ºçº§åˆ« \u0026ldquo;zj2595\u0026quot;è¿™ä¸ªæ˜¯æ ‡ç­¾\nFridaå¸¸ç”¨API 1. Hookæ™®é€šæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 //å®šä¹‰ä¸€ä¸ªåä¸ºhookTest1çš„å‡½æ•° function hookTest1(){ //è·å–ä¸€ä¸ªåä¸º\u0026#34;ç±»å\u0026#34;çš„Javaç±»ï¼Œå¹¶å°†å…¶å®ä¾‹èµ‹å€¼ç»™JavaScriptå˜é‡utils var utils = Java.use(\u0026#34;ç±»å\u0026#34;); //ä¿®æ”¹\u0026#34;ç±»å\u0026#34;çš„\u0026#34;method\u0026#34;æ–¹æ³•çš„å®ç°ã€‚è¿™ä¸ªæ–°çš„å®ç°ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆaå’Œbï¼‰ utils.method.implementation = function(a, b){ //å°†å‚æ•°aå’Œbçš„å€¼æ”¹ä¸º123å’Œ456ã€‚ a = 123; b = 456; //è°ƒç”¨ä¿®æ”¹è¿‡çš„\u0026#34;method\u0026#34;æ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼å­˜å‚¨åœ¨`retval`å˜é‡ä¸­ var retval = this.method(a, b); //åœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‚æ•°aï¼Œbçš„å€¼ä»¥åŠ\u0026#34;method\u0026#34;æ–¹æ³•çš„è¿”å›å€¼ console.log(a, b, retval); //è¿”å›\u0026#34;method\u0026#34;æ–¹æ³•çš„è¿”å›å€¼ return retval; } } 2. Hooké‡è½½å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 // .overload() // .overload(\u0026#39;è‡ªå®šä¹‰å‚æ•°\u0026#39;) // .overload(\u0026#39;int\u0026#39;) function hookTest2(){ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //overloadå®šä¹‰é‡è½½å‡½æ•°ï¼Œæ ¹æ®å‡½æ•°çš„å‚æ•°ç±»å‹å¡« utils.Inner.overload(\u0026#39;com.zj.wuaipojie.Demo$Animal\u0026#39;,\u0026#39;java.lang.String\u0026#39;).implementation = function(aï¼Œb){ b = \u0026#34;aaaaaaaaaa\u0026#34;; this.Inner(a,b); console.log(b); } } 3. Hookæ„é€ å‡½æ•° 1 2 3 4 5 6 7 8 9 function hookTest3(){ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //ä¿®æ”¹ç±»çš„æ„é€ å‡½æ•°çš„å®ç°ï¼Œ$initè¡¨ç¤ºæ„é€ å‡½æ•° utils.$init.overload(\u0026#39;java.lang.String\u0026#39;).implementation = function(str){ console.log(str); str = \u0026#34;52\u0026#34;; this.$init(str); } } 4. Hookå­—æ®µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 function hookTest5(){ Java.perform(function(){ //é™æ€å­—æ®µçš„ä¿®æ”¹ var utils = Java.use(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;); //ä¿®æ”¹ç±»çš„é™æ€å­—æ®µ\u0026#34;flag\u0026#34;çš„å€¼ utils.staticField.value = \u0026#34;æˆ‘æ˜¯è¢«ä¿®æ”¹çš„é™æ€å˜é‡\u0026#34;; console.log(utils.staticField.value); //éé™æ€å­—æ®µçš„ä¿®æ”¹ //ä½¿ç”¨`Java.choose()`æšä¸¾ç±»çš„æ‰€æœ‰å®ä¾‹ Java.choose(\u0026#34;com.zj.wuaipojie.Demo\u0026#34;, { onMatch: function(obj){ //ä¿®æ”¹å®ä¾‹çš„éé™æ€å­—æ®µ\u0026#34;_privateInt\u0026#34;çš„å€¼ä¸º\u0026#34;123456\u0026#34;ï¼Œå¹¶ä¿®æ”¹éé™æ€å­—æ®µ\u0026#34;privateInt\u0026#34;çš„å€¼ä¸º9999ã€‚ obj._privateInt.value = \u0026#34;123456\u0026#34;; //å­—æ®µåä¸å‡½æ•°åç›¸åŒ å‰é¢åŠ ä¸ªä¸‹åˆ’çº¿ obj.privateInt.value = 9999; }, onComplete: function(){ } }); }); } 5. æšä¸¾æ‰€æœ‰ç±»ä¸æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 function hookTest7() { Java.perform(function () { Java.enumerateLoadedClasses({ onMatch: function (name) { console.log(name); }, onComplete: function () {} }); }); } ","date":"2025-05-19T00:15:39+08:00","image":"https://raw.githubusercontent.com/fanshanng/blog_picture/master/3.png","permalink":"https://fanshanng.cn/p/fr1da/","title":"Frida"}]